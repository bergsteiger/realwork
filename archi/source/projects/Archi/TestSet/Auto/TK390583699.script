USES
	ArchiControls.script
	QuickTestsUtils.script
;

PROCEDURE "Копируем библиотеки-dll арчи"

	STRING VAR l_FullPath
	STRING VAR l_ShortPath
	STRING VAR l_SubDirForTest

	"Получить полный путь к исполняемому файлу" >>> l_FullPath
	"Извлечь путь из полного пути {(l_FullPath)}" >>> l_ShortPath
	"Сформировать путь к новому каталогу {(l_ShortPath)}" >>> l_SubDirForTest

	STRING VAR l_SourceDir 
	"Извлечь путь из полного пути {(l_FullPath)}" >>> l_SourceDir
 
	STRING VAR l_DestDir 
	"Сформировать путь к новому каталогу {(l_ShortPath)}"  >>> l_DestDir

	STRING VAR l_FileMask
	'*.dll' >>> l_FileMask
	l_FileMask l_DestDir l_SourceDir CopyFilesByMask
;

PROCEDURE "Запустить 'ArchiTest.exe'"
	STRING VAR l_FullPath
	STRING VAR l_ShortPath
	STRING VAR l_SubDirForTest
	"Получить полный путь к исполняемому файлу" >>> l_FullPath
	"Извлечь путь из полного пути {(l_FullPath)}" >>> l_ShortPath
	"Сформировать путь к новому каталогу {(l_ShortPath)}" >>> l_SubDirForTest
	STRING VAR l_SourceDir 
	"Извлечь путь из полного пути {(l_FullPath)}" >>> l_SourceDir
	STRING VAR l_DestDir 
	"Сформировать путь к новому каталогу {(l_ShortPath)}"  >>> l_DestDir 'ArchiTest.exe' sysutils:FileExists 'Не найден ArchiTest.exe' ASSERTS
 	STRING VAR l_File
 	STRING VAR l_TempFile
 	STRING VAR l_CMD 
 	script:FileName '' sysutils:ChangeFileExt
 	sysutils:ExtractFileName >>> l_File
 	l_File >>> l_TempFile 
 	l_TempFile '' + >>> l_TempFile
 	STRING VAR l_CMDLINE
	[ "Сформировать путь к новому каталогу {(l_ShortPath)}"  >>> l_DestDir 'ArchiTest.exe' ' TestSet\' l_TempFile ' TestSet\' l_File ' -a'] strings:Cat >>> l_CMDLINE
	l_CMDLINE WinExec
 	5000 SLEEP // Чтобы предыдущаяя программа могла спокойно выполниться !
	[ "Сформировать путь к новому каталогу {(l_ShortPath)}"  >>> l_DestDir ' TestSet\' l_TempFile ] strings:Cat >>> l_TempFile

;

Тест TK390583699
	Параметры: ( 
		"Не открывать документ" 
	)
	Выполнить ( 

		STRING VAR l_FullPath
		STRING VAR l_ShortPath
		STRING VAR l_SubDirForTest

		"Получить полный путь к исполняемому файлу" >>> l_FullPath
		"Извлечь путь из полного пути {(l_FullPath)}" >>> l_ShortPath
		"Сформировать путь к новому каталогу {(l_ShortPath)}" >>> l_SubDirForTest
		"Создать каталог, если он не существует {(l_SubDirForTest)}"
		"Очистить каталог {(l_SubDirForTest)}"

		"Копируем библиотеки-dll арчи"

		"Копировать в каталог для теста ArchiTest.ini {(l_FullPath)} {(l_ShortPath)} {(l_SubDirForTest)}"
		"Копировать в каталог для теста ArchiTest.exe {(l_FullPath)} {(l_ShortPath)} {(l_SubDirForTest)}"
		"Копировать в каталог для теста ArchiTest.map {(l_FullPath)} {(l_ShortPath)} {(l_SubDirForTest)}"

		"Запустить 'ArchiTest.exe'"
		
	)
;

TK390583699