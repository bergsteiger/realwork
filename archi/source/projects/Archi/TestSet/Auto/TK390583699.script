USES
	ArchiControls.script
	QuickTestsUtils.script
;

PROCEDURE "Создать каталог, если он не существует" STRING IN aNameDir 
	aNameDir sysutils:ForceDirectories ASSERT
;

PROCEDURE "Подготовка к копированию" STRING IN aDestDir
	"Создать каталог, если он не существует {(aDestDir)}"
	"Очистить каталог {(aDestDir)}"	
;

PROCEDURE "Создать временный каталог, если он не существует" STRING IN aArchiTestTmp
	aArchiTestTmp sysutils:ForceDirectories ASSERT
;

PROCEDURE "Подготовка к копированию в временный каталог" STRING IN aArchiTestTmp
	"Создать временный каталог, если он не существует {(aArchiTestTmp)}"
	"Очистить каталог {(aArchiTestTmp)}"
;

PROCEDURE "Копировать в каталог для теста dll" STRING IN aDestDir STRING IN aSourceDir
	 "Все dll" aDestDir aSourceDir CopyFilesByMask
;

PROCEDURE "Копировать из каталога в каталог для теста исполняемый файл" STRING IN aSourceDir STRING IN aDestDir STRING IN aFile 
	STRING VAR l_Archi_Path
	[ aSourceDir aFile ] strings:Cat >>> l_Archi_Path
	STRING VAR l_DestDirArchiTest
 	[ aDestDir '\' aFile ] strings:Cat >>> l_DestDirArchiTest
	"Не создавать копию перезаписываемого файла" l_DestDirArchiTest l_Archi_Path CopyFile
;

STRING FUNCTION "Путь к директории TestSet в CVS"
	'' test:ResolveInputFilePath >>> Result	
;

PROCEDURE "Копировать в каталог для теста файл" STRING IN aDestDir STRING IN aFile
	STRING VAR l_Archi_CVS_Path
	"Путь к директории TestSet в CVS" >>> l_Archi_CVS_Path
	[ l_Archi_CVS_Path 'CMD\' aFile ] strings:Cat >>> l_Archi_CVS_Path
	STRING VAR l_DestDirArchiTest
 	[ aDestDir '\' aFile ] strings:Cat >>> l_DestDirArchiTest
	"Не создавать копию перезаписываемого файла" l_DestDirArchiTest l_Archi_CVS_Path CopyFile
;

PROCEDURE "Копирование библиотек в временный каталог" STRING IN aArchiTestTmp STRING IN aSourceDir
	 "Все dll" aArchiTestTmp aSourceDir CopyFilesByMask
;

PROCEDURE "Копирование исполняемых файлов" STRING IN aDestDir STRING IN aSourceDir
	"Копировать в каталог {(aDestDir)} для теста файл {('ArchiTest.ini')}"
	"Копировать в каталог {(aDestDir)} для теста файл {('OneTest.txt')}"
	"Копировать из каталога {(aSourceDir)} в каталог {(aDestDir)} для теста исполняемый файл {('ArchiTest.exe')}"
	"Копировать из каталога {(aSourceDir)} в каталог {(aDestDir)} для теста исполняемый файл {('ArchiTest.map')}"
;

Тест TK390583699
	Параметры: ( 
		"Не открывать документ" 
	)
	Выполнить (
		STRING VAR l_SourceDir
           	"Путь Архивариуса" >>> l_SourceDir
          	STRING VAR l_DestDir 
           	"Путь к копии Архивариуса {(l_SourceDir)}" >>> l_DestDir
		STRING VAR l_ArchiTestTmp
 		[ l_DestDir '\' 'Tmp\' ] strings:Cat >>>  l_ArchiTestTmp
	TRY 
		"Подготовка к копированию {(l_DestDir)}"
		"Копирование исполняемых файлов {(l_DestDir)} {(l_SourceDir)}"
		"Подготовка к копированию в временный каталог {(l_ArchiTestTmp)}"
		"Копирование библиотек в временный каталог {(l_ArchiTestTmp)} {(l_SourceDir)}"
		"Копировать в каталог {(l_DestDir)} для теста dll {(l_ArchiTestTmp)}"
		"Распаковка тестовой базы"
		"Запуск второй копии тестового Архивариуса {(l_DestDir)}"
		"Сравнить с эталоном количество открытых окон Арчи"
	FINALLY
		"Очистить каталог {(l_DestDir)}"
                "Очистка после теста"
	END
	)
;

TK390583699