<?xml encoding = "ISO-8859-1"?>

<!--
	uses:
		ru.garant.extensions.scriptdefs.copyFile
-->

<scriptdef
	name = "ru.garant.extensions.scriptdefs.copyCppTarget"
	language = "javascript"
>
	<attribute name = "cpp.target.default.file"/>
	<attribute name = "cpp.target.release.file"/>
	<attribute name = "cpp.target.to.file"/>

	<![CDATA[
		{
			importClass (
				Packages.java.io.File
			);

			importPackage (
				Packages.org.apache.tools.ant
			);

			importPackage (
				Packages.org.apache.tools.ant.types
			);
		} {
			var a_cppTargetDefaultFile = (
				attributes.get ("cpp.target.default.file")
			);

			if (a_cppTargetDefaultFile != null) {
				var l_cppTargetDefaultFileFile = new File (a_cppTargetDefaultFile);
				var l_cppTargetDefaultFilePath = l_cppTargetDefaultFileFile.getPath ();

				a_cppTargetDefaultFile = l_cppTargetDefaultFilePath;
			}

			var a_cppTargetReleaseFile = (
				attributes.get ("cpp.target.release.file")
			);

			if (a_cppTargetReleaseFile != null) {
				var l_cppTargetReleaseFileFile = new File (a_cppTargetReleaseFile);
				var l_cppTargetReleaseFilePath = l_cppTargetReleaseFileFile.getPath ();

				a_cppTargetReleaseFile = l_cppTargetReleaseFilePath;
			}

			var a_cppTargetToFile = (
				attributes.get ("cpp.target.to.file")
			);

			if (a_cppTargetToFile != null) {
				var l_cppTargetToFileFile = new File (a_cppTargetToFile);
				var l_cppTargetToFilePath = l_cppTargetToFileFile.getPath ();

				a_cppTargetToFile = l_cppTargetToFilePath;
			}

			{
				var l_cppTargetActiveFile = (project.getProperty ("enable-cppFinalBuild") != null) ? (a_cppTargetReleaseFile) : (a_cppTargetDefaultFile);

				var l_copyFileTask = project.createTask ("ru.garant.extensions.scriptdefs.copyFile"); {
					var l_runtimeConfigurableWrapper = l_copyFileTask.getRuntimeConfigurableWrapper (); {
						var l_file = l_cppTargetActiveFile;
						var l_toFile = a_cppTargetToFile;

						l_runtimeConfigurableWrapper.setAttribute ("file", l_file);
						l_runtimeConfigurableWrapper.setAttribute ("to.file", l_toFile);
					}

					l_copyFileTask.reconfigure ();
				}

				l_copyFileTask.execute ();
			}
		}
	]]>
</scriptdef>
