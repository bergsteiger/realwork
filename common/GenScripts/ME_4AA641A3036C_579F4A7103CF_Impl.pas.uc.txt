//#UC START# *4AA641A3036C_579F4A7103CF_Impl_ext:ParentFileName
w:\garant6x\implementation\Garant\GbaNemesis\View\Search\Search_Module.pas
//#UC END# *4AA641A3036C_579F4A7103CF_Impl_ext:ParentFileName
//#UC START# *4AB77FFF008F_4AA641A3036C_impl*
 // Создание базового контейнера для КЗ
 l_Container := TCommonSearchService.Instance.MakeSaveLoadForm(vcmCheckAggregate(
                                            vcmMakeParams(nil,
                                                      CheckContainer(nil))),
                                           vcm_ztParent,
                                           True,
                                           Ord(slqtLegislationReview));

 // Создание карточки "Построение обзора законодательства"
 Result := TCommonSearchService.Instance.MakeQueryCardForm(false, // IsFilter
                                       vcmMakeParams(l_Container.Aggregate,
                                                 l_Container.AsContainer),
                                       vcm_ztParent,
                                       True,
                                       Ord(utqcLegislationReview));
 if (aQuery <> nil) then
  // Передаем запрос в форму КЗ
  op_SearchParameters_SetQuery.Call(l_Container.Aggregate, aQuery)
 else
  Op_Query_ClearAll.Call(l_Container.Aggregate, True);
//#UC END# *4AB77FFF008F_4AA641A3036C_impl*
//#UC START# *4AB77FFF008F_4AA641A3036C_var*
//#UC END# *4AB77FFF008F_4AA641A3036C_var*
//#UC START# *4AB7B8D30345_4AA641A3036C_impl*
 TvcmDispatcher.Instance.FormDispatcher.Lock;
 try
  l_MainContainer := TCommonSearchService.Instance.MakeSaveLoadForm(vcmCheckAggregate(
                                                 vcmMakeParams(nil,
                                                           CheckContainer(nil))),
                                                vcm_ztManualModal,
                                                true,
                                                Ord(slqtFilters));
  Result := TCommonSearchService.Instance.MakeQueryCardForm(true, // IsFilter
                                        vcmMakeParams(l_MainContainer.Aggregate, l_MainContainer.AsContainer),
                                        vcm_ztAny,
                                        True,
                                        0);
  // Передадим запрос в КЗ
  if (aData <> nil) then
   op_SearchParameters_SetQuery.Call(l_MainContainer.Aggregate, aData.Query);
 finally
  TvcmDispatcher.Instance.FormDispatcher.UnLock;
 end;//try..finally
 if (l_MainContainer <> nil) AND (l_MainContainer.ZoneType = vcm_ztManualModal) then
 begin
  l_MainContainer.ShowModal;
  Result := nil;
  l_MainContainer := nil;
 end;//Result <> nil
//#UC END# *4AB7B8D30345_4AA641A3036C_impl*
//#UC START# *4AB7B8D30345_4AA641A3036C_var*
//#UC END# *4AB7B8D30345_4AA641A3036C_var*
//#UC START# *4AB7BFE700D2_4AA641A3036C_impl*
 Case aListType of
  bs_ltNone:
   Assert(false);
  bs_ltDocument:
   OpenFiltersForm(nil);
  bs_ltDrug:
   TSearchModule.OpenInpharm(0,
               vcm_ztManualModal,
               slqtFilters,
               nil,
               nil,
               nil);
  else
   Assert(false);
 end;//Case aListType
//#UC END# *4AB7BFE700D2_4AA641A3036C_impl*
//#UC START# *4AB7BFE700D2_4AA641A3036C_var*
//#UC END# *4AB7BFE700D2_4AA641A3036C_var*
//#UC START# *4AB7D4340301_4AA641A3036C_impl*
 TSearchModule.OpenInpharm(0,
             vcm_ztParent,
             vcm_utAny,
             aQuery,
             aList,
             aContainer);
//#UC END# *4AB7D4340301_4AA641A3036C_impl*
//#UC START# *4AB7D4340301_4AA641A3036C_var*
//#UC END# *4AB7D4340301_4AA641A3036C_var*
//#UC START# *4AB8A68700C7_4AA641A3036C_impl*
  TSearchModule.OpenPublishSource(0,
                   vcm_ztParent,
                   vcm_utAny,
                   aQuery,
                   aList,
                   nil);
//#UC END# *4AB8A68700C7_4AA641A3036C_impl*
//#UC START# *4AB8A68700C7_4AA641A3036C_var*
//#UC END# *4AB8A68700C7_4AA641A3036C_var*
//#UC START# *4AB8CC830075_4AA641A3036C_impl*
 Result := Ten_DefineSearchDate.Make(aData, vcmMakeParams(nil, nil, aCaller.VCLWinControl));
//#UC END# *4AB8CC830075_4AA641A3036C_impl*
//#UC START# *4AB8CC830075_4AA641A3036C_var*
//#UC END# *4AB8CC830075_4AA641A3036C_var*
//#UC START# *4AB8EF3B0310_4AA641A3036C_impl*
 // ППС 6.х
 if l3Same(afw.Settings.LoadString(pi_Search_SituationType,
                     dv_Search_SituationType),
                     li_NewSearch_SituationType) then
  OpenSituationCard(aQuery)
 // ППС 5.х
 else
  OpenOldSituationCard(aQuery, aContainer);
//#UC END# *4AB8EF3B0310_4AA641A3036C_impl*
//#UC START# *4AB8EF3B0310_4AA641A3036C_var*
//#UC END# *4AB8EF3B0310_4AA641A3036C_var*
//#UC START# *4AB8F2DC01A3_4AA641A3036C_impl*
 // Редактироваить фильтр
 if (aFilter <> nil) AND (aFilter.Query <> nil) then
 begin
  case TSearchModule.DefineFilterForm(aFilter.Query) of
   ns_ffAttributeSearch:
    OpenFiltersForm(aFilter);
   ns_ffPublishSource:
    TSearchModule.OpenPublishSource(anItemIndex,
                      vcm_ztManualModal,
                      slqtFilters,
                      aFilter.Query,
                      nil,
                      nil);
   ns_ffSituation:
    TSearchModule.OpenSituation(Tfs_SituationFilter,
                  aFilter.Query);
   ns_ffOldSituation:
    TSearchModule.OpenOldSituation(vcm_ztManualModal,
                     slqtFilters,
                     aFilter.Query,
                     nil);
   ns_ffBaseSearch:
    TBaseSearchService.Instance.OpenBaseSearch(ns_bsokGlobal, aFilter.Query);
   ns_ffInpharmSearch:
    TSearchModule.OpenInpharm(anItemIndex,
                vcm_ztManualModal,
                slqtFilters,
                aFilter.Query,
                nil,
                nil);
   else
    Assert(false, 'Неизвестный тип фильтра');
  end;//case DefineFilterForm(aFilter.Query) of
 end//aFilter <> nil..
 // Создать новый фильтр
 else
  Assert(false, 'Пользуйтесь фабрикой TSearchService.Instance.MakeNewFilter');
//#UC END# *4AB8F2DC01A3_4AA641A3036C_impl*
//#UC START# *4AB8F2DC01A3_4AA641A3036C_var*
//#UC END# *4AB8F2DC01A3_4AA641A3036C_var*
//#UC START# *4AB8FBBA016C_4AA641A3036C_impl*
  TSearchModule.OpenAttribute(0,
               vcm_ztParent,
               vcm_utAny,
               aQuery,
               aList,
               aContainer);
//#UC END# *4AB8FBBA016C_4AA641A3036C_impl*
//#UC START# *4AB8FBBA016C_4AA641A3036C_var*
//#UC END# *4AB8FBBA016C_4AA641A3036C_var*
//#UC START# *4ACDF7FB02FB_4AA641A3036C_impl*
 if (aPublishSearchTag = nil) then
  TSearchModule.OpenPublishSource(0,
                    vcm_ztParent,
                    vcm_utAny,
                    nil,
                    nil,
                    nsCStr('AT_PUBLISH_SOURCE_FINANCE'))
 else                   
  TSearchModule.OpenPublishSource(0,
                    vcm_ztParent,
                    vcm_utAny,
                    nil,
                    nil,
                    aPublishSearchTag);
//#UC END# *4ACDF7FB02FB_4AA641A3036C_impl*
//#UC START# *4ACDF7FB02FB_4AA641A3036C_var*
//#UC END# *4ACDF7FB02FB_4AA641A3036C_var*
//#UC START# *4F27EA7D0011_4AA641A3036C_impl*
  TSearchModule.OpenSituation(Tfs_SituationSearch, aQuery);
//#UC END# *4F27EA7D0011_4AA641A3036C_impl*
//#UC START# *4F27EA7D0011_4AA641A3036C_var*
//#UC END# *4F27EA7D0011_4AA641A3036C_var*
//#UC START# *4F27EAB1039F_4AA641A3036C_impl*
  TSearchModule.OpenOldSituation(vcm_ztParent, vcm_utAny, aQuery, aContainer);
//#UC END# *4F27EAB1039F_4AA641A3036C_impl*
//#UC START# *4F27EAB1039F_4AA641A3036C_var*
//#UC END# *4F27EAB1039F_4AA641A3036C_var*
//#UC START# *53A7FE780201_4AA641A3036C_impl*
  TSearchModule.OpenPublishSource(0,
                    vcm_ztParent,
                    vcm_utAny,
                    nil,
                    nil,
                    nsCStr(AT_PUBLISH_SOURCE_PHARM))
//#UC END# *53A7FE780201_4AA641A3036C_impl*
//#UC START# *53A7FE780201_4AA641A3036C_var*
//#UC END# *53A7FE780201_4AA641A3036C_var*
//#UC START# *53D771310272_4AA641A3036C_impl*
  l_Date := '''' + DateToStr(IncMonth(Now, -2)) + '''';
  TbsHyperLinkProcessorPrim.RunScript(Format(c_Script, [c_Class, l_Date]));
//#UC END# *53D771310272_4AA641A3036C_impl*
//#UC START# *53D771310272_4AA641A3036C_var*
const
 c_Script = ': Fill'#13#10 +
            ' OBJECT VAR l_QC'#13#10 +
            ' focused:control:push >>> l_QC'#13#10 +
            ' 1 ''AT_CLASS_REVIEW'' %s l_QC pop:QueryCard:Attribute:SetWithLogicOperation'#13#10 +
            ' ''AT_PUBLISHING_DATE'' %s l_QC pop:QueryCard:SetAttribute'#13#10 +
            ';'#13#10 +
            '@ Fill RunLegislationReviewSearch'#13#10;

 c_Class = '''Здравоохранение, образование, наука, культура, спорт и туризм\Охрана здоровья населения''';
var
 l_Date: AnsiString;
//#UC END# *53D771310272_4AA641A3036C_var*
