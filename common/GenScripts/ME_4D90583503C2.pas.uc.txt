//#UC START# *48C7925A02E5_4D90583503C2_impl*
 inherited;
 {$IfDef vtLayeredFormIsForm}
 Params.ExStyle := Params.ExStyle and not(WS_EX_APPWINDOW) or WS_EX_TOOLWINDOW or WS_EX_TOPMOST;
 {$EndIf vtLayeredFormIsForm}
//#UC END# *48C7925A02E5_4D90583503C2_impl*
//#UC START# *48C7925A02E5_4D90583503C2_var*
//#UC END# *48C7925A02E5_4D90583503C2_var*
//#UC START# *4D90583503C2_ext:FileName
w:\common\components\gui\Garant\VT\vtPopupForm.pas
//#UC END# *4D90583503C2_ext:FileName
//#UC START# *4F2A599E0283_4D90583503C2_impl*
 // сохраняем Bounds до корректировки
 f_CurrentBounds[f_TailPosition] := Rect(ALeft, ATop, AWidth, AHeight);

 Inc(afwFacade.g_DisableMessageHook);
 try
  inherited SetBounds(ALeft, ATop, AWidth, AHeight);
  if (f_Scene <> nil) then
  begin
   l_FontSize := Abs(f_Panel.Font.Size);
   f_Scene.RealignRoot;
   with f_CalloutPanel do
   begin
    CalloutWidth  := l_FontSize * cTailMul;
    CalloutLength := l_FontSize * cTailMul;
   end;//with f_CalloutPanel
   with f_NonVGLayout do
   begin
    case (f_TailPosition) of
      vtTailLeft,
      vtTailRight  :
       begin
        if f_TailPosition = vtTailLeft then
         Position.X := l_FontSize * (cIndentHMul + cTailMul)
        else
         Position.X := l_FontSize * cIndentHMul;
        Position.Y := l_FontSize * cIndentTopMul;
        Width  := f_CalloutPanel.Width  - l_FontSize * (cTailMul + cBtnWidthMul + cIndentHMul * 2 + cBtnIndentMul);
        Height := f_CalloutPanel.Height - l_FontSize * (cIndentTopMul + cIndentBottomMul);
       end;
      vtTailTop,
      vtTailBottom :
       begin
        Position.X := l_FontSize * cIndentHMul;
        if f_TailPosition = vtTailTop then
         Position.Y := l_FontSize * (cTailMul + cIndentTopMul)
        else
         Position.Y := l_FontSize * cIndentTopMul;
        Width  := f_CalloutPanel.Width  - l_FontSize * (cBtnWidthMul + cIndentHMul * 2 + cBtnIndentMul);
        Height := f_CalloutPanel.Height - l_FontSize * (cTailMul + cIndentTopMul + cIndentBottomMul);
       end;
    end;
    Realign;
   end;//with f_NonVGLayout
   with f_CloseButton do
   begin
    if f_TailPosition = vtTailRight then
     Position.X := f_CalloutPanel.Width - l_FontSize * (cBtnWidthMul + cBtnIndentMul + cTailMul)
    else
     Position.X := f_CalloutPanel.Width - l_FontSize * (cBtnWidthMul + cBtnIndentMul);
    if f_TailPosition = vtTailTop then
     Position.Y := l_FontSize * (cTailMul + cBtnIndentMul)
    else
     Position.Y := l_FontSize * (cBtnIndentMul);
    Width  := l_FontSize * cBtnWidthMul;
    Height := l_FontSize * cBtnWidthMul;
   end;//with f_CloseButton
  end;//Assigned(f_Scene)
 finally
  Dec(afwFacade.g_DisableMessageHook);
 end;//try..finally
//#UC END# *4F2A599E0283_4D90583503C2_impl*
//#UC START# *4F2A599E0283_4D90583503C2_var*
var
 l_FontSize: Integer;
//#UC END# *4F2A599E0283_4D90583503C2_var*
//#UC START# *4F9007B20376_4D90583503C2_impl*
 f_TailPosition := vtTailLeft;
 inherited CreateNew(AOwner);
 BorderStyle := bsNone;

 f_BackGround := TvgBackGround.Create(Self);
 with f_BackGround do
 begin
  Align := vaClient;
 end;//with f_BackGround

 f_Scene := TvgScene.Create(Self);
 with f_Scene do
 begin
  Parent := Self;
  AddObject(f_BackGround);
  ControlStyle := ControlStyle + [csAcceptsControls];
  Align := alClient;
  Style := vtVGSceneResources.vgResources;
  Transparency := True;
 end;//with f_Scene

 f_CalloutPanel := TvgCalloutPanel.Create(Self);
 with f_CalloutPanel do
 begin
  Parent := f_BackGround;
  Align  := vaClient;
  CalloutPosition := vgCalloutLeft;
  Resource := cCalloutPanelWarningStyleLayoutName;
 end;//with f_CalloutPanel

 f_CloseButton := TvgCloseButton.Create(Self);
 with f_CloseButton do
 begin
  Name := 'CloseButton';
  Parent := f_CalloutPanel;
  CloseForm := True;
 end;//with f_CloseButton

 f_Panel := TvtPanel.Create(Self);
 with f_Panel do
 begin
  Color :=  cWarningMessageColor;
  Bevelouter := bvNone;
  Parent := f_Scene;
  DockSite := True;
  OnGetSiteInfo := PanelGetSiteInfo; // http://mdp.garant.ru/pages/viewpage.action?pageId=317263132
  TabStop := false;
 end;//with f_Panel

{$IfDef IsVCMProject}
 l_DockTree := TvcmDockTree.Create(TWinControl(f_Panel));
 //l_DockTree.CanUndock := CanUndock;
 //l_DockTree.CanClose := CanClose;
 THackWinControl(f_Panel).DockManager := l_DockTree;
 // http://mdp.garant.ru/pages/viewpage.action?pageId=259170982&focusedCommentId=259170984&#comment-259170984
{$EndIf IsVCMProject}

 f_NonVGLayout := TvgNonVGLayout.Create(Self);
 with f_NonVGLayout do
 begin
  Parent := f_CalloutPanel;
  NonVGControl := f_Panel;
 end;//with f_NonVGLayout
//#UC END# *4F9007B20376_4D90583503C2_impl*
//#UC START# *4F9007B20376_4D90583503C2_var*
{$IfDef IsVCMProject}
var
 l_DockTree : TvcmDockTree;
{$EndIf IsVCMProject}
//#UC END# *4F9007B20376_4D90583503C2_var*
//#UC START# *4FC768990140_4D90583503C2set_impl*
 if (f_CalloutPanel <> nil) and (f_TailPosition <> aValue) then
 begin
  f_TailPosition := aValue;
  case f_TailPosition of
    vtTailTop    : f_CalloutPanel.CalloutPosition := vgCalloutTop;
    vtTailLeft   : f_CalloutPanel.CalloutPosition := vgCalloutLeft;
    vtTailBottom : f_CalloutPanel.CalloutPosition := vgCalloutBottom;
    vtTailRight  : f_CalloutPanel.CalloutPosition := vgCalloutRight;
  end;
  with f_CurrentBounds[f_TailPosition] do
   SetBounds(Left, Top, Right, Bottom);
 end;
//#UC END# *4FC768990140_4D90583503C2set_impl*
//#UC START# *4FC768990140_4D90583503C2set_var*
//#UC END# *4FC768990140_4D90583503C2set_var*
//#UC START# *4FC7694303B7_4D90583503C2_impl*
 inherited;
 if not Visible then
  if Assigned(f_AfterBaloonHidden) then
   f_AfterBaloonHidden(Self);

 // костыль для http://mdp.garant.ru/pages/viewpage.action?pageId=326773126
 if Visible then
  SetWindowPos(Handle, HWND_TOPMOST, 0, 0, 0, 0, SWP_NOACTIVATE or SWP_NOMOVE or SWP_NOSIZE);
//#UC END# *4FC7694303B7_4D90583503C2_impl*
//#UC START# *4FC7694303B7_4D90583503C2_var*
//#UC END# *4FC7694303B7_4D90583503C2_var*
//#UC START# *4FC7711F014B_4D90583503C2_impl*
 a_WidthOut  := a_WidthIn;
 a_HeightOut := a_HeightIn;
 case a_TailPosition of
  vtTailLeft,
  vtTailRight:
   begin
    Inc(a_WidthOut, Round(a_FontSize * (cTailMul + cBtnWidthMul + cIndentHMul * 2 + cBtnIndentMul * 3)));
    Inc(a_HeightOut, Round(a_FontSize * (cIndentTopMul + cIndentBottomMul)));
   end;
  vtTailTop,
  vtTailBottom:
   begin
    Inc(a_WidthOut, Round(a_FontSize * (cBtnWidthMul + cIndentHMul * 2 + cBtnIndentMul * 3)));
    Inc(a_HeightOut, Round(a_FontSize * (cTailMul + cIndentTopMul + cIndentBottomMul)));
   end;
 end;
 //Inc(a_WidthOut, 10);
//#UC END# *4FC7711F014B_4D90583503C2_impl*
//#UC START# *4FC7711F014B_4D90583503C2_var*
//#UC END# *4FC7711F014B_4D90583503C2_var*
//#UC START# *4FC87D8002D6_4D90583503C2_impl*
 CanDock := false;
//#UC END# *4FC87D8002D6_4D90583503C2_impl*
//#UC START# *4FC87D8002D6_4D90583503C2_var*
//#UC END# *4FC87D8002D6_4D90583503C2_var*
