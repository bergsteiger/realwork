//#UC START# *479731C50290_52A1DDF20272_impl*
 vcmFree(f_Operations);
 inherited;
//#UC END# *479731C50290_52A1DDF20272_impl*
//#UC START# *479731C50290_52A1DDF20272_var*
//#UC END# *479731C50290_52A1DDF20272_var*
//#UC START# *52A1DDF20272_ext:ParentFileName
w:\common\components\gui\Garant\VCM\implementation\Visual\vcmBaseMenuManager.pas
//#UC END# *52A1DDF20272_ext:ParentFileName
//#UC START# *52A1DE69039A_52A1DDF20272_impl*
 inherited Create;
 f_IsEntitiesLoad := False;
 f_IsModulesLoad := False;
 //g_MenuManager := aMenuManager;
 Assert(Assigned(g_MenuManager));
 {$IfNDef DesignTimeLibrary}
 f_Operations := TvcmObjectList.Make;
 {$EndIf DesignTimeLibrary}
//#UC END# *52A1DE69039A_52A1DDF20272_impl*
//#UC START# *52A1DE69039A_52A1DDF20272_var*
//#UC END# *52A1DE69039A_52A1DDF20272_var*
//#UC START# *52A1DE8F0369_52A1DDF20272_impl*
 Result := nil;

 { Загрузим операции если они не были загружены }
 LoadOperations;

 { Проверим заявлена ли операция на управление формой }
 for l_Index := 0 to Pred(f_Operations.Count) do
 begin
  if CheckOwnersAndNames(aOperation,
   TvcmBaseOperationsCollectionItem(f_Operations[l_Index])) then
  begin
   Result := TvcmRepOperationsCollectionItem(f_Operations[l_Index]).FormActivate;
   Break;
  end;//CheckOwnersAndNames(aOperation,..
 end;//for l_Index
//#UC END# *52A1DE8F0369_52A1DDF20272_impl*
//#UC START# *52A1DE8F0369_52A1DDF20272_var*

  function CheckOwnersAndNames(aDest, aSource : TvcmBaseOperationsCollectionItem) : Boolean;
  begin//CheckOwnersAndNames
   Result := False;
   { Операция модуля }
   if (aSource.Collection.Owner is TvcmModulesCollectionItem) and
    (TvcmCustomModuleDef(aDest.Collection.Owner).Owner is TvcmModule) then
   begin
    Assert(TvcmCustomModuleDef(aDest.Collection.Owner).Owner Is TvcmModule);
    Result :=
     (TvcmModulesCollectionItem(aSource.Collection.Owner).Name + aSource.Name) =
     (TvcmModule(TvcmCustomModuleDef(aDest.Collection.Owner).Owner).Name + aDest.Name);
   end//aSource.Collection.Owner is TvcmModulesCollectionItem..
   { Операция сущности }
   else
   if (aSource.Collection.Owner is TvcmRepEntitiesCollectionItem) then
   begin
    if (aDest.Collection.Owner Is TvcmCustomModuleDef) then
    begin
     Assert(TvcmCustomModuleDef(aDest.Collection.Owner).Owner Is TvcmModule);
     Result :=
      (TvcmModule(TvcmCustomModuleDef(aDest.Collection.Owner).Owner).Name + aDest.Name) =
      (TvcmRepEntitiesCollectionItem(aSource.Collection.Owner).Name + aSource.Name);
    end//aDest.Collection.Owner Is TvcmCustomModuleDef
    else
    begin
     Assert(aDest.Collection.Owner Is TvcmBaseEntitiesCollectionItem);
     Result :=
      (TvcmBaseEntitiesCollectionItem(aDest.Collection.Owner).Name + aDest.Name) =
      (TvcmRepEntitiesCollectionItem(aSource.Collection.Owner).Name + aSource.Name);
    end;//aDest.Collection.Owner Is TvcmCustomModuleDef
   end;//aSource.Collection.Owner is TvcmRepEntitiesCollectionItem
  end;//CheckOwnersAndNames

var
 l_Index : Integer;
//#UC END# *52A1DE8F0369_52A1DDF20272_var*
//#UC START# *52A1DEB300EC_52A1DDF20272_impl*
 if aOperation.IsFormActivateDefined then
  f_Operations.Add(aOperation);
//#UC END# *52A1DEB300EC_52A1DDF20272_impl*
//#UC START# *52A1DEB300EC_52A1DDF20272_var*
//#UC END# *52A1DEB300EC_52A1DDF20272_var*
//#UC START# *52A1DF8C0277_52A1DDF20272_impl*
 { Зарегистрируем операции модулей }
 if not f_IsModulesLoad then
 begin
  f_IsModulesLoad := (g_MenuManager.Modules.Count > 0);
  for I := 0 to Pred(g_MenuManager.Modules.Count) do
  begin
   l_Module := TvcmBaseEntitiesCollectionItem(g_MenuManager.Modules.Items[I]);
   for J := 0 to Pred(l_Module.Operations.Count) do
    AddOperation(TvcmRepOperationsCollectionItem(l_Module.Operations.Items[J]));
  end;//for I
 end;//not f_IsModulesLoad

 { Зарегистрируем операции сущностей }
 if not f_IsEntitiesLoad then
 begin
  f_IsEntitiesLoad := (g_MenuManager.Entities.Count > 0);
  for I := 0 to Pred(g_MenuManager.Entities.Count) do
  begin
   l_Entity := TvcmBaseEntitiesCollectionItem(g_MenuManager.Entities.Items[I]);
   for J := 0 to Pred(l_Entity.Operations.Count) do
    AddOperation(TvcmRepOperationsCollectionItem(l_Entity.operations.Items[J]));
  end;
 end;
//#UC END# *52A1DF8C0277_52A1DDF20272_impl*
//#UC START# *52A1DF8C0277_52A1DDF20272_var*
var
 I, J : Integer;
 l_Module : TvcmBaseEntitiesCollectionItem;
 l_Entity : TvcmBaseEntitiesCollectionItem;
//#UC END# *52A1DF8C0277_52A1DDF20272_var*
//#UC START# *52A6FAA300CC_52A1DDF20272get_impl*
 Result := f_Operations.Count;
//#UC END# *52A6FAA300CC_52A1DDF20272get_impl*
//#UC START# *52A6FAA300CC_52A1DDF20272get_var*
//#UC END# *52A6FAA300CC_52A1DDF20272get_var*
//#UC START# *52A6FAB70156_52A1DDF20272get_impl*
 Result := TvcmBaseOperationsCollectionItem(f_Operations[anIndex]);
//#UC END# *52A6FAB70156_52A1DDF20272get_impl*
//#UC START# *52A6FAB70156_52A1DDF20272get_var*
//#UC END# *52A6FAB70156_52A1DDF20272get_var*
