//#UC START# *5372265401B9_ext:FileName
w:\archi\source\projects\PipeInAuto\Tests\Tasks\Import\Abstract\alcuImportTest.pas
//#UC END# *5372265401B9_ext:FileName
//#UC START# *537226BB0284_5372265401B9_impl*
 l_RootTaskFolder := ddAppConfiguration.AsString['RootTaskFolder'];
 PureDir(l_RootTaskFolder);
 TalcuServer.Instance.TaskProcessor.TaskExecutionEnabled := true;
 TalcuServer.Instance.TaskProcessor.TaskList.Clear;
 TalcuServer.Instance.UpdateRequestLists;
 TalcuServer.Instance.TaskProcessor.WaitForAsyncRunningTasks;
 l_TestSetFolder := Self.FileFromCurrent('K' + Self.KPage);
 //l_TaskFolder := '';
 try
  l_Task := {TalcuImport}TcsImportTaskItem.Create(defaultUser, defaultUser);
  try
//   l_Task.Date := defaultUser;
   l_Task.SourceDir := l_TestSetFolder;
   l_Task.TaskFolder := l_RootTaskFolder;

   with TddFileIterator.Make(l_Task.SourceDir, cMask) do
   try
    l_Task.SourceFiles.CopyFrom(FileList);
   finally
    Free;
   end;//try..finally
   SaveTask(l_Task, true);

(*   l_TaskFolder := l_Task.TaskFolder;
   ForceDirectories(l_TaskFolder);
   DeleteFilesByMask(l_TaskFolder, cMask);
   CopyFilesByMask(l_Task.SourceDir, l_TaskFolder, cMask);

   TalcuServer.Instance.TaskProcessor.AddTaskToRawList(l_Task);*)
  finally
   FreeAndNil(l_Task);
  end;//try..finally

  l_S := Tl3NamedTextStream.Create(FileForOutput, l3_fmRead, 1000);
  try
   TalcuServer.Instance.TaskProcessor.AddTaskFromStreamToIncoming(l_S, l_RootTaskFolder, true);
  finally
   FreeAndNil(l_S);
  end;//try..finally

  StartTimer;
  try
   TalcuServer.Instance.UpdateRequestLists;
   TalcuServer.Instance.TaskProcessor.WaitForAsyncRunningTasks;
  finally
   StopTimer;
  end;//try..finally
 finally
  //if (l_TaskFolder <> '') then
  // DelDir(l_TaskFolder);
  PureDir(l_RootTaskFolder);
 end;//try..finally
//#UC END# *537226BB0284_5372265401B9_impl*
//#UC START# *537226BB0284_5372265401B9_var*
const
 defaultUser = 65000;
 cMask = '*.evd';
var
 l_Task : TcsImportTaskItem;
 l_TestSetFolder : String;
 l_RootTaskFolder : String;
 //l_TaskFolder : String;
 l_S : Tl3NamedTextStream;
//#UC END# *537226BB0284_5372265401B9_var*
