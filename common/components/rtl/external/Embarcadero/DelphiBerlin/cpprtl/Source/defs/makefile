#############################################################################
#                                                                           #
# The make process relies on the creation of DLL and library response file  #
# creation.  To control the location of object modules the following should #
# be defined:                                                               #
#                                                                           #
#     IMPOBJS - A list of object modules that should appear in the DLL      #
#               import library.                                             #
#                                                                           #
#        OBJS - If a DLL is build, this is a list of the object modules     #
#               that are linked into the DLL.  If building a library, this  #
#               is the list of object modules that goes into the library.   #
#                                                                           #
# The building of miscellaneous object modules and libraries is controlled  #
# by the list of files in the MISC variable.                                #
#                                                                           #
#############################################################################

# $Revision: 35794 $

# Need LIBDIR but can't include rules.mak until after setting target macros
!if $d(WIN64)
LIBDIR    = $(RTLROOT)\lib64
!else
!if $d(CLANG32)
LIBDIR    = $(RTLROOT)\lib32
!else
LIBDIR    = $(RTLROOT)\lib
!endif
!endif

#############################################################################
# Build the object module lists.                                            #
#############################################################################
!if $d(WIN64)
MISC =                         \
        $(LIBDIR)\import64.a \
        $(LIBDIR)\ws2_32.a

MISC =  $(MISC)                \
        $(LIBDIR)\dummy.fil         # dummy target to force all the .defs to
                                    # be built
!else
MISC =                         \
        $(LIBDIR)\import32.lib \
        $(LIBDIR)\ole2w32.lib

MISC =  $(MISC)                \
        $(LIBDIR)\w32inet.lib          # Internet APIs (WININET, MSCONF, WEBPOST,
                                    # URLMON, HLINK)

MISC =  $(MISC)                \
        $(LIBDIR)\wininet.lib       # Internet APIs (WININET for MS compat.)

MISC =  $(MISC)                \
        $(LIBDIR)\dxextra.lib       # Used for DirectX.  Contains the pre-
                                    # defined DINPUT.H stuff: c_dfDIMouse &
                                    # c_dfDIKeyboard

MISC =  $(MISC)                \
        $(LIBDIR)\uuid.lib          # Used to hold some of the common GUIDS
                                    # generated by the new INETSDK headers.
                                    # Many of these headers attempt to do
                                    # a #pragma comment (lib, uuid.lib) so
                                    # instead of always removing those
                                    # uuid.lib references, we simply place
                                    # those GUIDS in that lib file.


MISC =  $(MISC)                \
        $(LIBDIR)\dummy.fil         # dummy target to force all the .defs to
                                    # be built
!endif

#############################################################################
# Configure the environment appropriately.                                  #
#############################################################################
TASMCFG = 1        # Force tasm.cfg creation
TASM_CASE_SENSITIVE = 1

!include rules.mak

#############################################################################
# MISC explicit rules.                                                      #
#############################################################################

CONLIBS =                   \
        advapi32.def        \
        dlcapi.def          \
        kernel32w$(BITS).def \
        inetmib1.def        \
        lz32.def            \
        mgmtapi.def         \
        mpr.def             \
        netapi32.def        \
        nddeapi.def         \
        rasapi32.def        \
        rpcrt4.def          \
        vdmdbg.def          \
        version$(BITS).def  \
        win32spl.def        \
        winspool.def

WIN95LIBS =                 \
        imm32.def           \
        mapi32.def          \
        tapi32.def          \
        pkpd32.def          \
        url.def             \
        snmpapi.def

NT40LIBS =                  \
        wintrust.def        \
        sporder.def         \
        msvfw32.def         \
        avifil32.def        \
        avicap32.def        \
        setupapi.def        \
        rassapi.def         \
        rasdlg.def          \
        pdh.def             \
        lsapi32.def         \
        loadperf.def        \
        imagehlp.def        \
        cap.def

GUILIBS =                   \
        comctl32.def        \
        comdlg32.def        \
        ctl3d32.def         \
        dwmapi.def          \
        gdi32.def           \
        glu32.def           \
        msacm32.def         \
        msimg32.def         \
        opengl32.def        \
        shell32nt4.def      \
        shfolder.def        \
        user32w$(BITS).def  \
        winmm.def

DIRECTXLIBS =               \
        ddraw.def           \
        dplayx.def          \
        dsound.def          \
        dinput.def          \
        dsetup.def          \
        d3drm.def

TH32LIB =                   \
        th32.def

INETLIBS =                  \
        hlink.def           \
        msconf.def          \
        urlmon.def          \
        webpost.def         \
        wininet.def

WININET =                   \
        wininet.def


DIRECTXEXTRALIB =           \
        dxiface.obj                 # Note: This is source code (initialized data)

RPCEXTRALIB =               \
        rpcdce4.def

MSWSOCKLIB =                \
        mswsock.def

OLEPRO32LIB =               \
        olepro32.def

OLE2LIBS =                  \
        ole32.def           \
        oleaut32.def        \
        oledlg.def          \
        oleacc.def          \
        $(OLEPRO32LIB)

OLE1LIBS =                  \
        olecli32.def        \
        olesvr32.def


MSEXTRALIB =                \
        mfcuia32.def        \
        svrapi.def          \
        penwin32.def        \
        winstrm.def         \
        thunk32.def         \
        wsock32.def         \
        $(OLE1LIBS)

UUIDLIB =                   \
        uuid.obj                 # stub that contains only _GUID_NULL


# These were new from the NT5 / Win98 Platform SDK
NT50LIBS =                  \
        aclcls.def          \
        activeds.def        \
        adptif.def          \
        bdnapi.def          \
        bhmon.def           \
        bhsupp.def          \
        clusapi.def         \
        crypt32.def         \
        dacdll.def          \
        dapi.def            \
        dflayout.def        \
        dtccfg.def          \
        edbbcli.def         \
        filter.def          \
        fmistr32.def        \
        friendly.def        \
        gtrtst32.def        \
        gwperf.def          \
        hexedit.def         \
        icmui.def           \
        ihvlink.def         \
        measure.def         \
        mprapi.def          \
        mqrt.def            \
        mscms.def           \
        mscomstf.def        \
        msdetstf.def        \
        msi.def             \
        msimg32.def         \
        msinsstf.def        \
        msjava.def          \
        msrating.def        \
        msshlstf.def        \
        msuilstf.def        \
        mtx.def             \
        mtxdm.def           \
        mtxoci.def          \
        nal.def             \
        nmapi.def           \
        ntmsapi.def         \
        ntquery.def         \
        ntwdblib.def        \
        odbc32.def          \
        oleacc.def          \
        opends60.def        \
        parser.def          \
        quartz.def          \
        resutils.def        \
        rtm.def             \
        rtutils.def         \
        rulecls.def         \
        scarddlg.def        \
        shlwapi.def         \
        slbs.def            \
        smsapi.def          \
#
        snacli.def          \
#
        snanls.def          \
        svcsrvl.def         \
        trnsdt.def          \
        wappc32.def         \
        wcpic32.def         \
        wincsv32.def        \
        winscard.def        \
        wldap32.def         \
        wsnmp32.def         \
        xolehlp.def         \
        wow32.def           \
        rpcns4.def          \
        wst.def             \



# These are additional modules from the WIN2K.RC2 Platform SDK
WIN2KLIBS =                 \
        aclui.def           \
        comsvcs.def         \
        dbghelp.def         \
        dhcpcsvc.def        \
        dsprop.def          \
        framedyd.def        \
        framedyn.def        \
        gpedit.def          \
        icm32.def           \
        iphlpapi.def        \
        iprop.def           \
        ksproxy.def         \
        mobsync.def         \
        ntdsapi.def         \
        ntdsbcli.def        \
        psapi.def           \
        qosname.def         \
        riched20.def        \
        secur32.def         \
        sens.def            \
        sensapi.def         \
        sfc.def             \
        shell32.def         \
        sti.def             \
        traffic.def         \
        userenv.def         \
        winfax.def          \
        wtsapi32.def


# These are additional modules from the WIN2KXP Platform SDK update from 8/2001
WIN2KXPLIBS =               \
        ASycFilt.def        \
        AuthZ.def           \
        Cabinet.def         \
        CertAdm.def         \
        CryptNet.def        \
        DSUIExt.def         \
        DbgEng.def          \
        DnsAPI.def          \
        GdiPlus.def         \
        NMSupp.def          \
        NetSh.def           \
        SrClient.def        \
        Toolbar.def         \
        USP10.def           \
        Uxtheme.def         \
        credui.def          \
        cryptui.def         \
        esebcli2.def        \
        ksuser.def          \
        monitors.def        \
        npptools.def        \
        powrprof.def        \
        sisbkup.def         \
        MSTask.def          \
        d3d8thk.def         \
        dciman32.def        \
        dhcpsapi.def        \
        httpapi.def         \
        irprops.def         \
        winhttp.def


# Additional modules from the Platform SDK update from 5/2005: (Windows Server 2003 SP1 Platform SDK)
PSDKUPDATE_2005=            \
        bufferoverflowu.def \
        clfsw32.def         \
        dtchelp.def         \
        esent.def           \
        fcachdll.def        \
        glaux.def           \
        gtrts32w.def        \
        htmlhelp.def        \
        inetcomm.def        \
        libcp.def           \
        minidump.def        \
        mmc.def             \
        mscoree.def         \
        msdmo.def           \
        mspatchc.def        \
        normaliz.def        \
        odbcbcp.def         \
        odbccp32.def        \
        p2p.def             \
        p2pgraph.def        \
        patchwiz.def        \
        scrnsave.def        \
        scrnsavw.def        \
        unicows.def         \
        xaswitch.def

# Additional modules from the Platform SDK update from 11/2006: (Vista Platform SDK)
PSDKUPDATE_2006=            \
        AHADMIN.def         \
        AVRT.def            \
        BCRYPT.def          \
        BTHPROPS.def        \
        CLFSMGMT.def        \
        D3D10.def           \
        D3D9.def            \
        DHCPCSVC6.def       \
        DWMAPI.def          \
        DXGI.def            \
        DXVA2.def           \
        EAPPCFG.def         \
        EAPPPRXY.def        \
        EVR.def             \
        FAULTREP.def        \
        FILEEXTD.def        \
        FWPUCLNT.def        \
        FXSUTILITY.def      \
        IEPMAPI.def         \
        INFOCARDAPI.def     \
        ISCSIDSC.def        \
        KTMW32.def          \
        MAGNIFICATION.def   \
        MF.def              \
        MFPLAT.def          \
        MSCORSN.def         \
        MSCTFMONITOR.def    \
        MSDRM.def           \
        MUILOAD.def         \
        NCRYPT.def          \
        NDFAPI.def          \
        NEWDEV.def          \
        PRNTVPT.def         \
        PROPSYS.def         \
        QUTIL.def           \
        QWAVE.def           \
        RSTRTMGR.def        \
        SLC.def             \
        SLCEXT.def          \
        SLWGA.def           \
        TBS.def             \
        TDH.def             \
        UIAUTOMATIONCORE.def\
        VSSAPI.def          \
        WDSCLIENTAPI.def    \
        WDSPXE.def          \
        WECAPI.def          \
        WER.def             \
        WEVTAPI.def         \
        WINDOWSCODECS.def   \
        WLANAPI.def         \
        WLANUI.def          \
        WMDRMSDK.def        \
        WMVCORE.def         \
        WSCAPI.def          \
        WSDAPI.def          \
        XINPUT.def          \
        XMLLITE.def

# Additional modules from the Platform SDK update from 4/2009: (Windows 7 Platform SDK v7.0)
PSDKUPDATE_2009=                \
        AD1.def                 \
        ADSIID.def              \
        ADVPACK.def             \
        AMSTRMID.def            \
        AUX_ULIB.def            \
        BITS.def                \
        CERTIDL.def             \
        CIUUID.def              \
        CORGUIDS.def            \
        CORRENGINE.def          \
        CRYPTXML.def            \
        D2D1.def                \
        D3D10_1.def             \
        D3D11.def               \
        DAOUUID.def             \
        DDAO35.def              \
        DDAO35D.def             \
        DDAO35U.def             \
        DDAO35UD.def            \
        DINPUT8.def             \
        DMOGUIDS.def            \
        DRT.def                 \
        DRTPROV.def             \
        DRTTRANSPORT.def        \
        DWRITE.def              \
        EHSTORGUIDS.def         \
        ELSCORE.def             \
        ENCAPI.def              \
        EVR_VISTA.def           \
        FCI.def                 \
        FDI.def                 \
        FORMAT.def              \
        GPMUUID.def             \
        IMGUTIL.def             \
        KSGUID.def              \
        LOCATIONAPI.def         \
        MBNAPI_UUID.def         \
        MFPLAT_VISTA.def        \
        MFPLAY.def              \
        MFREADWRITE.def         \
        MFUUID.def              \
        MF_VISTA.def            \
        MQOA.def                \
        MSDASC.def              \
        MSXML2.def              \
        MSXML6.def              \
        NDPROXYSTUB.def         \
        OLEDB.def               \
        OSPTK.def               \
        PENTER.def              \
        PHOTOACQUIREUID.def     \
        PORTABLEDEVICEGUIDS.def \
        SAPI.def                \
        SEARCHSDK.def           \
        SENSORSAPI.def          \
        SHDOCVW.def             \
        STRMIIDS.def            \
        STRSAFE.def             \
        STRUCTUREDQUERY.def     \
        SVCGUID.def             \
        TASKSCHD.def            \
        TRANSCODEIMAGEUID.def   \
        UUID.def                \
        VDS_UUID.def            \
        VIRTDISK.def            \
        VPCCOMINTERFACES.def    \
        VSS_UUID.def            \
        VSTORINTERFACE.def      \
        WBEMUUID.def            \
        WCMGUID.def             \
        WEBSERVICES.def         \
        WIAGUID.def             \
        WINBIO.def              \
        WINDOWSSIDESHOWGUIDS.def\
        WINSATAPI.def           \
        WMCODECDSPUUID.def      \
        WMIUTILS.def            \
        WSBAPP_UUID.def         \
        WSMSVC.def              \
        WUGUID.def              \
        XPSPRINT.def

WIN8LIBS =                      \
	BluetoothApis.def 

# Additional modules from the Windows 10 SDK v10.0.10069.0
SDKUPDATE_v10_0= \
AMSI.def \
APIDLL.def \
APPMGMTS.def \
AUDIOBASEPROCESSINGOBJECT.def \
AUDIOENG.def \
BASESRV.def \
BUFFEROVERFLOW.def \
CFGMGR32.def \
CHAKRART.def \
COMPPKGSUP.def \
COMPSTUI.def \
CRYPTDLL.def \
CSCDLL.def \
D3D12.def \
D3DCOMPILER.def \
D3DCSX.def \
D3DCSXD.def \
DCOMP.def \
DEVICEACCESS.def \
DEVMGR.def \
DIFXAPI.def \
DNSCRCLI.def \
DNSLIB.def \
DNSPERF.def \
DNSRPC.def \
DNSRSLVR.def \
DSSEC.def \
DSTSTLOG.def \
EASREGPROV.def \
EFSWRT.def \
ELFAPI.def \
FECLIENT.def \
FHSVCCTL.def \
FLTLIB.def \
GLMF32.def \
HBAAPI.def \
HID.def \
HRTFAPO.def \
IASHLPR.def \
INSENG.def \
JSRT.def \
KERBCLI.def \
MCIOLE32.def \
MDMREGISTRATION.def \
MFCORE.def \
MFSRCSNK.def \
MI.def \
MMDEVAPI.def \
MPRSNAP.def \
MRMSUPPORT.def \
MSAJAPI.def \
MSPATCHA.def \
MSPBASE.def \
MSPORTS.def \
MSV1_0.def \
NETLIB.def \
NINPUT.def \
NT.def \
NTDLL.def \
NTDSA.def \
NTDSATQ.def \
NTDSETUP.def \
NTFRSAPI.def \
NTLANMAN.def \
NTMARTA.def \
NTSTC_LIBCMT.def \
NTSTC_MSVCRT.def \
NTVDM.def \
OEMLICENSE.def \
ONDEMANDCONNROUTEHELPER.def \
PEERDIST.def \
QUERY.def \
ROMETADATA.def \
RPCEXTS.def \
RPCPROXY.def \
RPCUTIL.def \
RTWORKQ.def \
SAMLIB.def \
SAMSRV.def \
SAS.def \
SBTSV.def \
SCECLI.def \
SCESRV.def \
SCHANNEL.def \
SECURITY.def \
SENSORSUTILS.def \
SPOOLSS.def \
SRPAPI.def \
SSDPAPI.def \
STRMBASE.def \
SWDEVICE.def \
TAPI32L.def \
TOKENBINDING.def \
TSEC.def \
TWAIN_32.def \
UALAPI.def \
UMPDDDI.def \
VCCOMSUP.def \
WCMAPI.def \
WEBSOCKET.def \
WIASERVC.def \
WIAUTIL.def \
WINDOWS.DATA.PDF.def \
WINDOWS.NETWORKING.def \
WINDOWS.UI.def \
WINSTA.def \
WINUSB.def \
WMIP.def \
WOFUTIL.def \
WORKSPACEAX.def \
WSCLIENT.def \
XAPOBASE.def \
XAUDIO2.def \
XINPUT9_1_0.def

# DEF files created by hand until COFF2OMF is fixed
SDKUPDATE_v10_0= $(SDKUPDATE_v10_0) \
SHCORE.def \
APPNOTIFY.def \
PATHCCH.def \
SYNCHRONIZATION.def

WINRT_LIB = \
winrt_core.def \
winrt_string.def \
winrt_parameterizediid.def \

#
# List of the def files that should only be built and not added into any
# composite library.
#

DUMMY_BUILD_LIST =          \
        vfw32.def           \
        $(DIRECTXLIBS)      \
        $(MSEXTRALIB)       \
        $(MSWSOCKLIB)       \
        $(RPCEXTRALIB)      \
        $(TH32LIB)          \
        $(NT50LIBS)         \
        $(WIN2KLIBS)        \
        $(WIN2KXPLIBS)      \
        $(PSDKUPDATE_2005)  \
        $(PSDKUPDATE_2006)  \
        $(PSDKUPDATE_2009)  \
        $(WIN8LIBS)         \
        $(SDKUPDATE_v10_0)

#
# dummy.fil is a dummy rule designed to make sure that the .def->.fst
# file dependents are properly built.  We don't add them to any libs,
# but as part of the .fst process they get added into individually named
# libs and placed into the LIB\PSDK dir (the .def.fst: rule in RULES.MAK
# does this for us.)
#
# Note: Several individual lib files are then also back copied into the
#       main LIB dir.
#
# Note: Currently these are being added into 64bit import library
#
!if !$d(WIN64)
$(LIBDIR)\dummy.fil    : $(DUMMY_BUILD_LIST:.def=.fst)
    copy $(PSDKDIR)\oleaut32.lib            $(LIBDIR)
    copy $(PSDKDIR)\$(MSWSOCKLIB:.def=.lib) $(LIBDIR)
    echo ** Made DUMMY_BUILD_LIST current
!else
$(LIBDIR)\dummy.fil    : $(DUMMY_BUILD_LIST:.def=.imp)
    echo ** Made DUMMY_BUILD_LIST current
!endif

!if $d(WIN64)
$(LIBDIR)\import64.a:  guids.rsp $(NT40LIBS:.def=.imp)  $(CONLIBS:.def=.imp) \
                       $(GUILIBS:.def=.imp) $(WIN95LIBS:.def=.imp)           \
                       $(OLE2LIBS:.def=.imp) $(INETLIBS:.def=.imp) gdiplus.imp uxtheme.imp dwmapi.imp \
                       wtsapi32.imp propsys.imp windowscodecs.imp shell32.imp \
                       oleacc.imp crypt32.imp propsys.imp userenv.imp wininet.imp \
                       D3D9.imp D3D10.imp D3D10_1.imp DXGI.imp odbc32.imp powrprof.imp \
                       ws2_32.imp bthprops.imp bluetoothapisminimal.imp mswsock.imp $(WINRT_LIB:.def=.imp) shlwapi.imp uuid.o
    $(TLIB) /Q $< /u @&&|
$(?:guids.rsp=) @guids.rsp
|

guids.rsp: inetguid.asm inetguid2.asm
    python make_guids.py guids.a $?


$(LIBDIR)\ws2_32.a : $(WS2_32LIB:.def=.imp)
    $(TLIB) /Q $< /u $(WS2_32LIB:.def=.imp)
    if exist $*.bak del $*.bak

$(LIBDIR)\runtimeobject.a : $(WINRT_LIB:.def=.imp)
    $(TLIB) /Q $< /u $(WINRT_LIB:.def=.imp)
    if exist $*.bak del $*.bak

!else
$(LIBDIR)\import32.lib : $(NT40LIBS:.def=.fst)  $(CONLIBS:.def=.fst)     \
                         $(GUILIBS:.def=.fst)                            \
                         $(WIN95LIBS:.def=.fst) $(OLE2LIBS:.def=.fst)    \
                         uuid.obj inetguid.obj inetguid2.obj mltmstub.obj              \
                         sock_data.obj gdiplus.fst propsys.fst ws2_32.fst\
			 bthprops.fst bluetoothapisminimal.fst mswsock.fst $(WINRT_LIB:.def=.fst) shlwapi.fst
    makersp "-+!s &\n" &&|
        $?
|   > $&.rsp
    $(TLIB) $< @$&.rsp, temp.lst
    del *.rsp
    del temp.lst
    if exist $*.bak del $*.bak
!endif

$(LIBDIR)\ole2w32.lib : $(OLE2LIBS:.def=.fst)
    makersp "-+!s &\n" &&|
        $?
|   > $&.rsp
    $(TLIB) $< @$&.rsp, temp.lst
    del *.rsp
    del temp.lst
    if exist $*.bak del $*.bak

$(LIBDIR)\w32inet.lib : $(INETLIBS:.def=.fst)
    makersp "-+!s &\n" &&|
        $?
|   > $&.rsp
    $(TLIB) $< @$&.rsp, temp.lst
    del *.rsp
    del temp.lst
    if exist $*.bak del $*.bak

$(LIBDIR)\wininet.lib : $(WININET:.def=.fst)
    makersp "-+!s &\n" &&|
        $?
|   > $&.rsp
    $(TLIB) $< @$&.rsp, temp.lst
    del *.rsp
    del temp.lst
    if exist $*.bak del $*.bak

$(LIBDIR)\dxextra.lib : $(DIRECTXEXTRALIB)
    makersp "-+!s &\n" &&|
        $?
|   > $&.rsp
    $(TLIB) $< @$&.rsp, temp.lst
    del *.rsp
    del temp.lst
    if exist $*.bak del $*.bak

$(LIBDIR)\uuid.lib : $(UUIDLIB)
    makersp "-+!s &\n" &&|
        $?
|   > $&.rsp
    $(TLIB) $< @$&.rsp, temp.lst
    del *.rsp
    del temp.lst
    if exist $*.bak del $*.bak

$(LIBDIR)\runtimeobject.lib : $(WINRT_LIB)
    makersp "-+!s &\n" &&|
        $?
|   > $&.rsp
    $(TLIB) $< @$&.rsp, temp.lst
    del *.rsp
    del temp.lst
    if exist $*.bak del $*.bak
