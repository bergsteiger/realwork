unit TestASCII85Encode;
{

  Delphi DUnit Test Case
  ----------------------
  This unit contains a skeleton test case class generated by the Test Case Wizard.
  Modify the generated code to correctly setup and call the methods from the unit 
  being tested.

}

interface

uses
  TestFramework, Stream, gtObject, Classes, EncodeIntf, ASCII85Encode, gtTypes,
  FileStream, ASCII85Stream, SysUtils, DUnitAssert, Dialogs;

type
  // Test methods for class TgtASCII85Encode
  
  TestTgtASCII85Encode = class(TAssertTestCase)
  public
    procedure SetUp; override;
    procedure TearDown; override;
  published
    procedure TestWrite;
//    procedure TestWrite1;
  end;

implementation
Var
    
    FgtASCII85Encode: TgtASCII85Encode;
    FInFile, FOutFile: TFileStream;
    FgtInFile,FgtOutFile: TgtFileStream;
    FOutStream: TgtStream;
    Lbuffer : Bytes;
    OutValue,i : Integer;

procedure TestTgtASCII85Encode.SetUp;
begin
  FInFile := TFileStream.Create('Filters\ASCII85Decode\Decode.txt', fmOpenRead);
  FgtInFile := TgtFileStream.Create(FInFile, 0, 0, False);
  FgtASCII85Encode := TgtASCII85Encode.create(FgtInFile);

  FOutFile := TFileStream.Create('Filters\ASCII85Decode\Encode12.txt', fmCreate);
  FgtOutFile := TgtFileStream.Create(FOutFile, 0, 0, False);
end;

procedure TestTgtASCII85Encode.TearDown;
begin

  FreeAndNil(FgtASCII85Encode);
  FreeAndNil(FgtInFile);
  FreeAndNil(FInFile);
  FreeAndNil(FOutFile);
  FreeAndNil(FgtOutFile);
  FreeAndNil(FOutStream);
end;

procedure TestTgtASCII85Encode.TestWrite;
var
  ReturnValue, Count: Cardinal;
  EncFileStream: TFileStream;
  TgtEncFile: TgtFileStream;
begin
  // TODO: Setup method call parameters
  Count := 20;
  ReturnValue := FgtASCII85Encode.Write(FgtOutFile, Count);
  { **
  EncFileStream is the actual encoded file and comparing it with the generated encoded file,
  in order to check that does the proper encoding being done.
  ** }

  EncFileStream := TFileStream.Create('Filters\ASCII85Decode\Encode.txt', fmOpenRead);
  TgtEncFile := TgtFileStream.Create(EncFileStream, 0, 0, False);

  TgtEncFile.Reset;
  FgtOutFile.Reset;

  for I := 0 to ReturnValue-1 do
    Assert.AreEqual(TgtEncFile.GetChar, FgtOutFile.GetChar);

  FreeAndNil(EncFileStream);
  FreeAndNil(TgtEncFile);
  // TODO: Validate method results
end;

initialization
  // Register any test cases with the test runner
  RegisterTest(TestTgtASCII85Encode.Suite);
end.

