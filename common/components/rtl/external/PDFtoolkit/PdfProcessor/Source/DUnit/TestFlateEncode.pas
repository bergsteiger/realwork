unit TestFlateEncode;
{

  Delphi DUnit Test Case
  ----------------------
  This unit contains a skeleton test case class generated by the Test Case Wizard.
  Modify the generated code to correctly setup and call the methods from the unit 
  being tested.

}

interface

uses
  TestFramework, gtTypes, Stream, gtObject, EncodeIntf, FlateEncode, Classes,
   Predictor, FileStream, DCTStream, SysUtils, DUnitAssert, Dialogs;

type
  // Test methods for class TgtFlateEncode
  
  TestTgtFlateEncode = class(TAssertTestCase)
  strict private
    FgtFlateEncode: TgtFlateEncode;
  public
    procedure SetUp; override;
    procedure TearDown; override;
  published
    procedure TestWrite;
  end;

implementation
var
    FgtFlateDecode: TgtFlateEncode;
    FInFile, FOutFile: TFileStream;
    FgtInFile,FgtOutFile: TgtFileStream;
    FOutStream: TgtStream;
    Lbuffer : Bytes;
    OutValue, i : Integer;

procedure TestTgtFlateEncode.SetUp;
begin
//  FgtFlateEncode := TgtFlateEncode.Create(nil);

FInFile := TFileStream.Create('Filters\FlateDecode\Decode.txt', fmOpenRead);
FgtInFile := TgtFileStream.Create(FInFile, 0, 0, False);
FgtFlateEncode := TgtFlateEncode.create(FgtInFile);

//FgtFlateDecode.Reset;

FOutFile := TFileStream.Create('Filters\FlateDecode\Encode12.txt', fmCreate);
FgtOutFile := TgtFileStream.Create(FOutFile, 0, 0, False);
end;

procedure TestTgtFlateEncode.TearDown;
begin
  FreeAndNil(FgtFlateEncode);
  FreeAndNil(FgtInFile);
  FreeAndNil(FInFile);
  FreeAndNil(FOutFile);
  FreeAndNil(FgtOutFile);
  FreeAndNil(FOutStream);
end;

procedure TestTgtFlateEncode.TestWrite;
var
  ReturnValue, Count: Cardinal;
  EncFileStream: TFileStream;
  TgtEncFile: TgtFileStream;
begin
  // TODO: Setup method call parameters

  Count := 20;
  ReturnValue := FgtFlateEncode.Write(FgtOutFile, Count);
  //Assert.AreEqual(30, ReturnValue);

  EncFileStream := TFileStream.Create('Filters\FlateDecode\Encode.txt', fmOpenRead);
  TgtEncFile := TgtFileStream.Create(EncFileStream, 0, 0, False);

  TgtEncFile.Reset;
  FgtOutFile.Reset;

  for I := 0 to ReturnValue-1 do
    Assert.AreEqual(TgtEncFile.GetChar, FgtOutFile.GetChar);

  FreeAndNil(EncFileStream);
  FreeAndNil(TgtEncFile);
  // TODO: Validate method results
end;

initialization
  // Register any test cases with the test runner
  RegisterTest(TestTgtFlateEncode.Suite);
end.

