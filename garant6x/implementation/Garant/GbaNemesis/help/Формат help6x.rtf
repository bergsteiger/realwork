{\rtf1\ansi\deflang1049{\fonttbl{\f13\froman\fcharset204\fprq2 Georgia;}{\f36\froman\fcharset204\fprq2 Times New Roman;}{\f46\fswiss\fcharset0\fprq2 Arial;}{\f67\froman\fcharset0\fprq2 Georgia;}}{\stylesheet{\snext0\f46\fs22\fi0\li0\ri0\ql{\*\stloverrides\f46\fs22\widctlpar} Normal;}{\s1\sbasedon0\snext0\f46\fs28\b\kerning28\fi0\li0\ri0\ql\keepn\sb240\sa60{\*\stloverrides\fs28\b\kerning28\keepn\sb240\sa60} heading 1;}{\s2\sbasedon0\snext0\f46\fs24\b\i\fi0\li0\ri0\ql\keepn\sb240\sa60{\*\stloverrides\fs24\b\i\keepn\sb240\sa60} heading 2;}{\s3\sbasedon0\snext0\f46\fs22\b\fi0\li0\ri0\ql\keepn\sb240\sa60{\*\stloverrides\b\keepn\sb240\sa60} heading 3;}}{\info{\operator alexey}{\creatim\yr2004\mo9\dy13\hr15\min1\sec47}{\author Алексей Возмищев}}\margl1440\margr1440\widowctrl\useltbaln\plain\f36\fs24\pard\qj\f13\fs30\b Формат \f67\lang1033\fs32 help6x\fs22\b0\\\\f13\lang1049\\fs20\b ОБЩИЕ СВЕДЕНИЯ\b0\fs22\\f67\lang1033\\fs24\i help6x\fs22\i0  - {\lang1049\f13 основанный на }xml {\lang1049\f13 язык разметки (аналог }DocBook{\lang1049\f13 ), хранящий исходные тексты контекстной справки ГАРАНТ 6.х. Последовательностью }xslt-{\lang1049\f13 преобразований исходный текст трансформируется в набор входных  файлов для }Html Help Workshop. {\f13\lang1049 Этот набор сохраняется на диск и состоит из файлов-топиков в формате }html, {\f13\lang1049 изображений, }css-{\lang1049\f13 файла стилей, }js-{\f13\lang1049 скриптов,} {\lang1049\f13 а также файла проекта, файла ключевых слов и файла оглавления. После автоматической компиляции этот набор файлов превращается в справку в формате }chm.\\f13\lang1049\В процессе преобразований в компилируемую систему подключаются данные, экспортированные из программной оболочки 6.х. Основным файлом является \f67\lang1033\i vcm-\f13\lang1049 описание\i0   оболочки, также имеющее {\f67\lang1033 xml-}формат. К нему прилагается набор графических изображений-пиктограмм из интерфейса оболочки. Описание содержит полный перечень окон и команд, реализованных в оболочке, а также их взаимосвязи, текстовые названия, шоткаты и т.д.  \\Все упоминания объектов  {\f67\lang1033 vcm (}окна, сущности, команды{\f67\lang1033 ) }в справочной системе основываются на внутренних идентификаторах этих объектов. Таким образом, при смене их названий, пиктограмм или горячих клавиш новые, актуальные значения этих параметров будут импортированы в справочную систему автоматически.\f67\lang1033\\\f13\lang1049 Все действия по трансформированию исходных текстов выполняются единственным скриптом. Скрипт создает выходной файл в формате {\f67\lang1033 chm }и открывает его после успешного завершения компиляции.\lang1033\f67\\\f13\lang1049 Преимущества данной системы - полная независимость от платных "внешних" инструментов, нетребовательность, настраиваемость, учет особенностей программной оболочки ГАРАНТа. При необходимости на основе исходных файлов можно одновременно создавать файлы справки и в других форматах ({\f67\lang1033 html, rtf, pdf }и т.д.), в т.ч. и с другой структурой (например, выводить весь текст справки на одной странице, как это сделано для системы Гарант-Интранет). Для этого требуется написать дополнительные правила преобразования и подключить необходимые конверторы.\\f67\lang1033\\\f13\b\lang1049 ИНСТРУМЕНТЫ\b0\f67\lang1033\\\f13\lang1049 1. Для {\f67\lang1033 xslt-}преобразования входных файлов требуется установленный в операционной системе процессор {\f67\lang1033 MSXML 4.0. }Эта версия процессора изначально встроена в последние версии ОС {\f67\lang1033 Windows, }а также{\f67\lang1033  }всегда доступна для скачивания с сайта \f67\lang1033 Microsoft.\\2. {\f13\lang1049 Компиляция в формат }chm {\f13\lang1049 выполняется с помощью }Microsoft Html Help Workshop, \f13\lang1049 который также должен быть установлен в системе.\\f67\lang1033\\lang1049\\f13\fs20\b РАЗМЕЩЕНИЕ ФАЙЛОВ\b0\fs22\\nowidctlpar\widctlpar\f67\lang1033\\f13\lang1049 Исходные тексты, входные данные, скрипт компиляции, правила {\f67\lang1033 xslt-}преобразований и {\lang1033\f67  }прочие компоненты системы размещаются в фиксированной структуре каталогов, корень которой доступен в репозитарии {\f67\lang1033 CVS }по адресу\\\i\\garant6x\\implementation\\garant\\gbanemesis\\help\\\i0\f67\lang1033\\\f13\lang1049 Все пути, упоминаемые внутри этой структуры, относительны (исключение - вызов {\f67\lang1033 chm-}компилятора). Все выходные файлы также создаются во вложенных каталогах.\\f67\lang1033\\f13\lang1049\\f67\i\lang1033 1. \\data\i0  - {\f13\lang1049 входные файлы: исходные тексты, }vcm-{\f13\lang1049 описания, изображения}\\\li720\i\\data\\\f13 data.xml - \i0\lang1049 исходные тексты справочной системы\lang1033\f67\\i\\data\\\f13 nemesis.xml\i0  - \f67 vcm-{\f13\lang1049 описание программной оболочки}\\li0\\li720\i\\data\\images\\\lang1049\f13 help - {\i0 изображения, используемые в оформлении справки}\\f67\lang1033\\data\\images\\ \lang1049\f13 icon - {\i0 пиктограммы, экспортированные из оболочки}\\f67\lang1033\\data\\images\\ \lang1049\f13 icon_nonvcm - {\i0 прочие пиктограммы}\\f67\lang1033\\data\\images\\ \lang1049\f13 screenshot - \i0 экранные срезы\\li0\f67\lang1033\\\i 2. \\output\i0  - {\f13\lang1049 выходной каталог}\\li720\i\\output\\chm\\garant.chm\i0  - {\f13\lang1049 выходной файл в формате }chm\\li0\\\i 3. \\rules \i0 - {\lang1049\f13 скрипты и правила преобразования в различные форматы}\\\li720\i\\rules\\chm - \lang1049\i0\f13 скрипты и правила преобразования в \f67\lang1033 chm\\i\\rules\\common - \lang1049\i0\f13 скрипты, общие для всех форматов\\li0\f67\lang1033\\li720\i\\rules\\chm\\files - \i0 css- {\f13\lang1049 и }js-{\f13\lang1049 файлы, подключаемые к справке}\\i\\rules\\chm\\{\f13  make.wsf }- \f13\i0\lang1049 основной скрипт, выполняющий{\lang1033\f67  } преобразования\lang1033\f67\\i\\rules\\chm\\*.xsl - \lang1049\i0\f13 файлы {\f67\lang1033 xslt }с правилами преобразований\lang1033\f67\\li0\\\\\i 4. \\tools - \f13\i0\lang1049 утилита масштабирования подключаемых изображений-скриншотов.\lang1033\f67\\\\i 5. make.bat\i0  - \f13\lang1049 файл, вызывающий скрипты компиляции. На данный момент вызывает только \f67\i\lang1033\\rules\\chm\\\f13  make.wsf.\i0\f67\\\\nowidctlpar\f13\fs20\b\lang1049 АКТУАЛЬНОСТЬ\b0\fs22\\nowidctlpar\widctlpar\Последнее {\f67\lang1033 vcm-}описание, полученное от Шуры Люлина, датируется 10/09/2004. \\Исходные файлы справки приведены в актуальное состояние согласно этому описанию и скомпилированы 13/09/2004.\\-----\\Текущее {\f67\lang1033 vcm-}описание содержит ряд ошибок, о которых сообщено Шуре Люлину. Так, например, оно не содержит упоминаний о главной форме настроек. Эта и ряд других причин делали работы по описание настроек системы нецелесообразными (вплоть до настоящего момента). Вся остальная функциональность системы описана полностью.\\-----\\Скриншоты, создаваемые в процессе написания справки, устарели практически полностью. Перед выпуском ГАРАНТа в коммерческую эксплуатацию требуется переработка всех скриншотов с обязательным сохранением всех наложенных на изображения элементов (надписей, рамок, стрелок-указателей).\\\nowidctlpar\f67\\nowidctlpar\widctlpar\f13\fs20\b НАСТРОЙКА\b0\f67\fs22\\\f13 При необходимости следует отредактировать в файле \f67\\\i\lang1033\\rules\\chm\\\f13  make.wsf\lang1049\i0\\строку 71 (по состоянию на 14.09.2004) со следующим содержанием:\\\i C:\\\\Program Files\\\\Help Workshop\\\\hhc.exe\i0\f67\lang1033\\\f13\lang1049 В строке следует указать актуальный путь к компилятору \f67\lang1033 Html Help Workshop.\\\\nowidctlpar\f13\fs20\b\lang1049 ПРОЦЕДУРА КОМПИЛЯЦИИ\b0\fs22\\Для запуска преобразований и компиляции используется \i\\\f67\lang1033 make.bat {\f13\i0\lang1049 или }\\rules\\chm\\\f13  make.wsf.\i0  \lang1049 При нормальном течении сборки никаких окон или сообщений не выводится. Процедура активно потребляет процессорные ресурсы и занимает ок. пяти минут на ПК средней мощности. По завершении процесса открывается созданный файл справки {\f67\i\lang1033\\output\\chm\\garant.chm}, который перед следующей компиляцией следует обязательно закрыть.\\В процессе преобразований проверяется ссылочная целостность, и в случае ее нарушения в отдельном окне браузера выводится сводная информация о "повисших" ссылках на {\f67\lang1033 vcm-}объекты и о топиках, не имеющих соответствия в {\f67\lang1033 vcm -}описании.\\\li720\nowidctlpar\widctlpar Прим. Для успешной компиляции необходимы права на запись в подкаталоги \f67\lang1033{\i output} \f13\lang1049 и в {\lang1033\i\f67\\rules\\chm\\. }При компиляции не допускается залоченность каких-либо создаваемых файлов, в т.ч. результирующего файла справки. В произвольный момент вермени может быть запущена только одна компиляция. При необходимости прервать процесс следует использовать {\f67\lang1033 Task Manager, }снимая процессы: {\f67\lang1033 wscript }или\lang1033\f67  hhc.\\pard\qj\lang1049\\\\f13\fs20\b ФОРМАТ\f67\fs22\b0\\nowidctlpar\widctlpar\\f13\b Элементы разметки\b0\f67\\\nowidctlpar\f13 Исходные тексты справочной системы могут содержать элементы языка разметки {\f67\lang1033 html, }а также следующие специализированные элементы разметки: \f67\lang1033\i topic, text, {\f13 screen, }com, {\f13 hint, hintn, }kw, sel, kdb, br2, description\i0\f13 . \\\lang1049 Из всего разрешенного множества элементов {\f67\lang1033 html }целесообразно использовать только следующие: \f67\lang1033{\i h3, p, br, ul, li, a, i, table, tr, td, hr}. {\f13\lang1049 Этого набора  достаточно для надлежащего оформления любых текстов. Для перечисленных элементов предусмотрены необходимые стилевые настройки.} {\f13\lang1049 Остальные элементы }html \f13\lang1049 настоятельным образом к использованию не рекомендуются.\\lang1033\\lang1049 Кроме того, некоторые элементы {\f67\lang1033 html }расширены специализированными атрибутами, описание которых, наряду с описанием специализированных элементов, приводится в настоящем документе.\\\b Особенности \f67\lang1033 XML\b0\f13\lang1049\\Базовый формат исходных текстов,  {\f67\lang1033 xml, }накладывает ряд требований по корректности оформления ({\f67\lang1033 well-formed }текст {\f67\lang1033 xml}). За исполнением этих требований тщательно следит {\lang1033\f67 xml-}парсер. Наличие ошибок в исходном тексте делает его компиляцию невозможной. В случае сообщений об ошибках рекомендуется открыть входной файл \f67\i\lang1033\\data\\\f13 data.xml \i0\lang1049 в любом веб-браузере, обнаружить строку  с ошибкой и исправить ее.\\Список требований к оформлению {\f67\lang1033 xml-}файлам можно найти в {\f67\lang1033 msdn }или в интернете. В качестве ключевого слова можно использовать {\f67\lang1033 xhtml (html-}файл на основе {\f67\lang1033 xml).}\\Вкратце эти требования таковы:\\1) теги должны быть парными и неперекрывающимися\2) для непарных тегов использовать дополнительный слеш: <{\f67\lang1033 br/}>\3) имена тегов и атрибутов - только в нижнем регистре\4) значения атрибутов - обязательно в двойных кавычках\5) спецсимволы <, >, &,  и т.п. (их немного) заменяются мнемоническими обозначениями типа &{\f67\lang1033 lt;}\\\\b Элементы\b0\\Описания приводятся в максимально краткой форме и без примеров, поскольку сопоставление результирующего{\lang1033\f67  chm }и исходного текста достаточно для выяснения правил преобразования любых элементов.\\\f67\lang1033 < topic \f13 title="{\lang1049 Заголовок страницы}" id="{\lang1049 уникальный идентификатор топика}"\f67 >\\f13\lang1049 </{\lang1033\f67 topic}>\f67\lang1033\\\li720\f13\lang1049 Структурная единица исходного текста.  Каждому тегу {\lang1033\f67\i topic} соответствует топик (страница) справочной системы и элемент в её оглавлении.\lang1033\f67\\\f13\lang1049 Имя {\f67\lang1033 html-}страницы формируется по след. правилу: {\f67\lang1033 page-< }идентификатор топика {\f67\lang1033 >.htm. }Это имя передается из оболочки при вызове конкретной странницы справочной системы.\\f67\lang1033\\f13\lang1049 Тег \f67\lang1033{\i topic} \f13\lang1049 может содержать теги: \f67\lang1033{\i topic, text, kw}.\\\f13\lang1049 Вложенные топики составят иерархическую структуру в оглавлении справочной системы.\lang1033\f67\\li0\<text>\ html-{\f13\lang1049 текст страницы}\\f13\lang1049 </{\lang1033\f67 text}>\\\li720 Текстовое наполнение топика. Любой текст должен быть оформлен как валидный {\f67\lang1033 xhtml. }Чисто текстовые фрагменты должны заключаться в \i <{\f67\lang1033 p}></{\f67\lang1033 p}>\i0 .\\Может содержать: {\f67\lang1033 html-}теги, \i\lang1033 screen, {\f67 com, }hint, hintn, \f67 kw, sel, kdb, br2.\lang1049\i0\f13\\li0\\lang1033 <screen  src="\lang1049 Имя {\f67\lang1033 jpg-}файла (без пути){\lang1033 "  title="}Подпись к рисунку\lang1033 "/> \\\li720\lang1049 Скриншот. Если требуется отключить масштабирование, добавить опциональный атрибут \f67\lang1033{\i nopreview="true"}.\f13\\li0\\f67 <com id="{\f13\lang1049 идентификатор топика}"/>\\\li720\f13\lang1049 Гипертекстовая ссылка на другой топик. Текстом для ссылки служит заголовок адресуемого топика. \\Чтобы изменить текст ссылки, можно добавить опциональный атрибут \lang1033\f67\i title="{\f13\lang1049 текст ссылки}"\i0 .\\\f13\lang1049 Чтобы скрыть пиктограмму в ссылке на {\f67\lang1033 vcm-}объект, можно добавить опциональный атрибут \f67\lang1033{\i icon="no"}.\f13\lang1049\\f67\lang1033\\f13\lang1049 Если в адресуемом топике размещен якорь <{\f67\lang1033 a name="}имя якоря{\f67\lang1033 "/}>, то сослаться на него можно так: {\f67\lang1033 <com id="}идентификатор топика#имя якоря{\lang1033\f67 "/>.}\\li0\f67\lang1033\\f13 <hint \f67 title="{\f13\lang1049 подсвечиваемый текст}"\f13 >\\lang1049 текст всплывающей подсказки\lang1033\</hint>\\\li720\lang1049 Всплывающая подсказка. Текст из {\f67\lang1033\i title }оформляется пунктирным подчеркиванием, а при наведении мыши всплывает текст подсказки.\\Все переводы строк в{\f67\lang1033  }тексте подсказки при ее выводе на экран сохраняются (подобно тегу {\f67\lang1033 pre}).\lang1033\\\li0 <hint{\f67 n}>\</hint{\f67 n}>\\\li720\lang1049 То же, что и \lang1033{\i hint}, {\lang1049 но текст подсказки форматируется произвольным образом.}\\li0\\f67 <kw name="{\f13\lang1049 имя ключевого слова}"/>\\\li720\f13\lang1049 Ключевое слово, отображающееся на вкладке {\f67\lang1033 Index }при просмотре хелпа.\\Данный тег может размещаться только внутри \f67\lang1033{\i topic, text}.\\li0\<sel>{\f13\lang1049 Выделяемый текст}</sel>\\\li720\f13\lang1049 Используется вместо \i <{\f67\lang1033 b}> <{\f67\lang1033 b}>\i0   для выделения фрагментов текста жирным серым шрифтом.\\li0\f67\lang1033\<kdb> </kdb>\\li720\\f13\lang1049 Оформление клавиатурных сочетаний, напр., \f67\lang1033 <kdb>Ctrl-P</kdb>.\\li0\<br/>, <br2/>\\\li720\f13\lang1049 Одинарный и двойной переводы строки.\lang1033\f67\\li0\<description \f13 id="\lang1049 идентификатор {\f67\lang1033 vcm-}объекта{\lang1033 " ann="}краткое описание объекта\lang1033 " \f67 >\\f13\lang1049  {\f67\lang1033 html-}текст описания\f67\lang1033\</description>\\\li720\f13\lang1049 Описание {\f67\lang1033 vcm-}объекта (окно-{\f67\lang1033 usertype, }элемент-{\f67\lang1033 entity, }команда-{\f67\lang1033 operation}). Может содержать те же теги, что и обычный топик.  \\Такие описания размещаются в теле исходника в секции {\f67\lang1033 <descriptions></descriptions>. }Для каждого {\f67\lang1033 vcm-}объекта ({\lang1033\f67 usertype, entity, operation}) из \f67\i\lang1033\\data\\\f13 nemesis.xml\i0\lang1049  должно присутствовать одно и только одно описание.\\\f67\lang1033 description{\f13\lang1049  преобразуется в обычный топик, идентификатор которого совпадает с указанным }id, {\f13\lang1049 а заголовком топика служит название }vcm-\f13\lang1049 объекта, импортированное при преобразовании.\\Для ссылки на такой топик используется обычный способ (<{\f67\lang1033 com id=""/}>).\\Идентификатор для тега {\f67\lang1033 description, }в отличие от других идентификаторов, должен задаваться не произвольным образом, а формироваться на основе следующих соглашений (необходимо для контекстного вызова справки из оболочки):\\для \f67\lang1033 usertype: <usertype id>\\f13\lang1049 для {\f67\lang1033 entity: <module id>-<entity  id>}\для \f67\lang1033 operation: <entity  id>-<operation id>\\f13\lang1049\Данные {\lang1033\f67 module id, usertype id, entity  id }и {\f67\lang1033 operation id }берутся из файла {\f67\lang1033 vcm-}описания. Для {\f67\lang1033 entity }и для {\f67\lang1033 operation }нужно указывать родительский элемент ({\f67\lang1033 module }и {\f67\lang1033 entity }соответственно), вышележащий в иерархии {\f67\lang1033 vcm-}описания{\f67\lang1033 .}\\Атрибут {\f67\lang1033 ann }должен содержать краткое,  в два-три предложения, описание данного объекта.\\li0\\\b Атрибуты\b0\\Здесь перечисляются элементы {\f67\lang1033 html, }для которых предусмотрены дополнительные атрибуты.\\<{\f67\lang1033 p style="}имя стиля{\f67\lang1033 "}> \ Текст абзаца.\</{\lang1033\f67 p}>\\\li720 модифицированный атрибут \f67\lang1033{\i style} {\f13\lang1049 может принимать значения "attn", "}note{\f13\lang1049 ", "}debug\f13\lang1049 ".\\li0\<{\f67\lang1033 a name="" title="}текст ссылки{\f67\lang1033 "/}>\\li720\f67\i\lang1033 title \i0\f13\lang1049 позволяет задать текст для гиперссылки, которая будет указывать на этот якорь.\\li0\\\\\f67\\nowidctlpar\widctlpar\f13\fs20\b СКРИНШОТЫ\b0\fs22\f67\\nowidctlpar\lang1033\\f13\lang1049 Для снятия скриншотов применялась утилита {\f67\lang1033 SnagIt 7.0, }имеющая встроенный редактор для "навешивания" на изображения различных надписей, указателей, рамок и т.п.\\Утилита имеет собственный формат (.{\f67\lang1033 ssd}) для хранения редактируемых копий{\f67\lang1033  }обработанных изображений, при открытии которых можно изменять положение надписей, редактировать наложенный текст, добавлять указатели и т.д. Все подключенные в справку скриншоты сохранены в двух форматах - во внутреннем, {\f67\lang1033 ssd (}для дальнейшего редактирования{\lang1033\f67 ), }и во "внешнем", {\f67\lang1033 jpg (}для встраивания  в справочную систему).\\f67\\f13 Снимаемые скриншоты должны иметь размер не больше ~ 650 х 400 пикселей (для корректного просмотра на 800{\f67\lang1033 x}600). В процессе преобразований для каждого скриншота создается и подключается его (уменьшенная) превью-копия шириной 300 {\f67\lang1033 px. }Приведение размеров выполняется независимо от исходного размера скриншота, в т.ч. и в большую сторону. Чтобы отключить масштабирование для небольших скриншотов, следует добавить атрибут \f67\lang1033{\i nopreview="true"} \f13\lang1049 к тегу \f67\lang1033{\i screen}.\f13\lang1049\\f67\\\nowidctlpar\widctlpar\f13\fs20\b КОНСУЛЬТАЦИИ\b0\fs22\f67\\\nowidctlpar\f13 Структура и наполнение файла {\f67\lang1033 vcm-}описания - Шура Люлин. К нему же обращаться за обновлениями.\f67\\\f13 Содержимое файла {\f67\lang1033 vcm-}описания ("опознание" объектов {\f67\lang1033 vcm, }их идентификаторы{\lang1033\f67 , }текстовые названия, ошибки и т.д.) - Дм. Тучнин. В последнее время, впрочем, модификацию структуры {\f67\lang1033 vcm }выполняют и другие разработчики.\f67\\\f13 Некоторый опыт написания хелпа {\f67\lang1033 c }использование данной системы имеет Затеев Артем.\f67\\\f13 Преобразования {\f67\lang1033 xslt - msdn }и книга А.Валикова, стоящая на полке в переговорной.\f67\\\\f13\i Конец документа\14.09.2004, А.Возмищев\i0\f67\\\}