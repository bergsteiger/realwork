#!/bin/sh

if test "$1" = "" ; then
echo "Usage: mpcxc_make_target <mwc_dir_relative_mpcxc_root> <mwc_file_without_dir> [<target_suffix>]"
exit
fi

if test "$MPCXC_ROOT" = ""; then
echo "You must export MPCXC_ROOT env to point to the root of your Multi Platform Common eXtra Code."
exit
fi

echo "mpcxc_make_target ..."

mwc_dir=$1
mwc_file=$2

target_suffix=$3
taoace_target=`$MPCXC_ROOT/src/garant6x/implementation/Projects/sh/build/uname2target.rb`
if test "$target_suffix" != "" ; then
taoace_target=$taoace_target"_"$target_suffix
fi
echo $taoace_target

if test "$taoace_target" = "" ; then
echo "mpcxc_make_target: FATAL: target platform = $taoace_target not supported."
exit
fi	  

echo "Optimize using $target_suffix"

export MPCXC_SH=$MPCXC_ROOT/src/garant6x/implementation/Projects/sh/build

export MPCXC_CONFIG=$MPCXC_ROOT/src/shared/support/mpc/make/TAOACE

export MPCXC_TARGET=$taoace_target

export TAOACE_MPCXC_ROOT=$MPCXC_ROOT
export TAOACE_MPCXC_TARGET=$taoace_target

export ACE_ROOT=$TAOACE_MPCXC_ROOT/src
export TAO_ROOT=$ACE_ROOT/TAO

###########export LOKI_ROOT="/home2/grigorio/samba2/2006-01-11" # must be in profile
###########export XERCES_ROOT="/home/grigorio/tuning/xerces-c-src_2_6_0" # must be in profile

$MPCXC_SH/partial_remake $mwc_dir $mwc_file

echo "end. See $MPCXC_ROOT/make_partial.log for details"
