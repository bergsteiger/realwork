
(object Petal
    version    	50
    _written   	"Rose 2006.0.0.060314"
    charSet    	204)

(object Class_Category "DiscussionsSupport"
    is_unit    	TRUE
    is_loaded  	TRUE
    attributes 	(list Attribute_Set
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"AbstarctOperation"
	    value      	"regular")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"IsNative"
	    value      	"false")
	(object Attribute
	    tool       	"MDA Generator User Properties"
	    name       	"name"
	    value      	"Garant Discussion Support")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"SELF GENERATED FILE (jar)"
	    value      	"w:/MDProcess/MDPlugins/src/etc/atlassian-plugin.xml")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"SELF GENERATED FILE (output.classpath)"
	    value      	"")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"SELF GENERATED FILE (output.project)"
	    value      	"")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"SELF GENERATED FILE (output.xml)"
	    value      	"")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"AutoCounter"
	    value      	"6")
	(object Attribute
	    tool       	"MDA Generator User Properties"
	    name       	"prefix"
	    value      	"ru.garant")
	(object Attribute
	    tool       	"MDA Generator User Properties"
	    name       	"vendor name"
	    value      	"ООО НПП 'Гарант-Сервис'")
	(object Attribute
	    tool       	"MDA Generator User Properties"
	    name       	"vendor url"
	    value      	"www.garant.ru")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"NESTED GENERATED FILES (java)"
	    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/CheckForDeadDiscussionsJob.java::468F4FB90148,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/CloseDiscussionPlugin.java::45FA6DAC034B,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/ClosedDiscussionMacro.java::45E43B700203,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/CommentBranchStateActionPlugin.java::4729BB88003E,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/CommentListener.java::45B719C1003E,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DashboardFilter.java::465ADE52034B,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DashboardFilterAction.java::465ADEEF0280,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DashboardQuery.java::468F4F6203B9,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DeadDiscussionMacro.java::468F4F130261,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DiscussionManager.java::468F4EC30177,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DiscussionVelocityContextPlugin.java::45FA988B008C,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DiscussionsMacroBase.java::460A5C2100AB,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/GarantHibernate.java::468F4E6C003E,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/GarantViewPageAction.java::47B2B67300EB,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/OpenDiscussionsMacro.java::45B72EE10213,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/PageListener.java::45BDE64A004E,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/RecentlyUpdatedContentMacro.java::460A5B8C0242,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/SweepOldDiscussionsJob.java::471C9E650261,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadComments.java::468F4D8C0109,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadDiscussion.java::468F4D7A00DA,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadDocument.java::468F4D6B002E,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadEntity.java::468F4D500196,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadStateActionPlugin.java::46690C610109,w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/VelocityItem.java::468F4D100213")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"NESTED GENERATED FILES (output.xml)"
	    value      	"")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"WikiPageID (wiki)"
	    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport|45B7192701D4
	    ))
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"NESTED GENERATED WikiPageID (wiki)"
	    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CheckForDeadDiscussionsJob|468F4FB90148::468F4FB90148;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CloseDiscussionPlugin|45FA6DAC034B::45FA6DAC034B;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/ClosedDiscussionMacro|45E43B700203::45E43B700203;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateActionPlugin|4729BB88003E::4729BB88003E;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage/SetCollapseState|477CE41200C7::4729BD22000F;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage/setCollapseState|477CE41200C7::4729BD22000F;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage|4729BDBB00CB::4729BD22000F;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin|4729BD22000F::4729BD22000F;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentListener|45B719C1003E::45B719C1003E;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/DashboardFilterAction|465ADEEF0280::465ADEEF0280;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/DashboardFilter|465ADE52034B::465ADE52034B;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/DashboardQuery|468F4F6203B9::468F4F6203B9;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/DeadDiscussionMacro|468F4F130261::468F4F130261;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/DiscussionManager|468F4EC30177::468F4EC30177;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/DiscussionVelocityContextPlugin|45FA988B008C::45FA988B008C;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/DiscussionsMacroBase|460A5C2100AB::460A5C2100AB;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/DiscussionsMacro|46120DA70290::46120DA70290;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/SetCheck|477CE1520369::465ADEC3030D;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/SetRadio|477CE1D40029::465ADEC3030D;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/setCheck|477CE1520369::465ADEC3030D;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/setRadio|477CE1D40029::465ADEC3030D;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage|465ADED20280::465ADEC3030D;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin|465ADEC3030D::465ADEC3030D;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantHibernate|468F4E6C003E::468F4E6C003E;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantViewPageAction|47B2B67300EB::47B2B67300EB;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/OpenDiscussionsMacro|45B72EE10213::45B72EE10213;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/PageListener|45BDE64A004E::45BDE64A004E;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/RecentlyUpdatedContentMacro|460A5B8C0242::460A5B8C0242;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/SweepOldDiscussionsJob|471C9E650261::471C9E650261;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadComments|468F4D8C0109::468F4D8C0109;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadDiscussion|468F4D7A00DA::468F4D7A00DA;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadDocument|468F4D6B002E::468F4D6B002E;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadEntity|468F4D500196::468F4D500196;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateActionPlugin|46690C610109::46690C610109;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadCommentState|477CE30702D0::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadEntityState|477CE2BE0096::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadEtityState|477CE2BE0096::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadStateForAll|477CE2DC02B7::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadState|477CE27B01EC::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadCommentState|477CE2F90279::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadEntityState|477CE2C80019::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadEtityState|477CE2C80019::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadState|477CE28702B3::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadCommentState|477CE30702D0::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadEtityState|477CE2BE0096::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadStateForAll|477CE2DC02B7::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadState|477CE27B01EC::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setUnreadCommentState|477CE2F90279::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setUnreadEtityState|477CE2C80019::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setUnreadState|477CE28702B3::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage|46690C5102CE::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin|46690C39037A::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/VelocityItem|468F4D100213::468F4D100213;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/CloseDiscussionPlugin|45FA6DAC034B::45FA6DAC034B;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/ClosedDiscussionMacro|45E43B700203::45E43B700203;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/CommentListener|45B719C1003E::45B719C1003E;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/DashboardFilterAction|465ADEEF0280::465ADEEF0280;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/DiscussionVelocityContextPlugin|45FA988B008C::45FA988B008C;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/DiscussionsMacroBase|460A5C2100AB::460A5C2100AB;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/DiscussionsMacro|46120DA70290::46120DA70290;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage|465ADED20280::465ADEC3030D;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin|465ADEC3030D::465ADEC3030D;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/OpenDiscussionsMacro|45B72EE10213::45B72EE10213;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/PageListener|45BDE64A004E::45BDE64A004E;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/RecentlyUpdatedContentMacro|460A5B8C0242::460A5B8C0242;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/UnreadStateActionPlugin|46690C610109::46690C610109;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage|46690C5102CE::46690C39037A;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin|46690C39037A::46690C39037A
	    ))
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"NESTED GENERATED FILES (vm)"
	    value      	"")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"SourceType (wiki)"
	    value      	"wiki")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"ElementCreationOrder"
	    value      	"19036085505"))
    quid       	"45B7192701D4"
    documentation 	"Библиотека плагинов для поддержки обсуждений."
    stereotype 	"KPlugins"
    visible_categories 	(list visibility_relationship_list
	(object Visibility_Relationship
	    quid       	"460A5D190109"
	    supplier   	"Logical View::external::JavaConfluence::ConfluenceClassPack"
	    quidu      	"45DAC0AA0232")
	(object Visibility_Relationship
	    quid       	"477E2B4B020D"
	    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsView"
	    quidu      	"477E2B2B02EC")
	(object Visibility_Relationship
	    quid       	"47861CD802E2"
	    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserData"
	    quidu      	"475FF9ED0184")
	(object Visibility_Relationship
	    quid       	"47B2B7240216"
	    supplier   	"Logical View::external::ConfluenceSupport::com.atlassian.confluence.pages.actions"
	    quidu      	"4795D23101A0")
	(object Visibility_Relationship
	    quid       	"47B2E242033F"
	    supplier   	"Logical View::MDProcess::ConfluencePlugins::FilterPanel"
	    quidu      	"473C40040346")
	(object Visibility_Relationship
	    quid       	"47BD5C3502F6"
	    supplier   	"Logical View::MDProcess::ConfluencePlugins::AutoCompleteSupport"
	    quidu      	"47BD59730221")
	(object Visibility_Relationship
	    quid       	"4F4C7B2901C7"
	    supplier   	"Logical View::external::ConfluenceSupport::com.atlassian.event"
	    quidu      	"4678041F021D")
	(object Visibility_Relationship
	    quid       	"4FB9FE1402B9"
	    supplier   	"Logical View::MDProcess::ConfluencePlugins::EntitySupport"
	    quidu      	"4B1F4958003C"))
    exportControl 	"Public"
    logical_models 	(list unit_reference_list
	(object Class "CommentListener"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"name"
		    value      	"")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/CommentListener.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B719C1003E_CUSTOM_IMPORT*"
		    value      	"//#UC START# *45B719C1003E_CUSTOM_IMPORT*¤import java.util.List;¤import ru.garant.MDProcess.ConfluencePlugins.ArchiveCommentSupport.ArchiveCommentAction;¤import ru.garant.MDProcess.ConfluencePlugins.Entities.ContentEntityObjectCache;¤¤import com.atlassian.confluence.core.ContentEntityObject;¤import com.atlassian.confluence.event.events.content.comment.*;¤import com.atlassian.confluence.pages.Comment;¤import com.atlassian.confluence.pages.AbstractPage;¤import com.google.common.cache.RemovalNotification;¤¤import ru.garant.shared.ConfluenceCore.LabelSupport.GarLabelManager;¤//#UC END# *45B719C1003E_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B719C1003E_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *45B719C1003E_CUSTOM_CLASS_DEFINITION*¤//#UC END# *45B719C1003E_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B719C1003E_GETHANDLEDEVENTCLASSES_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45B719C1003E_GETHANDLEDEVENTCLASSES_IMPLEMETATION*¤		return handledClasses;¤		//#UC END# *45B719C1003E_GETHANDLEDEVENTCLASSES_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B719C1003E_CUSTOM_OPERATION_DEFENITION*"
		    value      	(value Text 
|//#UC START# *45B719C1003E_CUSTOM_OPERATION_DEFENITION*¤	static private final String DISCUSSION_LABEL = "open";¤	//#UC END# *45B719C1003E_CUSTOM_OPERATION_DEFENITION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B719C1003E_HANDLEEVENT_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45B719C1003E_HANDLEEVENT_IMPLEMETATION*¤		try {¤			if (event instanceof CommentCreateEvent) {¤				CommentCreateEvent comment_event = (CommentCreateEvent)event;¤				Comment comment = comment_event.getComment ();¤				¤				unarchive_all_parents (comment);¤				AbstractPage page = comment.getPage ();¤¤				getGarLabelManager().removeLabel(page, DiscussionManager.CLOSE_DISCUSSION_LABEL);¤				getGarLabelManager().removeLabel(page, DiscussionManager.DEAD_DISCUSSION_LABEL);¤				getGarLabelManager().addLabel(page, DiscussionManager.OPEN_DISCUSSION_LABEL);¤				getGarLabelManager().addLabel(comment, DiscussionManager.COMMENT_DISCUSSION_LABEL);¤¤				getDiscussionManager ().onCommentCreate (comment);¤				ContentEntityObjectCache.Factory.get("COMMENTS_NO_CACHE").refresh(comment.getId());¤			} else if (event instanceof CommentUpdateEvent) {¤				CommentUpdateEvent comment_event = (CommentUpdateEvent)event;¤				Comment comment = comment_event.getComment ();¤				getDiscussionManager ().onCommentUpdate (comment);¤				ContentEntityObjectCache.Factory.get("COMMENTS_NO_CACHE").refresh(comment.getId());¤			} else if (event instanceof CommentRemoveEvent) {¤				CommentRemoveEvent comment_event = (CommentRemoveEvent)event;¤				Comment oldComment = comment_event.getComment ();¤				AbstractPage page = oldComment.getPage ();¤				List commentList = page.getComments();¤				int count = commentList.size();¤				String totalName = "(/) *" + ru.garant.shared.GCI.I18N.Messages.Factory.messages().get("total.name") + ":*";¤				String bodyContent = oldComment.getContent();¤				ContentEntityObjectCache.Factory.get("COMMENTS_NO_CACHE").delete(oldComment.getId());¤¤				if (count > 0) {¤					if(ContainerManager.Factory.get().getLabelManager().getLabel(page, DiscussionManager.CLOSE_DISCUSSION_LABEL) != null && bodyContent.contains(totalName)){¤						getGarLabelManager().removeLabel(page, DiscussionManager.CLOSE_DISCUSSION_LABEL);¤						getGarLabelManager().removeLabel(page, DiscussionManager.DEAD_DISCUSSION_LABEL);¤						getGarLabelManager().removeLabel(page, DiscussionManager.OPEN_DISCUSSION_LABEL);¤					}¤					getDiscussionManager ().onCommentRemove (oldComment);¤				} else {¤					getDiscussionManager ().removeUnreadDiscussion(page.getId());¤					getGarLabelManager().removeLabel(page, DiscussionManager.CLOSE_DISCUSSION_LABEL);¤					getGarLabelManager().removeLabel(page, DiscussionManager.DEAD_DISCUSSION_LABEL);¤					getGarLabelManager().removeLabel(page, DiscussionManager.OPEN_DISCUSSION_LABEL);¤				}¤			} else {¤				Logs.LOG_E (¤					" CommentListener::handleEvent: ERROR! Event type is unknown '"¤					+ event.getClass ().getName () + "'"¤				);¤			}¤		} catch (Exception e) {¤			Logs.LOG_E ("CommentListener::handleEvent: ERROR(" + e + "): " + e.getMessage ());¤			Logs.LOG_SEX(e);¤			Logs.LOG_E ("CommentListener::handleEvent: --------------------------------------------------------");¤		}¤		//#UC END# *45B719C1003E_HANDLEEVENT_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B719C1003E_CUSTOM_ABSTRACT*"
		    value      	(value Text 
|//#UC START# *45B719C1003E_CUSTOM_ABSTRACT*¤	//#UC END# *45B719C1003E_CUSTOM_ABSTRACT*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B719C1003E_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *45B719C1003E_CUSTOM_METHODS_AND_DATA*¤	private void unarchive_all_parents (Comment comment) {¤		ArchiveCommentAction.unarchiveComment(comment);¤		Comment parentComment = comment.getParent ();¤		if (parentComment != null) {¤			unarchive_all_parents (parentComment);¤		}¤	}¤¤	private DiscussionManager discussionManager = null;¤	private DiscussionManager getDiscussionManager () {¤		if (this.discussionManager == null) {¤			this.discussionManager = (DiscussionManager) com.atlassian.spring.container.ContainerManager.getComponent("ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager");¤			if (this.discussionManager == null) {¤				Logs.LOG_E ("CommentListener::getOpenDiscussionManager: can not find OpenDiscussionManager");¤			}¤		}¤		return this.discussionManager;¤	}¤¤	public GarLabelManager getGarLabelManager () {¤		return ContainerManager.Factory.get().getLabelManager();¤	}¤ 	//#UC END# *45B719C1003E_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B719C1003E_CONTENT*"
		    value      	(value Text 
|//#UC START# *45B719C1003E_CONTENT*¤		CommentCreateEvent.class¤		, CommentRemoveEvent.class¤		, CommentUpdateEvent.class¤		//#UC END# *45B719C1003E_CONTENT*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/CommentListener|45B719C1003E
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038956375"))
	    quid       	"45B719C1003E"
	    documentation 	
|Слушает событие о добавлении коментария, когда услышал - зовет
|OpenDiscussions для перевода страницы (для которой ставится коментарий) в
|состояние с открытм обсуждением и удаляет из списка закрытых, если она там
|была.
	    
	    stereotype 	"KListenerPlugin"
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006306513"))
		    quid       	"468F5741009C"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionManager"
		    quidu      	"468F4EC30177"))
	    language   	"MDA Generator")
	(object Class "OpenDiscussionsMacro"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/OpenDiscussionsMacro.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B72EE10213_CUSTOM_IMPORT*"
		    value      	"//#UC START# *45B72EE10213_CUSTOM_IMPORT*¤¤import java.util.*;¤¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤¤//#UC END# *45B72EE10213_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B72EE10213_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *45B72EE10213_CUSTOM_CLASS_DEFINITION*¤//#UC END# *45B72EE10213_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B72EE10213_CUSTOM_OPERATION_DEFENITION*"
		    value      	(value Text 
|//#UC START# *45B72EE10213_CUSTOM_OPERATION_DEFENITION*¤	//#UC END# *45B72EE10213_CUSTOM_OPERATION_DEFENITION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B72EE10213_CUSTOM_ABSTRACT*"
		    value      	(value Text 
|//#UC START# *45B72EE10213_CUSTOM_ABSTRACT*¤	//#UC END# *45B72EE10213_CUSTOM_ABSTRACT*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B72EE10213_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *45B72EE10213_CUSTOM_METHODS_AND_DATA*¤	public String getName() {¤        return "OpenDiscussionsMacro";¤    }¤	protected DashboardFilter.DashboardListType getType () {¤		return DashboardFilter.DashboardListType.ACTIVE;¤	}¤	¤	protected String getMySQLQuery (boolean unreadOnly, String inSpaces, List<String> andFilter, String excludeFilter) {¤	 	String ret = "SELECT STRAIGHT_JOIN uds.entity_id, uds.date, uds.lastCommentId, uds.lastCommentAuthor, ucomm.count, ucomm.firstComment, ucomm.firstCommentAuthor, ucomm.date, ucomm.id"¤ 			+ " FROM content_label cl";¤	 	¤	 	if (inSpaces.length() > 0) {¤	 		ret += " JOIN content page ON (cl.contentid = page.contentid AND page.spaceid IN (" + inSpaces + "))";¤	 	}¤	 	¤	 	for (int i = 0; i < andFilter.size (); i++) {¤	 		String s = andFilter.get(i);¤	 		String cl = "cl" + (i+1);¤			ret += " JOIN content_label " + cl + " ON (" + cl + ".contentid = cl.contentid AND " + cl + ".labelid in (" + s + "))";	 		¤	 	}¤	 	¤	 	if(unreadOnly) {¤	 		ret += " JOIN unread_discussions_map udm ON (udm.entity_id = cl.contentid AND udm.user_name = '" + AuthenticatedUserThreadLocal.getUsername() + "')"¤ 				+ " JOIN unread_discussions uds ON (uds.entity_id = cl.contentid)"¤ 				+ " JOIN unread_comments ucomm ON (ucomm.id = udm.unread_comments_id AND ucomm.count > 0)"¤			;	 		¤	 	} else {¤	 		ret += " LEFT JOIN unread_discussions_map udm ON (udm.entity_id = cl.contentid AND udm.user_name = '" + AuthenticatedUserThreadLocal.getUsername() + "')"¤ 				+ " JOIN unread_discussions uds ON (uds.entity_id = cl.contentid)"¤ 				+ " LEFT JOIN unread_comments ucomm ON (ucomm.id = udm.unread_comments_id)"¤ 			;¤	 	}¤	 	¤ 		ret += " JOIN content comm ON (uds.lastCommentId = comm.contentid)"¤ 			+ " WHERE cl.labelid = " + ContainerManager.Factory.get().getLabelManager().getLabel("open").getId()¤			+ ((excludeFilter.length() > 0)¤					? " AND cl.contentid NOT IN ("¤						+ "SELECT ecl.contentid FROM content_label ecl"¤						+ " WHERE ecl.labelid in ("+ excludeFilter +")"¤						+")"¤				: ""¤			)¤			+ " ORDER BY comm.lastmoddate desc"¤ 		;¤	 	return ret;¤	}¤	//#UC END# *45B72EE10213_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B72EE10213_ISINLINE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45B72EE10213_ISINLINE_IMPLEMETATION*¤		return false;¤		//#UC END# *45B72EE10213_ISINLINE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B72EE10213_HASBODY_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45B72EE10213_HASBODY_IMPLEMETATION*¤		return false;¤		//#UC END# *45B72EE10213_HASBODY_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B72EE10213_GETBODYRENDERMODE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45B72EE10213_GETBODYRENDERMODE_IMPLEMETATION*¤		return RenderMode.NO_RENDER;¤		//#UC END# *45B72EE10213_GETBODYRENDERMODE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45B72EE10213_EXECUTE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45B72EE10213_EXECUTE_IMPLEMETATION*¤		try {¤			// now create a simple velocity context and render a template for the output¤			Map<String, Object> contextMap = MacroUtils.defaultVelocityContext ();¤			String strHeader = (String)parameters.get ("header");¤			if (strHeader != null) {¤				contextMap.put ("header", strHeader);¤			}¤			String strSpace =  (String)parameters.get ("space");¤			if (strSpace != null) {¤				contextMap.put ("curSpace", strSpace);¤			}¤¤			String strStartLines = (String)parameters.get ("lines");¤			if (strStartLines == null) {¤				contextMap.put ("lines", new Integer (999999));¤			} else {¤				contextMap.put ("lines", new Integer (strStartLines));¤			}¤			String strInc = (String)parameters.get ("inc");¤			if (strInc == null) {¤				contextMap.put ("inc", new Integer (999999));¤			} else {¤				contextMap.put ("inc", new Integer (strInc));¤			}¤			User user = AuthenticatedUserThreadLocal.getUser ();¤			if (user != null) { // if the user was logged¤				contextMap.put ("curUser", user.getName ());¤			}¤			//¤			int intAgoFrom = get_int ((String)parameters.get ("ago_from"), 0);¤			int intAgoTo = get_int ((String)parameters.get ("ago_to"), 999999999);¤			List<Discussion2> list = getDiscussionList (strSpace, intAgoFrom, intAgoTo);¤			if (get_int ((String)parameters.get ("sort_dir"), 0) == 0) {¤				Collections.sort (list, new DiscussionList.ComparatorByDateIncrease ());¤			} else {¤				Collections.sort (list, new DiscussionList.ComparatorByDateDecrease ());¤			}¤			contextMap.put ("discussionList", list);¤¤			contextMap.put ("open_discussion", true);¤			contextMap.put ("maxRecentlyUpdatedPageCount", "maxRecentlyUpdatedPageCount" + this.getClass ().getSimpleName ());¤¤			contextMap.put ("discussionmanager", getOpenDiscussionManager ());¤			contextMap.put ("pagemanager", this.pageManager);¤			contextMap.put ("commentmanager", this.commentManager);¤			ContentEntityObject contentObject = ((PageContext)renderContext).getEntity ();¤			contextMap.put ("content", contentObject);¤¤			return VelocityUtils.getRenderedTemplate ("OpenDiscussionsMacro.vm", contextMap);¤		} catch (Exception e) {¤			System.err.println ("OpenDiscussionsMacro:execute: error:" + e.getMessage ());¤			throw new MacroException(e.getMessage());¤		}¤	//#UC END# *45B72EE10213_EXECUTE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/OpenDiscussionsMacro|45B72EE10213
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038960781"))
	    quid       	"45B72EE10213"
	    documentation 	"Макрос, который показывает на странице список активных (открытых) обсуждений."
	    stereotype 	"KMacroPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"460BB55B0138"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionsMacroBase"
		    quidu      	"460A5C2100AB"))
	    language   	"MDA Generator")
	(object Class "PageListener"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/PageListener.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45BDE64A004E_CUSTOM_IMPORT*"
		    value      	"//#UC START# *45BDE64A004E_CUSTOM_IMPORT*¤import com.atlassian.confluence.event.events.content.page.*;¤import com.atlassian.confluence.event.events.content.blogpost.*;¤import com.atlassian.spring.container.ContainerManager;¤import com.atlassian.confluence.event.events.content.attachment.*;¤import ru.garant.MDProcess.ConfluencePlugins.IconsSelectorSupport.IconSelectorInVelocity;¤import ru.garant.MDProcess.DocCardChange.DocCardSupport.DpoUvsHelper;¤¤import com.atlassian.confluence.labels.Label;¤import com.atlassian.confluence.labels.LabelParser;¤import java.util.Date;¤import java.util.List;¤import java.util.Map;¤//#UC END# *45BDE64A004E_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45BDE64A004E_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *45BDE64A004E_CUSTOM_CLASS_DEFINITION*¤//#UC END# *45BDE64A004E_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45BDE64A004E_CONTENT*"
		    value      	(value Text 
|//#UC START# *45BDE64A004E_CONTENT*¤		BlogPostCreateEvent.class, BlogPostUpdateEvent.class, BlogPostRestoreEvent.class¤		, BlogPostRemoveEvent.class, BlogPostTrashedEvent.class¤		, BlogPostViewEvent.class¤		, PageCreateEvent.class, PageUpdateEvent.class, PageRestoreEvent.class¤		, PageRemoveEvent.class, PageTrashedEvent.class¤		, PageViewEvent.class¤		, ResetViewEntityEvent.class¤		, BlogPostViewDiffEvent.class¤		, PageViewDiffEvent.class¤		, AttachmentCreateEvent.class, AttachmentRemoveEvent.class, AttachmentUpdateEvent.class¤		//#UC END# *45BDE64A004E_CONTENT*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45BDE64A004E_CUSTOM_OPERATION_DEFENITION*"
		    value      	(value Text 
|//#UC START# *45BDE64A004E_CUSTOM_OPERATION_DEFENITION*¤	//#UC END# *45BDE64A004E_CUSTOM_OPERATION_DEFENITION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45BDE64A004E_GETHANDLEDEVENTCLASSES_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45BDE64A004E_GETHANDLEDEVENTCLASSES_IMPLEMETATION*¤		return handledClasses;¤		//#UC END# *45BDE64A004E_GETHANDLEDEVENTCLASSES_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45BDE64A004E_HANDLEEVENT_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45BDE64A004E_HANDLEEVENT_IMPLEMETATION*¤		try {¤			javax.servlet.http.HttpServletRequest reqHTTP = com.opensymphony.webwork.ServletActionContext.getRequest();¤			if (reqHTTP != null) {¤				String actionName = reqHTTP.getRequestURL().substring(reqHTTP.getRequestURL().lastIndexOf("/")+1);¤				if (actionName != null) {¤					if (actionName.equals("importoldrequest.action") || actionName.equals("importreleases.action")) {¤						return;¤					}¤				}¤			}¤		} catch (Exception e) {¤		}¤		¤		try {¤			if ((event instanceof BlogPostCreateEvent)¤					|| (event instanceof BlogPostRestoreEvent)){¤				BlogPostEvent pageEvent  = (BlogPostEvent)event;¤				getDiscussionManager ().onDocumentUpdate (pageEvent.getBlogPost(), false);¤			} else if (event instanceof BlogPostUpdateEvent) {¤				BlogPostUpdateEvent pageEvent  = (BlogPostUpdateEvent)event;¤				getDiscussionManager ().onDocumentUpdate (pageEvent.getBlogPost(), pageEvent.isMinorEdit());¤			} else if ((event instanceof BlogPostRemoveEvent)¤					|| (event instanceof BlogPostTrashedEvent)) {¤				BlogPostEvent pageEvent  = (BlogPostEvent)event;¤				getDiscussionManager ().onDocumentRemove (pageEvent.getBlogPost());¤			} else if (event instanceof BlogPostViewEvent || event instanceof BlogPostViewDiffEvent) {¤				BlogPostEvent pageEvent  = (BlogPostEvent)event;¤				getDiscussionManager ().onDocumentView (pageEvent.getBlogPost());¤			} else if ((event instanceof PageCreateEvent)¤					|| (event instanceof PageRestoreEvent)) {¤				PageEvent pageEvent  = (PageEvent)event;¤				getDiscussionManager ().onDocumentUpdate (pageEvent.getPage (), false);¤			} else if (event instanceof PageUpdateEvent) {¤				PageUpdateEvent pageEvent  = (PageUpdateEvent)event;¤				getDiscussionManager ().onDocumentUpdate (pageEvent.getPage (), pageEvent.isMinorEdit());¤				DpoUvsHelper.changeBandanaValueForGardocConfigIni(((PageUpdateEvent) event).getPage());¤			} else if ((event instanceof PageRemoveEvent)¤					|| (event instanceof PageTrashedEvent)) {¤				PageEvent pageEvent  = (PageEvent)event;¤				getDiscussionManager ().onDocumentRemove (pageEvent.getPage ());¤			} else if (event instanceof PageViewEvent || event instanceof PageViewDiffEvent) {¤				long time = new Date().getTime();¤				PageEvent pageEvent  = (PageEvent)event;¤				getDiscussionManager ().onDocumentView (pageEvent.getPage ());¤				Logs.LOG_W("PageListener::event=" + event.toString() + " time=" + (new Date().getTime() - time));¤			} else if (event instanceof ResetViewEntityEvent) {¤				ResetViewEntityEvent rve_event = (ResetViewEntityEvent)event;¤				getDiscussionManager ().onDocumentSimpleViewAll (rve_event.getPage ());¤			/////////////////////////////////////////////////////////////////////////¤			// The code below has to be in the IconsSelectorSupport package!¤			} else if (event instanceof AttachmentEvent) {¤				AttachmentEvent attach_event = (AttachmentEvent)event;¤				if (IconSelectorInVelocity.isConfluenceConfigPage(attach_event.getContent())) {¤					IconSelectorInVelocity.updateIconMaps();¤				}¤			/////////////////////////////////////////////////////////////////////////¤			} else {¤				Logs.LOG_E (¤						" PageListener::handleEvent: ERROR! Event type is unknown '"¤						+ event.getClass ().getName () + "'"¤				);¤			}¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤		//#UC END# *45BDE64A004E_HANDLEEVENT_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45BDE64A004E_CUSTOM_ABSTRACT*"
		    value      	(value Text 
|//#UC START# *45BDE64A004E_CUSTOM_ABSTRACT*¤	//#UC END# *45BDE64A004E_CUSTOM_ABSTRACT*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45BDE64A004E_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *45BDE64A004E_CUSTOM_METHODS_AND_DATA*¤	private DiscussionManager discussionManager = null;¤	public DiscussionManager getDiscussionManager () {¤		if (this.discussionManager == null) {¤			this.discussionManager = (DiscussionManager) ContainerManager.getComponent ("ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager");¤			if (this.discussionManager == null) {¤				Logs.LOG_E ("PageListener::getOpenDiscussionManager: can not find OpenDiscussionManager");¤			}¤		}¤		return this.discussionManager;¤	}¤¤	public static class ResetViewEntityEvent extends com.atlassian.confluence.event.events.content.page.PageEvent {¤		private static final long serialVersionUID = 1123992951310531211l;¤		public ResetViewEntityEvent (Object src, com.atlassian.confluence.pages.Page page) {¤			super (src, page);¤		}¤	}¤	public static class PageViewDiffEvent extends com.atlassian.confluence.event.events.content.page.PageEvent {¤		private static final long serialVersionUID = 1123992951310531212l;¤		public PageViewDiffEvent (Object src, com.atlassian.confluence.pages.Page page) {¤			super (src, page);¤		}¤	}¤	public static class BlogPostViewDiffEvent extends com.atlassian.confluence.event.events.content.blogpost.BlogPostEvent {¤		private static final long serialVersionUID = 1123992951310531213l;¤		public BlogPostViewDiffEvent (Object src, com.atlassian.confluence.pages.BlogPost blogpost) {¤			super (src, blogpost);¤		}¤	}¤	¤	//#UC END# *45BDE64A004E_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/PageListener|45BDE64A004E
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039029001"))
	    quid       	"45BDE64A004E"
	    documentation 	"Обрабатывает событие просмотра документа. Если по документу ведется дискусия, то отмечает, что текущий Пользователь смотрел данный документ, чтобы снять выделение в списке открытых и закрытых дискусий."
	    stereotype 	"KListenerPlugin"
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006307930"))
		    quid       	"468F5744031C"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionManager"
		    quidu      	"468F4EC30177"))
	    language   	"MDA Generator")
	(object Class "ClosedDiscussionMacro"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/ClosedDiscussionMacro.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45E43B700203_CUSTOM_IMPORT*"
		    value      	"//#UC START# *45E43B700203_CUSTOM_IMPORT*¤¤import java.util.List;¤¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤¤//#UC END# *45E43B700203_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45E43B700203_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *45E43B700203_CUSTOM_CLASS_DEFINITION*¤//#UC END# *45E43B700203_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45E43B700203_CUSTOM_OPERATION_DEFENITION*"
		    value      	(value Text 
|//#UC START# *45E43B700203_CUSTOM_OPERATION_DEFENITION*¤	//#UC END# *45E43B700203_CUSTOM_OPERATION_DEFENITION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45E43B700203_EXECUTE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45E43B700203_EXECUTE_IMPLEMETATION*¤		try {¤			// now create a simple velocity context and render a template for the output¤			Map defVelocityContext = MacroUtils.defaultVelocityContext ();¤			final Map<String, Object> contextMap = defVelocityContext;¤			String strHeader = (String)parameters.get ("header");¤			if (strHeader != null) {¤				contextMap.put ("header", strHeader);¤			}¤			String strSpace =  (String)parameters.get ("space");¤			if (strSpace != null) {¤				contextMap.put ("curSpace", strSpace);¤			}¤¤			String strStartLines = (String)parameters.get ("lines");¤			if (strStartLines == null) {¤				contextMap.put ("lines", new Integer (999999));¤			} else {¤				contextMap.put ("lines", new Integer (strStartLines));¤			}¤			String strInc = (String)parameters.get ("inc");¤			if (strInc == null) {¤				contextMap.put ("inc", new Integer (999999));¤			} else {¤				contextMap.put ("inc", new Integer (strInc));¤			}¤¤			User user = AuthenticatedUserThreadLocal.getUser ();¤			if (user != null) { // if the user was logged¤				contextMap.put ("curUser", user.getName ());¤			}¤¤			List<Discussion2> list = getDiscussionList (strSpace);¤			contextMap.put ("discussionList", list);¤¤			contextMap.put ("open_discussion", false);¤			contextMap.put ("maxRecentlyUpdatedPageCount", "maxRecentlyUpdatedPageCount" + this.getClass ().getSimpleName ());¤¤			contextMap.put ("discussionmanager", getClosedDiscussionManager ());¤			contextMap.put ("pagemanager", this.pageManager);¤			contextMap.put ("commentmanager", this.commentManager);¤			ContentEntityObject contentObject = ((PageContext)renderContext).getEntity ();¤			contextMap.put ("content", contentObject);¤¤			return VelocityUtils.getRenderedTemplate ("OpenDiscussionsMacro.vm", contextMap);¤		} catch (Exception e) {¤			System.err.println ("ClosedDiscussionMacro:execute: error:" + e.getMessage ());¤			throw new MacroException(e.getMessage());¤		}¤		//#UC END# *45E43B700203_EXECUTE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45E43B700203_ISINLINE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45E43B700203_ISINLINE_IMPLEMETATION*¤		return false;¤		//#UC END# *45E43B700203_ISINLINE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45E43B700203_HASBODY_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45E43B700203_HASBODY_IMPLEMETATION*¤		return false;¤		//#UC END# *45E43B700203_HASBODY_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45E43B700203_GETBODYRENDERMODE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45E43B700203_GETBODYRENDERMODE_IMPLEMETATION*¤		return RenderMode.NO_RENDER;¤		//#UC END# *45E43B700203_GETBODYRENDERMODE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45E43B700203_CUSTOM_ABSTRACT*"
		    value      	(value Text 
|//#UC START# *45E43B700203_CUSTOM_ABSTRACT*¤	//#UC END# *45E43B700203_CUSTOM_ABSTRACT*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45E43B700203_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *45E43B700203_CUSTOM_METHODS_AND_DATA*¤	public String getName() {¤		return "ClosedDiscussionMacro";¤	}¤	protected DashboardFilter.DashboardListType getType () {¤		return DashboardFilter.DashboardListType.CLOSE;¤	}¤	protected boolean forceOnlyUnread () {¤		return false;¤	}¤	protected String getMySQLQuery (boolean unreadOnly, String inSpaces, List<String> andFilter, String excludeFilter) {¤	 	String ret =¤	 		"SELECT STRAIGHT_JOIN uds.entity_id, uds.date, uds.lastCommentId, uds.lastCommentAuthor"¤	 		+ ", ucomm.count, ucomm.firstComment, ucomm.firstCommentAuthor, ucomm.date, ucomm.id"¤			+ " FROM content_label cl";¤	 	¤	 	if (inSpaces.length() > 0) {¤	 		ret += " JOIN content page ON (cl.contentid = page.contentid AND page.spaceid IN (" + inSpaces + "))";¤	 	}¤	 	for (int i = 0; i < andFilter.size (); i++) {¤	 		String s = andFilter.get(i);¤	 		String cl = "cl" + (i+1);¤			ret += " JOIN content_label " + cl + " ON (" + cl + ".contentid = cl.contentid AND " + cl + ".labelid in (" + s + "))";	 		¤	 	}¤¤	 	if(unreadOnly) {¤	 		ret += " JOIN unread_discussions_map udm ON (udm.entity_id = cl.contentid AND udm.user_name = '" + AuthenticatedUserThreadLocal.getUsername() + "')"¤			+ " JOIN unread_discussions uds ON (uds.entity_id = cl.contentid)"¤			+ " JOIN unread_comments ucomm ON (ucomm.id = udm.unread_comments_id AND ucomm.count > 0)"¤	 		;¤	 	} else {¤	 		ret += " LEFT JOIN unread_discussions_map udm ON (udm.entity_id = cl.contentid AND udm.user_name = '" + AuthenticatedUserThreadLocal.getUsername() + "')"¤			+ " JOIN unread_discussions uds ON (uds.entity_id = cl.contentid)"¤			+ " LEFT JOIN unread_comments ucomm ON (ucomm.id = udm.unread_comments_id)"¤			;¤	 	}¤	 	¤ 		ret += " JOIN content comm ON (uds.lastCommentId = comm.contentid)"¤		+ " WHERE cl.labelid = " + ContainerManager.Factory.get().getLabelManager().getLabel("close").getId()¤		+ " AND cl.lastmoddate > '" + getLimitDateAsSQLString() + "'"¤		+ ((excludeFilter.length() > 0)¤				? " AND cl.contentid NOT IN ("¤					+ "SELECT ecl.contentid FROM content_label ecl"¤					+ " WHERE ecl.labelid in ("+ excludeFilter +")"¤					+")"¤				: ""¤			)¤			+ " ORDER BY comm.lastmoddate desc"¤		;¤	 	return ret;		¤	}¤	//#UC END# *45E43B700203_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/ClosedDiscussionMacro|45E43B700203
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038979312"))
	    quid       	"45E43B700203"
	    documentation 	"Макрос, который показывает на странице список закрытых обсуждений."
	    stereotype 	"KMacroPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"461110FA00DA"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionsMacroBase"
		    quidu      	"460A5C2100AB"))
	    language   	"MDA Generator")
	(object Class "CloseDiscussionPlugin"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/CloseDiscussionPlugin.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45FA6DAC034B_CUSTOM_IMPORT*"
		    value      	"//#UC START# *45FA6DAC034B_CUSTOM_IMPORT*¤import ru.garant.MDProcess.ConfluencePlugins.ArchiveCommentSupport.ArchiveCommentAction;¤import ru.garant.shared.ConfluenceCore.Helpers.ContainerManager;¤import ru.garant.shared.ConfluenceCore.LabelSupport.GarLabelManager;¤¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤import com.atlassian.confluence.util.ajax.AjaxResponse;¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.Comment;¤import com.opensymphony.util.TextUtils;¤¤import java.util.*;¤import net.sf.hibernate.*;¤import com.atlassian.confluence.labels.*;¤¤import ru.garant.shared.ConfluenceCore.ActionSupport.ActionContextThreadLocalFactory;¤import ru.garant.shared.GCI.I18N.Messages;¤//#UC END# *45FA6DAC034B_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45FA6DAC034B_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *45FA6DAC034B_CUSTOM_CLASS_DEFINITION*¤//#UC END# *45FA6DAC034B_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45FA6DAC034B_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *45FA6DAC034B_CUSTOM_METHODS_AND_DATA*¤¤	public CloseDiscussionPlugin() {¤	}¤¤	public AjaxResponse close (String entityId, String summaryComment) throws Exception {¤		return Close(entityId, summaryComment, false);¤	}¤¤	public AjaxResponse closeAndArchive (String entityId, String summaryComment) throws Exception {¤		return Close(entityId, summaryComment, true);¤	}¤¤	private AjaxResponse makeResponse () {¤		return AjaxResponse.success("");¤	}¤	¤	private AjaxResponse makeResponse (String where, Exception ex) {¤		String msg = ex.getClass().getSimpleName();¤		msg += " in '";¤		msg += where + "': ";¤		String exMsg = ex.getMessage();¤		if (exMsg != null) {¤			msg += ex.getMessage();¤		} else {¤			msg += "Unknown";¤		}¤		Logs.LOG_E(msg);¤		return AjaxResponse.failure(msg);¤	}¤	¤	private List<Labelling> getOpenComments (AbstractPage page) throws Exception {¤		long startCC = new java.util.Date().getTime();¤		Session session = org.springframework.orm.hibernate.SessionFactoryUtils¤				.getSession(¤							ContainerManager.Factory.get().getSessionFactory(), false);¤		Query q = session.createQuery(¤				"select labelling from Labelling as labelling, Label as label, Comment as comment" +¤				" where labelling.label = label" +¤				" and labelling.content = comment" +¤				" and label.name='" + DiscussionManager.COMMENT_DISCUSSION_LABEL + "'" +¤				" and comment.page=" + page.getId()¤				);¤		List<Labelling> ret = q.list();¤		Logs.LOG_D(¤				"CloseDiscussionPlugin::getOpenComments - "¤				+ (new java.util.Date().getTime() - startCC)¤				+ "ms"¤				);¤		return ret;¤¤	}¤	¤	private void removeCommentDiscussionLabel (AbstractPage page, boolean needToArchive) throws Exception {¤		Label archiveLabel = null;¤		if (needToArchive) {¤			archiveLabel = ContainerManager.Factory.get().getLabelManager().getLabel(ArchiveCommentAction.ARCHIVE_COMMNET_LABEL);			¤		}¤		for (Labelling labelling : getOpenComments(page)) {¤			Comment comment = (Comment) labelling.getContent();¤			comment.removeLabelling(labelling);¤			if (needToArchive) {¤				comment.addLabelling(new Labelling(¤					archiveLabel, comment, AuthenticatedUserThreadLocal.getUsername(), comment.getSpaceKey()¤				));¤			}¤		}¤	}¤	¤	private AjaxResponse Close (String entityId, String summaryComment, boolean needToArchive) throws Exception {¤		long startD = new java.util.Date().getTime(); ¤	¤		// init session¤		getSession();¤		¤		try {¤¤			try {¤				if (AuthenticatedUserThreadLocal.getUser() == null) {¤					String msg = Messages.Factory.messages().get("closediscussionplugin.not.logged");¤					throw new Exception(msg);¤				}¤¤				AbstractPage page = getPage(entityId);¤¤				long startCC = new java.util.Date().getTime();¤				Comment summaryCommnet = createComment(page, summaryComment);¤				Logs.LOG_D(¤						"CloseDiscussionPlugin::Close:createComment "¤						+ (new java.util.Date().getTime() - startCC)¤						+ "ms"¤						);¤¤				final GarLabelManager lm = ContainerManager.Factory.get().getLabelManager();¤				if (summaryCommnet != null) {¤					lm.addLabel(summaryCommnet, DiscussionManager.COMMENT_SUMMARY_LABEL);¤				}¤¤				startCC = new java.util.Date().getTime();¤				removeCommentDiscussionLabel(page, needToArchive);¤				Logs.LOG_D(¤						"CloseDiscussionPlugin::Close:removeCommentDiscussionLabel "¤						+ (new java.util.Date().getTime() - startCC)¤						+ "ms"¤						);¤¤				lm.removeLabel(page, DiscussionManager.OPEN_DISCUSSION_LABEL);¤				lm.removeLabel(page, DiscussionManager.DEAD_DISCUSSION_LABEL);¤				lm.addLabel(page, DiscussionManager.CLOSE_DISCUSSION_LABEL);¤¤				startCC = new java.util.Date().getTime();¤				getDiscussionManager().setDiscussionReadState(page.getId());¤				Logs.LOG_D(¤						"CloseDiscussionPlugin::Close:setDiscussionReadState "¤						+ (new java.util.Date().getTime() - startCC)¤						+ "ms"¤						);¤¤				return makeResponse();¤			} catch (Exception ex) {¤				return makeResponse("CloseDiscussionPlugin::Close", ex);¤			}¤¤		} finally {¤			Logs.LOG_D(¤					"CloseDiscussionPlugin::Close - complete in "¤					+ (new java.util.Date().getTime() - startD)¤					+ "ms"¤					);¤		}¤	}¤¤	private Comment createComment (AbstractPage page, String content) throws Exception {¤		if (TextUtils.stringSet (content)) {¤			Comment parent = DiscussionManager.findLastComment (page);¤			if (parent == null) {¤				Logs.LOG_I ("CloseDiscussionPlugin::createComment: the page id=" + page.getId () + " has not had any comments.");¤			}¤			return ContainerManager.Factory.get().getCommentManager().addCommentToPage (page, parent, content);¤		}¤		return null;¤	}¤	¤	private AbstractPage getPage (String sEntityId) throws Exception {¤		long entityId = Long.decode (sEntityId);¤		return ContainerManager.Factory.get().getPageManager().getAbstractPage (entityId);¤	}¤¤	private DiscussionManager discussionManager = null;¤	private DiscussionManager getDiscussionManager () {¤		if (this.discussionManager == null) {¤			this.discussionManager = (DiscussionManager) com.atlassian.spring.container.ContainerManager.getComponent("ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager");¤			if (this.discussionManager == null) {¤				Logs.LOG_E ("CommentListener::getOpenDiscussionManager: can not find OpenDiscussionManager");¤			}¤		}¤		return this.discussionManager;¤	}¤	¤	private Session getSession () {¤		return org.springframework.orm.hibernate.SessionFactoryUtils¤				.getSession(ContainerManager.Factory.get().getSessionFactory(), false);¤	}¤	¤	//#UC END# *45FA6DAC034B_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45FA6DAC034B_DO_EXECUTE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *45FA6DAC034B_DO_EXECUTE_IMPLEMETATION*¤		 ActionContextThreadLocalFactory.Factory.get().getContext().removeAll();¤		//#UC END# *45FA6DAC034B_DO_EXECUTE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/CloseDiscussionPlugin|45FA6DAC034B
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038985473"))
	    quid       	"45FA6DAC034B"
	    documentation 	"Object to implement AJAX idea to close discussion and add summary comment."
	    stereotype 	"KSpringPlugin"
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006309297"))
		    quid       	"468F578F03D8"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionManager"
		    quidu      	"468F4EC30177"))
	    language   	"MDA Generator")
	(object Class "DiscussionVelocityContextPlugin"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"context-key"
		    value      	"garDiscussion")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45FA988B008C_CUSTOM_IMPORT*"
		    value      	"//#UC START# *45FA988B008C_CUSTOM_IMPORT*¤import ru.garant.MDProcess.ConfluencePlugins.ArchiveCommentSupport.ArchiveCommentVelocityContextPlugin;¤import ru.garant.MDProcess.ConfluencePlugins.UserData.UserData;¤import ru.garant.shared.ConfluenceCore.LabelSupport.GarLabelManager;¤import ru.garant.shared.ConfluenceCore.ActionSupport.ActionContext;¤import ru.garant.shared.ConfluenceCore.ActionSupport.ActionContextThreadLocalFactory;¤¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.CommentManager;¤import com.atlassian.confluence.pages.Comment;¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤import com.atlassian.core.exception.InfrastructureException;¤import com.atlassian.user.User;¤¤¤import javax.servlet.http.HttpServletRequest;¤¤import java.util.*;¤¤import org.springframework.orm.hibernate.SessionFactoryUtils;¤import net.sf.hibernate.Session;¤//#UC END# *45FA988B008C_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45FA988B008C_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *45FA988B008C_CUSTOM_CLASS_DEFINITION*¤//#UC END# *45FA988B008C_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45FA988B008C_DEFAULT_CONSTRUCTOR*"
		    value      	(value Text 
|//#UC START# *45FA988B008C_DEFAULT_CONSTRUCTOR*¤		//#UC END# *45FA988B008C_DEFAULT_CONSTRUCTOR*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*45FA988B008C_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *45FA988B008C_CUSTOM_METHODS_AND_DATA*¤	public int isOpen (AbstractPage page) {¤		if(page == null){¤			return 0;¤		}¤		¤		try{¤			GarLabelManager garLabelManager = ContainerManager.Factory.get().getLabelManager(); ¤			if (garLabelManager.getLabel(page, DiscussionManager.OPEN_DISCUSSION_LABEL) == null¤				&& garLabelManager.getLabel(page, DiscussionManager.DEAD_DISCUSSION_LABEL) == null) {¤				return 0;¤			} else {¤				return 1;¤			}¤		}¤		catch(IllegalArgumentException ex){¤			Logs.LOG_E("DiscussionVelocityContextPlugin : isOpen : Failed to convert property value. Exception: " + ex);¤			Logs.LOG_SEX(ex);¤¤		}¤		return 1;¤	}¤	public int isSummary (Comment comment) {¤		ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤		Set<Long> commentIds = (Set<Long>)context.get(GarantViewPageAction.IS_SUMMARY_COMMENT);¤		if(commentIds != null){¤			return commentIds.contains(comment.getId())?1:0;¤		}¤		¤		¤		GarLabelManager garLabelManager = ContainerManager.Factory.get().getLabelManager(); ¤		if (garLabelManager.getLabel(comment, DiscussionManager.COMMENT_SUMMARY_LABEL) == null) {¤			return 0;¤		} else {¤			return 1;¤		}¤	¤	}¤¤	public boolean hasSpaceInDashboard (HttpServletRequest request, User user, String strSpace) {¤		String[] strSpaces = strSpace.split(",");¤		List<String> spaces = new ArrayList<String>(strSpaces.length);¤		for (int i = 0; i < strSpaces.length; ++i) {¤			spaces.add(strSpaces [i]);¤		}¤		return getDiscussionManager().hasSpaceInDashboard(¤			request, (user == null)? AuthenticatedUserThreadLocal.getUser() : user, spaces¤		);¤	}¤¤	public DashboardFilter createDashboardFilter (String userName) {¤		return new DashboardFilter(DashboardFilter.DashboardListType.UNDEFINED, false);¤	}¤¤	public int getCountUnviewed (AbstractPage page) {¤		return getDiscussionManager().getUnreadCommentCount(page.getId());¤	}¤¤	public int getCountUnviewed (Comment parentComment) {¤		return getDiscussionManager().getUnreadCommentCount (parentComment);¤	}¤¤	public boolean hasManyUnviewed (AbstractPage page) {¤		return getDiscussionManager().getUnreadCommentCount (page.getId()) > 0;¤	}¤¤	public boolean hasArchiveUnviewed (AbstractPage page) {¤		return (page == null) ? false : getDiscussionManager().getArchiveUnviewed(page.getId()) > 0;¤	}¤¤	public long getDiscussionCommentId (AbstractPage page) {¤		return getDiscussionManager().getDiscussionCommentId(page.getId());¤	}¤¤	public boolean isViewed (Comment comment) {¤		return getDiscussionManager().isCommentRead(comment);¤	}¤¤	public int getArrayCount (Object[] ar) {¤		if (ar == null) {¤			return 0;¤		}¤		return ar.length;¤	}¤¤	public boolean isCollapsed (Comment comment) {¤		return getDiscussionManager().isBranchCollapsed(comment);¤	}¤¤	public boolean hasChildren (Comment comment, boolean showArchive) {¤		ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤		Map<Long, List<Comment>> commentIds = (Map<Long, List<Comment>>)context.get(GarantViewPageAction.IS_HAS_CHILDREN);¤		List<Comment> children = null;¤		if(commentIds != null){¤			children = commentIds.get(comment.getId());¤			if(children == null){¤				children = new ArrayList<Comment>();¤			}¤		}else{¤			children = comment.getChildren();¤		}¤¤		if (showArchive && !children.isEmpty()) {¤			return true;¤		}¤		for (Iterator<?> it = children.iterator(); it.hasNext();) {¤			Comment c = (Comment)it.next();¤			if (ArchiveCommentVelocityContextPlugin.isArchiveComment(c) == 0) {¤				return true;¤			}¤		}¤		return false;¤	}¤¤	public boolean hasChildren (Comment comment, boolean showArchive, Integer isArchiveComment) {¤		ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤		Map<Long, List<Comment>> commentIds = (Map<Long, List<Comment>>)context.get(GarantViewPageAction.IS_HAS_CHILDREN);¤		List<Comment> children = null;¤		if(commentIds != null){¤			children = commentIds.get(comment.getId());¤		}else{¤			children = comment.getChildren();¤		}¤¤		if (showArchive && !children.isEmpty()) {¤			return true;¤		}¤		for (Iterator<?> it = children.iterator(); it.hasNext();) {¤			Comment c = (Comment)it.next();¤			if (isArchiveComment == 0) {¤				return true;¤			}¤		}¤		return false;¤	}¤¤	public boolean isAncestorById (long ancestor, long descendant) {¤		return this.isAncestor(¤				this.commentManager.getComment(ancestor)¤				, this.commentManager.getComment(descendant)¤		);¤	}¤¤	private boolean isAncestor (Comment ancestor, Comment descendant) {¤		if (ancestor == null || descendant == null || descendant.getParent() == null) {¤	        return false;¤		}¤	    if (descendant.getParent().getId() == ancestor.getId()) {¤	        return true;¤	    }¤	    return isAncestor(ancestor, descendant.getParent());¤	}¤¤	public boolean isEntityViewed (long entityId) {¤		return getDiscussionManager().isDocumentRead (entityId);¤	}¤¤	private DiscussionManager discussionManager = null;¤	private DiscussionManager getDiscussionManager () {¤		if (this.discussionManager == null) {¤			this.discussionManager = (DiscussionManager)com.atlassian.spring.container.ContainerManager.getComponent("ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager");¤			if (this.discussionManager == null) {¤				Logs.LOG_E ("DiscussionVelocityContextPlugin::getDiscussionManager: can not find OpenDiscussionManager");¤			}¤		}¤		return this.discussionManager;¤	}¤¤	private CommentManager commentManager = null;¤	public void setCommentManager (CommentManager commentManager) {¤		this.commentManager = commentManager;¤	}¤¤	public List<VelocityItem> processFavPages (List<AbstractPage> favPages) {¤		if ((favPages == null) || (favPages.isEmpty())) {¤			return new ArrayList<VelocityItem>();¤		}¤		int sizeFavPages = favPages.size();¤/*		if(isUnviewed()){¤			favPages = getAllFavouritiesPages();¤		}¤		*/¤		try {¤			Session sess = ContainerManager.Factory.get().getSession();¤			List<VelocityItem> items = DashboardQuery.loadFavPages(sess, favPages);¤			int count = items.size();¤			while(count > sizeFavPages){¤				count--;¤				items.remove(count);¤			}¤			return items;¤		} catch (Exception e) {¤			Logs.LOG_E("DiscussionVelocityContextPlugin::processFavPages: catch Exception - " + e.getMessage());¤			throw new InfrastructureException(e);¤		}¤	}¤	¤	private boolean isUnviewed(){¤		UserData ud = UserData.Factory.getAndCreate(AuthenticatedUserThreadLocal.getUsername(), "unread");¤		String value = (String)ud.getData();¤		return value.equals("true");¤	}¤	¤	private List<AbstractPage> getAllFavouritiesPages(){¤		List<AbstractPage> pages = null;¤		String query = "select page from Labelling as labellings, AbstractPage page"¤			+ " where labellings.label.namespace='my' and  labellings.label.owner='" + AuthenticatedUserThreadLocal.getUsername() + "'"¤			+ " and page.id=labellings.content.id"¤			+ " group by labellings.content.id";¤		try {¤			Session sess = SessionFactoryUtils.getSession(ContainerManager.Factory.get().getSessionFactory(), false);¤			pages = sess.createQuery(query).list();¤		} catch (Exception e) {¤			Logs.LOG_E("DiscussionVelocityContextPlugin::processFavPages: catch Exception - " + e.getMessage());¤			throw new InfrastructureException(e);¤		}¤		return pages;¤	}¤	¤	/*public List processFavPages (List favPages) {¤		List ret = new ArrayList<VelocityItem>();¤		String filtratedIds = "";¤		for (Iterator it = favPages.iterator(); it.hasNext();) {¤			AbstractPage page = (AbstractPage)it.next();¤			if (!filtratedIds.equals("")) {¤				filtratedIds += ",";¤			}¤			filtratedIds += String.valueOf(page.getId());¤		}¤		if (filtratedIds.equals("")) {¤			return ret;¤		}¤		¤		DashboardFilter df = createDashboardFilter (AuthenticatedUserThreadLocal.getUsername());¤		¤		String query = "select labellings.content.id from Labelling as labellings"¤			+ " group by labellings.content.id"¤			+ " having labellings.label.id in ses' and labellings.label.namespace='my'";¤		¤		//String query = "select page.id from AbstractPage as page left join page.labellings as labellings"¤		//	+ " where labellings.label.owner='ses' and"¤		//	+ " labellings.label.namespace='my' and"¤		//	+ " page.id in ("¤		//		+ "select labellings1.content.id from Labelling as labellings1"¤		//		+ " where labellings1.label.id=57016321"¤		//	+ ")";¤		¤		¤		Session sess = null;¤		Set unviewedSet = new TreeSet<Long>();¤		try {¤			sess = SessionFactoryUtils.getSession(ContainerManager.Factory.get().getSessionFactory(), false);¤			//Query favLabels = sess.createQuery(¤			//		"select labellings.label.id from Labelling as labellings"¤			//		+ " where labellings.label.owner='ses' and labellings.label.namespace='my'"					¤			//	);¤			//String labels = favLabels.list().toString();¤			//labels += ",570"¤			//Query			¤			//List<Long> favLabels = sess.createQuery().list();¤			¤			List<Long> ids = sess.createQuery(query).list();¤			unviewedSet.addAll(ids);¤			//Query q = sess.createQuery(¤			//		"select ud.entityId from UnreadDiscussion as ud"¤			//		+ " where ud.entityId in ("¤			//		+filtratedIds+¤			//		") and ud.users['"+AuthenticatedUserThreadLocal.getUsername()+"'].count>0"¤			//	);¤			//List<Long> ids = sess.createFilter(q.list(), df.getQueryFilterStringByLabels()).list();¤			//unviewedSet.addAll(ids);¤			¤			//q = sess.createQuery(¤			//	"select ud.entityId from UnreadDocument as ud where ud.entityId in ("¤			//	+ filtratedIds¤			//	+ ") and '" + AuthenticatedUserThreadLocal.getUsername() + "' in elements(ud.users) order by ud.entityId"¤			//);¤			//ids = sess.createFilter(q.list(), df.getQueryFilterStringByLabels()).list();¤			//unviewedSet.addAll(ids);			¤		} catch (Exception e) {¤			Logs.LOG_E("DiscussionVelocityContextPlugin::processFavPages: catch Exception - " + e.getMessage());¤			throw new InfrastructureException(e);¤		}¤¤		for (Iterator it = favPages.iterator(); it.hasNext();) {¤			AbstractPage page = (AbstractPage)it.next();¤			if (unviewedSet.contains(Long.valueOf(page.getId()))) {¤				ret.add(new FavPageStruct(page, true, 10));¤			}¤		}		¤		return ret;¤	}*/¤	//#UC END# *45FA988B008C_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DiscussionVelocityContextPlugin.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/DiscussionVelocityContextPlugin|45FA988B008C
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460BA8260261_BODY*"
		    value      	(value Text 
|//#UC START# *460BA8260261_BODY*¤		//#UC END# *460BA8260261_BODY*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039197407"))
	    quid       	"45FA988B008C"
	    documentation 	"Объект поодержки работы с дискусиями."
	    stereotype 	"KVelocityContextPlugin"
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006310515"))
		    quid       	"468F57820157"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionManager"
		    quidu      	"468F4EC30177"))
	    operations 	(list Operations
		(object Operation "ctor"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*460BA8260261_BODY*"
			    value      	(value Text 
|//#UC START# *460BA8260261_BODY*¤		//#UC END# *460BA8260261_BODY*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006310148"))
		    quid       	"460BA8260261"
		    stereotype 	"ctor"
		    concurrency 	"Sequential"
		    opExportControl 	"Public"
		    uid        	0))
	    language   	"MDA Generator")
	(object Class "RecentlyUpdatedContentMacro"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/RecentlyUpdatedContentMacro.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5B8C0242_CUSTOM_IMPORT*"
		    value      	"//#UC START# *460A5B8C0242_CUSTOM_IMPORT*¤//#UC END# *460A5B8C0242_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5B8C0242_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *460A5B8C0242_CUSTOM_CLASS_DEFINITION*¤//#UC END# *460A5B8C0242_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5B8C0242_EXECUTE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *460A5B8C0242_EXECUTE_IMPLEMETATION*¤		return "";¤		//#UC END# *460A5B8C0242_EXECUTE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5B8C0242_ISINLINE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *460A5B8C0242_ISINLINE_IMPLEMETATION*¤		return false;¤		//#UC END# *460A5B8C0242_ISINLINE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5B8C0242_HASBODY_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *460A5B8C0242_HASBODY_IMPLEMETATION*¤		return false;¤		//#UC END# *460A5B8C0242_HASBODY_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5B8C0242_GETBODYRENDERMODE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *460A5B8C0242_GETBODYRENDERMODE_IMPLEMETATION*¤		return RenderMode.NO_RENDER;¤		//#UC END# *460A5B8C0242_GETBODYRENDERMODE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5B8C0242_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *460A5B8C0242_CUSTOM_METHODS_AND_DATA*¤	public String getName() {¤		return "RecentlyUpdatedContentMacro";¤	}¤	protected DashboardFilter.DashboardListType getType () {¤		return DashboardFilter.DashboardListType.RECENTLY;¤	}¤	//#UC END# *460A5B8C0242_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/RecentlyUpdatedContentMacro|460A5B8C0242
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039206012"))
	    quid       	"460A5B8C0242"
	    documentation 	"Макрос, который показывает на странице список последних обновлений."
	    stereotype 	"KMacroPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"468F771801A5"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionsMacroBase"
		    quidu      	"460A5C2100AB"))
	    language   	"MDA Generator")
	(object Class "DiscussionsMacroBase"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"abstract")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need assign op"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need copy ctor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need ref count"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need unsorted less"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"ifdef"
		    value      	"")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need dctor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need objcounter"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"no base class"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"non virtual base"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"singleton"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DiscussionsMacroBase.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5C2100AB_CUSTOM_IMPORT*"
		    value      	"//#UC START# *460A5C2100AB_CUSTOM_IMPORT*¤import ru.garant.MDProcess.ConfluencePlugins.CommonVelocityContext.GlobalHelper;¤¤import ru.garant.shared.ConfluenceCore.Helpers.ContainerManager;¤¤import com.atlassian.confluence.renderer.radeox.macros.MacroUtils;¤¤import com.atlassian.confluence.renderer.PageContext;¤import com.atlassian.confluence.security.Permission;¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.Page;¤import com.atlassian.confluence.util.GeneralUtil;¤import com.atlassian.confluence.util.velocity.VelocityUtils;¤import com.atlassian.core.bean.EntityObject;¤import com.atlassian.gzipfilter.org.apache.commons.lang.StringUtils;¤import com.opensymphony.webwork.ServletActionContext;¤import com.opensymphony.util.TextUtils;¤¤import org.radeox.macro.parameter.MacroParameter;¤¤import javax.servlet.http.HttpServletRequest;¤¤import java.io.IOException;¤import java.util.*;¤¤import net.sf.hibernate.Query;¤import net.sf.hibernate.Session;¤¤import java.sql.Array;¤import java.sql.PreparedStatement;¤import java.sql.ResultSet;¤¤import com.atlassian.user.*;¤//#UC END# *460A5C2100AB_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5C2100AB_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *460A5C2100AB_CUSTOM_CLASS_DEFINITION*¤//#UC END# *460A5C2100AB_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*460A5C2100AB_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *460A5C2100AB_CUSTOM_METHODS_AND_DATA*¤	abstract protected DashboardFilter.DashboardListType getType ();¤¤	protected String getHtml (MacroParameter macroParameter) throws IllegalArgumentException, IOException {¤		long startHtmlTime = System.currentTimeMillis();¤		long makeResutlTime = 0L;¤		long renderTime = 0L;¤		String strListTitle = null;¤		try {¤			// now create a simple velocity context and render a template for the output¤			Map<String, Object> contextMap = MacroUtils.defaultVelocityContext();¤¤			String strMacroKey = this.getType().toString();//parseParameterForKey(macroParameter, "key");¤			if (strMacroKey != null) {¤				contextMap.put("macroKey", strMacroKey);¤			}¤			this.maxListCountParameter = this.createMaxCountParamaterName(strMacroKey);¤¤			String strLines = parseParameterForKey(macroParameter, "lines");¤	        if (strLines != null) {¤	        	this.defListCount = Integer.parseInt(strLines);¤	        }¤	        String strInc = parseParameterForKey(macroParameter, "inc");¤        	this.incCount = (strInc == null)? this.defListCount : Integer.parseInt(strInc);¤¤			String strHeader = parseParameterForKey(macroParameter, "header");¤			if (strHeader != null) {¤				contextMap.put("header", strHeader);¤			}¤			strListTitle = strHeader;¤¤			List<EntityObject> spaces = this.getSpaces(parseParameterForKey(macroParameter, "space"));¤			if ((spaces == null) || (spaces.size() > 1)) {¤				contextMap.put("needSpace", Boolean.TRUE);¤			}¤			contextMap.put("isDiscussion", this.getType() != DashboardFilter.DashboardListType.RECENTLY);¤¤			final boolean forceOnlyUnread = this.forceOnlyUnread();¤			contextMap.put("forceOnlyUnread", forceOnlyUnread);¤			final int maxListCount = this.getMaxListCount();			¤			DashboardFilter filter = new DashboardFilter(this.getType(), forceOnlyUnread);¤¤			long startQueryTime = System.currentTimeMillis();¤			List<VelocityItem> itemList = makeResult (filter, contextMap, spaces);			¤			makeResutlTime = System.currentTimeMillis() - startQueryTime;¤¤			contextMap.put("itemList", itemList);¤			contextMap.put("itemListCount", maxListCount);¤¤			addMoreLessUrl(¤				contextMap¤				, macroParameter¤				, itemList.size()¤			);¤			¤			int unreadCountInList = 0;¤			for (VelocityItem vi : itemList) {¤				if (vi.isRead() == false) {¤					unreadCountInList++;¤				}¤			}¤			if (unreadCountInList > 0) {¤				contextMap.put("unreadCountInList", unreadCountInList);¤			}¤			if (filter.onlyUnread()) {¤				contextMap.put("maxUnreadCount", (Integer)contextMap.get("maxCount"));¤			}¤¤			contextMap.put("remoteUser", (this.getRemoteUser() == null)? null : this.getRemoteUser());¤¤			startQueryTime = System.currentTimeMillis();¤			String ret = VelocityUtils.getRenderedTemplate("/ConfluencePlugins/DiscussionsView/DiscussionsMacro.vm", contextMap);¤			renderTime = System.currentTimeMillis() - startQueryTime;¤			¤			Long onlyQueryTime = (Long)contextMap.get("debugOnlyQueryTime");¤			Logs.LOG_D(¤				getClass().getSimpleName()¤				+ ": makeResult in " + makeResutlTime + "(" + onlyQueryTime + ")" + "ms"¤				+", render in " + renderTime + "ms"¤			);¤			return ret;¤		} catch (Exception e) {¤			Logs.LOG_E("******************************************************");¤			Logs.LOG_E("DiscussionsMacroBase:getHtml in '" + new String(strListTitle.getBytes("CP866")) + "': Exception:" + e);¤			Logs.LOG_SEX(e);¤			Logs.LOG_E("******************************************************");¤			throw new IOException(e.getMessage());¤		} finally {¤			long fullTime = System.currentTimeMillis () - startHtmlTime;¤			if (fullTime > 3000) { // more than 3 sec.¤				this.timeLog(strListTitle, (makeResutlTime+renderTime), fullTime);¤			}¤		}¤	}¤¤	private void timeLog (String strListTitle, long queryTime, long htmlTime) {¤		String userName = (this.getRemoteUser()!=null)? this.getRemoteUser().getName() : "Anonymous";¤		String out =¤			getClass().getSimpleName()¤			+ ":getHTML: SLOW, execute in " + htmlTime + "(" + queryTime + ")ms"¤			+ " [" + userName + "]";		¤		Logs.LOG_I(out);¤	}¤¤	private String getTimerStr (String title, long time) {¤		String s = "";¤		com.atlassian.user.User user = this.getRemoteUser ();¤		return s + ": HTML time " + time + "ms.";¤	}¤/*¤	protected boolean showEmptyList () {¤		return false;¤	}¤*/¤	protected boolean forceOnlyUnread () {¤		return false;¤	}¤¤	protected void addMoreLessUrl (¤			Map<String, Object> contextMap¤			, MacroParameter macroParameter¤			, int resCount¤	) throws Exception {¤		String url = null;¤		HttpServletRequest request = ServletActionContext.getRequest ();¤        if (request != null) {¤            url = buildBaseUrl (request, Arrays.asList (new String []{this.getMaxListCountParameter()}));¤        } else {¤            PageContext context = getPageContext (macroParameter);¤            String baseurl = GlobalHelper.getBaseUrl();¤            url = GeneralUtil.appendAmpsandOrQuestionMark (baseurl + context.getEntity ().getUrlPath ());¤        }¤        if (resCount > this.getDefListCount ()) {¤        	contextMap.put ("showless", url + this.getMaxListCountParameter() + "=" + (resCount / 2 ));¤        }¤        if (((Boolean)contextMap.get("needShowMore")) == true) {¤        	contextMap.put ("showmore", url + this.getMaxListCountParameter() + "=" + resCount*2);¤        }¤	}¤¤	private String createMaxCountParamaterName (String listKey) {¤		return "maxCount" + ((listKey == null)? this.getClass ().getSimpleName () : listKey);¤	}¤¤	private int getMaxListCount () {¤        try {¤        	HttpServletRequest request = ServletActionContext.getRequest ();¤        	// recentlyUpdatedPageCount = getUserInterfaceState().getMaxRecentChangesSize();¤            return (request == null)? this.getDefListCount() : Integer.parseInt(request.getParameter(this.getMaxListCountParameter()));¤        } catch (NumberFormatException e) {¤            return this.getDefListCount();//getUserInterfaceState().getMaxRecentChangesSize(); // get value from preferences or use default¤        }¤    }¤¤	protected List<EntityObject> getSpaces (String strSpaces) throws Exception {¤		if (!TextUtils.stringSet (strSpaces)) {¤			return null;¤		}¤		if (!"dashboard".equals(strSpaces)) {¤			return getTokenizeSpaces (strSpaces);¤		}¤¤		return (List) ContainerManager.Factory.get().getSpaceManager().getDashboardSpaces(getRemoteUser(), false);¤	}¤¤	private List<EntityObject> getTokenizeSpaces (String strSpaces) throws Exception {¤		String[] list = strSpaces.split(",");¤		List<EntityObject> spaces = new ArrayList<EntityObject>(list.length);¤		for (int i = 0; i < list.length; ++i) {¤			spaces.add(ContainerManager.Factory.get().getSpaceManager().getSpace(list[i]));¤		}¤		return spaces;¤	}¤¤	private String maxListCountParameter = null;¤	final protected String getMaxListCountParameter () {¤		return this.maxListCountParameter;¤	}¤¤	private int defListCount = 10;¤	final protected int getDefListCount () {¤		return this.defListCount;¤	}¤¤	private int incCount = 10;¤	final protected int getIncCount () {¤		return this.incCount;¤	}¤	¤	private int maxAvailableListCount = 1000;¤	final protected int getMaxAvailableListCount () {¤		return this.maxAvailableListCount;¤	}¤¤	private void testResults (List<VelocityItem> newVer, List<VelocityItem> oldVer) {¤		Iterator<VelocityItem> itNew = newVer.iterator();¤		Iterator<VelocityItem> itOld = oldVer.iterator();¤		int i = 0;¤		while (itNew.hasNext() && itOld.hasNext()) {¤			VelocityItem viNew = itNew.next();¤			VelocityItem viOld = itOld.next();¤			i++;¤			boolean isEquals = true;¤			if (!viOld.getAuthor().equals(viNew.getAuthor())) {¤				isEquals = false;¤			}			¤			if (!viOld.getDate().equals(viNew.getDate())) {¤				isEquals = false;¤			}			¤			if (viOld.getIsDocumentBodyRead() != viNew.getIsDocumentBodyRead()) {¤				isEquals = false;¤			}			¤			if (viOld.getIsRead() != viNew.getIsRead()) {¤				isEquals = false;¤			}			¤			if (viOld.getLastCommentId() != viNew.getLastCommentId()) {¤				isEquals = false;¤			}			¤			if (!viOld.getPage().equals(viNew.getPage())) {¤				isEquals = false;¤			}			¤			if (!viOld.getTitle().equals(viNew.getTitle())) {¤				isEquals = false;¤			}			¤			if (viOld.getUnreadCommentCount() != viNew.getUnreadCommentCount()) {¤				isEquals = false;¤			}¤			¤			if (!isEquals) {¤				break;¤			}¤		}¤		if (i != newVer.size() || i != oldVer.size()) {¤			Logs.LOG_E("!!ERROR!! " + getClass().getSimpleName()¤				+ ": " + i + " item not equals, newVerListSize=" + newVer.size()¤				+ ", oldVerListSize=" + oldVer.size()¤			);¤		}¤	}¤	¤	//ses: что бы без перезагрузки сервера менять алгоритим поиска на ПУ¤	// для чего нужно выполнить макрос script в котором написать:¤	// ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionsMacroBase.isNeedNewQueryProcessing_ = false;¤	public static boolean isNeedNewQueryProcessing_ = true;¤	¤	private List<VelocityItem> makeResult (DashboardFilter filter, Map<String, Object> contextMap, List<EntityObject> spaces) throws Exception {¤		//return makeResultOld (filter, contextMap, spaces);¤		/*¤		 * TODO:¤		 * - Доделать список Recenly, обязательно реализовать чтение результата пачками через несколько запросов,¤		 * используя оператор LIMIT, иначе без фильтров тормозит сильно.¤		 * ¤		 * Известные на данный момент ограничения:¤		 * - Количество, указанное в скобках, учитывает документы на которые может не быть прав просмотра¤		 * - Закрытые обсуждения, из-за того что таблица очень большая, берутся за последние два месяца¤		 * ¤		 *  При установке не забываем добавить индексы:¤		 *  unread_doc_set: с_user_name_and_entity_id¤		 *  ? unread_comments: с_count¤		 *  ? unread_discussions: c_date_spaceid¤		 *  ? unread_discussions_map: c_user_name¤		 *  ? unread_documents: c_lastmoddate¤		*/¤		//List<VelocityItem> oldv = makeResultOld (filter, contextMap, spaces);¤		//List<VelocityItem> newv = makeResultNew (filter, contextMap, spaces);¤		//testResults (newv, oldv);¤		//return newv;¤		//return oldv;¤		if (isNeedNewQueryProcessing_) {¤			Logs.LOG_W("DiscussionsMacroBase::makeResult::makeResultNew");¤			return makeResultNew (filter, contextMap, spaces);¤		}¤		Logs.LOG_W("DiscussionsMacroBase::makeResult::makeResultOld");¤		return makeResultOld (filter, contextMap, spaces);¤	}¤	¤	private List<VelocityItem> makeResultOld (DashboardFilter filter, Map<String, Object> contextMap, List<EntityObject> spaces) throws Exception {¤		DashboardQuery dq = new DashboardQuery(filter);¤		final int maxListCount = this.getMaxListCount();¤		List<VelocityItem> ret = dq.createItemList(Math.min(maxListCount, Integer.MAX_VALUE - 1), spaces);¤		if (filter.isStatusSet()) {¤			int itemMaxCount = (ret.size() < maxListCount) ? ret.size() : dq.getCountItems(spaces);¤			contextMap.put("maxCount", itemMaxCount);¤		}¤		return ret;¤	}¤	¤	private List<VelocityItem> makeResultNew (DashboardFilter filter, Map<String, Object> contextMap, List<EntityObject> spaces) throws Exception {¤		if (DashboardFilter.DashboardListType.RECENTLY == getType()) {¤			return makeRecentlyResult(filter, contextMap, spaces);¤		} else {¤			return makeDiscussionResult(filter, contextMap, spaces);¤		}		¤	}¤	¤	static private boolean canView (User user, AbstractPage target) {¤		if (false == target.isCurrent()) {¤			return false;¤		}¤		¤		boolean ret = ContainerManager.Factory.get().getPermissionManager().hasPermission(¤			user¤			, Permission.VIEW¤			, target¤		);¤		return ret;		¤	}¤	¤	private List<VelocityItem> makeDiscussionResult (DashboardFilter filter, Map<String, Object> contextMap, List<EntityObject> spaces) throws Exception {¤		List<VelocityItem> ret = new ArrayList<VelocityItem> ();¤		Session session = org.springframework.orm.hibernate.SessionFactoryUtils.getSession(ContainerManager.Factory.get().getSessionFactory(), true);¤		PreparedStatement ps = null;¤		ResultSet rs = null;¤		int maxListCount = this.getMaxListCount();		¤		try {¤	 		List<String> andFilter = new ArrayList<String> (entityListListToQueryString(filter.getCheckboxFilterLabels()));¤	 		andFilter.addAll(entityListListToQueryString(filter.getRadioButtonFilterLabels()));		 		¤			¤		 	String mysql = getMySQLQuery (¤		 		filter.onlyUnread()¤		 		, spacesListToQueryString (spaces)¤		 		, andFilter¤		 		, entityListToQueryString (filter.getNotOrLabels())¤		 	);¤		 	//mysql += " LIMIT " + maxListCount*2;¤			long startQueryTime = System.currentTimeMillis();¤			ps = session.connection().prepareStatement(mysql);¤			rs = ps.executeQuery();¤			contextMap.put("debugOnlyQueryTime", Long.valueOf(System.currentTimeMillis() - startQueryTime));¤¤			int hasNotPermPageCount = 0;¤			boolean needShowMore = true;¤		 	while (ret.size () <  maxListCount) {¤		 		if (false == rs.next()) {¤		 			needShowMore = false;¤		 			break;¤		 		}¤		 		AbstractPage page = ContainerManager.Factory.get().getPageManager().getAbstractPage(rs.getLong(1));¤		 		if (!canView(filter.getUser(), page)) {¤		 			hasNotPermPageCount++;¤		 			continue;¤		 		}		 		¤		 		VelocityItem vi = new VelocityItem ();¤		 		vi.setPage(page);¤				vi.setDate(rs.getTimestamp(2));¤				vi.setLastCommentId(rs.getLong(3));¤				vi.setAuthor(rs.getString(4));¤				¤				if ((vi.getDate() == null) || (TextUtils.stringSet(vi.getAuthor()) == false)) {¤					GarantHibernate uds = new GarantHibernate(ContainerManager.Factory.get().getSessionFactory());¤					UnreadDiscussion ud = uds.get(UnreadDiscussion.class, page.getId());¤					if (ud != null) {¤						ud.setLastComment(DiscussionManager.findLastComment(page));¤¤						vi.setDate(ud.getDate());¤						vi.setAuthor(ud.getLastCommentAuthor());¤						vi.setLastCommentId(ud.getLastCommentId());¤					}¤				}¤				¤				Integer unreadCount = rs.getInt(5);¤				if (unreadCount == null) {¤					vi.setUnreadCommentCount(0);¤				} else {¤					vi.setUnreadCommentCount(unreadCount);¤				}¤				vi.setRead(vi.getUnreadCommentCount() == 0);¤				if (vi.getUnreadCommentCount() > 0) {¤					vi.setLastCommentId(rs.getLong(6));¤					vi.setAuthor(rs.getString(7));¤					vi.setDate(rs.getTimestamp(8));¤					if (¤						vi.getLastCommentId() == 0¤						|| vi.getDate() == null¤						|| !TextUtils.stringSet(vi.getAuthor())¤					) {¤						UnreadComments uc = (UnreadComments)session.get(UnreadComments.class, rs.getLong(9));¤						vi.setLastCommentId(uc.getFirstComment());¤						vi.setAuthor(uc.getFirstCommentAuthor());¤						vi.setDate(uc.getDate());¤					}¤				}¤				ret.add(vi);¤			}¤			contextMap.put("needShowMore", needShowMore);		 	¤			if (filter.isStatusSet()) {¤				rs.last();¤				int itemMaxCount = rs.getRow()-hasNotPermPageCount;¤				contextMap.put("maxCount", itemMaxCount);¤			}¤			//Logs.LOG_D(¤			//	getClass().getSimpleName() + ": query in " + (System.currentTimeMillis() - startQueryTime) + "ms"¤			//	+ "\r\n"¤			//	+ mysql¤			//);		 	¤		} finally {¤			com.atlassian.core.db.JDBCUtils.close (rs);¤			com.atlassian.core.db.JDBCUtils.close (ps);¤		}¤		return ret;¤	}¤	¤	private List<VelocityItem> makeRecentlyResult (DashboardFilter filter, Map<String, Object> contextMap, List<EntityObject> spaces) throws Exception {¤		List<VelocityItem> ret = new ArrayList<VelocityItem> ();¤		int maxListCount = this.getMaxListCount() < this.getMaxAvailableListCount ()? this.getMaxListCount() : this.getMaxAvailableListCount ();¤		HQueryWrapper hqw = null;¤		try {¤			RecentlyCollectionBuilder rcb = new RecentlyCollectionBuilder (filter, spaces);¤			Session session = org.springframework.orm.hibernate.SessionFactoryUtils.getSession(ContainerManager.Factory.get().getSessionFactory(), true);¤			if (filter.isStatusSet()) {¤				hqw = new HQueryWrapper (session, rcb, -1, contextMap, maxListCount, filter);¤			} else {¤				hqw = new HQueryWrapper (session, rcb, maxListCount * 2, contextMap, maxListCount, filter);				¤			}¤			ret = hqw.getItems();¤			contextMap.put("needShowMore", hqw.getNeedShowMore());¤			if (filter.isStatusSet()) {¤				int itemMaxCount = (ret.size() < maxListCount) ? ret.size() : hqw.count();¤				contextMap.put("maxCount", itemMaxCount);¤			}	¤¤		} finally {¤			if (hqw != null) {¤				hqw.close();¤			}¤			¤		}¤		return ret;¤		/*List<VelocityItem> ret = new ArrayList<VelocityItem> ();¤		Session session = org.springframework.orm.hibernate.SessionFactoryUtils.getSession(ContainerManager.Factory.get().getSessionFactory(), true);¤		PreparedStatement ps = null;¤		ResultSet rs = null;¤		int maxListCount = this.getMaxListCount();		¤		try {¤		 	String mysql = getMySQLQuery (¤		 		filter.onlyUnread()¤		 		, entityListToQueryString (spaces)¤		 		, entityListListToQueryString (filter.getOrLabels())¤		 		, entityListToQueryString (filter.getNotOrLabels())¤		 	);¤			long startQueryTime = System.currentTimeMillis();¤			ps = session.connection().prepareStatement(mysql);¤			rs = ps.executeQuery();¤			Logs.LOG_D("RECENTLY: executeQuery in " + (System.currentTimeMillis() - startQueryTime) + "ms");¤			¤		 	while (ret.size () <  maxListCount && rs.next()) {¤		 		if (filter.onlyUnread()) {¤		 			Long unreadMark = rs.getLong(3);¤		 			if (unreadMark == null || unreadMark == 0) {¤		 				continue;¤		 			}¤		 		}¤		 		AbstractPage page = ContainerManager.Factory.get().getPageManager().getAbstractPage(rs.getLong(1));¤		 		if (!hasPermission(filter.getUser(), page)) {¤		 			continue;¤		 		}¤		 		¤		 		VelocityItem vi = new VelocityItem ();¤		 		vi.setPage(page);¤		 		¤		 		Date date = rs.getDate(2);¤		 		if (date == null) {¤					date = page.getLastModificationDate();¤					if (date == null) {¤						date = page.getCreationDate();¤					}¤					getDiscussionManager().updateDocumentModificationDate(page.getId(), date);		 			¤		 		}¤		 		vi.setDate(date);¤		 		¤	 			Long unreadMark = rs.getLong(3);¤		 		vi.setRead((unreadMark == null || unreadMark == 0) ? true: false);¤		 		¤				String modifierName = page.getLastModifierName();¤				vi.setAuthor((modifierName == null) ? page.getCreatorName() : modifierName);¤				ret.add(vi);¤			}¤		} finally {¤			com.atlassian.core.db.JDBCUtils.close (rs);¤			com.atlassian.core.db.JDBCUtils.close (ps);¤		}¤		return ret;*/¤	}¤	¤	¤	protected String getMySQLQuery (boolean unreadOnly, String inSpaces, List<String> andFilter, String excludeFilter) {¤		if (DashboardFilter.DashboardListType.RECENTLY == getType()) {¤		 	String ret = "SELECT STRAIGHT_JOIN ud.entity_id, ud.lastmoddate, uds.entity_id"¤		 		+ " FROM unread_documents ud"¤		 		+ " LEFT OUTER JOIN unread_doc_set uds ON (uds.entity_id = ud.entity_id AND uds.user_name = 'ses')"¤		 		+ " WHERE ud.lastmoddate > '" + getLimitDateAsSQLString () + "'"¤		 		+ " ORDER BY ud.lastmoddate desc, ud.entity_id desc"¤		 		+ " LIMIT 100"¤		 	;¤		 	return ret;¤		} else {¤			throw new IllegalStateException ("call getDiscussionLabelId for AbstractMacro, how?!");¤		}¤	}¤	¤	static private String entityListToQueryString (List<EntityObject> ar) {¤		StringBuilder ret = new StringBuilder();¤		if (ar == null) {¤			return ret.toString();¤		}¤		for (Iterator<EntityObject> it = ar.iterator(); it.hasNext();) {¤			if (ret.length() > 0) {¤				ret.append(",");¤			}¤			ret.append(it.next().getId());¤		}¤		return ret.toString();¤	}¤	¤	static private String spacesListToQueryString (List<EntityObject> ar) {¤		StringBuilder ret = new StringBuilder();¤		if (ar == null) {¤			return ret.toString();¤		}¤		for (Iterator<EntityObject> it = ar.iterator(); it.hasNext();) {¤			if (ret.length() > 0) {¤				ret.append(",");¤			}¤			//ret += "'" + ContainerManager.Factory.get().getSpaceManager().getSpace(it.next().getId()).getKey() + "'";¤			ret.append(it.next().getId());¤		}¤		return ret.toString();¤	}¤	¤	¤	static private List<String> entityListListToQueryString (List<List<EntityObject>> list) {¤		List<String> ret = new ArrayList<String> ();¤		if (list == null) {¤			return ret;¤		}¤		for (Iterator<List<EntityObject>> it = list.iterator(); it.hasNext();) {¤			ret.add(entityListToQueryString(it.next()));¤		}¤		return ret;¤	}¤	¤	private static DiscussionManager discussionManager = null;¤	private static DiscussionManager getDiscussionManager () {¤		if (discussionManager == null) {¤			synchronized (DiscussionManager.class) {¤				if (discussionManager == null) {¤					discussionManager = (DiscussionManager) com.atlassian.spring.container.ContainerManager.getComponent(¤						"ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager"¤					);¤					if (discussionManager == null) {¤						Logs.LOG_E("DiscussionsMacroBase::getDiscussionManager: can not find OpenDiscussionManager");¤					}¤				}¤			}¤		}¤		return discussionManager;¤	}¤	¤	protected static String getLimitDateAsSQLString () {¤		java.sql.Date d = new java.sql.Date(new java.util.Date().getTime() - 1000l*60l*60l*24l*30l*2l);¤		String ret = d.toString();¤		return ret;¤	}¤	¤	interface CollectionBuilder {¤		VelocityItem makeVelocityItem (final List<Object> paramList) throws Exception;¤		String getMainQuery();¤		boolean needViewPermissions();¤	}¤	¤	static abstract class CollectionBuilderImpl implements CollectionBuilder {¤		protected DashboardFilter filter_ = null;¤		protected List<EntityObject> spaces_ = null;¤		public CollectionBuilderImpl (DashboardFilter filter, List<EntityObject> spaces) {¤			filter_ = filter;¤			spaces_ = spaces;¤		}¤	}¤	¤	static class RecentlyCollectionBuilder extends CollectionBuilderImpl {¤		public RecentlyCollectionBuilder (DashboardFilter filter, List<EntityObject> spaces) {¤			super (filter, spaces);¤		}¤		¤		public VelocityItem makeVelocityItem (final List<Object> paramList) throws Exception {¤			long startTime1 = new Date().getTime();¤			VelocityItem ret = new VelocityItem ();¤			AbstractPage page = null;¤			if(paramList.size() == 4){¤				page = (AbstractPage)paramList.get(3);¤			}¤//	 		AbstractPage page = ContainerManager.Factory.get().getPageManager().getAbstractPage((Long)paramList.get(0));¤	 		if((new Date().getTime() - startTime1) > 0){¤	 			Logs.LOG_W("makeVelocityItem::time1=" + (new Date().getTime() - startTime1));¤	 		}¤			long startTime2 = new Date().getTime();¤	 		if (page == null) {¤	 			return null;¤	 		}¤	/* 		if (false == canView(filter_.getUser(), page)) {¤	 			return null;¤	 		}¤	 		*/¤	 		if((new Date().getTime() - startTime2) > 0){¤	 			Logs.LOG_W("makeVelocityItem::time2=" + (new Date().getTime() - startTime2));¤	 		}¤			long startTime3 = new Date().getTime();¤	 		¤	 		ret.setPage(page);¤		¤	 		Date date = (Date)paramList.get(1);¤	 		if (date == null) {¤				date = page.getLastModificationDate();¤				if (date == null) {¤					date = page.getCreationDate();¤				}¤				getDiscussionManager().updateDocumentModificationDate(page.getId(), date);		 			¤	 		}¤	 		ret.setDate(date);¤	 		¤	 		if (filter_.onlyUnread()) {¤		 		ret.setRead(false);	 			¤	 		} else {¤	 			Long unreadMark = (Long)paramList.get(2);¤	 			ret.setRead((unreadMark == null || unreadMark == 0) ? true: false);¤	 		}¤	 		¤			String modifierName = page.getLastModifierName();¤			ret.setAuthor((modifierName == null) ? page.getCreatorName() : modifierName);¤	 		if((new Date().getTime() - startTime3) > 0){¤	 			Logs.LOG_W("makeVelocityItem::time3=" + (new Date().getTime() - startTime3));¤	 		}¤			return ret; ¤		}¤		¤		private String getWithCheckboxFilter () {¤			List<String> checkFilter = entityListListToQueryString (filter_.getCheckboxFilterLabels());¤			List<String> radioFilter = entityListListToQueryString (filter_.getRadioButtonFilterLabels());¤			String excludeFilter = entityListToQueryString (filter_.getNotOrLabels());¤	 		String ret;			¤	 		ret = "SELECT STRAIGHT_JOIN ud.entity_id, ud.lastmoddate, 0"¤	 			+ ((filter_.onlyUnread()) ? "": ", uds.entity_id")¤	 			+ " FROM content_label cl"¤	 		;¤	 		¤	 		List<String> andFilter = new ArrayList<String> (checkFilter);¤	 		andFilter.addAll(radioFilter);		 		¤		 	for (int i = 1; i < andFilter.size (); i++) {¤		 		String s = andFilter.get(i);¤		 		String cl = "cl" + i;¤				ret += " JOIN content_label " + cl + " ON ("¤					+ cl + ".contentid = cl.contentid"¤					+ " AND " + cl + ".labelid in (" + s + ")"¤					+ ")"¤				;¤		 	}¤		 	¤		 	if (spaces_ != null && spaces_.size() > 0) {¤		 		ret += " JOIN content page ON (cl.contentid = page.contentid AND page.content_status='current' AND page.spaceid IN (" + spacesListToQueryString(spaces_) + "))";¤		 	}¤		 	¤		 	ret += " JOIN unread_documents ud ON (ud.entity_id = cl.contentid)";¤		 	¤		 	ret += ((filter_.onlyUnread()) ? " JOIN" :" LEFT OUTER JOIN")¤		 		+" unread_doc_set uds ON (uds.entity_id = cl.contentid AND uds.user_name = '"¤		 		+ filter_.getUser().getName()¤		 		+ "')"¤		 	;¤		 	¤		 	ret += " WHERE cl.labelid IN (" + andFilter.get(0) + ")";¤		 	¤		 	if (excludeFilter.length() > 0) {¤		 		ret += " AND cl.contentid NOT IN ("¤		 			+ "SELECT ecl.contentid FROM content_label ecl"¤		 			+ " WHERE ecl.labelid in ("+ excludeFilter +")"¤		 			+")"¤		 		;¤		 	}¤		 	¤			ret += " ORDER BY ud.lastmoddate desc, ud.entity_id desc";¤			return ret;¤		}¤		¤		private String getForAllQuery () {¤			List<String> checkFilter = entityListListToQueryString (filter_.getCheckboxFilterLabels());¤			List<String> radioFilter = entityListListToQueryString (filter_.getRadioButtonFilterLabels());¤			String excludeFilter = entityListToQueryString (filter_.getNotOrLabels());¤			¤			//return getWithCheckboxFilter ();¤	 		String ret;			¤			if (checkFilter.size() > 0) {¤				ret = getWithCheckboxFilter ();¤	 		} else {¤	 			ret = "SELECT STRAIGHT_JOIN ud.entity_id, ud.lastmoddate, uds.entity_id"¤	 				+ " FROM unread_documents ud"¤	 				;¤			 	for (int i = 0; i < radioFilter.size (); i++) {¤			 		String s = radioFilter.get(i);¤			 		String cl = "cl" + i;¤					ret += " JOIN content_label " + cl + " ON ("¤						+ cl + ".contentid = ud.entity_id"¤						+ " AND " + cl + ".labelid in (" + s + ")"¤						+ ")"¤					;¤			 	}¤			 	¤			 	if (spaces_ != null && spaces_.size() > 0) {¤			 		ret += " JOIN content c ON ("¤			 			+ "ud.entity_id  = c.contentid"¤			 			+ " AND c.content_status='current'"	¤			 			+ " AND c.spaceid IN (" + entityListToQueryString(spaces_) + ")"¤			 			+")"¤			 		;		 		¤			 	}			 	¤			 	¤			 	¤			 	ret += " LEFT OUTER JOIN"¤			 		+ " unread_doc_set uds USE INDEX (Index_4) ON (uds.entity_id = ud.entity_id AND uds.user_name = '"¤			 		+ filter_.getUser().getName()¤			 		+ "')"¤			 	;¤			 	¤			 	if (excludeFilter.length() > 0) {¤			 		ret +=" WHERE ud.entity_id NOT IN ("¤						+ "SELECT ecl.contentid FROM content_label ecl"¤						+ " WHERE ecl.labelid IN ("+ excludeFilter +")"¤						+") AND "¤					;¤			 	} else {¤			 		ret += " WHERE ";¤			 	}¤			 	¤			 	ret += "ud.lastmoddate > '" + getLimitDateAsSQLString() + "'";¤			 	¤			 	//ses: возможно понадобиться, когда разберемся почему canView и это дает разные результаты.¤			 	//ret += ¤			 	//	" AND ud.entity_id NOT IN (SELECT rp.page_id FROM gar_restricted_page rp, gar_restricted_page_view_users rpvu WHERE rp.id = rpvu.id AND rpvu.user_name = 'pugin')"¤			 	//;¤			 	¤	 			ret += " ORDER BY ud.lastmoddate desc, ud.entity_id desc";¤	 		}¤			return ret;¤		}¤		¤		private String getOnlyUnreadQuery () {¤			List<String> checkFilter = entityListListToQueryString (filter_.getCheckboxFilterLabels());¤			¤			if (checkFilter.size() > 0) {¤				return getWithCheckboxFilter ();¤			} else {¤				String inSpaces = entityListToQueryString (spaces_);¤				List<String> andFilter = entityListListToQueryString (filter_.getRadioButtonFilterLabels());¤		 		String excludeFilter = entityListToQueryString (filter_.getNotOrLabels());¤		 		String ret = "SELECT STRAIGHT_JOIN ud.entity_id, ud.lastmoddate"¤		 			+ " FROM unread_doc_set uds"¤		 			+ " JOIN unread_documents ud ON (ud.entity_id = uds.entity_id)"¤		 		;¤		 		¤			 	for (int i = 0; i < andFilter.size (); i++) {¤			 		String s = andFilter.get(i);¤			 		String cl = "cl" + (i+1);¤					ret += " JOIN content_label " + cl + " ON (" + cl + ".contentid = uds.entity_id AND " + cl + ".labelid in (" + s + "))";	 		¤			 	}¤			 	¤			 	ret += " WHERE uds.user_name = '" + filter_.getUser().getName() + "'";¤			 	if (spaces_ != null && spaces_.size() > 0) {¤			 		ret += " AND uds.entity_id in ("¤			 			+ "SELECT c.contentid"¤			 			+ " FROM content c"¤			 			+ " WHERE c.spaceid in (" + inSpaces + ")"¤			 			+ " AND c.content_status='current'"	¤			 			+ ")"¤			 		;¤			 	}¤			 	¤			 	if (excludeFilter.length() > 0) {¤			 		ret +=" AND uds.entity_id NOT IN ("¤						+ "SELECT ecl.contentid FROM content_label ecl"¤						+ " WHERE ecl.labelid IN ("+ excludeFilter +")"¤						+")"¤					;¤			 	}¤			 	¤	 			ret += " ORDER BY ud.lastmoddate desc, ud.entity_id desc";			 	¤		 		return ret;¤			}¤		}¤		¤		public String getMainQuery () {¤			boolean unreadOnly = filter_.onlyUnread();¤			if (unreadOnly) {¤				return getOnlyUnreadQuery ();¤			}¤			return getForAllQuery();¤		}¤¤		@Override¤		public boolean needViewPermissions() {¤			return true;¤		}¤	}¤	¤	static abstract class DiscussionCollectionBuilder implements CollectionBuilder {¤		public VelocityItem makeVelocityItem (final List<Object> paramList) {¤			VelocityItem ret = new VelocityItem ();¤			return ret; ¤		}¤		¤		public String getMainQuery() {¤			return "";¤		}¤		¤		abstract protected long getDiscussionLabelId ();¤	}¤¤	static class OpenDiscussionCollectionBuilder extends DiscussionCollectionBuilder {¤		protected long getDiscussionLabelId () {¤			return ContainerManager.Factory.get().getLabelManager().getLabel("open").getId();¤		}¤¤		@Override¤		public boolean needViewPermissions() {¤			// TODO Auto-generated method stub¤			return false;¤		}¤	}¤	¤	static class DeadDiscussionCollectionBuilder extends DiscussionCollectionBuilder {¤		protected long getDiscussionLabelId () {¤			return ContainerManager.Factory.get().getLabelManager().getLabel("dead").getId();¤		}¤¤		@Override¤		public boolean needViewPermissions() {¤			// TODO Auto-generated method stub¤			return false;¤		}¤	}¤	¤	static class CloseDiscussionCollectionBuilder extends DiscussionCollectionBuilder {¤		protected long getDiscussionLabelId () {¤			return ContainerManager.Factory.get().getLabelManager().getLabel("close").getId();¤		}¤¤		@Override¤		public boolean needViewPermissions() {¤			// TODO Auto-generated method stub¤			return false;¤		}¤	}¤	¤	static class HQueryWrapper {¤		private CollectionBuilder cb_ = null;¤		private long limit_ = -1;¤		private long currentOffset_ = 0;¤		private Session session_ = null;¤		private Map<String, Object> contextMap_ = null;¤		¤		private PreparedStatement ps_ = null;¤		private ResultSet rs_ = null;¤		private int countRead_ = 0;¤		private int nullItems_ = 0;¤		private boolean needShowMore_ = true;¤		List<VelocityItem> items_ = null;¤		private long maxListCount_;¤		private DashboardFilter filter_ = null; ¤		¤		public HQueryWrapper (Session session, CollectionBuilder cb, long limit, Map<String, Object> contextMap, long maxListCount,  DashboardFilter filter) throws Exception {¤			session_ = session;¤			cb_ = cb;¤			limit_ = limit;¤			countRead_ = 0;¤			contextMap_ = contextMap;		¤			maxListCount_ = maxListCount;¤			filter_ = filter;¤			try {¤				firstQuery ();¤			} catch (Exception e) {¤				close ();¤				throw e;¤			}¤		}¤		¤		private void firstQuery () throws Exception {¤			long startQueryTime = System.currentTimeMillis();¤			String mysql = cb_.getMainQuery();¤			if (limit_ >= 0) { ¤				mysql += " LIMIT " + currentOffset_ + ", " + limit_;¤			}¤			ps_ = session_.connection().prepareStatement(mysql);¤			rs_ = ps_.executeQuery();¤			contextMap_.put("debugOnlyQueryTime", Long.valueOf(System.currentTimeMillis() - startQueryTime));¤			Map<Long, List<Object>> objs = new HashMap<Long, List<Object>>();¤			List<Long> sortedIds = new ArrayList<Long>();¤			String ids = "";¤			items_ = new ArrayList<VelocityItem> ();¤			while (items_.size () <  maxListCount_) {¤				if (false == next()) {¤					addVelocityItems(objs, ids, sortedIds);¤					needShowMore_ = false;¤					break;¤				}¤				List<Object> paramList = new ArrayList<Object>();¤				paramList.add(rs_.getLong(1));¤				paramList.add(rs_.getTimestamp(2));¤				if (filter_.onlyUnread()) {¤					paramList.add(0);¤				}else{¤					paramList.add(rs_.getLong(3));¤				}¤				objs.put(rs_.getLong(1), paramList);¤				sortedIds.add(rs_.getLong(1));¤				¤				if(StringUtils.isNotEmpty(ids)){¤					ids += ", ";¤				}¤				ids += rs_.getLong(1);¤				if(objs.size () ==  maxListCount_){¤					addVelocityItems(objs, ids, sortedIds);¤					objs = new HashMap<Long, List<Object>>();¤					ids = "";¤					sortedIds = new ArrayList<Long>();¤				}¤	¤			}¤		}¤		¤		private void addVelocityItems(Map<Long, List<Object>> initObjs, String ids, List<Long> sortedIds) throws Exception{¤			if(StringUtils.isNotEmpty(ids)){¤				Map<Long, List<Object>> objs = getPagesWithPermissions(ids, initObjs);¤				for(Long id : sortedIds){¤					if(items_.size () ==  maxListCount_){¤						return;¤					}¤					VelocityItem vi = getVelocityItem (objs.get(id));¤					if (vi != null) {¤						items_.add(vi);¤					}¤				}¤			}¤		}¤		¤		private  Map<Long, List<Object>> getPagesWithPermissions(String ids, Map<Long, List<Object>> objs)throws Exception{¤			String username = (filter_.getUser() != null)?filter_.getUser().getName():null;¤			¤			Query q = session_.createQuery(¤					"SELECT page FROM AbstractPage page WHERE page.id in (" + ids + ") " +¤				    "and ((select count(rpDao.id) from RestrictedPageDAO rpDao where rpDao.pageId=page.id " + ¤			    	"and (:userName) in elements(rpDao.viewRestrictedUsers))=0)"¤					);¤			q.setString("userName", username);¤			List<AbstractPage> pages = q.list();¤			for(AbstractPage page : pages){¤				objs.get(page.getId()).add(page);¤			}¤			return objs;¤		}¤		¤		¤		public List<VelocityItem> getItems(){¤			return items_;¤		}¤		¤		public boolean getNeedShowMore(){¤			return needShowMore_;¤		}¤		¤		private boolean nextQuery () throws Exception {¤			currentOffset_ += limit_;¤			close ();¤			firstQuery ();¤			countRead_ = 1;			¤			return rs_.next();¤		}¤		¤		public boolean next () throws Exception {¤			boolean ret = rs_.next();¤			if (ret == false) {¤				if (limit_ > 0 && countRead_ == limit_) {¤					return nextQuery ();¤				}¤				return false;¤			} else {¤				countRead_++;¤				return true;¤			}¤		}¤		¤		public VelocityItem getVelocityItem (List<Object> paramList) throws Exception {¤			VelocityItem vi = cb_.makeVelocityItem(paramList);¤			if (vi == null) {¤				nullItems_++;¤			}¤			return vi;¤		}¤		¤		public int count () throws Exception {¤			long startQueryTime = System.currentTimeMillis();¤			int ret = 0;¤			if (limit_ > 0) {¤				throw new IllegalStateException ("With limit SQL query no count!!!");¤			} else {¤				rs_.last();¤				ret = rs_.getRow() - nullItems_;¤			}¤			//Logs.LOG_D("HQueryWrapper: executeQuery in " + (System.currentTimeMillis() - startQueryTime) + "ms");¤			return ret;¤		}¤		¤		public void close () {¤			if (rs_ != null) {¤				com.atlassian.core.db.JDBCUtils.close (rs_);¤			}¤			if (ps_ != null) {¤				com.atlassian.core.db.JDBCUtils.close (ps_);¤			}¤		}¤		¤	}	¤	//#UC END# *460A5C2100AB_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/DiscussionsMacroBase|460A5C2100AB
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038967293"))
	    quid       	"460A5C2100AB"
	    documentation 	"Базовый класс макросов обсуждений."
	    stereotype 	"KMacroPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"460A5CE70251"
		    supplier   	"Logical View::external::JavaConfluence::ConfluencePlugins::AbstractHtmlGeneratingMacro"
		    quidu      	"460A5C880148"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006312203"))
		    quid       	"468F575B005D"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DashboardQuery"
		    quidu      	"468F4F6203B9")
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006312583"))
		    quid       	"468F576302DE"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DashboardFilter"
		    quidu      	"465ADE52034B")
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006312947"))
		    quid       	"468F576F038A"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::VelocityItem"
		    quidu      	"468F4D100213"))
	    language   	"MDA Generator"
	    abstract   	TRUE)
	(object Class "DashboardFilter"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need assign op"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need copy ctor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need ref count"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need unsorted less"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need dctor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need objcounter"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"no base class"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"non virtual base"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"singleton"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DashboardFilter.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*465ADE52034B_CUSTOM_IMPORT*"
		    value      	"//#UC START# *465ADE52034B_CUSTOM_IMPORT*¤import ru.garant.MDProcess.ConfluencePlugins.ArchiveCommentSupport.ArchiveCommentAction;¤import ru.garant.MDProcess.ConfluencePlugins.LabelSupport.LabelGroup;¤import ru.garant.MDProcess.ConfluencePlugins.LabelSupport.LabelGroupName;¤import ru.garant.shared.ConfluenceCore.Helpers.ContainerManager;¤¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.labels.Label;¤import com.atlassian.confluence.labels.LabelManager;¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤import com.atlassian.core.bean.EntityObject;¤¤import java.util.*;¤//#UC END# *465ADE52034B_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*465ADE52034B_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *465ADE52034B_CUSTOM_CLASS_DEFINITION*¤//#UC END# *465ADE52034B_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*465ADE52034B_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *465ADE52034B_CUSTOM_METHODS_AND_DATA*¤/*	public enum DocType {¤		ALL, REPORTS, FAULTNEWS, REQUIREMENTS, CODE_ENTITIES, NOT_CODE_ENTITIES, REQUEST¤	};¤*/	¤	public enum DocType {¤		REPORTS, FAULTNEWS, REQUIREMENTS, REQUEST, CONTRACT, CASE, UVS_QUERY, CODE_ENTITIES, NOT_CODE_ENTITIES, ALL¤	};¤	¤	public enum DashboardListType {¤		UNDEFINED, RECENTLY, ACTIVE, DEAD, CLOSE, WARNING_REQUEST¤	};¤	¤	//соответствие элементов NUM с nameLabelList и LabelList  ¤	final int NUM_IMPORTANT			= 0; ¤	final int NUM_REPORT 			= 1; ¤	final int NUM_FAULT  			= 2; ¤	final int NUM_REQUIREMENTS 		= 3; ¤	final int NUM_REQUEST 			= 4; ¤	final int NUM_CONTRACT 			= 5; ¤	final int NUM_CASE	 			= 6; ¤	final int NUM_UVS	 			= 7; ¤	final int NUM_CODE_ENTITIES		= 8; ¤	final int NUM_NOT_CODE_ENTITIES = 9; ¤	final int NUM_ALL_PAGES 		= 10; ¤	¤	final int COUNT_NUM	 			= 10; ¤	//названия групп элементов LabelList (например, группа nameLabelList[0] = "important" содержит элементы LabelList[0][0] = "important" и LabelList[0][1] = "ri_critical") ¤	private String[] nameLabelList = {"important", "report", "faultnews", "requirements", "request", "contract", "case", "uvs_query",¤									  "code_entities", "not_code_entities", "all_pages"};¤	¤	private String[][] LabelList = {	{"important", "ri_critical"},¤										{"report", "briefing"},¤								   		{"fault"},¤								   		{"requirements", "userneeds", "feature", "usecase"},¤								   		{"request"},¤								   		{"contract"},¤								   		{"case"},¤								   		{"uvs_query"},¤								   		{},¤								   		{}¤								   };¤	¤	¤	private DocType docType = DocType.ALL;¤	private boolean unread = false;¤	private boolean important = false;¤	private boolean draft = false;¤¤	private DashboardListType type = DashboardListType.UNDEFINED;¤	private List<EntityObject> radioLabelList = null;¤	private List<EntityObject> importantLabelList = null;¤¤	private com.atlassian.user.User user = AuthenticatedUserThreadLocal.getUser();¤	¤	static final private Map<String, Label> sLabelMap = loadLabelMap();¤¤	static private Map<String, Label> loadLabelMap () {¤		return Collections.synchronizedMap(new HashMap<String, Label>());¤	}¤	static private Label getLabel (String labelTitle) {¤		Label label = sLabelMap.get(labelTitle);¤		if (label == null) {¤			label = getLabelManager().getLabel(labelTitle);¤			if (label == null) {¤				Logs.LOG_E("DashboardFilter::getLabel: can not load label '" + labelTitle + "' from LabelManager.");¤			}¤			sLabelMap.put(labelTitle, label);			¤		}¤		return label;¤	}¤¤	public DashboardFilter (String dashboardListKey, boolean forceOnlyUnread) {¤		init(DashboardListType.valueOf(dashboardListKey), forceOnlyUnread);¤	}¤¤	public DashboardFilter (DashboardListType type, boolean forceOnlyUnread) {¤		init(type, forceOnlyUnread);¤	}¤¤	private void init (DashboardListType dashboardListType, boolean onlyUnread) ¤	{¤		type = dashboardListType;¤		boolean flagInitLabel = false;¤		¤		if (user != null) {¤			unread = (onlyUnread)? true: getBooleanProfileData("unread", false);¤			important = getBooleanProfileData("important", false);¤			draft = getBooleanProfileData("draft", false);¤			importantLabelList = makeLabelList(NUM_IMPORTANT);¤¤			String filterType = getStringProfileData("filter_type");¤			if (filterType != null) ¤			{¤				for(int i = NUM_REPORT; (i < COUNT_NUM) || !flagInitLabel; i++)¤				{¤					if (nameLabelList[i].equals(filterType)) {¤						getFromNumLabelListType(i);¤						switch(i)¤						{¤							case NUM_REPORT:¤							case NUM_FAULT:¤							case NUM_REQUIREMENTS:¤							case NUM_REQUEST:¤							case NUM_CONTRACT:¤							case NUM_CASE:¤							case NUM_UVS:¤								radioLabelList = makeLabelList(i);¤							break;¤							case NUM_CODE_ENTITIES:¤							case NUM_NOT_CODE_ENTITIES:¤								radioLabelList = getCodeLabels();¤							break;¤							case NUM_ALL_PAGES:¤							break;¤						}¤						flagInitLabel = true;¤					}¤				}¤				¤				if(!flagInitLabel)¤					Logs.LOG_E("DashboardFilter::init: unknown filter type '" + filterType + "'.");¤			}¤		}¤	}¤¤	private void getFromNumLabelListType(int i)¤	{¤		switch(i)¤		{¤		case NUM_REPORT:¤			docType = DocType.REPORTS;¤		break;¤		case NUM_FAULT:¤			docType = DocType.FAULTNEWS;¤		break;¤		case NUM_REQUIREMENTS:¤			docType = DocType.REQUIREMENTS;¤		break;¤		case NUM_REQUEST:¤			docType = DocType.REQUEST;¤		break;¤		case NUM_CONTRACT:¤			docType = DocType.CONTRACT;¤		break;¤		case NUM_CASE:¤			docType = DocType.CASE;¤		break;¤		case NUM_UVS:¤			docType = DocType.UVS_QUERY;¤		break;¤		case NUM_CODE_ENTITIES:¤			docType = DocType.CODE_ENTITIES;¤		break;¤		case NUM_NOT_CODE_ENTITIES:¤			docType = DocType.NOT_CODE_ENTITIES;¤		break;¤		default:¤			docType = DocType.ALL;¤		}¤		¤	}¤	¤	public List<EntityObject> makeLabelList (int index) ¤	{¤		ArrayList<EntityObject> labels = new ArrayList<EntityObject>(LabelList[index].length);¤		for(int i = 0; i < LabelList[index].length; i++)¤		{¤			Label lab = getLabel(LabelList[index][i]);¤			if (lab != null) {¤				labels.add(lab);¤			}¤		}¤		return labels;¤	}¤¤/*¤	private void init (DashboardListType dashboardListType, boolean onlyUnread) {¤		type = dashboardListType;¤		if (user != null) {¤			unread = (onlyUnread)? true: getBooleanProfileData("unread", false);¤			important = getBooleanProfileData("important", false);¤			draft = getBooleanProfileData("draft", false);¤			importantLabelList = makeImportantLabelList();¤¤			String filterType = getStringProfileData("filter_type");¤			if (filterType != null) {¤				if ("report".equals(filterType)) {¤					docType = DocType.REPORTS;¤					radioLabelList = makeReportLabelList();¤				} else if ("faultnews".equals (filterType)) {¤					docType = DocType.FAULTNEWS;¤					radioLabelList = makeFaultLabelList();¤				} else if ("requirements".equals (filterType)) {¤					docType = DocType.REQUIREMENTS;¤					radioLabelList = makeRequirementsLabelList();¤				} else if ("request".equals(filterType)) {¤					docType = DocType.REQUEST;¤					radioLabelList = getRequestLabels();¤				} else if ("code_entities".equals(filterType)) {¤					docType = DocType.CODE_ENTITIES;¤					radioLabelList = getCodeLabels();¤				} else if ("not_code_entities".equals(filterType)) {¤					docType = DocType.NOT_CODE_ENTITIES;¤					radioLabelList = getCodeLabels();¤				} else if ("all_pages".equals(filterType)) {¤					docType = DocType.ALL;¤				} else {¤					Logs.LOG_E("DashboardFilter::init: unknown filter type '" + filterType + "'.");¤				}¤			}¤		}¤	}¤*/¤	final public boolean isStatusSet () {¤		return unread || important || draft;¤	}¤¤	final public com.atlassian.user.User getUser () {¤		return user;¤	}¤	final public DashboardListType getType () {¤		return type;¤	}¤¤	final public boolean onlyUnread () {¤		return unread;¤	}¤	final public List<EntityObject> getSpaces () {¤		return null;¤	}¤	final public List<EntityObject> getAndLabels () {¤		ArrayList<EntityObject> labels = new ArrayList<EntityObject>(2);¤		if (onlyDraft()) {¤			labels.add(getLabel("draft"));¤		}¤		switch (type) {¤		case ACTIVE:¤			labels.add(getLabel("open"));¤			break;¤		case DEAD:¤			labels.add(getLabel("dead"));¤			break;¤		case CLOSE:¤			labels.add(getLabel("close"));¤			break;¤		}¤		return labels;¤	}¤	final public boolean hasAndLabels () {¤		return onlyDraft()¤			|| (type == DashboardListType.ACTIVE)¤			|| (type == DashboardListType.DEAD)¤			|| (type == DashboardListType.CLOSE);¤	}¤	final public List<EntityObject> getNotAndLabels () {¤		return null;¤	}¤	final public boolean hasNotAndLabels () {¤		return false;¤	}¤	final public List<List<EntityObject>> getOrLabels () {¤		List<List<EntityObject>> res = new ArrayList<List<EntityObject>>(2);¤		if (needCodeEntities()) {¤			res.add(radioLabelList);¤		}¤		if (onlyImportant()) {¤			res.add(importantLabelList);¤		}¤		return res;¤	}¤	final public boolean hasOrLabels () {¤		return needCodeEntities() || onlyImportant();¤¤	}¤	final public List<EntityObject> getNotOrLabels () {¤		return hasNotOrLabels()? radioLabelList : null;¤	}¤	final public boolean hasNotOrLabels () {¤		return needNotCodeEntities();¤	}¤¤	public boolean needCodeEntities () {¤		return (docType != DocType.NOT_CODE_ENTITIES) && (radioLabelList != null);¤	}¤	public boolean needNotCodeEntities () {¤		return (docType == DocType.NOT_CODE_ENTITIES) && (radioLabelList != null);¤	}¤¤	private List<EntityObject> getCodeLabels () {¤		LabelGroup labelGroup = LabelGroup.Factory.get(LabelGroupName.CODE_ELEMENTS.toString());¤		List<EntityObject> labels = new ArrayList<EntityObject> (labelGroup.getLabels().size());¤		for (ru.garant.MDProcess.ConfluencePlugins.LabelSupport.Label l : labelGroup.getLabels()) {¤			labels.add (l.getConfluenceLabel());			¤		}¤		return labels;¤	}¤¤	public List<EntityObject> getRadioLabels () {¤		return radioLabelList;¤	}¤/*¤	private List<EntityObject> getRequestLabels () {¤		ArrayList<EntityObject> labels = new ArrayList<EntityObject>();¤		Label l1 = getLabel("request");¤		if (l1 != null) {¤			labels.add(l1);¤		}¤		return labels;¤	}¤¤	private List<EntityObject> makeImportantLabelList () {¤		ArrayList<EntityObject> labels = new ArrayList<EntityObject>(2);¤		Label l1 = getLabel("important");¤		if (l1 != null) {¤			labels.add(l1);¤		}¤		Label l2 = getLabel("ri_critical");¤		if (l2 != null) {¤			labels.add(l2);¤		}¤		return labels;¤	}¤	¤	private List<EntityObject> makeRequirementsLabelList () {¤		ArrayList<EntityObject> labels = new ArrayList<EntityObject>(4);¤		Label l1 = getLabel("requirements");¤		if (l1 != null) {¤			labels.add(l1);¤		}¤		Label l2 = getLabel("userneeds");¤		if (l2 != null) {¤			labels.add(l2);¤		}¤		Label l3 = getLabel("feature");¤		if (l3 != null) {¤			labels.add(l3);¤		}¤		Label l4 = getLabel("usecase");¤		if (l4 != null) {¤			labels.add(l4);¤		}¤		return labels;¤	}¤	private List<EntityObject> makeReportLabelList () {¤		ArrayList<EntityObject> res = new ArrayList<EntityObject>(2);¤		res.add(getLabel("report"));¤		res.add(getLabel("briefing"));¤		return res;¤	}¤	private List<EntityObject> makeFaultLabelList () {¤		ArrayList<EntityObject> res = new ArrayList<EntityObject>(1);¤		res.add(getLabel("fault"));¤		return res;¤	}¤*/	¤	public boolean onlyImportant () {¤		return important;¤	}¤	public boolean onlyDraft () {¤		return draft;¤	}¤	private DocType getDocType () {¤		return docType;¤	}¤¤	final public boolean isPassed (AbstractPage page, String userName) {¤		if (userName == null) {¤			return true;¤		}¤		if (!isLabelsPassed(page)) {¤			return false;¤		}¤		if (!isUnreadPassed(page)) {¤			return false;¤		}¤		return true;¤	}¤¤	private boolean isLabelsPassed (AbstractPage page) {¤		if (checkFilterType(page) == false) {¤			return false;¤		}¤		if (onlyImportant()){¤			if (!checkForLabels(page, importantLabelList, true)) {¤				return false;¤			}¤		}¤		if (onlyDraft()){¤			if (ContainerManager.Factory.get().getLabelManager().getLabel(page, "draft") == null) {¤				return false;¤			}¤		}¤		return true;¤	}¤¤	private boolean isUnreadPassed (AbstractPage page) {¤		return !onlyUnread()¤			|| !getDiscussionManager().isDocumentRead(page.getId ())¤			|| !getDiscussionManager().isDiscussionRead(page.getId ());¤	}¤	final private boolean checkFilterType (AbstractPage page) {¤		return (getDocType() == DocType.ALL) ?¤				true : checkForLabels(page, radioLabelList, getDocType() != DocType.NOT_CODE_ENTITIES);¤	}¤¤	private boolean checkForLabels (AbstractPage page, List<EntityObject> labels, boolean have_to_be) {¤		for (Iterator<EntityObject> it = labels.iterator(); it.hasNext();) {¤			Label l = (Label)it.next();¤			if ((l != null) && (ContainerManager.Factory.get().getLabelManager().getLabel(page, l.getName()) != null)) {¤				return have_to_be;¤			}¤		}¤		return !have_to_be;¤	}¤¤	private DiscussionManager discussionManager = null;¤	private DiscussionManager getDiscussionManager () {¤		if (discussionManager == null) {¤			discussionManager = (DiscussionManager)com.atlassian.spring.container.ContainerManager.getComponent(¤					"ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager"¤			);¤			if (discussionManager == null) {¤				Logs.LOG_E("DashboardFilter::getDiscussionManager: can not find DiscussionManager");¤			}¤		}¤		return discussionManager;¤	}¤	static private LabelManager getLabelManager() {¤		return ContainerManager.Factory.get().getLabelManager();¤	}¤	¤	public boolean getBooleanProfileData (String dataKey, boolean defaultValue) {¤		String data = getStringProfileData(dataKey);¤		if (data == null) {¤			return defaultValue;¤		}¤		return "true".equals(data);¤	}¤	private String getStringProfileData (String dataKey) {¤		final UserData data = UserData.Factory.getAndCreate(user.getName(), dataKey);¤		if (data == null) {¤			return null;¤		}¤		final Object o = data.getData();¤		if (o == null) {¤			return null;¤		}¤		return o.toString();¤	}¤	¤	boolean isRequestOnly () {¤		return "request".equals (getStringProfileData("filter_type"));		¤	}¤	¤	final public List<List<EntityObject>> getRadioButtonFilterLabels () {¤		List<List<EntityObject>> res = new ArrayList<List<EntityObject>>();¤		if (needCodeEntities()) {¤			res.add(radioLabelList);¤		}¤		return res;¤	}¤	¤	final public List<List<EntityObject>> getCheckboxFilterLabels () {¤		List<List<EntityObject>> res = new ArrayList<List<EntityObject>>();¤		if (onlyImportant()) {¤			res.add(importantLabelList);¤		}¤		if (draft) {¤			List<EntityObject> d = new ArrayList<EntityObject>();¤			d.add(ContainerManager.Factory.get().getLabelManager().getLabel("draft"));¤			res.add (d);¤		}¤		return res;¤	}¤	¤	//#UC END# *465ADE52034B_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/DashboardFilter|465ADE52034B
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19026227489"))
	    quid       	"465ADE52034B"
	    documentation 	"Класс фильтра для формирования списка документов для ПУ"
	    stereotype 	"SimpleClass"
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006313976"))
		    quid       	"47861AD502CC"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserData::UserData"
		    quidu      	"4760022E0189"))
	    language   	"MDA Generator")
	(object Class "GarantDashboardFilterXWorkPlugin"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"NESTED GENERATED WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/SetCheck|477CE1520369::465ADED20280;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/SetRadio|477CE1D40029::465ADED20280;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/setCheck|477CE1520369::465ADED20280;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/setRadio|477CE1D40029::465ADED20280;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage|465ADED20280::465ADED20280;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage|465ADED20280::465ADED20280
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin|465ADEC3030D
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039209296"))
	    quid       	"465ADEC3030D"
	    documentation 	"Экшн для установки пользователем состояния фильтра ПУ"
	    stereotype 	"KXWorkPlugin"
	    language   	"MDA Generator"
	    nestedClasses 	(list nestedClasses
		(object Class "GarantDashboardFilterXPackage"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"output.xml:*465ADED20280_PACKAGE_CONTENT*"
			    value      	(value Text 
|<!--UC_BEGIN*465ADED20280_PACKAGE_CONTENT*-->¤                        <default-interceptor-ref name="validatingStack"/>¤¤                        <action name="setCheck" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DashboardFilterAction" method="setCheck">¤                             <result name="success" type="rawText" />¤                             <result name="error" type="rawText" />¤                        </action>¤                        <action name="setRadio" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DashboardFilterAction" method="setRadio">¤                             <result name="success" type="rawText" />¤                             <result name="error" type="rawText" />¤                        </action>¤			<!--UC_END*465ADED20280_PACKAGE_CONTENT*-->
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"WikiPageID (wiki)"
			    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage|465ADED20280
			    ))
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"def-interceptor"
			    value      	"validatingStack")
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"interceptor"
			    value      	"defaultStack")
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"need UC"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"NESTED GENERATED WikiPageID (wiki)"
			    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/SetCheck|477CE1520369::477CE1520369;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/SetRadio|477CE1D40029::477CE1D40029;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/setCheck|477CE1520369::477CE1520369;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/setRadio|477CE1D40029::477CE1D40029
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"SourceType (wiki)"
			    value      	"wiki")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19039210603"))
		    quid       	"465ADED20280"
		    documentation 	"Экшн для установки пользователем состояния фильтра ПУ"
		    stereotype 	"XPackage"
		    nestedClasses 	(list nestedClasses
			(object Class "SetCheck"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setCheck")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/SetCheck|477CE1520369
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039212068"))
			    quid       	"477CE1520369"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006316338"))
				    quid       	"477CE1E70374"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DashboardFilterAction"
				    quidu      	"465ADEEF0280"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006315477"))
				    quid       	"477CE1FA0318"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006315887"))
				    quid       	"477CE20902F0"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SetRadio"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setRadio")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/GarantDashboardFilterXWorkPlugin/GarantDashboardFilterXPackage/SetRadio|477CE1D40029
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039215150"))
			    quid       	"477CE1D40029"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006318196"))
				    quid       	"477CE1F002CA"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DashboardFilterAction"
				    quidu      	"465ADEEF0280"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006317331"))
				    quid       	"477CE2160348"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006317749"))
				    quid       	"477CE21C01D8"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))))))
	(object Class "DashboardFilterAction"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DashboardFilterAction.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*465ADEEF0280_CUSTOM_IMPORT*"
		    value      	"//#UC START# *465ADEEF0280_CUSTOM_IMPORT*¤//import ru.garant.MDProcess.ConfluencePlugins.GarantProfileSupport.ProfileComponentPlugin;¤import ru.garant.MDProcess.ConfluencePlugins.UserData.UserData;¤¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤import com.atlassian.user.User;¤//#UC END# *465ADEEF0280_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*465ADEEF0280_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *465ADEEF0280_CUSTOM_CLASS_DEFINITION*¤//#UC END# *465ADEEF0280_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*465ADEEF0280_ACTION_NAME*"
		    value      	(value Text 
|//#UC START# *465ADEEF0280_ACTION_NAME*¤		return getClass ().getName (); ¤		//#UC END# *465ADEEF0280_ACTION_NAME*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*465ADEEF0280_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *465ADEEF0280_CUSTOM_METHODS_AND_DATA*¤	public String setCheck () {¤		return setToProfile (this.id, this.state);¤	}¤¤	public String setRadio () {¤		return setToProfile (this.name, this.id);¤	}¤¤	private String setToProfile (String key, String value) {¤		try {¤			User user = AuthenticatedUserThreadLocal.getUser ();¤			if (user != null) { // if the user was not logged¤				UserData ud = UserData.Factory.getAndCreate(user.getName(), key);¤				ud.setData(value);¤				¤				//getProfile ().put (user.getName (), key, value);¤				return SUCCESS;¤			}¤		} catch (Exception e) {¤			Logs.LOG_E ("DashboardFilterAction::setToProfile: Exception: " + e);¤		}¤		return ERROR;¤	}¤¤	private String id = null;¤	public void setId (String id) {¤		this.id = id;¤	}¤¤	private String name = null;¤	public void setName (String name) {¤		this.name = name;¤	}¤¤	private String state = null;¤	public void setState (String state) {¤		this.state = state;¤	}¤¤//	private ru.garant.MDProcess.ConfluencePlugins.GarantProfileSupport.ProfileComponentPlugin profile;¤//	private ProfileComponentPlugin getProfile () {¤//		if (this.profile == null) {¤//			this.profile =¤//				(ProfileComponentPlugin) ContainerManager.getInstance ().getContainerContext ().getComponent (¤//						"ru.garant.MDProcess.ConfluencePlugins.GarantProfileSupport.ProfileComponentPlugin"¤//				);¤//		}¤//		if (this.profile == null) {¤//			Logs.LOG_E ("DashboardFilterAction::getProfile: ProfileComponentPlugin is NULL.");¤//		}¤//		return this.profile;¤//	}¤	//#UC END# *465ADEEF0280_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/DashboardFilterAction|465ADEEF0280
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039213662"))
	    quid       	"465ADEEF0280"
	    documentation 	"Экшн для установки пользователем состояния фильтра ПУ"
	    stereotype 	"KActionPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"465ADF1400CB"
		    supplier   	"Logical View::external::JavaConfluence::ConfluenceClassPack::ConfluenceActionSupport"
		    quidu      	"465ADCCA036B"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006319754"))
		    quid       	"47861B0C0383"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserData::UserData"
		    quidu      	"4760022E0189"))
	    language   	"MDA Generator")
	(object Class "UnreadStateXWorkPlugin"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"NESTED GENERATED WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadCommentState|477CE30702D0::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadEntityState|477CE2BE0096::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadEtityState|477CE2BE0096::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadStateForAll|477CE2DC02B7::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadState|477CE27B01EC::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadCommentState|477CE2F90279::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadEntityState|477CE2C80019::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadEtityState|477CE2C80019::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadState|477CE28702B3::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadCommentState|477CE30702D0::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadEtityState|477CE2BE0096::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadStateForAll|477CE2DC02B7::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadState|477CE27B01EC::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setUnreadCommentState|477CE2F90279::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setUnreadEtityState|477CE2C80019::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setUnreadState|477CE28702B3::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage|46690C5102CE::46690C5102CE;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage|46690C5102CE::46690C5102CE
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/UnreadStateXWorkPlugin|46690C39037A
		    ))
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039059343"))
	    quid       	"46690C39037A"
	    documentation 	"Поддержка экшена для реализации смены состояния прочитанности контента (документа, новости или комментария)."
	    stereotype 	"KXWorkPlugin"
	    language   	"MDA Generator"
	    nestedClasses 	(list nestedClasses
		(object Class "UnreadStateXPackage"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"output.xml:*46690C5102CE_PACKAGE_CONTENT*"
			    value      	(value Text 
|<!--UC_BEGIN*46690C5102CE_PACKAGE_CONTENT*-->¤                        <default-interceptor-ref name="validatingStack"/>¤¤			<action name="setReadState" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.UnreadStateActionPlugin" method="setReadState">¤                             <result name="success" type="rawText" />¤                             <result name="error" type="rawText" />¤			</action>¤			<action name="setUnreadState" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.UnreadStateActionPlugin" method="setUnreadState">¤                             <result name="success" type="rawText" />¤                             <result name="error" type="rawText" />¤			</action>¤                        <action name="setReadEtityState" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.UnreadStateActionPlugin" method="setReadEtityState">¤                             <result name="success" type="rawText" />¤                             <result name="error" type="rawText" />¤			</action>¤			<action name="setUnreadEtityState" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.UnreadStateActionPlugin" method="setUnreadEtityState">¤                             <result name="success" type="rawText" />¤                             <result name="error" type="rawText" />¤			</action>¤			<action name="setReadStateForAll" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.UnreadStateActionPlugin" method="setReadStateForAll">¤                             <result name="success" type="velocity-xml">/AjaxResponse.xml</result>¤                             <result name="error" type="rawText" />¤			</action>¤			<action name="setUnreadCommentState" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.UnreadStateActionPlugin" method="setUnreadCommentState">¤                             <result name="success" type="velocity-xml">/AjaxResponse.xml</result>¤                             <result name="error" type="rawText" />¤			</action>¤			<action name="setReadCommentState" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.UnreadStateActionPlugin" method="setReadCommentState">¤                             <result name="success" type="velocity-xml">/AjaxResponse.xml</result>¤                             <result name="error" type="rawText" />¤			</action>¤			<!--UC_END*46690C5102CE_PACKAGE_CONTENT*-->
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"WikiPageID (wiki)"
			    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage|46690C5102CE
			    ))
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"def-interceptor"
			    value      	"validatingStack")
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"need UC"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"NESTED GENERATED WikiPageID (wiki)"
			    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadCommentState|477CE30702D0::477CE30702D0;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadEntityState|477CE2BE0096::477CE2BE0096;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadEtityState|477CE2BE0096::477CE2BE0096;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadStateForAll|477CE2DC02B7::477CE2DC02B7;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadState|477CE27B01EC::477CE27B01EC;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadCommentState|477CE2F90279::477CE2F90279;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadEntityState|477CE2C80019::477CE2C80019;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadEtityState|477CE2C80019::477CE2C80019;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadState|477CE28702B3::477CE28702B3;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadCommentState|477CE30702D0::477CE30702D0;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadEtityState|477CE2BE0096::477CE2BE0096;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadStateForAll|477CE2DC02B7::477CE2DC02B7;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setReadState|477CE27B01EC::477CE27B01EC;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setUnreadCommentState|477CE2F90279::477CE2F90279;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setUnreadEtityState|477CE2C80019::477CE2C80019;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/setUnreadState|477CE28702B3::477CE28702B3
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"SourceType (wiki)"
			    value      	"wiki")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19039060744"))
		    quid       	"46690C5102CE"
		    documentation 	"Поддержка экшена для реализации смены состояния прочитанности контента (документа, новости или комментария)."
		    stereotype 	"XPackage"
		    nestedClasses 	(list nestedClasses
			(object Class "SetReadState"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setReadState")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadState|477CE27B01EC
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039063854"))
			    quid       	"477CE27B01EC"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006322101"))
				    quid       	"477CE330009B"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin"
				    quidu      	"46690C610109"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006321215"))
				    quid       	"477CE3C5001A"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006321645"))
				    quid       	"477CE3C90081"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SetUnreadState"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setUnreadState")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadState|477CE28702B3
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039073387"))
			    quid       	"477CE28702B3"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006323972"))
				    quid       	"477CE339033B"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin"
				    quidu      	"46690C610109"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006323099"))
				    quid       	"477CE3E50025"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006323519"))
				    quid       	"477CE3EA00E8"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SetReadEntityState"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setReadEntityState")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadEntityState|477CE2BE0096
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039062234"))
			    quid       	"477CE2BE0096"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006326125"))
				    quid       	"477CE3350120"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin"
				    quidu      	"46690C610109"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006325259"))
				    quid       	"477CE3CF01FD"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006325675"))
				    quid       	"477CE3D50148"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SetUnreadEntityState"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setUnreadEntityState")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadEntityState|477CE2C80019
				    ))
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"finished"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ApplyedGens"
				    value      	"All")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039071831"))
			    quid       	"477CE2C80019"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006328065"))
				    quid       	"477CE336038E"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin"
				    quidu      	"46690C610109"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006327197"))
				    quid       	"477CE3DA0352"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006327608"))
				    quid       	"477CE3E0003D"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SetReadStateForAll"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setReadStateForAll")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadStateForAll|477CE2DC02B7
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039070284"))
			    quid       	"477CE2DC02B7"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006329928"))
				    quid       	"477CE329026B"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin"
				    quidu      	"46690C610109"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator User Properties"
					    name       	"xml_name"
					    value      	"ConfluencePlugins/AjaxResponse.xml")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006329056"))
				    quid       	"477CE3A4036A"
				    stereotype 	"velocity-xml"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006329481"))
				    quid       	"477CE3B00126"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SetUnreadCommentState"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setUnreadCommentState")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadCommentState|477CE2F90279
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039068665"))
			    quid       	"477CE2F90279"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006331798"))
				    quid       	"477CE3260379"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin"
				    quidu      	"46690C610109"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator User Properties"
					    name       	"xml_name"
					    value      	"ConfluencePlugins/AjaxResponse.xml")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006330924"))
				    quid       	"477CE39003AA"
				    stereotype 	"velocity-xml"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006331348"))
				    quid       	"477CE399036C"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SetReadCommentState"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setReadCommentState")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadCommentState|477CE30702D0
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039065458"))
			    quid       	"477CE30702D0"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006333683"))
				    quid       	"477CE32C01E9"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin"
				    quidu      	"46690C610109"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator User Properties"
					    name       	"xml_name"
					    value      	"ConfluencePlugins/AjaxResponse.xml")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006332807"))
				    quid       	"477CE3720206"
				    stereotype 	"velocity-xml"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006333232"))
				    quid       	"477CE3870138"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SetReadTwoStates"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"finished"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setReadTwoStates")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ApplyedGens"
				    value      	"All")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetReadTwoStates|48AAC1AD0018
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039067050"))
			    quid       	"48AAC1AD0018"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006335558"))
				    quid       	"48AAC22200BF"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin"
				    quidu      	"46690C610109"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006334687"))
				    quid       	"48AAC1F90272"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006335106"))
				    quid       	"48AAC2080262"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SetUnreadTwoStates"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"finished"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setUnreadTwoStates")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/UnreadStateXWorkPlugin/UnreadStateXPackage/SetUnreadTwoStates|48AAC276010B
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039076807"))
			    quid       	"48AAC276010B"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006337444"))
				    quid       	"48AAC2A902CF"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin"
				    quidu      	"46690C610109"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006336571"))
				    quid       	"48AAC290022A"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006336995"))
				    quid       	"48AAC29B0220"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))))))
	(object Class "UnreadStateActionPlugin"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadStateActionPlugin.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*46690C610109_CUSTOM_IMPORT*"
		    value      	"//#UC START# *46690C610109_CUSTOM_IMPORT*¤import com.atlassian.confluence.pages.CommentManager;¤import com.atlassian.confluence.pages.Comment;¤import com.atlassian.spring.container.ContainerManager;¤¤import java.util.List;¤¤import org.apache.poi.util.StringUtil;¤//#UC END# *46690C610109_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*46690C610109_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *46690C610109_CUSTOM_CLASS_DEFINITION*¤//#UC END# *46690C610109_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*46690C610109_ACTION_NAME*"
		    value      	(value Text 
|//#UC START# *46690C610109_ACTION_NAME*¤		return getClass().getName();¤		//#UC END# *46690C610109_ACTION_NAME*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*46690C610109_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *46690C610109_CUSTOM_METHODS_AND_DATA*¤	public String setReadStateForAll () {¤		responseContent =¤			"<state>"¤			+ ((this.idList == null)¤					? getDiscussionManager().setReadStateForAll(dashboardListKey, maxCount, forceOnlyUnread)¤					: getDiscussionManager().setReadStateForAll(dashboardListKey, idList, isDiscussion))¤			+ "</state>";¤		return SUCCESS;¤	}¤¤	public String setUnreadEntityState () {¤		getDiscussionManager ().setDocumentUnreadState (this.contentId);¤		return SUCCESS;¤	}¤	public String setReadEntityState () {¤		getDiscussionManager().setDocumentReadState (this.contentId);¤		return SUCCESS;¤	}¤¤	public String setUnreadState () {¤		getDiscussionManager ().setDiscussionUnreadState (this.contentId);¤		return SUCCESS;¤	}¤	public String setReadState () {¤		getDiscussionManager ().setDiscussionReadState (this.contentId);¤		return SUCCESS;¤	}¤¤	public String setUnreadTwoStates () {¤		getDiscussionManager ().setDocumentUnreadState (this.contentId);¤		getDiscussionManager ().setDiscussionUnreadState (this.contentId);¤		return SUCCESS;¤	}¤¤	public String setReadTwoStates () {¤		getDiscussionManager().setDocumentReadState (this.contentId);¤		getDiscussionManager ().setDiscussionReadState (this.contentId);¤		return SUCCESS;¤	}¤¤	public String setUnreadCommentState () {¤		Comment comment = this.commentManager.getComment(this.contentId);¤		List<Long> arrayCommentIds = getDiscussionManager().setCommentUnreadState (comment);¤		this.responseContent = makeXmlId(arrayCommentIds);¤		return SUCCESS;¤	}¤	public String setReadCommentState () {¤		Comment comment = this.commentManager.getComment(this.contentId);¤		List<Long> arrayCommentIds = getDiscussionManager().setCommentReadState (comment, this.withDescendants);¤		this.responseContent = makeXmlId(arrayCommentIds);¤		return SUCCESS;¤	}¤¤    private String makeXmlId (List<Long> arrayCommentIds) {¤    	String res = "";¤    	for (Long id : arrayCommentIds) {¤    		if (id != 0L) {¤    			res += "<id>" + id + "</id>";¤    		}¤    	}¤    	return res;¤    }¤¤    private String responseContent = null;¤    public String getResponseContent () {¤    	return this.responseContent;¤    }¤¤ 	private String dashboardListKey = null;¤	public void setDashboardListKey (String dashboardListKey) {¤		this.dashboardListKey = dashboardListKey;¤	}¤	¤	private Boolean isDiscussion = null;¤	public void setIsDiscussion (String isDiscussion) {¤		this.isDiscussion = Boolean.valueOf(isDiscussion);¤	}¤	¤	private List<Long> idList = null;¤	public void setIdList (String idList) {¤		if(idList == null || idList.isEmpty()){¤			Logs.LOG_E("Error in UnreadStateActionPlugin : setIdList : idList is empty");¤			return;¤		}¤		¤		for(char ch : idList.toCharArray()){¤			if(!Character.isDigit(ch) && !Character.isWhitespace(ch)){¤				Logs.LOG_E("Error in UnreadStateActionPlugin : setIdList : idList=" + idList);¤				return;¤			}	¤		}¤		¤		String[] list = idList.split(" ");¤		this.idList = new java.util.ArrayList<Long>(list.length);¤		for (int i = 0; i < list.length; ++i) {¤			Long l = Long.valueOf(list[i]);¤			if ((l != null) && (l != 0L)) {¤				this.idList.add(l);¤			}¤		}¤	}¤¤	private int maxCount = -1;¤	public void setMaxCount (String maxCount) {¤		this.maxCount = Integer.valueOf (maxCount);¤	}¤	public void setAll (String all) {¤		if (Integer.valueOf (all) == 1) {¤			this.maxCount = -1;¤		}¤	}¤	private boolean forceOnlyUnread = false;¤	public void setForceOnlyUnread (String forceOnlyUnread) {¤		this.forceOnlyUnread = Boolean.valueOf(forceOnlyUnread);¤	}¤¤    private long contentId = 0L;¤	public void setId (String id) {¤		this.contentId = Long.valueOf (id);¤	}¤¤¤	private boolean withDescendants = false;¤	public void setWithDescendants (String withDescendants) {¤		this.withDescendants = Boolean.valueOf (withDescendants);¤	}¤¤	private CommentManager commentManager = null;¤	public void setCommentManager (CommentManager commentManager) {¤		this.commentManager = commentManager;¤	}¤¤	private DiscussionManager discussionManager = null;¤	private DiscussionManager getDiscussionManager () {¤		if (this.discussionManager == null) {¤			this.discussionManager = (DiscussionManager) ContainerManager.getComponent ("ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager");¤			if (this.discussionManager == null) {¤				Logs.LOG_E ("UnreadStateActionPlugin::getDiscussionManager: can not find getDiscussionManager");¤			}¤		}¤		return this.discussionManager;¤	}¤	//#UC END# *46690C610109_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/UnreadStateActionPlugin|46690C610109
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039074929"))
	    quid       	"46690C610109"
	    documentation 	"Поддержка экшена для реализации смены состояния прочитанности контента (документа, новости или комментария)."
	    stereotype 	"KActionPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"46690C7B031C"
		    supplier   	"Logical View::external::JavaConfluence::ConfluenceClassPack::ConfluenceActionSupport"
		    quidu      	"465ADCCA036B"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006339428"))
		    quid       	"468F5748037A"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionManager"
		    quidu      	"468F4EC30177"))
	    language   	"MDA Generator")
	(object Class "VelocityItem"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/VelocityItem.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D100213_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4D100213_CUSTOM_IMPORT*¤import com.atlassian.confluence.pages.AbstractPage;¤import java.util.*;¤//#UC END# *468F4D100213_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D100213_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *468F4D100213_CUSTOM_CLASS_DEFINITION*¤//#UC END# *468F4D100213_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D100213_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4D100213_CUSTOM_METHODS_AND_DATA*¤	¤	private AbstractPage page_ = null;¤	private String author_ = "";¤	private Date date_ = null;¤	private boolean isRead_ = true;¤	private boolean isDocumentBodyRead_ = true;¤	private int unreadCommentCount_ = 0;¤	private long lastCommentId_ = 0L;¤	private String title_ = null;¤¤	public VelocityItem() {¤	}¤¤	final public AbstractPage getPage () {¤		return page_;¤	}¤¤	final public String getAuthor () {¤		return author_;¤	}¤¤	final public Date getDate () {¤		return date_;¤	}¤¤	final public boolean getIsRead () {¤		return isRead_;¤	}¤	¤	final public boolean getIsDocumentBodyRead() {¤		return isDocumentBodyRead_;¤	}¤	¤	final public boolean isDocumentBodyRead() {¤		return isDocumentBodyRead_;¤	}¤¤	final public int getUnreadCommentCount () {¤		return unreadCommentCount_;¤	}¤¤	final public long getLastCommentId () {¤		return lastCommentId_;¤	}¤¤	final public boolean isRead () {¤		return isRead_;¤	}¤¤	final public void setPage (AbstractPage page) {¤		page_ = page;¤	}¤¤	final public void setRead (boolean isRead) {¤		isRead_ = isRead;¤	}¤	¤	final public void setDocumentBodyRead(boolean read) {¤		isDocumentBodyRead_ = read;¤	}¤¤	final public void setDate (Date date) {¤		date_ = date;¤	}¤¤	final public void setUnreadCommentCount (int unreadCommentCount) {¤		unreadCommentCount_ = unreadCommentCount;¤	}¤¤	final public void setLastCommentId (long lastCommentId) {¤		lastCommentId_ = lastCommentId;¤	}¤¤	final public void setAuthor (String author) {¤		author_ = author;¤	}¤¤	final public String getTitle () {¤		if (title_ == null) {¤			return page_.getTitle();¤		}¤		return title_;¤	}¤¤	final public void setTitle (String title) {¤		title_ = title;¤	}¤	¤	//#UC END# *468F4D100213_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/VelocityItem|468F4D100213
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19026228575"))
	    quid       	"468F4D100213"
	    documentation 	"Класс для отображеия обсуждения или документа в списке ПУ"
	    stereotype 	"SimpleClass"
	    language   	"MDA Generator")
	(object Class "UnreadEntity"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadEntity.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D500196_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4D500196_CUSTOM_IMPORT*¤import java.util.*;¤¤import ru.garant.MDProcess.ConfluencePlugins.UserSupport.UserHelper;¤import com.atlassian.user.User;¤//#UC END# *468F4D500196_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D500196_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *468F4D500196_CUSTOM_CLASS_DEFINITION*¤//#UC END# *468F4D500196_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D500196_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4D500196_CUSTOM_METHODS_AND_DATA*¤	protected long entityId = 0L;¤¤	protected UnreadEntity () {¤	}¤	protected UnreadEntity (long entityId) {¤		this.entityId = entityId;¤	}¤¤	public long getEntityId () {¤		return this.entityId;¤	}¤	protected void setEntityId (long entityId) {¤		this.entityId = entityId;¤	}¤	¤	////////////////////////////////////////////////////////////////////////¤	static public Set<String> getUsersWithReadPermission (com.atlassian.confluence.pages.AbstractPage page) {¤    	return UserHelper.getViewPermittedUsersAsSetOfString(page.getSpaceKey());¤	}¤	//#UC END# *468F4D500196_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/UnreadEntity|468F4D500196
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19026218215"))
	    quid       	"468F4D500196"
	    documentation 	"Базовый класс для обсуждений или непрочитанных документов."
	    stereotype 	"SimpleClass"
	    language   	"MDA Generator")
	(object Class "UnreadDocument"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadDocument.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D6B002E_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4D6B002E_CUSTOM_IMPORT*¤import java.util.*;¤¤import net.sf.hibernate.HibernateException;¤import net.sf.hibernate.Session;¤¤import org.springframework.orm.hibernate.SessionFactoryUtils;¤¤import com.atlassian.confluence.pages.AbstractPage;¤//#UC END# *468F4D6B002E_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D6B002E_CUSTOM_CLASS_DEFINITION*"
		    value      	(value Text 
|//#UC START# *468F4D6B002E_CUSTOM_CLASS_DEFINITION*¤¤//databaseSubsystemContext.xml: <prop key="hibernate.hbm2ddl.auto">update</prop>¤//applicationContext.xml:hibernate.show_sql¤¤//#UC END# *468F4D6B002E_CUSTOM_CLASS_DEFINITION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D6B002E_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4D6B002E_CUSTOM_METHODS_AND_DATA*¤	private Set<Unreading> users_ = new HashSet<Unreading> ();¤	private Set<String> usersThatUnreadAssigned_ = new HashSet<String> ();¤	private Set<String> usersThatUnreadOwn_ = new HashSet<String> ();¤	private Date lastModificationDate = new Date();¤¤	public UnreadDocument () {¤		super ();¤	}¤	public UnreadDocument (long entityId) {¤		super (entityId);¤	}¤¤	public Set<String> getUsersThatUnreadOwn() {¤		return usersThatUnreadOwn_;¤	}¤	public void setUsersThatUnreadOwn (Set<String> usersSet) {¤		usersThatUnreadOwn_ = usersSet;¤	}¤	public Set<String> getUsersThatUnreadAssigned () {¤		return usersThatUnreadAssigned_;¤	}¤	public void setUsersThatUnreadAssigned (Set<String> usersSet) {¤		usersThatUnreadAssigned_ = usersSet;¤	}	¤	public Set<Unreading> getUsers () {¤		return users_;¤	}¤	public void setUsers (Set<Unreading> usersSet) {¤		users_ = usersSet;¤	}¤	public Date getLastModificationDate () {¤		return this.lastModificationDate;¤	}¤	public void setLastModificationDate (Date lastModificationDate) {¤		this.lastModificationDate = lastModificationDate;¤	}¤	¤	public boolean isUserUnreadAssigned (String user) {¤		return usersThatUnreadAssigned_.contains(user);¤	}¤¤	public boolean isUserUnreadOwn (String user) {¤		return usersThatUnreadOwn_.contains(user);¤	}¤	///////////////////////////////////////////////////////////¤	final public void addSingleUser (String user) {¤		Unreading u = new Unreading();¤		u.setUser(user);¤¤		if (users_.contains(u) == false) {¤			u.setId(0);¤			AbstractPage page = ContainerManager.Factory.get().getPageManager().getAbstractPage(getEntityId());¤			if (page == null) {¤				u.setVersionId(1);¤			} else {¤				u.setVersionId(page.getVersion());¤			}¤			¤			users_.add(u);¤		}¤	}¤	¤	final public void addUserThatUnreadAssigned (String user) {¤		usersThatUnreadAssigned_.add(user);¤	}¤¤	final public void addUserThatUnreadOwn (String user) {¤		usersThatUnreadOwn_.add(user);¤	}¤¤	final public void addUsersThatUnreadAssigned (Iterable<String> users) {¤		for (String user : users) {¤			addUserThatUnreadAssigned(user);¤		}¤	}¤¤	final public void addUsersThatUnreadOwn (Iterable<String> users) {¤		for (String user : users) {¤			addUserThatUnreadOwn(user);¤		}¤	}¤	¤	final public void removeUser (String user) {¤		Unreading u = new Unreading();¤		u.setUser(user);		¤		users_.remove(u);¤	}¤	¤	final public void removeFromUnreadAssigned (Iterable<String> users) {¤		for (String user : users) {¤			removeFromUnreadAssigned(user);¤		}¤	}¤		¤	final public void removeFromUnreadAssigned (String user) {¤		if(usersThatUnreadAssigned_.contains(user)){¤			Logs.LOG_W("Remove unread from assigned request with id=" + getEntityId() + " for user: " + user);¤			usersThatUnreadAssigned_.remove(user);¤		}	¤	}¤	¤	final public void removeFromUnreadOwn (Iterable<String> users) {¤		for (String user : users) {¤			removeFromUnreadOwn(user);¤		}¤	}¤	¤	final public void removeFromUnreadOwn (String user) {¤		if(usersThatUnreadOwn_.contains(user)){¤			Logs.LOG_W("Remove unread from own request with id=" + getEntityId() + " for user: " + user);¤			usersThatUnreadOwn_.remove(user);¤		}¤	}¤	¤	final public boolean hasUser (String user) {¤		return getUnreading(user) != null;¤	}¤	¤	final public boolean removeAllUnread () {¤		if (users_.isEmpty()) {¤			return false;¤		}		¤		users_.clear();¤		Logs.LOG_W("Remove unread from assigned and own requests with all ids for all users");¤		return true;¤	}¤	final public boolean removeAllUsers () {¤		if (users_.isEmpty()) {¤			return false;¤		}		¤		users_.clear();¤		return true;¤	}¤	final public boolean removeAllUsersThatUnreadAssigned () {¤		if (usersThatUnreadAssigned_.isEmpty()) {¤			return false;¤		}		¤		usersThatUnreadAssigned_.clear();¤		Logs.LOG_W("Remove unread from assigned requests with all ids for all users");¤		return true;¤	}¤	final public boolean removeAllUsersThatUnreadOwn () {¤		if (usersThatUnreadOwn_.isEmpty()) {¤			return false;¤		}		¤		usersThatUnreadOwn_.clear();¤		Logs.LOG_W("Remove unread from own requests with all ids for all users");¤		return true;¤	}¤	¤	final public Set<String> users () {¤		Set<String> ret = new HashSet<String> ();¤		for (Unreading u : getUsers()) {¤			ret.add(u.getUser());¤		}¤		return ret;¤	}¤	final public void updateUsers (Iterable<String> usersSet) {¤		long time1 = new Date().getTime();¤¤		for (String user : usersSet) {¤			addSingleUser(user);¤		}¤		Logs.LOG_W("UnreadDocument::updateUsers::time1=" + (new Date().getTime() - time1));¤	}¤	¤	public static int getFirstUnreadedVersion (UnreadDocument ud, String user) {¤		Unreading u = ud.getUnreading(user);¤		return (u == null) ? 0: u.getVersionId();¤	}¤	¤	public Unreading getUnreading (String user) {¤		Session session = SessionFactoryUtils.getSession(ContainerManager.Factory.get().getSessionFactory(),false);¤		try {¤			List ret = session.createFilter(getUsers(), "where this.user = '"+user+"'").list();¤			return (ret.size() == 0) ? null: (Unreading)ret.get(0);¤		} catch (HibernateException e) {¤			Logs.LOG_SEX(e);¤			throw new IllegalStateException (e);¤		}¤	}¤	¤	//#UC END# *468F4D6B002E_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/UnreadDocument|468F4D6B002E
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038478069"))
	    quid       	"468F4D6B002E"
	    documentation 	"Класс непрочитанных ждокументов Hibernate"
	    stereotype 	"SimpleClass"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"468F4DA501B5"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadEntity"
		    quidu      	"468F4D500196"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006341729"))
		    quid       	"49D5EE5D028D"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::Unreading"
		    quidu      	"49D5ED8400CA"))
	    language   	"MDA Generator")
	(object Class "UnreadDiscussion"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadDiscussion.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D7A00DA_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4D7A00DA_CUSTOM_IMPORT*¤import com.atlassian.confluence.pages.Comment;¤import java.util.*;¤import net.sf.hibernate.HibernateException;¤import net.sf.hibernate.Query;¤import net.sf.hibernate.Session;¤¤import org.springframework.orm.hibernate.SessionFactoryUtils;¤¤//#UC END# *468F4D7A00DA_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D7A00DA_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *468F4D7A00DA_CUSTOM_CLASS_DEFINITION*¤//#UC END# *468F4D7A00DA_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D7A00DA_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4D7A00DA_CUSTOM_METHODS_AND_DATA*¤	private Date date_ = null;¤	private long lastCommentId_ = 0L;¤	private String lastCommentAuthor_ = "";¤¤	protected UnreadDiscussion () {¤		super();¤	}¤	public UnreadDiscussion (long entityId) {¤		super(entityId);¤	}¤¤	public Date getDate () {¤		return date_;¤	}¤	protected void setDate (Date date) {¤		date_ = date;¤	}¤¤	public long getLastCommentId () {¤		return lastCommentId_;¤	}¤	protected void setLastCommentId (long lastCommentId) {¤		lastCommentId_ = lastCommentId;¤	}¤¤	public String getLastCommentAuthor () {¤		return lastCommentAuthor_;¤	}¤	protected void setLastCommentAuthor (String lastCommentAuthor) {¤		lastCommentAuthor_ = lastCommentAuthor;¤	}¤¤	///////////////////////////////////////////////////////////¤	final public long getFirstCommentId (¤			String userName, net.sf.hibernate.Session session¤	) {¤		UnreadComments uc = getUnreadComments(userName);¤		return (uc == null)? 0L : uc.getFirstComment();¤	}¤¤	final public void setLastComment (Comment comment) {¤		if (comment == null) {¤			date_ = null;¤			lastCommentId_ = 0L;¤			lastCommentAuthor_ = "";¤		} else {¤			date_ = comment.getLastModificationDate();¤			lastCommentId_ = comment.getId();¤			lastCommentAuthor_ = comment.getLastModifierName();¤		}¤	}¤¤	final public void setCommentForUser (¤			String userName, Comment comment, net.sf.hibernate.Session session¤	) {¤		UnreadComments uc = getUnreadComments(userName);¤		if (uc == null) {¤			try {¤				uc = new UnreadComments();¤				session.save(uc);¤				users_.put(userName, uc);¤			} catch (net.sf.hibernate.HibernateException e) {¤				throw new RuntimeException(e);¤			}¤		}¤		if (comment != null) {¤			uc.addComment(comment.getId());¤		}¤	}¤¤	final public void setCommentForAll (Comment comment, net.sf.hibernate.Session session) {¤		Set<String> setUsers = UnreadEntity.getUsersWithReadPermission(comment.getPage());¤		for (String user : setUsers) {¤			setCommentForUser(user, comment, session);¤		}¤	}¤¤	final public void removeComment (Long commentId, net.sf.hibernate.Session session) {¤		List<String> usersToRemove = new ArrayList<String>();¤		Set<String> keys = users_.keySet();¤		for (String userName : keys) {¤			if (!removeUserComment(userName, commentId, true)) {¤				usersToRemove.add(userName);¤			}¤		}¤		for (String userName : usersToRemove) {¤			removeUser(userName, session);¤		}¤	}¤¤	final public boolean removeUserComment (String userName, Long commentId, boolean checkFirstComment) {¤		UnreadComments uc = getUnreadComments(userName);¤		if (uc != null) {¤			uc.removeComment(commentId, checkFirstComment);¤			return uc.getCount() > 0;¤		}¤		return false;¤	}¤	¤	final public boolean removeUserComments (String userName, Collection<Long> commentIds, boolean checkFirstComment) {¤		UnreadComments uc = getUnreadComments(userName);¤		if (uc != null) {¤			uc.removeComments(commentIds, checkFirstComment);¤			return uc.getCount() > 0;¤		}¤		return false;¤	}¤	¤	final public void resetFirstComment (String userName) {¤		UnreadComments uc = getUnreadComments(userName);¤		if (uc != null) {¤			uc.resetFirstComment();¤		}¤	}¤¤	final public void clearUserComments (String userName, net.sf.hibernate.Session session) {¤		UnreadComments uc = getUnreadComments(userName);¤		if (uc != null) {¤			uc.removeAllComments();¤		}¤	}¤¤	final private void removeUser (String userName, net.sf.hibernate.Session session) {¤		UnreadComments uc = getUnreadComments(userName);¤		if (uc != null) {¤			try {¤				session.delete(uc);¤				users_.remove(userName);¤			} catch (net.sf.hibernate.HibernateException e) {¤				throw new RuntimeException(e);¤			}¤		}¤	}¤¤	final public boolean removeAllUsers (net.sf.hibernate.Session session) {¤		if (users_.isEmpty()) {¤			return false;¤		}¤		for (UnreadComments uc : users_.values()) {¤			if (uc != null) {¤				try {¤					session.delete(uc);¤				} catch (net.sf.hibernate.HibernateException e) {¤					throw new RuntimeException(e);¤				}¤			}¤		}¤		users_.clear();¤		return true;¤	}¤¤	final public boolean isBranchCollapsed (String userName, Comment comment) {¤		UnreadComments uc = getUnreadComments(userName);¤		return (uc == null) ? false : uc.isCollapsed(comment.getId());¤	}¤	¤	final public void collapseBranch (¤			String userName, Comment comment, net.sf.hibernate.Session session¤	) {¤		UnreadComments uc = getUnreadComments(userName);¤		if (uc == null) {¤			try {¤				uc = new UnreadComments();¤				session.save(uc);¤				users_.put(userName, uc);¤			} catch (net.sf.hibernate.HibernateException e) {¤				throw new RuntimeException(e);¤			}¤		}¤		if (comment != null) {¤			uc.collapseBranch(comment.getId());¤		}¤	}¤	¤	final public void expandBranch (String userName, Comment comment) {¤		UnreadComments uc = getUnreadComments(userName);¤		if (uc != null) {¤			uc.expandBranch(comment.getId());¤		}¤	}¤¤	final public boolean hasUserComment (String userName, Comment comment) {¤		UnreadComments uc = getUnreadComments(userName);¤		return (uc == null) ? false : uc.hasComment(comment.getId());¤	}¤	¤	final public int getUserCommentCount (String userName) {¤		UnreadComments uc = getUnreadComments(userName);¤		return (uc == null)? 0 : uc.getCount();¤	}¤	¤	final public List<Long> getUserComments (String userName) {¤		UnreadComments uc = getUnreadComments(userName);¤		if (uc == null) {¤			return null;¤		}¤		Set<Long> set = uc.getComments();¤		return set.isEmpty() ? null : new ArrayList<Long>(set);¤	}¤	¤	final public UnreadComments getUnreadComments (String userName) {¤		UnreadComments uc = users_.get(userName);¤		Session session = SessionFactoryUtils.getSession(ContainerManager.Factory.get().getSessionFactory(),false);¤		try {¤			//List ret = session.createFilter(getUsers(), "where this['" + userName + "'].id > 0").list();¤			Query q = session.createQuery(¤				"select uc from UnreadComments uc, UnreadDiscussion ud " +¤				" where ud.users['" + userName + "'] = uc and ud.entityId = " + getEntityId()¤			); ¤			List ret = q.list(); ¤			return (ret.size() == 0) ? null: (UnreadComments)ret.get(0);¤		} catch (HibernateException e) {¤			Logs.LOG_SEX(e);¤			throw new IllegalStateException (e);¤		}		¤	}	¤	//#UC END# *468F4D7A00DA_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/UnreadDiscussion|468F4D7A00DA
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F53A001C5_INIT_users*"
		    value      	(value Text 
|//#UC START# *468F53A001C5_INIT_users*¤		return Collections.synchronizedMap(¤				new java.util.HashMap<String, ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.UnreadComments> ()¤		);¤		//#UC END# *468F53A001C5_INIT_users*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F53A001C5_GET_ACCESSOR*"
		    value      	(value Text 
|//#UC START# *468F53A001C5_GET_ACCESSOR*¤		return users_;¤		//#UC END# *468F53A001C5_GET_ACCESSOR*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F53A001C5_SET_ACCESSOR*"
		    value      	(value Text 
|//#UC START# *468F53A001C5_SET_ACCESSOR*¤		users_ = users;¤		//#UC END# *468F53A001C5_SET_ACCESSOR*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19026223571"))
	    quid       	"468F4D7A00DA"
	    documentation 	"Класс непрочитанных обсуждений Hibernate."
	    stereotype 	"SimpleClass"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"468F4DA80157"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadEntity"
		    quidu      	"468F4D500196"))
	    language   	"MDA Generator"
	    nestedClasses 	(list nestedClasses
		(object Class "UnreadCommentsMap"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19026221087"))
		    quid       	"468F533F002E"
		    documentation 	"Мапа <имя пользователя, список непрочитанных коментариев> для хранения непрочитанных комментариев для каждого пользователя."
		    stereotype 	"Map")))
	(object Class "UnreadComments"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/UnreadComments.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D8C0109_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4D8C0109_CUSTOM_IMPORT*¤import com.atlassian.confluence.pages.Comment;¤import com.opensymphony.util.TextUtils;¤import java.util.*;¤//#UC END# *468F4D8C0109_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D8C0109_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *468F4D8C0109_CUSTOM_CLASS_DEFINITION*¤//#UC END# *468F4D8C0109_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4D8C0109_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4D8C0109_CUSTOM_METHODS_AND_DATA*¤	private long id_ = 0L;¤	private int count_ = 0;¤	private long firstComment_ = 0L;¤	private String firstCommentAuthor_ = "";¤	private Date date_ = new Date();¤	private Set<Long> comments_ = new HashSet<Long>();¤	private Set<Long> collapsedBranches_ = new HashSet<Long>();¤¤	protected UnreadComments () {¤	}¤	///////////////////////////////////////////////////////////¤	protected long getId () {¤		return id_;¤	}¤	¤	protected void setId (long id) {¤		id_ = id;¤	}¤¤	protected Set<Long> getComments () {¤		return comments_;¤	}¤	¤	protected void setComments (Set<Long> comments) {¤		comments_ = comments;¤	}¤¤	protected Set<Long> getCollapsedBranches () {¤		return collapsedBranches_;¤	}¤	protected void setCollapsedBranches (Set<Long> collapsedBranches) {¤		collapsedBranches_ = collapsedBranches;¤	}¤¤	protected int getCount () {¤		return count_;¤	}¤	¤	protected void setCount (int count) {¤		count_ = count;¤	}¤¤	protected long getFirstComment () {¤		if (needForFirstComment()) {¤			findFirstComment();¤		}¤		return firstComment_;¤	}¤	¤	protected void setFirstComment (long firstComment) {¤		firstComment_ = firstComment;¤	}¤¤	protected String getFirstCommentAuthor () {¤		return firstCommentAuthor_;¤	}¤	¤	protected void setFirstCommentAuthor (String firstCommentAuthor) {¤		firstCommentAuthor_ = firstCommentAuthor;¤	}¤¤	protected Date getDate () {¤		return date_;¤	}¤	¤	protected void setDate (Date date) {¤		date_ = date;¤	}¤	///////////////////////////////////////////////////////////¤	final public boolean isCollapsed (long commentId) {¤		return collapsedBranches_.contains(commentId);¤	}¤	¤	final public void collapseBranch (long commentId) {¤		collapsedBranches_.add(commentId);¤	}¤	¤	final public void expandBranch (long commentId) {¤		collapsedBranches_.remove(commentId);¤	}¤¤	final public void addComment (long commentId) {¤		comments_.add(commentId);¤		setFirstCommentInt(DiscussionManager.findFirstComment(comments_));¤		count_ = comments_.size();¤	}¤	¤	final public void removeComment (Long commentId, boolean checkFirstComment) {¤		if ((comments_.remove(commentId))¤			&& (firstComment_ == commentId)¤			&& (checkFirstComment == true)¤		){¤			setFirstCommentInt(DiscussionManager.findFirstComment(comments_));¤		}¤		count_ = comments_.size();¤	}¤	¤	final public void removeComments (Collection<Long> commentIds, boolean checkFirstComment) {¤		if ((comments_.removeAll(commentIds))¤			&& (checkFirstComment == true)¤			&& (commentIds.contains(firstComment_))¤		){¤			setFirstCommentInt(DiscussionManager.findFirstComment(comments_));¤		}¤		count_ = comments_.size();¤	}¤	¤	final public void removeAllComments () {¤		comments_.clear();¤		count_ = 0;¤		firstComment_ = 0L;¤	}¤	¤	final public boolean hasComment (long commentId) {¤		count_ = comments_.size();¤		return comments_.contains(commentId);¤	}¤¤	final private boolean needForFirstComment () {¤		return ¤			(getCount() > 0) && (¤				(firstComment_ == 0L) ||¤				(!TextUtils.stringSet(firstCommentAuthor_)) ||¤				(date_ == null)¤			);¤	}¤¤	final private void findFirstComment () {¤		setFirstCommentInt(DiscussionManager.findFirstComment(comments_));¤		count_ = comments_.size();¤	}¤	¤	final public void resetFirstComment () {¤		firstComment_ = 0L;¤		firstCommentAuthor_ = "";¤		date_ = null;¤	}¤¤	final private void setFirstCommentInt (Comment firstComment) {¤		if (firstComment == null) {¤			resetFirstComment();¤		} else {¤			firstComment_ = firstComment.getId();¤			firstCommentAuthor_ = firstComment.getLastModifierName();¤			date_ = firstComment.getLastModificationDate();¤		}¤	}¤	//#UC END# *468F4D8C0109_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/UnreadComments|468F4D8C0109
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19026219294"))
	    quid       	"468F4D8C0109"
	    documentation 	"Класс непрочитанных комментариев HIbernate."
	    stereotype 	"SimpleClass"
	    language   	"MDA Generator")
	(object Class "GarantHibernate"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/GarantHibernate.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4E6C003E_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4E6C003E_CUSTOM_IMPORT*¤import net.sf.hibernate.LockMode;¤¤import org.springframework.orm.hibernate.SessionFactoryUtils;¤//#UC END# *468F4E6C003E_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4E6C003E_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *468F4E6C003E_CUSTOM_CLASS_DEFINITION*¤//#UC END# *468F4E6C003E_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4E6C003E_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4E6C003E_CUSTOM_METHODS_AND_DATA*¤	private net.sf.hibernate.Session session = null;¤¤	public GarantHibernate (net.sf.hibernate.SessionFactory sf) {¤		session = SessionFactoryUtils.getSession(sf, true);¤	}¤	¤	final public <T> T get (Class<T> cl, long id) {¤		try {¤			return (T)session.get(cl, id);¤		} catch (net.sf.hibernate.HibernateException e) {¤			throw new RuntimeException(e);¤		}¤	}¤	¤	final public <T> T get (Class<T> cl, long id, LockMode lockMode) {¤		try {¤			return (T)session.get(cl, id, lockMode);¤		} catch (net.sf.hibernate.HibernateException e) {¤			throw new RuntimeException(e);¤		}¤	}¤¤	final public net.sf.hibernate.Session getSession () {¤		return session;¤	}¤	¤	final public <T> void save (T ud) {¤		if (ud != null) {¤			try {¤				session.save (ud);¤			} catch (net.sf.hibernate.HibernateException e) {¤				throw new RuntimeException(e);¤			}¤		}¤	}¤	¤	final public <T> void remove (T ud) {¤		if (ud != null) {¤			try {¤				session.delete(ud);¤			} catch (net.sf.hibernate.HibernateException e) {¤				throw new RuntimeException(e);¤			}¤		}¤	}¤	¤	final public void flush () {¤		try {¤			session.flush();¤		} catch (net.sf.hibernate.HibernateException e) {¤			throw new RuntimeException(e);¤		}¤	}¤	//#UC END# *468F4E6C003E_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/GarantHibernate|468F4E6C003E
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19026222391"))
	    quid       	"468F4E6C003E"
	    documentation 	"Вспомогательный класс для загрузки обектов Hibernate."
	    stereotype 	"SimpleClass"
	    language   	"MDA Generator")
	(object Class "DiscussionManager"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DiscussionManager.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4EC30177_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4EC30177_CUSTOM_IMPORT*¤import ru.garant.MDProcess.ConfluencePlugins.ArchiveCommentSupport.ArchiveCommentAction;¤import ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DashboardFilter.DashboardListType;¤import ru.garant.shared.ConfluenceCore.Helpers.ContainerManager;¤import ru.garant.shared.ConfluenceCore.LabelSupport.GarLabelManager;¤¤import com.atlassian.confluence.labels.Label;¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.Comment;¤import com.atlassian.confluence.pages.CommentManager;¤import com.atlassian.confluence.spaces.Space;¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤import com.atlassian.user.User;¤import com.atlassian.core.bean.EntityObject;¤import com.atlassian.confluence.util.longrunning.ConfluenceAbstractLongRunningTask;¤¤import javax.servlet.http.HttpServletRequest;¤¤import net.sf.hibernate.HibernateException;¤import net.sf.hibernate.LockMode;¤import net.sf.hibernate.Session;¤¤import org.apache.commons.lang.StringUtils;¤import org.springframework.orm.hibernate.SessionFactoryUtils;¤import org.springframework.transaction.interceptor.*;¤import org.springframework.transaction.PlatformTransactionManager;¤import org.springframework.transaction.TransactionStatus;¤¤import java.util.*;¤//#UC END# *468F4EC30177_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4EC30177_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *468F4EC30177_CUSTOM_CLASS_DEFINITION*¤//#UC END# *468F4EC30177_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4EC30177_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4EC30177_CUSTOM_METHODS_AND_DATA*¤	static private Set<String> userRequests = Collections.synchronizedSet(new HashSet<String>());¤¤	static public final String DEAD_DISCUSSION_LABEL = "dead";¤	static public final String CLOSE_DISCUSSION_LABEL = "close";¤	static public final String OPEN_DISCUSSION_LABEL = "open";¤	static public final String COMMENT_DISCUSSION_LABEL = "commentopen";¤	static public final String COMMENT_SUMMARY_LABEL = "summarycomment";¤¤	public DiscussionManager () {¤	}¤¤	final public void onCommentCreate (Comment comment) {¤		onCommentUpdate(comment);¤	}¤	¤	final public void onCommentUpdate (Comment comment) {¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDiscussion ud = uds.get(UnreadDiscussion.class, comment.getPage().getId());¤		if (ud == null) {¤			ud = new UnreadDiscussion(comment.getPage().getId());¤			uds.save(ud);¤		}¤		ud.setDate(comment.getLastModificationDate());¤		ud.setLastCommentId(comment.getId());¤		ud.setLastCommentAuthor(comment.getLastModifierName());¤		ud.setCommentForAll(comment, uds.getSession());¤		String userName = AuthenticatedUserThreadLocal.getUsername();¤		if (userName != null) {¤			List<Long> ancestry = getAncestry(uds.getSession(), comment.getId());¤			ud.removeUserComments(userName, ancestry, false);¤			ud.resetFirstComment(userName);¤		}¤	}¤	¤	final public void onCommentRemove (Comment comment) {¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDiscussion ud = uds.get(UnreadDiscussion.class, comment.getPage().getId());¤		if (ud != null) {¤			ud.removeComment(comment.getId(), uds.getSession());¤			ud.setLastComment(DiscussionManager.findLastComment(comment.getPage()));¤		}¤	}¤	¤	final public boolean isBranchCollapsed (Comment comment) {¤		String userName = AuthenticatedUserThreadLocal.getUsername();¤		if (userName != null) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, comment.getPage().getId());¤			return (ud == null) ? true : ud.isBranchCollapsed(userName, comment);¤		}¤		return false;¤	}¤	¤	final public void setBranchCollapsedState (Comment comment) {¤		String userName = AuthenticatedUserThreadLocal.getUsername();¤		if (userName != null) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, comment.getPage().getId());¤			if (ud == null) {¤				ud = new UnreadDiscussion(comment.getPage().getId());¤				uds.save(ud);¤			}¤			ud.collapseBranch(userName, comment, uds.getSession());¤		}¤	}¤	¤	final public void setBranchExpandedState (Comment comment) {¤		String userName = AuthenticatedUserThreadLocal.getUsername();¤		if (userName != null) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, comment.getPage().getId());¤			if (ud == null) {¤				ud = new UnreadDiscussion(comment.getPage().getId());¤				uds.save(ud);¤			}¤			ud.expandBranch(userName, comment);¤		}¤	}¤¤	final public boolean isCommentRead (Comment comment) {¤		String userName = AuthenticatedUserThreadLocal.getUsername();¤		if (userName != null) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, comment.getPage().getId());¤			return (ud == null)? true : !ud.hasUserComment(userName, comment);¤		}¤		return true;¤	}¤¤	final private int getUnreadChildrenCount (String userName, UnreadDiscussion ud, List<?> children) {¤		int count = 0;¤		for (Iterator<?> it = children.iterator(); it.hasNext();) {¤			Comment cmt = (Comment)it.next();¤			if (ud.hasUserComment(userName, cmt)) {¤				++count;¤			}¤			count += getUnreadChildrenCount(userName, ud, cmt.getChildren());¤		}¤		return count;¤	}¤¤	final public int getUnreadCommentCount (Comment parentComment) {¤		String userName = AuthenticatedUserThreadLocal.getUsername();¤		if ((userName == null) || (parentComment == null)) {¤			return 0;¤		}¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDiscussion ud = uds.get(UnreadDiscussion.class, parentComment.getPage().getId());¤		int count = (ud==null)? 0 : getUnreadChildrenCount(userName, ud, parentComment.getChildren());¤		return count;¤	}¤¤	final public int getUnreadCommentCount (long pageId) {¤		User user = AuthenticatedUserThreadLocal.getUser();¤		if ((user == null) && (pageId == 0L)) {¤			return 0;¤		}¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDiscussion ud = uds.get(UnreadDiscussion.class, pageId);¤		return (ud == null)? 0 : ud.getUserCommentCount(user.getName());¤	}¤¤	final private void setDescendantsReadState (String userName, UnreadDiscussion ud, List<?> commentList) {¤		for (Iterator<?> it = commentList.iterator(); it.hasNext();) {¤			Comment c = (Comment)it.next();¤			ud.removeUserComment(userName, c.getId(), false);¤			setDescendantsReadState(userName, ud, c.getChildren());¤		}¤		ud.resetFirstComment(userName);¤	}¤¤	final public List<Long> setCommentReadState (Comment comment, boolean withDescendants) {¤		String userName = AuthenticatedUserThreadLocal.getUsername();¤		if ((userName != null) && (comment != null)) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, comment.getPage().getId(), LockMode.UPGRADE);¤			if (ud != null) {¤				if (withDescendants) {¤					setDescendantsReadState(userName, ud, comment.getChildren());¤				}¤				List<Long> ancestry = getAncestry(uds.getSession(), comment.getId());¤				ud.removeUserComments(userName, ancestry, false);¤				ud.resetFirstComment(userName);¤				return ancestry;¤			}¤		}¤		return new ArrayList<Long>(0);¤	}¤	¤	final private List<Long> getAncestry (net.sf.hibernate.Session session, Long id) {¤		try {¤			List<Long> res = new ArrayList<Long>();¤			while (id != null && id != 0L) {¤				res.add(id);¤				// get parent id¤				id = (Long)session.getNamedQuery("mdk.discussions.commentParent")¤					.setCacheable(true)¤					.setLong(0, id)¤					.uniqueResult();¤			}¤			return res;¤		} catch (HibernateException e) {¤			Logs.LOG_E("DiscussionManager:::getAncestry: HibernateException: " + e);¤			throw new RuntimeException(e);¤		}¤	}¤¤	final public List<Long> setCommentUnreadState (Comment comment) {¤		User user = AuthenticatedUserThreadLocal.getUser();¤		if ((user != null) && (comment != null)) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, comment.getPage().getId(), LockMode.UPGRADE);¤			if (ud == null) {¤				ud = new UnreadDiscussion(comment.getPage().getId());¤				uds.save(ud);¤			}¤			ud.setCommentForUser(user.getName(), comment, uds.getSession());	¤			return Arrays.asList(comment.getId());¤		}¤		return new ArrayList<Long>(0);¤	}¤¤	final public long getDiscussionCommentId (long pageId) {¤		if (pageId != 0L) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, pageId);¤			if (ud != null) {¤				long res = 0L;¤				String userName = AuthenticatedUserThreadLocal.getUsername();¤				if (userName != null) {¤					res = ud.getFirstCommentId(userName, uds.getSession());¤				}¤				if (res == 0L) {¤					res = ud.getLastCommentId();¤				}¤				return res;¤			}¤		}¤		return 0L;¤	}¤¤	final public int getArchiveUnviewed (long pageId) {¤		String userName = AuthenticatedUserThreadLocal.getUsername();¤		if ((userName != null) && (pageId != 0L)) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, pageId);¤			if (ud != null) {¤				List<Long> unviewedComments = ud.getUserComments(userName);¤				if (unviewedComments != null) {¤					DashboardQuery dq = new DashboardQuery();¤					return dq.getCountUnviewedArchive(¤							userName¤							, pageId¤							, ContainerManager.Factory.get().getLabelManager().¤								getLabel(ArchiveCommentAction.ARCHIVE_COMMNET_LABEL).getId()¤							, unviewedComments¤					);¤				}¤			}¤		}¤		return 0;¤	}¤¤	final public void setDiscussionUnreadState (long pageId) {¤		User user = AuthenticatedUserThreadLocal.getUser();¤		if (user != null && pageId != 0L) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, pageId);¤			if (ud == null) {¤				ud = new UnreadDiscussion(pageId);¤				uds.save(ud);¤			}¤			Comment comment = findLastComment(¤					ContainerManager.Factory.get().getPageManager().getAbstractPage(pageId)¤			);¤			ud.setCommentForUser(user.getName(), comment, uds.getSession());¤		}¤	}¤¤	final public void setDiscussionUnreadState4All (long pageId) throws Exception {¤		if (pageId != 0L) {¤			Comment comment = findLastComment(¤					ContainerManager.Factory.get().getPageManager().getAbstractPage(pageId)¤			);¤			{¤				GarantHibernate uds = new GarantHibernate(this.sf);¤				UnreadDiscussion ud = uds.get(UnreadDiscussion.class, pageId);¤				if (ud == null) {¤					ud = new UnreadDiscussion(pageId);¤					uds.save(ud);¤				}¤				ud.setCommentForAll(comment, uds.getSession());¤			}¤		}¤	}¤	¤	final public void setDiscussionReadState (long pageId) {¤		User user = AuthenticatedUserThreadLocal.getUser();¤		if ((user != null) && (pageId != 0L)) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, pageId);¤			if (ud != null) {¤				ud.clearUserComments(user.getName(), uds.getSession());¤			}¤		}¤	}¤¤	final public boolean isDiscussionRead (long pageId) {¤		User user = AuthenticatedUserThreadLocal.getUser();¤		if (user == null) {¤			return true;¤		}¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		boolean res = true;¤		UnreadDiscussion ud = uds.get(UnreadDiscussion.class, pageId);¤		if (ud != null) {¤			res = !(ud.getUserCommentCount(user.getName()) > 0);¤		}¤		return res;¤	}¤	¤	final public boolean isDiscussionOpen (long pageId) {¤		AbstractPage page = ContainerManager.Factory.get().getPageManager().getAbstractPage(pageId);¤		if (page == null) {¤			return false;¤		}¤¤		final GarLabelManager lm = ContainerManager.Factory.get().getLabelManager();¤		if (lm.getLabel(page, DiscussionManager.OPEN_DISCUSSION_LABEL) != null) {¤			for (Comment currentComment : (List<Comment>) page.getComments()) {¤				Label label = lm.getLabel(currentComment, DiscussionManager.COMMENT_DISCUSSION_LABEL);¤				if (label != null) {¤					return true;¤				}¤			}¤		}¤		return false;¤	}¤¤	final public void onDocumentUpdate (AbstractPage page, boolean isMinorChanges) {¤		if (isMinorChanges) {¤			return;¤		}¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDocument ud = uds.get(UnreadDocument.class, page.getId());¤		if (ud == null) {¤			ud = new UnreadDocument(page.getId());¤			uds.save(ud);¤		}¤		ud.setLastModificationDate(page.getLastModificationDate());¤		long time2 = new Date().getTime();¤		Set<String> users = UnreadEntity.getUsersWithReadPermission(page); ¤		Logs.LOG_W("DiscussionManager::onDocumentUpdate::UnreadEntity.getUsersWithReadPermission::time=" + (new Date().getTime() - time2));¤		long time3 = new Date().getTime();¤		ud.updateUsers(users);¤		Logs.LOG_W("DiscussionManager::onDocumentUpdate::ud.updateUsers::time=" + (new Date().getTime() - time3));¤		User user = AuthenticatedUserThreadLocal.getUser();¤		if (user != null) {¤			ud.removeUser(user.getName());¤		}¤	}¤	¤	final public void updateDocumentModificationDate (long pageId, Date lastModificationDate) {¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDocument ud = uds.get(UnreadDocument.class, pageId);¤		if (ud != null) {¤			ud.setLastModificationDate(lastModificationDate);¤		}¤	}¤¤	final public void onDocumentSimpleViewAll (AbstractPage page) {¤		removeUnreadSimpleDocument(page.getId ());¤		removeUnreadDiscussion(page.getId ());¤	}¤	¤	final public void onDocumentRemove (AbstractPage page) {¤		removeAllUnreadsFromDocument(page.getId ());¤		removeUnreadDiscussion(page.getId ());		¤	}¤¤	final public boolean removeAllUnreadsFromDocument (long pageId) {¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDocument ud = uds.get(UnreadDocument.class, pageId);¤		return (ud != null) && ud.removeAllUnread() && ud.removeAllUsersThatUnreadAssigned() && ud.removeAllUsersThatUnreadOwn();¤	}¤	¤	final public boolean removeUnreadDocument (long pageId) {¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDocument ud = uds.get(UnreadDocument.class, pageId);¤		return (ud != null) && ud.removeAllUnread();¤	}¤	¤	final public boolean removeUnreadSimpleDocument (long pageId) {¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDocument ud = uds.get(UnreadDocument.class, pageId);¤		return (ud != null) && ud.removeAllUsers();¤	}	¤¤	final public boolean sweepUnreadDiscussion (long pageId) {¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDiscussion ud = uds.get(UnreadDiscussion.class, pageId);¤		return (ud != null) && ud.removeAllUsers(uds.getSession());¤	}¤¤	final public void sweepUnreadEntities (int daysAgo) {¤		DashboardQuery dq = new DashboardQuery();¤		¤		Session session = SessionFactoryUtils.getSession (ContainerManager.Factory.get().getSessionFactory(), false);¤		sweepUnreadDocuments(dq, daysAgo, session);¤		sweepUnreadDiscussions(dq, daysAgo, session);¤	}¤¤	final private void sweepUnreadDocuments (DashboardQuery dq, int daysAgo, Session session) {¤		try {¤			long startTime = System.currentTimeMillis();¤			long[] ids = dq.getOldUnreadDocuments(daysAgo);¤			int deletedCount = 0;¤			for (int i = 0; i < ids.length; ++i) {¤				if (removeUnreadDocument(ids[i])) {¤					++deletedCount;¤					if (deletedCount % 100 == 0) {¤						// flush and release memory¤						session.flush();¤						session.clear();¤						Logs.LOG_I("DiscussionManager::sweepUnreadDocuments: i = " + deletedCount);¤					}¤				}¤			}¤			long finishTime = System.currentTimeMillis();¤			Logs.LOG_I(new Date() + ": DiscussionManager::sweepUnreadDocuments: "+ deletedCount + " ("¤					+ ids.length + ") docs have been swept for " + ((finishTime - startTime)/1000) + " sec.");¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤	}¤¤	final private void sweepUnreadDiscussions (DashboardQuery dq, int daysAgo, Session session) {¤		try {¤			long startTime = System.currentTimeMillis();¤			long[] ids = dq.getOldUnreadDiscussions(daysAgo);¤			int deletedCount = 0;¤			for (int i = 0; i < ids.length; ++i) {¤				if (sweepUnreadDiscussion(ids[i])) {¤					++deletedCount;¤					if (deletedCount % 100 == 0) {¤						// flush and release memory¤						session.flush();¤						session.clear();¤						Logs.LOG_I("DiscussionManager::sweepUnreadDiscussions: i = " + deletedCount);¤					}¤				}¤			}¤			long finishTime = System.currentTimeMillis();¤			Logs.LOG_I(new Date() + ": DiscussionManager::sweepUnreadDiscussions: "+ deletedCount + " ("¤					+ ids.length + ") docs have been swept for " + ((finishTime - startTime)/1000) + " sec.");¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤	}¤¤	final public void removeUnreadDiscussion (long pageId) {¤		GarantHibernate uds = new GarantHibernate(this.sf);¤		UnreadDiscussion ud = uds.get(UnreadDiscussion.class, pageId);¤		if (ud != null) {¤			uds.remove(ud);¤		}¤	}¤¤	final public void onDocumentView (AbstractPage page) {¤		setDocumentReadState(page.getId());¤	}¤	¤	final public boolean isDocumentRead (long pageId) {¤		return isDocumentRead (AuthenticatedUserThreadLocal.getUser(), pageId);¤	}¤	¤	final public boolean isDocumentRead (User user, long pageId) {¤		if ((user != null) && (pageId != 0L)) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			boolean res = true;¤			UnreadDocument ud = uds.get(UnreadDocument.class, pageId);¤			if (ud != null) {¤				res = !ud.hasUser(user.getName());¤			}¤			return res;¤		}¤		return true;¤	}¤	¤¤	final public void setDocumentReadState (long pageId) {¤		User user = AuthenticatedUserThreadLocal.getUser();¤		if ((user != null) && (pageId != 0L)) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDocument ud = uds.get(UnreadDocument.class, pageId);¤			if (ud != null) {¤				ud.removeUser(user.getName());¤			}			¤		}¤	}¤¤	final public void setDocumentUnreadState (long pageId) {¤		User user = AuthenticatedUserThreadLocal.getUser();¤		if ((user != null) && (pageId != 0L)) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			UnreadDocument ud = uds.get(UnreadDocument.class, pageId);¤			if (ud == null) {¤				ud = new UnreadDocument(pageId);¤				uds.save(ud);¤			}¤			ud.addSingleUser(user.getName());¤		}¤	}¤¤	final public Set<String> getDocumentUsers (long pageId) {¤		if (pageId != 0L) {¤			GarantHibernate uds = new GarantHibernate(this.sf);¤			Set<String> res = null;¤			UnreadDocument ud = uds.get(UnreadDocument.class, pageId);¤			if (ud != null) {¤				res = ud.users();¤			}¤			return res;¤		}¤		return null;¤	}¤	¤	private boolean lockUserForLongOperation (String userName) {¤		if (userRequests.contains(userName)) {¤			Logs.LOG_I(¤					new Date() + " DiscussionManager::setReadStateForAll: the request of '"¤					+ userName + "' is already in progress"¤			);¤			return false;¤		}¤		userRequests.add(userName);¤		return true;		¤	}¤	¤	private class SetReadStateTask extends ConfluenceAbstractLongRunningTask {¤		final private PlatformTransactionManager transactionManager = (PlatformTransactionManager)¤			com.atlassian.spring.container.ContainerManager.getComponent("transactionManager");¤		¤		final Object lock;¤		final private String userName;¤		final String dashboardKeys;¤		final int maxCount;¤		final DashboardQuery dq;¤		¤		final int COUNT_ON_TRANSACTION = 100;¤¤		public SetReadStateTask (¤				final Object lock_¤				, final String userName_¤				, final String dashboardKeys_¤				, final int maxCount_¤				, final boolean onlyUnread_¤		) {¤			lock = lock_;¤			userName = userName_;¤			dashboardKeys = dashboardKeys_;¤			maxCount = maxCount_;¤			dq = new DashboardQuery(¤				new DashboardFilter(dashboardKeys, (maxCount < 0)? true : onlyUnread_)¤			);¤		}¤		¤		public String getName () {¤			return "setReadStateForAll for " + userName;¤		}¤¤		protected void runInternal () {¤			synchronized (lock) {¤				final User previousUser = AuthenticatedUserThreadLocal.getUser();¤				final User user = ContainerManager.Factory.get().getUserAccessor().getUser(userName);¤				DefaultTransactionAttribute transAtt = null;¤				TransactionStatus ts = null;¤				try {¤					AuthenticatedUserThreadLocal.setUser(user);¤					Logs.LOG_D("SetReadStateTask::runInternal - changed user to " + ((user != null) ? user.getName() : "UNKNOWN"));¤					¤					transAtt = new DefaultTransactionAttribute(TransactionAttribute.PROPAGATION_REQUIRED);¤					transAtt.setTimeout(180);					¤					ts = transactionManager.getTransaction(transAtt);¤					¤					List<EntityObject> spaces = DiscussionManager.getSpacesList(user);¤					int countDeletedEntities = 0;¤					for (int i = (maxCount < 0)? Integer.MAX_VALUE - 1 : maxCount; i > 0;) {¤						final int maxSize = (i > COUNT_ON_TRANSACTION) ? COUNT_ON_TRANSACTION : i;¤						final int deletedEntities = (maxCount < 0)¤							? dq.removeAllDiscussions(user.getName(), maxSize, spaces)¤							: dq.removeDiscussions(user.getName(), maxSize, spaces);¤						if (deletedEntities == 0) {¤							break;¤						}¤						transactionManager.commit(ts);¤						ts = transactionManager.getTransaction(transAtt);¤¤						i -= deletedEntities;¤						countDeletedEntities += deletedEntities;¤						Logs.LOG_I("DiscussionManager::setReadStateForAll: " + countDeletedEntities¤								+ " have been passed for " + (getElapsedTime() / 1000) + " sec.");¤					}¤					transactionManager.commit(ts);¤					if (getElapsedTime() > 5000) {¤						Logs.LOG_I(new Date() + " DiscussionManager::setReadStateForAll: '" + user.getName()¤								+ "' for " + dashboardKeys + ": " + countDeletedEntities + " items for "¤								+ (getElapsedTime() / 1000) + " sec.");¤					}¤				} catch (Exception e) {¤					Logs.LOG_E("DiscussionManager::SetReadStateTask::runInternal - " + e);¤					if (ts != null && transAtt != null && transAtt.rollbackOn(e)) {¤						transactionManager.rollback(ts);¤					}¤				} finally {¤					AuthenticatedUserThreadLocal.setUser(previousUser);¤					Logs.LOG_D("SetReadStateTask::runInternal - revert user to " + ((previousUser != null) ? previousUser.getName() : "UNKNOWN"));¤					userRequests.remove(user.getName());¤					lock.notify();¤				}¤			}¤		} // runInternal¤	} // SetReadStateTask¤	¤	final public String setReadStateForAll (final String dashboardKeys, final int maxCount,¤			final boolean onlyUnread) {¤		User user = AuthenticatedUserThreadLocal.getUser();¤		if (user == null || StringUtils.isEmpty(user.getName())) {¤			Logs.LOG_E("DiscussionManager::setReadStateForAll - got NULL user");¤			return "Failed";¤		}¤¤		if(dashboardKeys == null){¤			Logs.LOG_E("DiscussionManager::setReadStateForAll - got NULL dashboardKeys");¤			return "Failed";¤		}¤		¤		if (!lockUserForLongOperation(user.getName())) {¤			return "InProgress";¤		} else {		¤			try {		¤				final Object lock = new Integer(0);¤				synchronized (lock) {¤					try {¤						com.atlassian.confluence.util.longrunning.LongRunningTaskUtils¤								.startTask(new SetReadStateTask(lock, user.getName(), dashboardKeys, maxCount, onlyUnread));¤						lock.wait();¤					} catch (Exception e) {¤						Logs.LOG_SEX(e);¤						return "Failed";¤					}¤				}¤				return "Completed";			¤			} finally {¤				userRequests.remove(user.getName());¤			}¤		}¤	}¤	¤	final public String setReadStateForAll (final String dashboardKeys, final List<Long> idList,¤			final Boolean isDiscussion) {¤		final User user = AuthenticatedUserThreadLocal.getUser();¤		if (user == null || StringUtils.isEmpty(user.getName())) {¤			Logs.LOG_E("DiscussionManager::setReadStateForAll_ - got NULL user");¤			return "Failed";¤		}¤¤		if (!lockUserForLongOperation(user.getName())) {¤			return "InProgress";¤		}¤		try {¤			boolean isWarningRequestList = ¤				DashboardFilter.DashboardListType.valueOf(dashboardKeys) == DashboardListType.WARNING_REQUEST;¤			¤			GarantHibernate uds = new GarantHibernate(sf);¤			for (Long id : idList) {¤				if (isDiscussion || isWarningRequestList) {¤					UnreadDiscussion ud = uds.get(UnreadDiscussion.class, id);¤					if (ud == null) {¤						ud = new UnreadDiscussion(id);¤						uds.save(ud);¤					}¤					ud.clearUserComments(user.getName(), uds.getSession());¤				}¤				if (!isDiscussion || isWarningRequestList) {¤					UnreadDocument ud = uds.get(UnreadDocument.class, id);¤					if (ud == null) {¤						ud = new UnreadDocument(id);¤						uds.save(ud);¤					}¤					ud.removeUser(user.getName());¤				}¤			}¤		} catch (Exception e) {¤			Logs.LOG_E("DiscussionManager::setReadStateForAll_ - " + e);¤			return "Failed";¤		} finally {¤			userRequests.remove(user.getName());¤		}¤¤		return "Completed";¤	}¤¤	private net.sf.hibernate.SessionFactory sf = null;¤¤	public void setSessionFactory (net.sf.hibernate.SessionFactory sf) {¤		this.sf = sf;¤	}¤¤	/////////////////////////////////////////////////////////////////////////////////¤	static public Comment findLastComment (AbstractPage page) {¤		List<?> comments = page.getComments();¤		if (comments == null) {¤			return null;¤		}¤		Comment lastComment = null;¤		for (Iterator<?> it = comments.iterator(); it.hasNext();) {¤			Comment c = (Comment) it.next();¤			if ((lastComment == null) || (lastComment.getCreationDate().compareTo(c.getCreationDate()) < 0)) {¤				lastComment = c;¤			}¤		}¤		return lastComment;¤	}¤	¤	static public Comment findFirstComment (Set<Long> comments) {¤		if (comments == null) {¤			Logs.LOG_E("DiscussionManager::findFirstComment: comments is NULL.");¤			return null;¤		}¤		List<Long> unexistedComments = null;¤		Comment firstComment = null;¤		CommentManager cm = ContainerManager.Factory.get().getCommentManager();¤		for (final long commentId : comments) {¤			Comment comment = cm.getComment(commentId);¤			if (comment == null) {¤				Logs.LOG_E("DiscussionManager::findFirstComment: comment=" + commentId + " does not exist.");¤				if (unexistedComments == null) {¤					unexistedComments = new ArrayList<Long>();¤				}¤				unexistedComments.add(commentId);¤			} else if ((firstComment == null)¤					|| (firstComment.getCreationDate().compareTo(comment.getCreationDate()) > 0)) {¤				firstComment = comment;¤			}¤		}¤		if (unexistedComments != null) {¤			comments.remove(unexistedComments);¤		}¤		return firstComment;¤	}¤¤	/////////////////////////////////////////////////////////////////////////////////¤	private static List<EntityObject> getSpacesList (User user) {¤		return getSpacesList(user, false);		¤	}¤¤	private static List<EntityObject> getSpacesList (User user, boolean emptyIfAll) {¤		return (List)ContainerManager.Factory.get().getSpaceManager().getDashboardSpaces(user, emptyIfAll);¤	}¤¤	public boolean hasSpaceInDashboard (HttpServletRequest request, User user, List<?> spaces) {¤		for (EntityObject entity : getSpacesList(user)) {¤			Space space = (Space) entity;¤			if (spaces.contains(space.getKey())) {¤				return true;¤			}¤		}¤		return false;¤	}¤	//#UC END# *468F4EC30177_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/DiscussionManager|468F4EC30177
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039207337"))
	    quid       	"468F4EC30177"
	    documentation 	"Менеджер дискуссий."
	    stereotype 	"KComponentPlugin"
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006346620"))
		    quid       	"468F574C0203"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::GarantHibernate"
		    quidu      	"468F4E6C003E")
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006346997"))
		    quid       	"468F575000AB"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadDiscussion"
		    quidu      	"468F4D7A00DA")
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006347369"))
		    quid       	"468F575300BB"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadDocument"
		    quidu      	"468F4D6B002E"))
	    language   	"MDA Generator")
	(object Class "DeadDiscussionMacro"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DeadDiscussionMacro.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4F130261_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4F130261_CUSTOM_IMPORT*¤¤import java.util.List;¤¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤¤//#UC END# *468F4F130261_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4F130261_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *468F4F130261_CUSTOM_CLASS_DEFINITION*¤//#UC END# *468F4F130261_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4F130261_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4F130261_CUSTOM_METHODS_AND_DATA*¤	public String getName() {¤        return "DeadDiscussionMacro";¤    }¤	protected DashboardFilter.DashboardListType getType () {¤		return DashboardFilter.DashboardListType.DEAD;¤	}¤	protected String getMySQLQuery (boolean unreadOnly, String inSpaces, List<String> andFilter, String excludeFilter) {¤	 	String ret = "SELECT STRAIGHT_JOIN uds.entity_id, uds.date, uds.lastCommentId, uds.lastCommentAuthor, ucomm.count, ucomm.firstComment, ucomm.firstCommentAuthor, ucomm.date, ucomm.id"¤			+ " FROM content_label cl";¤	 	¤	 	if (inSpaces.length() > 0) {¤	 		ret += " JOIN content page ON (cl.contentid = page.contentid AND page.spaceid IN (" + inSpaces + "))";¤	 	}	 	¤		 	¤	 	for (int i = 0; i < andFilter.size (); i++) {¤	 		String s = andFilter.get(i);¤	 		String cl = "cl" + (i+1);¤			ret += " JOIN content_label " + cl + " ON (" + cl + ".contentid = cl.contentid AND " + cl + ".labelid in (" + s + "))";	 		¤	 	}¤	 	¤	 	if(unreadOnly) {¤		 	ret += " JOIN unread_discussions_map udm ON (udm.entity_id = cl.contentid AND udm.user_name = '" + AuthenticatedUserThreadLocal.getUsername() + "')"¤				+ " JOIN unread_discussions uds ON (uds.entity_id = cl.contentid)"¤				+ " JOIN unread_comments ucomm ON (ucomm.id = udm.unread_comments_id AND ucomm.count > 0)"¤			;¤	 	} else {¤		 	ret += " LEFT JOIN unread_discussions_map udm ON (udm.entity_id = cl.contentid AND udm.user_name = '" + AuthenticatedUserThreadLocal.getUsername() + "')"¤				+ " JOIN unread_discussions uds ON (uds.entity_id = cl.contentid)"¤				+ " LEFT JOIN unread_comments ucomm ON (ucomm.id = udm.unread_comments_id)"¤			;¤	 	}¤	 	ret += " JOIN content comm ON (uds.lastCommentId = comm.contentid)"¤			+ " WHERE cl.labelid = " + ContainerManager.Factory.get().getLabelManager().getLabel("dead").getId()¤			+ ((excludeFilter.length() > 0)¤				? " AND cl.contentid NOT IN ("¤					+ "SELECT ecl.contentid FROM content_label ecl"¤					+ " WHERE ecl.labelid in ("+ excludeFilter +")"¤					+")"¤				: ""¤			)¤			+ " ORDER BY comm.lastmoddate desc"¤		;¤	 	return ret;¤	}¤	//#UC END# *468F4F130261_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/DeadDiscussionMacro|468F4F130261
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038962124"))
	    quid       	"468F4F130261"
	    documentation 	"Макрос, который показывает на странице список мертвых обсуждений."
	    stereotype 	"KMacroPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"468F4F4400AB"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionsMacroBase"
		    quidu      	"460A5C2100AB"))
	    language   	"MDA Generator")
	(object Class "DashboardQuery"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/DashboardQuery.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4F6203B9_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4F6203B9_CUSTOM_IMPORT*¤import ru.garant.shared.ConfluenceCore.Helpers.ContainerManager;¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.security.PermissionManager;¤import com.atlassian.confluence.security.Permission;¤import com.atlassian.confluence.spaces.SpaceType;¤import com.atlassian.core.bean.EntityObject;¤import com.atlassian.user.User;¤¤import com.opensymphony.util.TextUtils;¤import net.sf.hibernate.*;¤¤import java.util.*;¤//#UC END# *468F4F6203B9_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4F6203B9_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *468F4F6203B9_CUSTOM_CLASS_DEFINITION*¤//#UC END# *468F4F6203B9_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4F6203B9_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4F6203B9_CUSTOM_METHODS_AND_DATA*¤	private DashboardFilter filter_ = null;¤	public DashboardQuery (DashboardFilter filter) {¤		filter_ = filter;¤	}¤	public DashboardQuery () {¤	}¤	¤	final public int getCountUnviewedArchive (String userName, long pageId, long labelId, List<Long> unviewedCommentIDs) {¤		try {¤			Query query = getSession().getNamedQuery("mdk.discussions.getCountUnviewedArchive")¤				.setCacheable(true)¤				.setParameterList("ids", unviewedCommentIDs)¤				.setLong("pageId", pageId)¤				.setLong("labelId", labelId);¤			return ((Integer)query.iterate().next()).intValue();¤		} catch (HibernateException e) {¤			Logs.LOG_E("DashboardQuery::getCountUnviewedArchive: HibernateException: " + e);¤			throw new RuntimeException(e);¤		}¤	}¤¤	final public long[] getOldUnreadDiscussions (int days) throws Exception {¤		try {¤			Calendar cal = Calendar.getInstance();¤			if (days > 0) {¤				cal.add(Calendar.DAY_OF_YEAR, -days);¤			}¤			List<?> ids = getSession().getNamedQuery("mdk.discussions.getOldUnreadDiscussions")¤				//.setCacheable(true)¤				.setDate(0, cal.getTime())¤				.list();¤			int deletedEntities = 0;¤			long[] res = new long[ids.size()];¤			for (Iterator<?> it = ids.iterator(); it.hasNext(); ++deletedEntities) {¤				res[deletedEntities] = (Long)it.next();¤			}¤			return res;¤		} catch (HibernateException e) {¤			throw new RuntimeException(e);¤		}¤	}¤¤¤	final public long[] getOldUnreadDocuments (int days) throws Exception {¤		try {¤			Calendar cal = Calendar.getInstance();¤			if (days > 0) {¤				cal.add(Calendar.DAY_OF_YEAR, -days);¤			}¤			List<?> ids = getSession().getNamedQuery("mdk.discussions.getOldUnreadDocuments")¤				//.setCacheable(true)¤				.setDate(0, cal.getTime())¤				.list();¤			int deletedEntities = 0;¤			long[] res = new long[ids.size()];¤			for (Iterator<?> it = ids.iterator(); it.hasNext(); ++deletedEntities) {¤				res[deletedEntities] = (Long)it.next();¤			}¤			return res;¤		} catch (HibernateException e) {¤			throw new RuntimeException(e);¤		}¤	}¤¤	final public int removeAllDiscussions (String userName, int maxSize, List<EntityObject> spaces) {¤		String sQueryWarningRequestUnreadDocument = null;¤		final String sQuery =¤			(isRecently()¤					? " select ud from UnreadDocument as ud join ud.users as unreading, AbstractPage as page "¤					: " select ud from UnreadDiscussion as ud, AbstractPage as page")¤			+ (isWarningRequest() ¤					? ", UserWarningRequest as uwr where (ud.entityId=page.id and ud.entityId=uwr.content.id and uwr.user=\'" + userName + "\' and uwr.needMonitoring=\'1\') "¤					: " where (ud.entityId=page.id) " + getSpacesQueryStr(spaces))		¤			+ getLabelsQueryStr()¤			+ getUnreadQueryStr()¤		;¤		try {¤			Session session = getSession();¤			Query query = session.createQuery(sQuery);¤			int deletedEntities = 0;¤			for (¤				Iterator<?> it = query.iterate()¤				; it.hasNext() && (deletedEntities < maxSize)¤				; ++deletedEntities¤			) {¤				if (isRecently()) {¤					UnreadDocument ud = (UnreadDocument)it.next();¤					ud.removeUser(userName);¤				} else {¤					UnreadDiscussion ud = (UnreadDiscussion)it.next();¤					ud.clearUserComments(userName, session);¤				}¤			}¤			if(isWarningRequest()){¤				sQueryWarningRequestUnreadDocument = " select ud from UnreadDocument as ud join ud.users as unreading, AbstractPage as page "¤					+ ", UserWarningRequest as uwr where (ud.entityId=page.id and ud.entityId=uwr.content.id and uwr.user=\'" + userName + "\' and uwr.needMonitoring=\'1\') "¤					+ " and (ud.entityId=page.id) and (unreading.user='" + userName + "')";¤¤				Query queryWarningRequests = session.createQuery(sQueryWarningRequestUnreadDocument);¤				deletedEntities = 0;¤				for (¤					Iterator<?> it = queryWarningRequests.iterate()¤					; it.hasNext() && (deletedEntities < maxSize)¤					; ++deletedEntities¤				) {¤						UnreadDocument ud = (UnreadDocument)it.next();¤						ud.removeUser(userName);¤				}¤			}¤			return deletedEntities;¤		} catch (HibernateException e) {¤			throw new RuntimeException(e);¤		}¤	}¤¤	final public int removeDiscussions (String userName, int maxSize, List<EntityObject> spaces) {¤		GarantHibernate uds = new GarantHibernate(ContainerManager.Factory.get().getSessionFactory());¤		int deletedEntities = 0;¤		List<VelocityItem> dashBoardList = loadResults(uds.getSession(), spaces, maxSize);¤		for (VelocityItem item : dashBoardList) {¤			if (!item.isRead()) {¤				if (isRecently()) {¤					UnreadDocument ud = uds.get(UnreadDocument.class, item.getPage().getId());¤					ud.removeUser(userName);¤				} else {¤					UnreadDiscussion ud = uds.get(UnreadDiscussion.class, item.getPage().getId());¤					ud.clearUserComments(userName, uds.getSession());¤				}¤				++deletedEntities;¤			}¤		}¤		return deletedEntities;¤	}¤¤	final public long[] getDocsWithLabel (int days, long labelId) {¤		try {¤			Calendar cal = Calendar.getInstance();¤			if (days > 0) {¤				cal.add(Calendar.DAY_OF_YEAR, -days);¤			}¤			List<?> resList = getSession().getNamedQuery("mdk.discussions.getDocsWithLabel")¤				.setCacheable(true)¤				.setDate("date", cal.getTime())¤				.setLong("labelId", labelId)¤				.list();¤			long[] res = new long[resList.size()];¤			int iPageId = 0;¤			for (Iterator<?> iter = resList.iterator(); iter.hasNext(); ++iPageId) {¤				res[iPageId] = (Long)iter.next();¤			}¤			return res;¤		} catch (HibernateException e) {¤			throw new RuntimeException(e);¤		}¤	}¤¤	final public List<VelocityItem> createItemList (int maxSize, List<EntityObject> spaces) {¤		List<VelocityItem> res = loadResults(getSession(), spaces, maxSize);¤		return res;¤	}¤	¤	final public int getCountItems (List<EntityObject> spaces) {¤		try {¤			String sQuery = getPageQueryStr(spaces, true, null);			¤			return ((Integer)getSession().iterate(sQuery).next()).intValue();¤		} catch (HibernateException e) {¤			throw new RuntimeException(e);¤		}¤	}¤¤	static List<VelocityItem> makeItems (List<AbstractPage> pageList) {¤		List<VelocityItem> itemList = new ArrayList<VelocityItem>(pageList.size());¤		for (AbstractPage page : pageList) {¤			VelocityItem item = new VelocityItem();¤			item.setPage(page);¤			item.setDate(page.getLastModificationDate());¤			item.setAuthor(page.getLastModifierName());¤			itemList.add(item);¤		}¤		return itemList;¤	}¤	¤	public static List<VelocityItem> loadFavPages (Session session, List<AbstractPage> favPages) throws Exception {¤		List<VelocityItem> itemList = makeItems(favPages);¤		itemList = filteredPages(session, itemList, WITH_CHANGING_AUTHOR_AND_DATE);¤		return itemList;¤	}¤	¤	public static List<VelocityItem> filteredPages (Session session, List<VelocityItem> itemList, byte flagDataChanging)¤			throws Exception {¤		DashboardQuery dq = new DashboardQuery(new DashboardFilter(¤				DashboardFilter.DashboardListType.RECENTLY, false));¤		dq.loadUnreadDiscussions(session, itemList, flagDataChanging);¤		dq.loadUnreadDocuments(session, itemList);¤¤		for (Iterator<VelocityItem> it = itemList.iterator(); it.hasNext();) {¤			VelocityItem item = it.next();¤			if (dq.filter_.onlyUnread() && item.isRead()) {¤				it.remove();¤			}¤		}¤		return itemList;¤	}¤	public static byte WITHOUT_CHANGING_AUTHOR_AND_DATE = 1; ¤	public static byte WITH_CHANGING_AUTHOR_AND_DATE = 0; ¤	¤	private List<VelocityItem> loadRecently (Session session, List<EntityObject> spaces, int maxSize, List<Long> favPagesIds) {¤		com.atlassian.confluence.security.PermissionManager pm = ContainerManager.Factory.get().getPermissionManager();¤		List<VelocityItem> res = new ArrayList<VelocityItem>(Math.min(maxSize, 100));¤		¤		Iterator<Object[]> iter = null;¤		try {¤			String sQuery = getPageQueryStr(spaces, false, favPagesIds);¤			Query query = session.createQuery(sQuery);¤			iter = query.iterate();¤		} catch (HibernateException e) {¤			throw new RuntimeException(e);¤		}¤		¤		¤		while (res.size() < maxSize && iter.hasNext()) {¤			Object[] cur = iter.next();¤			VelocityItem vi = (isRecently()) ? makeDocumentItem(cur, pm) : makeDiscussionItem(cur, pm);¤			if (vi != null) {¤				res.add(vi);¤			}¤		}¤		return res;¤	}¤	¤	private List<VelocityItem> loadDiscussion (Session session, List<EntityObject> spaces, int maxSize, List<Long> favPagesIds) {¤		com.atlassian.confluence.security.PermissionManager pm = ContainerManager.Factory.get().getPermissionManager();¤		List<VelocityItem> res = new ArrayList<VelocityItem>(Math.min(maxSize, 100));¤		¤		Iterator<Object[]> iter = null;¤		try {¤			String sQuery = getPageQueryStr(spaces, false, favPagesIds);¤			Query query = session.createQuery(sQuery);¤			iter = query.iterate();¤		} catch (HibernateException e) {¤			throw new RuntimeException(e);¤		}¤		¤		¤		while (res.size() < maxSize && iter.hasNext()) {¤			Object[] cur = iter.next();¤			VelocityItem vi = (isRecently()) ? makeDocumentItem(cur, pm) : makeDiscussionItem(cur, pm);¤			if (vi != null) {¤				res.add(vi);¤			}¤		}¤		return res;¤	}¤	¤	private List<VelocityItem> loadAllPages (Session session, List<EntityObject> spaces, int maxSize, List<Long> favPagesIds) {¤		if (isRecently()) {¤			return loadRecently(session, spaces, maxSize, favPagesIds);¤		}¤		return loadDiscussion(session, spaces, maxSize, favPagesIds);¤	}¤	¤	private List<VelocityItem> loadResults (Session session, List<EntityObject> spaces, int maxSize) {¤		/*Logs.LOG_D("loadResults: ********************************************");¤		long time0 = System.currentTimeMillis();*/¤		List<VelocityItem> res = loadAllPages(session, spaces, maxSize, null);¤		loadUnreadItems(session, res);¤		/*long time1 = System.currentTimeMillis();¤		Logs.LOG_D(¤			"loadResults: user='" + filter_.getUser().getName() + "': " + filter_.getType()¤			+ ": maxSize=" + maxSize¤			+ "; time=" + (time1 - time0)¤		);*/¤		return res;¤	}¤¤	private void loadUnreadItems (Session session, List<VelocityItem> items) {¤		if (!items.isEmpty()) {¤			if (isRecently()) {¤				loadUnreadDocuments(session, items);¤			} else {¤				loadUnreadDiscussions(session, items, WITH_CHANGING_AUTHOR_AND_DATE);¤			}¤		}¤	}¤¤	private VelocityItem makeDocumentItem (Object[] row, PermissionManager pm) {¤		AbstractPage page = (AbstractPage)row[0];¤		if (!pm.hasPermission(filter_.getUser(), Permission.VIEW, page)) {¤			return null;¤		}¤		VelocityItem vi = new VelocityItem();¤		vi.setPage (page);¤¤		Date date = (Date)row[1];¤		if (date == null) {¤			date = page.getLastModificationDate();¤			if (date == null) {¤				date = page.getCreationDate();¤			}¤			getDiscussionManager().updateDocumentModificationDate(page.getId(), date);¤		}¤		vi.setDate(date);¤¤		String modifierName = page.getLastModifierName();¤		vi.setAuthor((modifierName == null) ? page.getCreatorName() : modifierName);¤		return vi;¤	}¤¤	private VelocityItem makeDiscussionItem (Object[] row, PermissionManager pm) {¤		AbstractPage page = (AbstractPage)row[0];¤		if (!pm.hasPermission(filter_.getUser(), Permission.VIEW, page)) {¤			if (filter_.onlyUnread()) {¤				getDiscussionManager().setDiscussionReadState(page.getId());¤			}¤			return null;¤		}¤		VelocityItem vi = new VelocityItem();¤		vi.setPage(page);¤		vi.setDate((Date)row[1]);¤		vi.setLastCommentId((Long)row[2]);¤		vi.setAuthor((String)row[3]);¤¤		if ((vi.getDate() == null) || (TextUtils.stringSet(vi.getAuthor()) == false)) {¤			GarantHibernate uds = new GarantHibernate(ContainerManager.Factory.get().getSessionFactory());¤			UnreadDiscussion ud = uds.get(UnreadDiscussion.class, page.getId());¤			if (ud != null) {¤				ud.setLastComment(DiscussionManager.findLastComment(page));¤¤				vi.setDate(ud.getDate());¤				vi.setAuthor(ud.getLastCommentAuthor());¤				vi.setLastCommentId(ud.getLastCommentId());¤			}¤		}¤		return vi;¤	}¤¤	private void loadUnreadDocuments (Session session, List<VelocityItem> items) {¤		if (filter_.getUser() == null) {¤			return;¤		}¤		try {¤			List<Long> unreadList = session.getNamedQuery("mdk.discussions.loadUnreadDocuments")¤				.setCacheable(true)¤				.setParameterList("ids", velocityItemList2Str(items))¤				.setString("userName", filter_.getUser().getName())¤				.list();¤			for (VelocityItem item : items) {¤				if (Collections.binarySearch(unreadList, item.getPage().getId()) >= 0) {¤					item.setRead(false);¤					item.setDocumentBodyRead(false);¤				}¤			}¤		} catch (HibernateException e) {¤			throw new RuntimeException(e);¤		}¤	}¤¤	private UnreadComments getUnreadComments (Session session, long unreadCommentId) {¤		try {¤			return (UnreadComments)session.get(UnreadComments.class, unreadCommentId);¤		} catch (HibernateException e) {¤			throw new RuntimeException(e);			¤		}¤	}¤	¤	private void loadUnreadDiscussionItem (Session session, VelocityItem item, Object[] curRow, byte flagDataChanging) {¤		if(flagDataChanging != WITHOUT_CHANGING_AUTHOR_AND_DATE){¤			item.setDate((Date)curRow[1]);¤			item.setAuthor((String)curRow[3]);¤		}¤		¤		item.setLastCommentId((Long)curRow[2]);¤		¤		item.setUnreadCommentCount((Integer)curRow[4]);¤		item.setRead(item.getUnreadCommentCount() == 0);¤		if (item.getUnreadCommentCount() > 0) {¤			item.setLastCommentId((Long)curRow[5]);¤			if(flagDataChanging != WITHOUT_CHANGING_AUTHOR_AND_DATE){¤			item.setAuthor((String)curRow[6]);¤			item.setDate((Date)curRow[7]);¤			}¤			if ((item.getLastCommentId() == 0) ||¤				(item.getDate() == null) ||¤				(!TextUtils.stringSet(item.getAuthor()))¤			) {¤				UnreadComments uc = getUnreadComments(session, (Long)curRow[8]);¤				item.setLastCommentId(uc.getFirstComment());¤				if(flagDataChanging != WITHOUT_CHANGING_AUTHOR_AND_DATE){¤				item.setAuthor(uc.getFirstCommentAuthor());¤				item.setDate(uc.getDate());¤				}¤			}¤		}¤	}¤¤	private void loadUnreadDiscussions (Session session, List<VelocityItem> items, byte flagDataChanging) {¤		if (filter_.getUser() == null) {¤			return;¤		}¤		try {¤			List<Object[]> unreadList = session.getNamedQuery("mdk.discussions.loadUnreadDiscussions")¤				.setCacheable(true)¤				.setParameterList("ids", velocityItemList2Str(items))¤				.setString("userName", filter_.getUser().getName())¤				.list();¤			Object[] objToSearch = new Long[1];¤			for (VelocityItem item : items) {¤				objToSearch[0] = item.getPage().getId();¤				int res = Collections.binarySearch(unreadList, objToSearch, new Comparator<Object[]>(){¤					public int compare (Object[] row1, Object[] row2) {¤						return ((Long)row1[0]).compareTo((Long)row2[0]);¤					}¤				});¤				if (res >= 0) {¤					loadUnreadDiscussionItem(session, item, unreadList.get(res), flagDataChanging);¤				}¤			}¤		} catch (HibernateException e) {¤			Logs.LOG_E("DashboardQuery::loadUnreadDiscussions: HibernateException: " + e);¤			throw new RuntimeException(e);¤		}¤	}¤¤	private String getPageQueryStr (List<EntityObject> spaces, boolean forCount, List<Long> pageIds) {¤		String sQuery =	(¤				forCount¤				? "select count(*) "¤				: (isRecently())¤						? " select distinct page, ud.lastModificationDate "¤						: " select distinct page, ud.date, ud.lastCommentId, ud.lastCommentAuthor "¤		)¤		+ " from AbstractPage as page ";¤¤		if (isRecently()) {¤			sQuery += ", UnreadDocument as ud ";¤			if (filter_.onlyUnread()) {¤				sQuery += "join ud.users as unreading ";¤			}¤		} else {¤			sQuery += ", UnreadDiscussion as ud ";¤		}¤		sQuery += " where (page.contentStatus='current' and page.originalVersion is null) "¤			+ ((isRecently())? getMajorChanges() : "")¤			+ getSpacesQueryStr(spaces)¤			+ getLabelsQueryStr()¤			+ ((pageIds == null) ? getUnreadQueryStr() : "")¤			+ getFiltratedStr(pageIds)¤			+ getOrderingQueryStr()¤		;¤		return sQuery;¤	}¤	¤	private String getFiltratedStr (List<Long> pageIds) {¤		return (pageIds == null || pageIds.isEmpty())¤			? " "¤			: " and page.id in (" + com.opensymphony.util.TextUtils.join(",", pageIds) + ")";¤	}¤	¤	private String getMajorChanges () {¤		return " and (ud.entityId=page.id) and (ud.lastModificationDate is not null) ";¤	}¤	¤	private String getOrderingQueryStr () {¤		return " order by ud." + (isRecently()? "lastModificationDate": "date") + " desc ";¤	}¤	¤	private String getSpacesQueryStr (List<EntityObject> spaces) {¤		return (spaces == null || spaces.isEmpty()) ?¤				" " : " and (page.space.id in (" + listEntityes2Str(spaces) + ")) ";¤	}¤	¤	private String getUnreadQueryStr () {¤		String sQuery = "";¤		if (isRecently()) {¤			if (filter_.onlyUnread()) {¤				//sQuery += " and (ud.entityId=page.id) and ('" + filter_.getUser().getName() + "' some elements(ud.users.user))";¤				sQuery += " and (ud.entityId=page.id) and (unreading.user='" + filter_.getUser().getName() + "')";¤			}¤		} else {¤			if (filter_.onlyUnread()) {¤				sQuery += " and (ud.entityId=page.id and ud.users['" + filter_.getUser().getName() + "'].count>0) ";¤			} else {¤				sQuery += " and (ud.entityId=page.id) ";¤			}¤		}¤		return sQuery;¤	}¤	¤	private String getLabelsQueryStr () {¤		String res = "";¤		for (Iterator<List<EntityObject>> it = filter_.getOrLabels().iterator(); it.hasNext();) {¤			List<EntityObject> or = it.next();¤			if (or != null && !or.isEmpty()) {¤				res += " and (0!=(select count(labelling.label.id) from Labelling labelling where (labelling.content=page.id) and (labelling.label.id in (" + listEntityes2Str(or) + "))))";¤			}¤		}¤¤		List<EntityObject> and = filter_.getAndLabels();¤		if (and != null && !and.isEmpty()) {¤			res += " and (" + and.size() + "=(select count(labelling.label.id) from Labelling labelling where (labelling.content=page.id) and (labelling.label.id in (" + listEntityes2Str(and) + "))))";¤		}¤¤		List<EntityObject> not_or = filter_.getNotOrLabels();¤		if (not_or != null && !not_or.isEmpty()) {¤			res += " and (0=(select count(labelling.label.id) from Labelling labelling where (labelling.content=page.id) and (labelling.label.id in (" + listEntityes2Str(not_or) + "))))";¤		}¤		return res;¤	}¤¤	private String listEntityes2Str (final List<EntityObject> array) {¤		String res = "";¤		final int last = array.size() - 1;¤		for (int i = 0; i < last; ++i) {¤			if (array.get(i) != null) {¤				res += array.get(i).getId() + ",";¤			}¤		}¤		if (array.get(last) != null) {¤			res += array.get(last).getId();¤		}¤		return res;¤	}¤¤	private List<Long> velocityItemList2Str (final List<VelocityItem> items) {¤		List<Long> res = new ArrayList<Long>(items.size());¤		for (VelocityItem item : items) {¤			long pageId = item.getPage().getId();¤			if (pageId != 0L) {¤				res.add(pageId);¤			}¤		}¤		return res;¤	}¤¤	private net.sf.hibernate.Session getSession () {¤		return org.springframework.orm.hibernate.SessionFactoryUtils.getSession (ContainerManager.Factory.get().getSessionFactory(), false);¤	}¤¤	private DiscussionManager discussionManager = null;¤	private DiscussionManager getDiscussionManager () {¤		if (discussionManager == null) {¤			discussionManager = (DiscussionManager) com.atlassian.spring.container.ContainerManager.getComponent(¤				"ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager"¤			);¤			if (discussionManager == null) {¤				Logs.LOG_E("DashboardQuery::getDiscussionManager: can not find OpenDiscussionManager");¤			}¤		}¤		return discussionManager;¤	}¤	¤	final private boolean isRecently () {¤		return filter_.getType() == DashboardFilter.DashboardListType.RECENTLY;¤	}¤¤	final private boolean isWarningRequest () {¤		return filter_.getType() == DashboardFilter.DashboardListType.WARNING_REQUEST;¤	}¤	¤	¤	/*private String toCP866 (String sout) {¤		try {¤			return new String (sout.getBytes ("CP866"));¤		} catch (java.io.UnsupportedEncodingException e) {¤			Logs.LOG_I("DashboardQuery::printInCP866::UnsupportedEncodingException: " + e);¤			return sout;¤		}¤	}*/¤	//#UC END# *468F4F6203B9_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/DashboardQuery|468F4F6203B9
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19026182186"))
	    quid       	"468F4F6203B9"
	    documentation 	
|Класс реализации HIbernate запросов формирования списков ПУ
|Требует разбиения на классы окрытых,закрытых, мертвых дискусий и непрочитанных документов для упрощения кода.
	    
	    stereotype 	"SimpleClass"
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006348843"))
		    quid       	"468F57660399"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DashboardFilter"
		    quidu      	"465ADE52034B")
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006349208"))
		    quid       	"468F576C03D8"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::VelocityItem"
		    quidu      	"468F4D100213"))
	    language   	"MDA Generator")
	(object Class "CheckForDeadDiscussionsJob"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/CheckForDeadDiscussionsJob.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4FB90148_CUSTOM_IMPORT*"
		    value      	"//#UC START# *468F4FB90148_CUSTOM_IMPORT*¤import ru.garant.shared.ConfluenceCore.Helpers.ContainerManager;¤import ru.garant.shared.ConfluenceCore.LabelSupport.GarLabelManager;¤import ru.garant.shared.ConfluenceCore.ActionSupport.ActionContextThreadLocalFactory;¤¤import com.atlassian.confluence.labels.LabelManager;¤import com.atlassian.confluence.pages.PageManager;¤import com.atlassian.confluence.pages.AbstractPage;¤¤import java.util.*;¤//#UC END# *468F4FB90148_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4FB90148_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *468F4FB90148_CUSTOM_CLASS_DEFINITION*¤//#UC END# *468F4FB90148_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4FB90148_DO_EXECUTE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *468F4FB90148_DO_EXECUTE_IMPLEMETATION*¤		super.doExecute(jec);¤		//#UC END# *468F4FB90148_DO_EXECUTE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*468F4FB90148_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *468F4FB90148_CUSTOM_METHODS_AND_DATA*¤	private void open2dead () throws Exception {¤		long startTime = System.currentTimeMillis();¤		GarLabelManager lm = ContainerManager.Factory.get().getLabelManager();¤		PageManager pm = ContainerManager.Factory.get().getPageManager();¤		DashboardQuery dq = new DashboardQuery();¤		long[] olds = dq.getDocsWithLabel(7, lm.getLabel(DiscussionManager.OPEN_DISCUSSION_LABEL).getId());¤		for (int i = 0; i < olds.length; ++i) {¤			long pageId = olds[i];¤			AbstractPage page = pm.getAbstractPage(pageId);¤			if (page == null) {¤				Logs.LOG_W ("Warning! Page " + pageId + " does not exist.");¤			} else {¤				lm.removeLabel(page, DiscussionManager.OPEN_DISCUSSION_LABEL);¤				if (lm.removeLabel(page, DiscussionManager.CLOSE_DISCUSSION_LABEL) == LabelManager.LABEL_REMOVED) {¤					Logs.LOG_W("CheckForDeadDiscussionsJob::open2dead: Warning! Page '"¤						+  new String(page.getTitle().getBytes("CP866"))¤						+ "'("+ page.getId() + ") had OPEN and CLOSE labels in the same time.");¤				}¤				lm.addLabel(page, DiscussionManager.DEAD_DISCUSSION_LABEL);¤				this.getDiscussionManager().setDiscussionUnreadState4All(page.getId());¤			}¤		}¤		if (olds.length > 0) {¤			final long time = System.currentTimeMillis() - startTime;¤			Logs.LOG_I(¤					"CheckForDeadDiscussionsJob::open2dead [" + time + "ms] " + olds.length + " docs"¤			);¤		}¤	}¤¤	private DiscussionManager discussionManager = null;¤	private DiscussionManager getDiscussionManager () {¤		if (this.discussionManager == null) {¤			this.discussionManager =¤				(DiscussionManager)com.atlassian.spring.container.ContainerManager.getComponent(¤						"ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager"¤				);¤			if (this.discussionManager == null) {¤				Logs.LOG_E(¤						"CheckForDeadDiscussionsJob::getOpenDiscussionManager: can not find OpenDiscussionManager"¤				);¤			}¤		}¤		return this.discussionManager;¤	}¤	@Override¤	protected void executeJob() {¤		 ActionContextThreadLocalFactory.Factory.get().getContext().removeAll();		¤		try {¤			open2dead ();¤		} catch (Exception e) {¤			Logs.LOG_E(new Date() + ": CheckForDeadDiscussionsJob::doExecute: " + e);¤			Logs.LOG_SEX(e);¤			Logs.LOG_E("CheckForDeadDiscussionsJob::doExecute: ------------------------------------------------");¤		}¤	}¤	¤	protected boolean isNeedWriteTransaction() {¤		return true;¤	}¤	//#UC END# *468F4FB90148_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/CheckForDeadDiscussionsJob|468F4FB90148
		    ))
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory auto reg"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory default impl"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need unsorted less"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Servant Pool"
		    value      	"none")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"debug log"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"finished"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"local supervisor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"repeat-count"
		    value      	"1000000000")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"repeat-interval"
		    value      	"3600000")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"repeated"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"singleton"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038997458"))
	    quid       	"468F4FB90148"
	    documentation 	"Обработка события для перевода обсуждений из активных (открытых) в мертвые."
	    stereotype 	"KJobPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"1337598027195692"))
		    quid       	"4FBA204B00C2"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::EntitySupport::GarantAbstractJobWithLock"
		    quidu      	"4FBA1F4403CC"))
	    language   	"MDA Generator")
	(object Class "SweepOldDiscussionsJob"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/SweepOldDiscussionsJob|471C9E650261
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/SweepOldDiscussionsJob.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*471C9E650261_CUSTOM_IMPORT*"
		    value      	"//#UC START# *471C9E650261_CUSTOM_IMPORT*¤import java.util.*;¤¤import ru.garant.shared.ConfluenceCore.ActionSupport.ActionContextThreadLocalFactory;¤//#UC END# *471C9E650261_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*471C9E650261_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *471C9E650261_CUSTOM_CLASS_DEFINITION*¤//#UC END# *471C9E650261_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*471C9E650261_DO_EXECUTE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *471C9E650261_DO_EXECUTE_IMPLEMETATION*¤		super.doExecute(jec);¤		//#UC END# *471C9E650261_DO_EXECUTE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*471C9E650261_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *471C9E650261_CUSTOM_METHODS_AND_DATA*¤	private DiscussionManager discussionManager = null;¤	private DiscussionManager getDiscussionManager () {¤		if (this.discussionManager == null) {¤			this.discussionManager =¤				(DiscussionManager)com.atlassian.spring.container.ContainerManager.getComponent(¤						"ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager"¤				);¤			if (this.discussionManager == null) {¤				Logs.LOG_E(¤						"SweepOldDiscussionsJob::getOpenDiscussionManager: can not find OpenDiscussionManager"¤				);¤			}¤		}¤		return this.discussionManager;¤	}¤	¤	@Override¤	protected void executeJob() {¤		try {¤			getDiscussionManager().sweepUnreadEntities(30);¤		} catch (Exception e) {¤			Logs.LOG_E(new Date() + ": SweepOldDiscussionsJob::doExecute: " + e);¤			Logs.LOG_SEX(e);¤			Logs.LOG_E("SweepOldDiscussionsJob::doExecute: ------------------------------------------------");¤		}¤	}¤	¤	protected boolean isNeedWriteTransaction() {¤		return true;¤	}¤	¤	//#UC END# *471C9E650261_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory auto reg"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory default impl"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need unsorted less"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Servant Pool"
		    value      	"none")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"cron-expression"
		    value      	"0 55 6 ? * *")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"debug log"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"finished"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"local supervisor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"repeated"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"singleton"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038998886"))
	    quid       	"471C9E650261"
	    documentation 	"Удаление старых обсуждений."
	    stereotype 	"KJobPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"1337598029298814"))
		    quid       	"4FBA204D0129"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::EntitySupport::GarantAbstractJobWithLock"
		    quidu      	"4FBA1F4403CC"))
	    language   	"MDA Generator")
	(object Class "CommentBranchStateActionPlugin"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/CommentBranchStateActionPlugin.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/CommentBranchStateActionPlugin|4729BB88003E
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4729BB88003E_CUSTOM_IMPORT*"
		    value      	"//#UC START# *4729BB88003E_CUSTOM_IMPORT*¤import ru.garant.MDProcess.ConfluencePlugins.Entities.ContentEntityObjectCache;¤¤import com.atlassian.confluence.security.PermissionHelper;¤import com.atlassian.confluence.security.PermissionManager;¤import com.atlassian.confluence.themes.PageHelper;¤import com.atlassian.confluence.themes.ThemeHelper;¤import com.atlassian.confluence.user.PersonalInformationManager;¤¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.Comment;¤import com.atlassian.confluence.pages.CommentManager;¤import com.atlassian.confluence.renderer.radeox.macros.MacroUtils;¤import com.atlassian.confluence.util.velocity.VelocityUtils;¤import com.atlassian.renderer.WikiStyleRenderer;¤import com.atlassian.spring.container.ContainerManager;¤import com.atlassian.user.User;¤¤import java.util.*;¤//#UC END# *4729BB88003E_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4729BB88003E_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *4729BB88003E_CUSTOM_CLASS_DEFINITION*¤//#UC END# *4729BB88003E_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4729BB88003E_ACTION_NAME*"
		    value      	(value Text 
|//#UC START# *4729BB88003E_ACTION_NAME*¤		return getClass ().getName ();¤		//#UC END# *4729BB88003E_ACTION_NAME*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4729BB88003E_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *4729BB88003E_CUSTOM_METHODS_AND_DATA*¤	public String setCollapseState () {¤		¤		Comment comment = this.commentManager.getComment (this.contentId);¤		if (this.collapseBranch) {¤			getDiscussionManager().setBranchCollapsedState(comment);¤			this.responseContent = this.makeCount(comment);¤			this.responseContent += this.makeIDs(comment);¤		} else {¤			getDiscussionManager().setBranchExpandedState(comment);¤			this.responseContent = this.generatedBranch(comment);¤		}¤		return SUCCESS;¤	}¤	final private String makeCount (Comment comment) {¤		return "<count>" + getDiscussionManager().getUnreadCommentCount(comment) + "</count>";¤	}¤	final private String makeIDs (Comment comment) {¤		String res = "";¤		for (Iterator<?> it = comment.getChildren().iterator(); it.hasNext();) {¤			Comment c = (Comment)it.next();¤			res += "<id>" + c.getIdAsString() + "</id>";¤		}¤		return res;¤	}¤¤	final private String generatedBranch (Comment comment) {¤		return VelocityUtils.getRenderedContent(¤				//"#treeHTML($commentList $rootDepth $showArchiveComments $showAllComments 0)"¤				"#viewPageComment($comment $rootDepth $showArchiveComments $showAllComments)"¤				, createContextMap(comment)¤		);¤	}¤¤	private Map<?,?> createContextMap (Comment comment) {¤		AbstractPage page = comment.getPage();¤		¤		Map<String, Object> result = MacroUtils.defaultVelocityContext();¤		result.put("comment", comment);¤		//map.put("commentToView", comment);¤		//map.put("commentList", comment.getChildren());¤		//map.put("cls2", " sub_tree line");¤		result.put("rootDepth", new Integer(0));¤		result.put("showArchiveComments"¤				, (this.showArchiveComments != null)¤				? this.showArchiveComments : page.getIdAsString() + "false"¤		);¤		result.put("page", page);¤		result.put("showAllComments", page.getIdAsString() + "true");¤¤		result.put("xHtmlComments", this.getXHtmlComments(comment));¤		result.put("permissionHelper", new PermissionHelper(this.permissionManager, this.personalInformationManager));¤		result.put("remoteUser", this.getRemoteUser());¤		result.put("threadComments", new Boolean(true));¤¤		result.put("firstLevelCommentId", comment.getId());¤		result.put("commentsData", new GarantViewPageAction.CommentsData(page.getId()));¤¤		return result;¤	}¤	¤	private Map<Comment, String> xHtmlComments = null;¤	private Map<?,?> getXHtmlComments(Comment comment) {¤	    if (this.xHtmlComments == null) {¤	    	this.xHtmlComments = new HashMap<Comment, String>();¤	    	this.addComment2HtmlCommentsMap(comment);¤	        this.addChildren2HtmlCommentsMap(comment.getChildren());¤	    }¤	    return this.xHtmlComments;¤	}¤	private void addComment2HtmlCommentsMap (Comment comment) {¤		this.xHtmlComments.put(¤				comment¤				, this.wikiStyleRenderer.convertWikiToXHtml(¤						comment.toPageContext(), comment.getContent()¤				)¤		);¤	}¤¤	private void addChildren2HtmlCommentsMap (List<?> commentList) {¤		for (Iterator<?> it = commentList.iterator(); it.hasNext();) {¤			Comment comment = (Comment)it.next();¤			this.addComment2HtmlCommentsMap(comment);¤			this.addChildren2HtmlCommentsMap(comment.getChildren());¤		}¤	}¤¤	private long contentId = 0L;¤	public void setId (String id) {¤		this.contentId = Long.valueOf (id);¤	}¤¤	private boolean collapseBranch = true;¤	public void setCollapse (String collapse) {¤		this.collapseBranch = Boolean.valueOf (collapse);¤	}¤¤	private String showArchiveComments = null;¤	public void setShowArchiveComments (String showArchiveComments) {¤		this.showArchiveComments = showArchiveComments;¤	}¤¤	private CommentManager commentManager = null;¤	public void setCommentManager (CommentManager commentManager) {¤		this.commentManager = commentManager;¤	}¤¤	private String responseContent = null;¤	public String getResponseContent () {¤		return this.responseContent;¤	}¤¤	private WikiStyleRenderer wikiStyleRenderer = null;¤	public void setWikiStyleRenderer(WikiStyleRenderer wikiStyleRenderer) {¤		this.wikiStyleRenderer = wikiStyleRenderer;¤	}¤	private PermissionManager permissionManager = null;¤	public void setPermissionManager (PermissionManager permissionManager) {¤		this.permissionManager = permissionManager;¤	}¤	¤¤	private PersonalInformationManager personalInformationManager = null;¤	public void setPersonalInformationManager (PersonalInformationManager personalInformationManager) {¤		this.personalInformationManager = personalInformationManager;¤	}¤¤	private DiscussionManager discussionManager = null;¤	private DiscussionManager getDiscussionManager () {¤		if (this.discussionManager == null) {¤			this.discussionManager = (DiscussionManager)ContainerManager.getComponent(¤				"ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager"¤			);¤			if (this.discussionManager == null) {¤				Logs.LOG_E("CommentBranchStateActionPlugin::getDiscussionManager: can not find OpenDiscussionManager");¤			}¤		}¤		return this.discussionManager;¤	}¤¤    public ThemeHelper getHelper()¤    {¤        return new PageHelper();¤    }¤¤	public String getXHtmlBody(final Comment comment){¤		return ContentEntityObjectCache.Factory.get(GarantViewPageAction.getCommentsCachedKey(comment.getContent())).get(comment.getId());¤    }¤¤	public static boolean canRemoveComment(User user, Comment comment){¤		return GarantViewPageAction.canRemoveComment(user, comment);¤	}¤    //#UC END# *4729BB88003E_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039007120"))
	    quid       	"4729BB88003E"
	    documentation 	"Поддержка экшена для реализации смены состояния свернутости/развернутости ветки комментариев."
	    stereotype 	"KActionPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"4729BBB50000"
		    supplier   	"Logical View::external::JavaConfluence::ConfluenceClassPack::ConfluenceActionSupport"
		    quidu      	"465ADCCA036B"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006351143"))
		    quid       	"4729BBB8035B"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionManager"
		    quidu      	"468F4EC30177"))
	    language   	"MDA Generator")
	(object Class "CommentBranchStateXWorkPlugin"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin|4729BD22000F
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"NESTED GENERATED WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage/SetCollapseState|477CE41200C7::4729BDBB00CB;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage/setCollapseState|477CE41200C7::4729BDBB00CB;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage|4729BDBB00CB::4729BDBB00CB
		    ))
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039004336"))
	    quid       	"4729BD22000F"
	    documentation 	"Поддержка экшена для реализации смены состояния свернутости/развернутости ветки комментариев."
	    stereotype 	"KXWorkPlugin"
	    language   	"MDA Generator"
	    nestedClasses 	(list nestedClasses
		(object Class "CommentBranchStateXPackage"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"WikiPageID (wiki)"
			    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage|4729BDBB00CB
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"output.xml:*4729BDBB00CB_PACKAGE_CONTENT*"
			    value      	(value Text 
|<!--UC_BEGIN*4729BDBB00CB_PACKAGE_CONTENT*-->¤                        <default-interceptor-ref name="validatingStack"/>¤¤			<action name="setCollapseState" class="ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.CommentBranchStateActionPlugin" method="setCollapseState">¤                             <result name="success" type="velocity-xml">/AjaxResponse.xml</result>¤                             <result name="error" type="rawText" />¤			</action>¤			<!--UC_END*4729BDBB00CB_PACKAGE_CONTENT*-->
			    ))
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"def-interceptor"
			    value      	"validatingStack")
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"need UC"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"NESTED GENERATED WikiPageID (wiki)"
			    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage/SetCollapseState|477CE41200C7::477CE41200C7;MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage/setCollapseState|477CE41200C7::477CE41200C7
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"SourceType (wiki)"
			    value      	"wiki")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19039005689"))
		    quid       	"4729BDBB00CB"
		    documentation 	"Поддержка экшена для реализации смены состояния свернутости/развернутости ветки комментариев."
		    stereotype 	"XPackage"
		    nestedClasses 	(list nestedClasses
			(object Class "SetCollapseState"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"setCollapseState")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/CommentBranchStateXWorkPlugin/CommentBranchStateXPackage/SetCollapseState|477CE41200C7
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039011551"))
			    quid       	"477CE41200C7"
			    documentation 	"документация отсутствует"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006353470"))
				    quid       	"477CE43701E3"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::CommentBranchStateActionPlugin"
				    quidu      	"4729BB88003E"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator User Properties"
					    name       	"xml_name"
					    value      	"ConfluencePlugins/AjaxResponse.xml")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006352614"))
				    quid       	"477CE41C02E9"
				    stereotype 	"velocity-xml"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19006353023"))
				    quid       	"477CE4270086"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))))))
	(object Class "GarantViewPageAction"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/GarantViewPageAction|47B2B67300EB
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/GarantViewPageAction.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*47B2B67300EB_CUSTOM_IMPORT*"
		    value      	"//#UC START# *47B2B67300EB_CUSTOM_IMPORT*¤import java.util.*;¤import java.util.regex.Matcher;¤import java.util.regex.Pattern;¤import ru.garant.shared.ConfluenceCore.ActionSupport.ActionContext;¤import ru.garant.shared.ConfluenceCore.ActionSupport.ActionContextThreadLocalFactory;¤import ru.garant.MDProcess.ConfluencePlugins.ArchiveCommentSupport.ArchiveCommentAction;¤import ru.garant.MDProcess.ConfluencePlugins.CommonVelocityContext.GlobalHelper;¤¤import net.sf.hibernate.*;¤¤import org.springframework.orm.hibernate.SessionFactoryUtils;¤¤import com.atlassian.confluence.pages.*;¤import com.atlassian.confluence.plugin.descriptor.web.DefaultWebInterfaceContext;¤import com.atlassian.confluence.plugin.descriptor.web.WebInterfaceContext;¤import com.atlassian.confluence.plugin.descriptor.web.conditions.ViewingContentCondition;¤import com.atlassian.confluence.renderer.PageContext;¤import com.atlassian.confluence.renderer.radeox.macros.MacroUtils;¤import com.atlassian.confluence.security.*;¤import com.atlassian.confluence.setup.bandana.ConfluenceBandanaContext;¤import com.atlassian.confluence.spaces.*;¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤import com.atlassian.confluence.util.GeneralUtil;¤import com.atlassian.confluence.util.SpaceComparator;¤import com.atlassian.confluence.util.velocity.VelocityUtils;¤import com.atlassian.confluence.velocity.htmlsafe.HtmlSafe;¤¤import org.apache.commons.lang.StringUtils;¤¤import ru.garant.MDProcess.ConfluencePlugins.Entities.ContentEntityObjectCache;¤import ru.garant.MDProcess.ConfluencePlugins.EntitySupport.GarantAbstractJobWithLock;¤import ru.garant.MDProcess.ConfluencePlugins.FilterPanel.Item;¤import ru.garant.MDProcess.ConfluencePlugins.FilterPanel.PreDefinedForm;¤import ru.garant.MDProcess.ConfluencePlugins.IconsSelectorSupport.IconSelectorInVelocity;¤import ru.garant.MDProcess.ConfluencePlugins.Search.SearchQuery;¤import ru.garant.MDProcess.ConfluencePlugins.Search.SearchQueryData;¤import ru.garant.MDProcess.ConfluencePlugins.Search.UnsupportedQueryDataException;¤import ru.garant.MDProcess.ConfluencePlugins.UserData.UserData;¤import ru.garant.MDProcess.ConfluenceMDChange.RequestDashboardSupport.DashboardScriptsCache;¤import ru.garant.MDProcess.ConfluenceMDChange.RequestSearch.RequestSearchQueryData;¤import ru.garant.MDProcess.ConfluenceMDChange.RequestSearchSupportTypes.RequestSearchQueryResultType;¤import ru.garant.MDProcess.ConfluenceMDChange.RequestSupport.RequestHelper;¤import ru.garant.MDProcess.ConfluenceMDChange.Requests.CommonRequestManager;¤import ru.garant.MDProcess.DocCardChange.DocCardCommon.DocCardManager;¤import ru.garant.MDProcess.DocCardChange.DocCardSupport.DpoUvsHelper;¤¤import com.atlassian.confluence.event.events.content.blogpost.BlogPostViewEvent;¤import com.atlassian.confluence.event.events.content.page.PageEvent;¤import com.atlassian.confluence.event.events.content.page.PageViewEvent;¤import com.atlassian.confluence.labels.Label;¤import com.atlassian.confluence.labels.Labelable;¤import com.atlassian.confluence.labels.Labelling;¤import com.atlassian.event.EventManager;¤import com.atlassian.user.User;¤¤//#UC END# *47B2B67300EB_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*47B2B67300EB_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *47B2B67300EB_CUSTOM_CLASS_DEFINITION*¤//#UC END# *47B2B67300EB_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*47B2B67300EB_ACTION_NAME*"
		    value      	(value Text 
|//#UC START# *47B2B67300EB_ACTION_NAME*¤		return null;¤		//#UC END# *47B2B67300EB_ACTION_NAME*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*47B2B67300EB_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *47B2B67300EB_CUSTOM_METHODS_AND_DATA*¤	¤¤	private BlogPost nextPostBriefing;¤    private BlogPost previousPostBriefing;¤    private String nameLabelPage;¤    ¤    public String getNameLabelPage()¤    {¤    	if(!getPage().getLabels().isEmpty())¤    		nameLabelPage = (getPage().getLabels().get(0)).getName();¤    	else ¤    		nameLabelPage = "";¤    	¤    	return nameLabelPage;¤    }¤¤    ¤	public BlogPost getNextPostBriefing() {¤		Label briefingNextLabel = null;¤		Label labelPage = null;¤		if (nextPostBriefing == null) {¤			nextPostBriefing = super.getNextPost();¤			if (nextPostBriefing != null) {¤				if(!getPage().getLabels().isEmpty())¤					labelPage = getPage().getLabels().get(0);¤				¤				if(!nextPostBriefing.getLabels().isEmpty())¤					briefingNextLabel = nextPostBriefing.getLabels().get(0);¤				¤				if (labelPage != null && labelPage.getName().equals("briefing"))¤					while (nextPostBriefing != null && (briefingNextLabel == null || !briefingNextLabel.getName().equals("briefing"))) ¤					{¤						nextPostBriefing = pageManager.findNextBlogPost(nextPostBriefing);¤						if(nextPostBriefing != null && !nextPostBriefing.getLabels().isEmpty())¤							briefingNextLabel = nextPostBriefing.getLabels().get(0);¤					}¤			}¤		}¤¤		return nextPostBriefing;¤	}¤¤	public BlogPost getPreviousPostBriefing() {¤		Label briefingPreviousLabel = null;¤		Label labelPage = null;¤		if (previousPostBriefing == null) {¤			previousPostBriefing = super.getPreviousPost();¤			if (previousPostBriefing != null) {¤				if(!getPage().getLabels().isEmpty())¤					labelPage = getPage().getLabels().get(0);¤				¤				if(!previousPostBriefing.getLabels().isEmpty())¤					briefingPreviousLabel = previousPostBriefing.getLabels().get(0);¤				¤				if (labelPage != null && labelPage.getName().equals("briefing"))¤					while (previousPostBriefing != null	&& (briefingPreviousLabel == null || !briefingPreviousLabel.getName().equals("briefing"))) ¤					{¤						previousPostBriefing = pageManager.findPreviousBlogPost(previousPostBriefing);¤						if(previousPostBriefing != null	&& !previousPostBriefing.getLabels().isEmpty())¤							briefingPreviousLabel = previousPostBriefing.getLabels().get(0);¤					}¤			}¤		}¤		return previousPostBriefing;¤	}¤	¤	private PreDefinedForm filterChildrenPanel_ = null;¤	¤	private PreDefinedForm getFilterChildrenPanel() {¤		if(filterChildrenPanel_ == null)¤			filterChildrenPanel_ = PreDefinedForm.Factory.make(getRemoteUser(), getSpace(), "page_children");¤		return filterChildrenPanel_;¤	}¤	¤	@Override¤	public List getPermittedChildren () {¤		if(permittedChidren_.size() == 0){¤			List result = getPermittedChildrenForFiltering();¤¤			if(isOGVPage()){¤				permittedChidren_ = result;¤			}else{¤				Collections.sort(result);¤				List res1 = new LinkedList();¤				List res2 = new LinkedList();¤¤				for (Object child : result) {¤					if (child instanceof Page) {¤						Page page = (Page) child;¤						if (CommonRequestManager.Factory.get().isRequest(page.getId())) {¤							res2.add(child);¤						} else {¤							res1.add(child);¤						}¤					}¤				}¤				res1.addAll(res2);¤				permittedChidren_ = res1;¤			}¤		}¤		return permittedChidren_;¤	}¤	¤	public long getPermittedChildrenSize () {¤		return getPageChildrenSize(getPage().getId());¤	}¤	¤	private List permittedChidren_ = new LinkedList();¤	¤	public boolean isPageOGV(){¤		if(getPage().getLabels().contains(DpoUvsHelper.getOGVLabel())){¤			return true;			¤		}¤		return false;¤	}¤	¤	public String getDocCardsList(long ogvId){¤		return	GlobalHelper.getBaseUrl() + ¤				"/ru/garant/MDProcess/DocCardChange/DocCardSupport/DocCardXPlugin/DocCardXPackage/searchuvsquery.action?docIssuer=" + ogvId;¤	}¤	¤	public List<Item> getActiveFilterItems() {¤		if(getPage().getLabels().contains(DpoUvsHelper.getOGVLabel())){¤			return new ArrayList<Item>();¤		}¤		processIncommingFilterItemId();¤		if (StringUtils.isEmpty(filterItemId_)){¤			childrenFilter();¤		}¤		¤		createFilteredChildrenAndModifyFilterItems();¤		¤		List<Item> filterItems = getFilterChildrenPanel().getItems();¤		List<Item> result = new ArrayList<Item>(filterItems.size());¤		¤		for(Item item : filterItems) {¤			if(!item.getDisabled())¤				result.add(item);¤		}¤		¤		return result;¤	}¤	¤	public boolean getFilterItemNewCheckedState(String filterItemId) {¤		Item filterItem = findFilterItem(filterItemId);¤		if(filterItem != null)¤			return !filterItem.getChecked();¤		return false;¤	}¤	¤	public boolean hasRemoveCommentPermissionForSpace(){¤		List<String> removeComment = new ArrayList<String>();¤		removeComment.add(SpacePermission.REMOVE_COMMENT_PERMISSION);¤		return super.hasPermissionForSpace(removeComment, getPage().getSpace());¤	}¤	¤	@Override¤	public WebInterfaceContext getWebInterfaceContext () {¤		DefaultWebInterfaceContext result = new DefaultWebInterfaceContext(super.getWebInterfaceContext());¤		result.setParameter(ViewingContentCondition.CONTEXT_KEY, Boolean.TRUE);¤		return result;¤	}¤	¤	private void processIncommingFilterItemId () {¤		if (StringUtils.isEmpty(filterItemId_))¤			return;¤		¤		Item filterItem = findFilterItem(filterItemId_);¤	}¤	¤	private Item findFilterItem (String id) {¤		for (Item filterItem : getFilterChildrenPanel().getItems()) {¤			if (filterItem.getId().equals(id)) {¤				return filterItem;¤			}¤		}¤		return null;¤	}¤	¤	private boolean hasOneOfLabels(Labelable labelable, List<String> labels) {¤		List<Label> currentLabels = labelable.getLabels();¤		for(Label curLabel : currentLabels) {¤			String curLabelName = curLabel.getName();¤			for(String labelName : labels)¤				if(curLabelName.startsWith(labelName))¤					return true;¤		}¤		return false;¤	}¤	¤	private void createFilteredChildrenAndModifyFilterItems() {¤		List<Item> filterItems = getFilterChildrenPanel().getItems();¤		List<Object> listChilds = (List<Object>)getPermittedChildrenForFiltering();¤			¤		for(Item item : filterItems) {¤			int filtratedCount = 0;¤			int totalCount = 0;¤			List<String> labelsToFilterBy = item.getFilterLabels();¤			List<Labelable> childToRemove = new ArrayList<Labelable>();¤			for (Object child : listChilds) {¤					if(child instanceof Labelable) {¤						Labelable labelable = (Labelable) child;¤						if(needToFiltrate(labelable, labelsToFilterBy, item.getId())) {¤							childToRemove.add(labelable);¤							filtratedCount++;¤						}¤					}¤					totalCount++;¤				}¤				if(childToRemove.size() > 0 && item.getId().equals(filterItemId_)){¤					getPermittedChildren ().removeAll(childToRemove);¤					getPermittedChildrenForFiltering().removeAll(childToRemove);¤				}	¤				item.setTitle(String.format(item.getTitle(), Integer¤						.toString(totalCount - filtratedCount)));¤				if(item.getId().equals(filterItemId_))¤					item.setDisabled(true);¤			}¤	}¤	¤	private boolean needToFiltrate(Labelable labelable, List<String> labelsToFilterBy, String itemId) {¤		if(labelsToFilterBy.size() == 0) return false;¤¤		boolean hasOneOfLabels = hasOneOfLabels(labelable, labelsToFilterBy);¤		¤		if(itemId.equals("persistent_requests"))¤			return !hasOneOfLabels;¤		else¤			return hasOneOfLabels;¤	}¤	¤	private boolean isOGVPage(){¤		if(getPage().getLabels().contains(DpoUvsHelper.getOGVLabel())){¤			return true;¤		}¤		return false;¤	}¤	¤	private List permittedChildren_ = null;¤	private List getPermittedChildrenForFiltering() {¤		if(permittedChildren_ == null){¤			boolean flagExistOGV = isOGVPage();¤			boolean flagIsDocCard = DpoUvsHelper.isDocCard(getPage().getId());¤			boolean flagIsUvsQuery = DpoUvsHelper.isUvsQuery(getPage().getId());¤			List children;¤			if(flagExistOGV){¤				children = getPermittedChildrenAttributesForPageNoPermissions();¤			}else if(flagIsDocCard || flagIsUvsQuery){¤					children = getPermittedChildrenForPageNoPermissions();¤			}else{¤				children = super.getPermittedChildren();¤			}¤			permittedChildren_ = children;¤		}	¤		return permittedChildren_;¤	}¤	¤	private List getPermittedChildrenAttributesForPageNoPermissions(){¤        // Fix for CONF-3846¤        if (!(getPage() instanceof Page))¤            return Collections.EMPTY_LIST;¤¤        if (getPage() instanceof Page)¤        {¤            return getGarPageChildrenAttributes(getPage().getId(), getGarPageChildrenLabels(getPage().getId()));¤        }¤        else¤        {¤        	return Collections.EMPTY_LIST;¤        }¤	}¤	¤	public static class OGVAttributes{¤		private long id;¤		private String title;¤		private String urlPath;¤		private List<String> labelNames = new ArrayList<String>();¤		¤		public OGVAttributes(long initId, String initTitle, String initUrlPath, List<String> initLabels){¤			id = initId;¤			title = initTitle;¤			urlPath = initUrlPath;¤			labelNames = initLabels;¤		}¤		¤		public long getId(){¤			return id;¤		}¤¤		public String getTitle(){¤			return title;¤		}¤¤		public String getUrlPath(){¤			return urlPath;¤		}¤¤		public List<String> getLabelNames(){¤			return labelNames;¤		}¤	}¤	¤	public static List getGarPageChildrenAttributes(long pageId, Map<Long, List<String>> idsAndLabels){¤		long time = new Date().getTime();¤		Session session = ContainerManager.Factory.get().getSession();¤		Map<Long, OGVAttributes> mapa = new HashMap<Long, OGVAttributes>();¤		String sQuery = "select page.id, page.title " +¤				"from Page page " +¤				"where page.contentStatus='current' " +¤				"and page.originalVersion is null " +¤				"and page.parent.id=" + pageId + " " +¤				"order by page.title asc";¤		Logs.LOG_W("START execute list query:" + sQuery);¤		try {¤			Query q = session.createQuery(sQuery);¤			List pagesAttrs = q.list();¤			for(Object pageAttr : pagesAttrs){¤				Object[] objs = (Object[])pageAttr;¤				long id = (Long)objs[0];¤				OGVAttributes attr = new OGVAttributes(id, (String)objs[1], "/pages/viewpage.action?pageId=" + id, idsAndLabels.get(id));¤				mapa.put(id, attr);¤			}¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤		Logs.LOG_W("FINISH execute, find " + mapa.size() + " items, in " + (new Date().getTime() - time) + " ms");¤		List res = Arrays.asList(mapa.values().toArray());¤		Collections.sort(res, new Comparator<Object> () {¤			@Override¤			public int compare(Object arg0, Object arg1) {¤				return ((OGVAttributes)arg0).getTitle().compareTo(((OGVAttributes)arg1).getTitle());¤			}				   ¤		});¤		return res;¤	}¤¤	public static Map<Long, List<String>> getGarPageChildrenLabels(long pageId){¤		long time = new Date().getTime();¤		Session session = ContainerManager.Factory.get().getSession();¤		List<String> labels = new ArrayList<String>();¤		Map<Long, List<String>> mapa = new HashMap<Long, List<String>>();¤		String sQuery = "select page.id, labellings.label.name " +¤				"from Page page left outer join page.labellings as labellings " +¤				"where page.contentStatus='current' " +¤				"and page.originalVersion is null " +¤				"and labellings.content.id=page.id " + ¤				"and page.parent.id=" + pageId;¤		Logs.LOG_W("START execute list query:" + sQuery);¤		Set<String> labelNames = new HashSet<String>();¤		try {¤			Query q = session.createQuery(sQuery);¤			List pagesAttrs = q.list();¤			for(Object pageAttr : pagesAttrs){¤				Object[] objs = (Object[])pageAttr;¤				long id = (Long)objs[0];¤				labels = mapa.get(id);¤				if(labels == null){¤					labels = new ArrayList<String>();¤					mapa.put(id, labels);¤				}¤				labels.add((String)objs[1]);¤				labelNames.add((String)objs[1]);¤			}¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤		saveInActionContextLabelIcons(labelNames);¤		¤		Logs.LOG_W("FINISH execute, find " + mapa.size() + " items, in " + (new Date().getTime() - time) + " ms");¤		return mapa;¤	}¤¤	public static void saveInActionContextLabelIcons(Set<String> labelNames){¤		ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤    	if(context == null){¤    		return;¤    	}¤    	Map<String, String> images = new HashMap<String, String>();¤    	for(String labelName : labelNames){¤    		String imagePath = IconSelectorInVelocity.getIconForOGVChildren(labelName);¤    		images.put(labelName, imagePath);¤    	}¤		context.put(LABELS_IMAGES_LIST_KEY, images);¤¤	}¤	¤	public static String getLabelPath(String labelName){¤		ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤    	if(context == null){¤    		return null;¤    	}¤    	Map<String, String> images = (Map<String, String>)context.get(LABELS_IMAGES_LIST_KEY);¤    	if(images != null){¤    		return images.get(labelName);¤    	}¤    	return null;¤	}¤	¤	final public static String LABELS_IMAGES_LIST_KEY = "GarantViewPageAction.LABELS_IMAGES_LIST_KEY";¤	¤	private List getPermittedChildrenForPageNoPermissions()¤    {¤        // Fix for CONF-3846¤        if (!(getPage() instanceof Page))¤            return Collections.EMPTY_LIST;¤¤        if (getPage() instanceof Page)¤        {¤            return getGarPageChildren(getPage().getId());¤        }¤        else¤        {¤        	return Collections.EMPTY_LIST;¤        }¤    }¤¤	public static List getGarPageChildren(long pageId){¤		long time = new Date().getTime();¤		Session session = ContainerManager.Factory.get().getSession();¤		List pages = new ArrayList();¤		String sQuery = "select page " +¤				"from Page page " +¤				"where page.contentStatus='current' " +¤				"and page.originalVersion is null " +¤				"and page.parent.id=" + pageId + " " +¤				"order by page.title asc";¤		Logs.LOG_W("START execute list query:" + sQuery);¤		try {¤			Query q = session.createQuery(sQuery);¤			pages = q.list();¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤		Logs.LOG_W("FINISH execute, find " + pages.size() + " items, in " + (new Date().getTime() - time) + " ms");¤		return pages;¤	}¤    ¤	public int getPageChildrenSize(long pageId){¤		long time = new Date().getTime();¤		Session session = ContainerManager.Factory.get().getSession();¤		Integer count = 0;¤		String sQuery = "select count(page.parent.id) " +¤				"from Page page " +¤				"where page.contentStatus='current' " +¤				"and page.originalVersion is null " +¤				"and page.parent.id=" + pageId + " ";¤		Logs.LOG_W("START execute list query:" + sQuery);¤		try {¤			Query q = session.createQuery(sQuery);¤			count = (Integer)q.uniqueResult();¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤		Logs.LOG_W("FINISH execute, find 1 item, in " + (new Date().getTime() - time) + " ms");¤		return count;¤	}¤¤	private CommentsData commentsData_ = null;¤	¤	public CommentsData getCommentsData () throws Exception {¤		if (commentsData_ == null) {¤			commentsData_ = new CommentsData (getPageId());¤		}¤		return commentsData_;¤	}¤	¤	public static class CommentsData {¤		private Map<Comment, List<Comment>> rootComments_ = new HashMap<Comment, List<Comment>> ();¤ 		private UnreadComments unreadComments_ = null;¤		private int commentsCount_ = 0;¤		¤		public int getCount () {¤			return commentsCount_;¤		}¤		¤		public List getTopLevel() {¤			List topLevelComments = new ArrayList();¤			List<Comment> tlc = rootComments_.get(null);¤			if (tlc != null && tlc.size() > 0) {¤				for (Iterator<Comment> it = tlc.iterator(); it.hasNext();) {¤					topLevelComments.add(it.next());¤				}¤			}¤			return topLevelComments;¤		}¤		¤		public int getCountUnviewed (Comment parentComment) {¤			return getUnviewedDescendantsCount (parentComment);¤		}¤		¤		private boolean isUnviewed (long id) {¤			if (unreadComments_ != null¤				&& unreadComments_.getComments() != null¤				&& unreadComments_.getComments().contains(id)¤			) {¤				return true;¤			}¤			return false;¤		}¤		¤		public boolean isViewed (Comment comment) {¤			return !isUnviewed(comment.getId());¤		}¤		¤		public int getCommentChildrenSize (Comment comment) {¤			List<Comment> childs = rootComments_.get(comment);¤			if(childs == null){¤				return 0;¤			}¤			return childs.size();¤		}¤¤		public List<Comment> getCommentChildren (Comment comment) {¤			List<Comment> childs = rootComments_.get(comment);¤			if(childs == null){¤				return new ArrayList<Comment>();¤			}¤			return childs;¤		}¤¤		private int getUnviewedDescendantsCount (Comment parentComment) {¤			int ret = 0;¤			List<Comment> childs = rootComments_.get(parentComment);¤			if (childs != null && childs.size() > 0) {¤				for (Iterator<Comment> it = childs.iterator(); it.hasNext();) {¤					Comment comment = it.next();¤					if (isUnviewed(comment.getId())) {¤						ret++;¤					}¤					ret += getUnviewedDescendantsCount (comment);¤				}¤			}¤			return ret;¤		}¤		¤		public boolean isCollapsed (Comment comment) {¤			if (unreadComments_ != null && unreadComments_.isCollapsed(comment.getId())) {¤				return true;¤			}¤			return false;¤		}¤		¤		public CommentsData (long pageId) {¤			Date sd = new Date ();¤	    	Logs.LOG_D("GarantViewPageAction::CommentsData - start make comment tree");¤	    	String sQuery = "select comment from Comment as comment" ¤				+ " where comment.page.id = " + pageId ¤				+ " and comment.page.contentStatus = 'current'"¤				+ " and comment.page.originalVersion is null";¤			try {¤				Session session = ContainerManager.Factory.get().getSession();¤				Query query = session.createQuery(sQuery);¤				//query.setCacheable(true);¤				List<Comment> res = query.list();¤				Map<Long, List<Comment>> commentIdsMap = new HashMap<Long, List<Comment>>();¤				List<Long> commentIdsList = new ArrayList<Long>();¤				commentsCount_ = res.size();¤				for (Comment child : res) {¤//					Comment parent = (Comment)cur[1];¤//					Comment child = (Comment)cur[0];¤					Comment parent = child.getParent();¤					List<Comment> childs = rootComments_.get(parent);¤					if (childs == null) {¤						childs = new ArrayList<Comment>();¤						rootComments_.put(parent, childs);¤						commentIdsMap.put((parent != null)?parent.getId():null, childs);¤					}¤					childs.add(child);¤					commentIdsList.add(child.getId());¤				}¤				¤		    	ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤		    	¤		    	context.put(IS_HAS_CHILDREN, commentIdsMap);¤		    	context.put(ALL_COMMENTS_IDS, commentIdsList);¤¤				String userName = com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUsername();¤				if (userName != null) {¤					UnreadDiscussion ud = (UnreadDiscussion)session.get(UnreadDiscussion.class, pageId);¤					if (ud != null) {¤						unreadComments_ = ud.getUnreadComments(userName);¤					}¤				}¤			} catch (HibernateException e) {¤				Logs.LOG_SEX(e);¤			} ¤	    	Logs.LOG_D("GarantViewPageAction::CommentsData - finish make comment tree ("¤	    		+ Long.valueOf(new Date().getTime()-sd.getTime()).toString()¤	    		+ "ms)"¤	    	);			¤		}		¤	}¤¤	public final static String IS_HAS_CHILDREN = "GarantViewPageAction.IS_HAS_CHILDREN"; ¤	public final static String IS_ARCHIVE_COMMENT = "GarantViewPageAction.IS_ARCHIVE_COMMENT"; ¤	public final static String IS_SUMMARY_COMMENT = "GarantViewPageAction.IS_SUMMARY_COMMENT";¤	public final static String SUMMARY_RENDER_TIME = "GarantViewPageAction.SUMMARY_RENDER_TIME"; ¤	public final static String SUMMARY_RENDER_COUNT = "GarantViewPageAction.SUMMARY_RENDER_COUNT";¤	public final static String ALL_COMMENTS_IDS = "GarantViewPageAction.ALL_COMMENTS_IDS";¤¤	¤	public void makeAllInformationAboutComments(long pageId){¤		long time = new Date().getTime();¤		ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤		List<Long> commentIds = (List<Long>)context.get(ALL_COMMENTS_IDS);¤		if(commentIds == null || commentIds.size() == 0){¤			return;¤		}¤		String sqlString = "SELECT " +¤							"l.content.id, " +¤							"l.label.id " +¤							"FROM Labelling l " +¤							"WHERE l.content.id in (:commentIds) " + ¤							"and l.label.id in (28, 34)";¤							//"and l.label.name in ('" + ArchiveCommentAction.ARCHIVE_COMMNET_LABEL + "','" + DiscussionManager.COMMENT_SUMMARY_LABEL + "')";¤		Set<Long> archivecomments = new HashSet<Long>();¤		Set<Long> summarycomments = new HashSet<Long>();¤		try {¤			Query q = ContainerManager.Factory.get().getSession().createQuery(sqlString);¤			q.setParameterList("commentIds", commentIds);¤			List res = q.list();¤¤			for(Object obj : res){¤				Object[] objs = (Object[])obj;¤				Long key = (Long)objs[0];¤				Long labelId = (Long)objs[1];¤				if(labelId == 28){¤					archivecomments.add(key);¤				}else if(labelId == 34){¤					summarycomments.add(key);¤				}¤			}¤		} catch (HibernateException e) {¤			Logs.LOG_I("ERROR! " + e);¤		}¤//		Logs.LOG_W("GarantViewPageAction::makeAllInformationAboutComments::archivecommentssize: " + archivecomments.size() + " summarycommentssize=" + summarycomments.size());¤    	¤    	context.put(IS_ARCHIVE_COMMENT, archivecomments);¤    	context.put(IS_SUMMARY_COMMENT, summarycomments);¤¤		Logs.LOG_W("GarantViewPageAction::makeAllInformationAboutComments::user=" + AuthenticatedUserThreadLocal.getUsername() + " pageId=" + pageId + " commentsSize=" + commentIds.size() + " sql=" + sqlString + " time=" + (new Date().getTime() - time));¤	}¤	/*¤	private static final byte UNDEFINED_REMOVE_COMMENT = 0;¤	private static final byte CAN_REMOVE_COMMENT = 1;¤	private static final byte CAN_NOT_REMOVE_COMMENT = 2;¤	private static Map<String, Byte> removeCommentFlag_ = new HashMap<String, Byte>();¤	*/¤	public static boolean canRemoveComment(User user, Comment comment){¤/*		if(removeCommentFlag_.get(user.getName()) == UNDEFINED_REMOVE_COMMENT){¤			if(new PermissionHelper(ContainerManager.Factory.get().getPermissionManager(), null).canRemove(user, comment)){¤				removeCommentFlag_.put(user.getName(), CAN_REMOVE_COMMENT);¤			}else{¤				removeCommentFlag_.put(user.getName(), CAN_NOT_REMOVE_COMMENT);¤			}¤		}¤		return (removeCommentFlag_.get(user.getName()) == CAN_REMOVE_COMMENT);¤		*/¤		return new PermissionHelper(ContainerManager.Factory.get().getPermissionManager(), null).canRemove(user, comment);¤	}¤	¤	public String execute () throws Exception {¤    	long start = System.currentTimeMillis();¤    	Logs.LOG_W("GarantViewPageAction::execute::start");¤    	getCommentsData ();¤    	makeAllInformationAboutComments(getPage().getId());¤/*    	¤    	ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤    	context.put(IS_HAS_CHILDREN, makeCommentTree(getPage().getId()));¤    	context.put(IS_ARCHIVE_COMMENT, makeArchiveComments(getPage().getId()));¤    	context.put(IS_SUMMARY_COMMENT, makeSummaryComments(getPage().getId()));¤*/    	¤    	Logs.LOG_W("GarantViewPageAction::execute::makeForCommentsInformation: " + (System.currentTimeMillis()-start));¤    	start = System.currentTimeMillis();¤    	if (getPage() instanceof Page) {¤    		EventManager em = ContainerManager.Factory.get().getEventManager();¤    		em.publishEvent(new PagePreViewEvent(getPage(), (Page) getPage()));¤    	}¤    	Logs.LOG_W("GarantViewPageAction::execute::publishEvent: " + (System.currentTimeMillis()-start));¤    	¤    	¤    	start = System.currentTimeMillis();¤    	String result = super.execute();¤/*¤    	if (getPage() != null && getPage().getSpace() == null && getPage().isLatestVersion())¤        {¤            addActionError(getText("error.corrupt.page", new Object[] {"" + getPage().getId(), getPage().getContent()}));¤¤            return ERROR;¤        }¤¤        pageContent = getPage().getContent();¤¤        // render page¤        PageContext context = getPage().toPageContext();¤¤        pageXHtmlContent = convertPageBody();//wikiStyleRenderer.convertWikiToXHtml(context, getPage().getContent());¤        externalReferences = context.getExternalReferences();¤¤        addToHistory(getPage());¤¤        if (getFocusedCommentId() != 0 && isThreadComments())¤            focusOnComment(findCommentInPage(getFocusedCommentId()));¤¤        if (getFocusedCommentId() != 0 || rootCommentId != 0 || getComment() != null)¤            setShowComments(Boolean.TRUE);¤¤        if (getPage() instanceof Page)¤            eventManager.publishEvent(new PageViewEvent(this, (Page) getPage()));¤        else if (getPage() instanceof BlogPost)¤            eventManager.publishEvent(new BlogPostViewEvent(this, (BlogPost) getPage()));¤¤        String result = getPage().getType();¤*/¤    	Logs.LOG_W("GarantViewPageAction::execute::super: " + (System.currentTimeMillis()-start));¤    	return result;¤    }¤	/*¤    public List getExternalReferences()¤    {¤        return externalReferences;¤    }¤¤	¤    public Comment getRootComment()¤    {¤        if (rootComment == null && rootCommentId != 0)¤            rootComment = findCommentInPage(rootCommentId);¤¤        return rootComment;¤    }¤¤    ¤    private void focusOnComment(Comment focusedComment)¤    {¤        if (focusedComment != null && focusedComment.getDepth() >= 4)¤        {¤            rootComment = focusedComment.getParent();¤            if (rootComment.getDescendantsCount() < 10)¤                rootComment = rootComment.getParent();¤        }¤    }¤¤    public void setRootCommentId(long rootCommentId)¤    {¤        this.rootCommentId = rootCommentId;¤    }¤¤    private Comment findCommentInPage(long commentId)¤    {¤        Comment myComment = null;¤        for (Comment comment : getPage().getComments())¤        {¤            if (comment.getId() == commentId)¤            {¤                myComment = comment;¤                break;¤            }¤        }¤        return myComment;¤    }¤¤¤    @HtmlSafe¤    public String getPageXHtmlContent()¤    {¤        return pageXHtmlContent;¤    }¤*/¤    public static class PagePreViewEvent extends PageEvent {¤		/**¤		 * ¤		 */¤		private static final long serialVersionUID = 6480252261267964960L;¤¤		public PagePreViewEvent (Object src, Page page) {¤			super (src, page);¤		}¤	}¤¤	@Override¤	public List getAvailableSpaces () {¤		User user = com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUser();¤		List<Space> permittedSpacesForUser = new ArrayList<Space>();¤		List<Space> availableSpaces = new ArrayList<Space>();¤		Space personalSpace = spaceManager.getPersonalSpace(user);¤¤		if (GeneralUtil.isSuperUser(user)) {¤			availableSpaces = spaceManager.getSpacesByType(SpaceType.GLOBAL);¤		} else {¤			permittedSpacesForUser = spaceManager.getPermittedSpacesByType(user, SpaceType.GLOBAL);¤¤			for (Space permSpace : permittedSpacesForUser) {¤				if (spacePermissionManager.hasPermission(SpacePermission.COMMENT_PERMISSION, permSpace, user))¤					availableSpaces.add(permSpace);¤			}¤		}¤		if (personalSpace != null && !availableSpaces.contains(personalSpace)) {¤			availableSpaces.add(personalSpace);¤		}¤¤		Collections.sort(availableSpaces, new SpaceComparator());¤		return availableSpaces;¤	}¤	¤	protected String getChildrenFilter () {¤		try {¤			return (String) UserData.Factory.get(getRemoteUser().getName(), "DefaultFilterViewChildrenParameters")¤					.getData();¤		}¤		catch (Exception e) {¤			Logs.LOG_E("AbstractDashboardTasksContextBuilderS::groupBySpace - can't get defaults - " + e);¤			return new String();¤		}¤	}¤¤	protected void childrenFilter () {¤		if(getChildrenFilter().equals("ALL_CHILDREN")){¤			filterItemId_ = "persistent_all_pages";¤		}else if(getChildrenFilter().equals("ONLY_REQUESTS")){¤			filterItemId_ = "persistent_requests";¤		}else if(getChildrenFilter().equals("EXCERPT_REQUESTS")){¤			filterItemId_ = "persistent_excerpt_requests";¤		}¤	}¤	¤	protected boolean isItItemId(Item item, String name){¤		return item.getId().equals(name);¤	}¤	¤	public boolean haveRemoveOGV(){¤		Page page = (Page)getPage();¤		long id = page.getId();¤		boolean hasDocCards = DocCardManager.Factory.get().getCountDocCardsFromOgv(id) > 0;¤		if(hasDocCards){¤			return false;¤		}¤		return true;¤	}¤¤	public static String getCommentsCachedKey(String content){¤/*		String key = "COMMENTS_CACHE";¤		Pattern p = Pattern.compile("\\{.*\\}");¤		Matcher m = p.matcher(content);¤		if(m.find()){¤		*/¤			String key = "COMMENTS_NO_CACHE";¤		//}¤		¤		return key;¤	}¤	¤	public String getXHtmlBody(final Comment comment){¤		long currentStart = System.currentTimeMillis();¤		String ret =  ContentEntityObjectCache.Factory.get(getCommentsCachedKey(comment.getContent())).get(comment.getId());¤		long delta = System.currentTimeMillis() - currentStart;¤    	ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤    	Integer count = (Integer)context.get(SUMMARY_RENDER_COUNT);¤    	Long deltaSummary = (Long)context.get(SUMMARY_RENDER_TIME);¤    	if(count == null){¤    		count = 0;¤    		deltaSummary = 0l;¤    	}¤    	count++;¤    	deltaSummary += delta;¤    	context.put(SUMMARY_RENDER_COUNT, count);¤    	context.put(SUMMARY_RENDER_TIME, deltaSummary);¤		return ret;¤    }¤	¤	public static void logRenderCommentTime () {¤		ActionContext context = ActionContextThreadLocalFactory.Factory.get().getContext();¤    	Integer count = (Integer)context.get(SUMMARY_RENDER_COUNT);¤    	Long delta = (Long)context.get(SUMMARY_RENDER_TIME);¤    	if (count != null) {¤    		Logs.LOG_D(String.format("Render comment time=%dms [%d]", delta, count));	¤    	}¤		¤	}¤/*¤	private static ContentBodyCache bodyCache_ = new ContentBodyCache ();¤	¤	public static ContentBodyCache getBodyCache(){¤		return bodyCache_;¤	}¤	¤	public String convertPageBody () {¤		String username = AuthenticatedUserThreadLocal.getUsername();¤		long id = getPage().getId();¤		if(getBodyCache().containsUser(id, username) == false){¤			getBodyCache().addUser(id, username);¤		}¤		return getBodyCache().get(String.valueOf(id) + ";" + username);¤	}¤¤    public void setPageContent(String pageContent)¤    {¤        this.pageContent = pageContent;¤    }¤¤    public String getPageContent()¤    {¤        return pageContent;¤    }¤¤    private String pageContent;¤	private String pageXHtmlContent;¤    private List externalReferences;¤    private Comment rootComment;¤    private long rootCommentId;¤    */¤    //#UC END# *47B2B67300EB_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory auto reg"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory default impl"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need unsorted less"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Servant Pool"
		    value      	"none")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"debug log"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"finished"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"force usage"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"local supervisor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"singleton"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*47B432EA0085*"
		    value      	(value Text 
|//#UC START# *47B432EA0085*¤		filterItemChecked_ = value;¤		//#UC END# *47B432EA0085*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*47B432C503C7*"
		    value      	(value Text 
|//#UC START# *47B432C503C7*¤		filterItemId_ = value;¤		//#UC END# *47B432C503C7*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039031236"))
	    quid       	"47B2B67300EB"
	    documentation 	"Ответственен за полный вывод страницы в К"
	    stereotype 	"KActionPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"47B2B6B2004D"
		    supplier   	"Logical View::external::ConfluenceSupport::com.atlassian.confluence.pages.actions::ViewPageAction"
		    quidu      	"4795D26C01D7"))
	    visible_modules 	(list dependency_list
		(object Dependency_Relationship
		    quid       	"47BD5B7D0339"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::AutoCompleteSupport"
		    quidu      	"47BD59730221"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006356176"))
		    quid       	"47BD5C1D0190"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::AutoCompleteSupport::AutoCompleteProviderInVelocity"
		    quidu      	"47BD59E202B3"))
	    operations 	(list Operations
		(object Operation "set_filter_item_id"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*47B432C503C7*"
			    value      	(value Text 
|//#UC START# *47B432C503C7*¤		filterItemId_ = value;¤		//#UC END# *47B432C503C7*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006355432"))
		    quid       	"47B432C503C7"
		    documentation 	" задать id элемента фильтра"
		    stereotype 	"chg"
		    parameters 	(list Parameters
			(object Parameter "value"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ResolvedTypeGuid"
				    value      	"3DBFFE240068")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19006355748"))
			    quid       	"47B432E4024A"
			    type       	"string"
			    quidu      	"3DBFFE240068"))
		    concurrency 	"Sequential"
		    opExportControl 	"Public"
		    uid        	0))
	    class_attributes 	(list class_attribute_list
		(object ClassAttribute "filter_item_id"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ValueInitialized"
			    value      	"true")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ResolvedTypeGuid"
			    value      	"3DBFFE240068")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006355048"))
		    quid       	"47B4324D03CF"
		    documentation 	"id вызванного на странице фильтрующего элемента"
		    type       	"string"
		    quidu      	"3DBFFE240068"
		    initv      	"EMPTY_STR"
		    Containment 	"By Value"))
	    language   	"MDA Generator")
	(object Class "Unreading"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/Unreading.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*49D5ED8400CA_CUSTOM_IMPORT*"
		    value      	"//#UC START# *49D5ED8400CA_CUSTOM_IMPORT*¤//#UC END# *49D5ED8400CA_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*49D5ED8400CA_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *49D5ED8400CA_CUSTOM_CLASS_DEFINITION*¤//#UC END# *49D5ED8400CA_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*49D5ED8400CA_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *49D5ED8400CA_CUSTOM_METHODS_AND_DATA*¤¤	@Override¤	public boolean equals(Object obj) {¤		if (this == obj) {¤			return true;¤		}¤		if (obj == null) {¤			return false;¤		}¤		if (getClass() != obj.getClass()) {¤			return false;¤		}¤		Unreading u = (Unreading)obj;¤		return u.getUser().equals(getUser());¤	}¤¤	@Override¤	public int hashCode() {¤		final int prime = 31;¤		int result = 1;¤		result = prime * result + getUser().hashCode();¤		return result;¤	}¤	¤	//#UC END# *49D5ED8400CA_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/Unreading|49D5ED8400CA
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19026217165"))
	    quid       	"49D5ED8400CA"
	    documentation 	"сущность для хранения данных о непрочитанности конкретного юзера"
	    stereotype 	"SimpleClass"
	    class_attributes 	(list class_attribute_list
		(object ClassAttribute "id"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ValueInitialized"
			    value      	"true")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*49D5F0CD00E9_GET_ACCESSOR*"
			    value      	(value Text 
|//#UC START# *49D5F0CD00E9_GET_ACCESSOR*¤		return id_;¤		//#UC END# *49D5F0CD00E9_GET_ACCESSOR*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*49D5F0CD00E9_SET_ACCESSOR*"
			    value      	(value Text 
|//#UC START# *49D5F0CD00E9_SET_ACCESSOR*¤		id_ = id;¤		//#UC END# *49D5F0CD00E9_SET_ACCESSOR*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ResolvedTypeGuid"
			    value      	"3DBFFD860205")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006357099"))
		    quid       	"49D5F0CD00E9"
		    documentation 	"идентификатор в базе"
		    stereotype 	"property"
		    type       	"long long"
		    quidu      	"3DBFFD860205"
		    exportControl 	"Public"
		    Containment 	"By Value")
		(object ClassAttribute "user"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ValueInitialized"
			    value      	"true")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*49D5F0F402B5_GET_ACCESSOR*"
			    value      	(value Text 
|//#UC START# *49D5F0F402B5_GET_ACCESSOR*¤		return user_;¤		//#UC END# *49D5F0F402B5_GET_ACCESSOR*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*49D5F0F402B5_SET_ACCESSOR*"
			    value      	(value Text 
|//#UC START# *49D5F0F402B5_SET_ACCESSOR*¤		user_ = user;¤		//#UC END# *49D5F0F402B5_SET_ACCESSOR*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ResolvedTypeGuid"
			    value      	"3DBFFE240068")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006357499"))
		    quid       	"49D5F0F402B5"
		    documentation 	"пользователь, который не читал"
		    stereotype 	"property"
		    type       	"string"
		    quidu      	"3DBFFE240068"
		    exportControl 	"Public"
		    Containment 	"By Value")
		(object ClassAttribute "versionId"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ValueInitialized"
			    value      	"true")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*49D5F1140011_GET_ACCESSOR*"
			    value      	(value Text 
|//#UC START# *49D5F1140011_GET_ACCESSOR*¤		return versionId_;¤		//#UC END# *49D5F1140011_GET_ACCESSOR*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*49D5F1140011_SET_ACCESSOR*"
			    value      	(value Text 
|//#UC START# *49D5F1140011_SET_ACCESSOR*¤		versionId_ = versionId;¤		//#UC END# *49D5F1140011_SET_ACCESSOR*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ResolvedTypeGuid"
			    value      	"3DBFFD7002C2")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006357872"))
		    quid       	"49D5F1140011"
		    documentation 	"номер версии, начиная с которой пользователь не смотрел изменения в документе"
		    stereotype 	"property"
		    type       	"long"
		    quidu      	"3DBFFD7002C2"
		    exportControl 	"Public"
		    Containment 	"By Value"))
	    language   	"MDA Generator")
	(object Class "LabelListener"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"1330412032983014")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory auto reg"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory default impl"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Servant Pool"
		    value      	"none")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"debug log"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"factory priority"
		    value      	"0")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"local supervisor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"singleton"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/LabelListener.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4F4C7A0003D5_CUSTOM_IMPORT*"
		    value      	"//#UC START# *4F4C7A0003D5_CUSTOM_IMPORT*¤import com.atlassian.confluence.core.ContentEntityObject;¤import com.atlassian.confluence.event.events.label.LabelAddEvent;¤import com.atlassian.confluence.event.events.label.LabelEvent;¤import com.atlassian.confluence.event.events.label.LabelRemoveEvent;¤import com.atlassian.confluence.labels.Label;¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.Page;¤import com.atlassian.confluence.renderer.radeox.macros.MacroUtils;¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤import com.atlassian.confluence.util.velocity.VelocityUtils;¤import com.atlassian.gzipfilter.org.apache.commons.lang.StringUtils;¤¤import java.util.regex.Matcher;¤import java.util.regex.Pattern;¤import java.util.Arrays;¤import java.util.Date;¤import java.util.HashMap;¤import java.util.List;¤import java.util.Map;¤¤import net.sf.hibernate.HibernateException;¤¤import ru.garant.MDProcess.ConfluencePlugins.CommonVelocityContext.GlobalHelper;¤¤import ru.garant.MDProcess.DocCardChange.DocCardChangeDAO.OGVLinksDAO;¤import ru.garant.MDProcess.DocCardChange.DocCardChangeDAO.UVSQuestDAO;¤import ru.garant.MDProcess.DocCardChange.DocCardCommon.OGVLinksManager;¤import ru.garant.MDProcess.DocCardChange.DocCardSupport.DpoUvsHelper;¤import ru.garant.MDProcess.DocCardChange.DocCardSupport.UpdateConfigOGVTask;¤//#UC END# *4F4C7A0003D5_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4F4C7A0003D5_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *4F4C7A0003D5_CUSTOM_CLASS_DEFINITION*¤//#UC END# *4F4C7A0003D5_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4F4C7A0003D5_CONTENT*"
		    value      	(value Text 
|//#UC START# *4F4C7A0003D5_CONTENT*¤		LabelAddEvent.class,¤		LabelRemoveEvent.class¤		//#UC END# *4F4C7A0003D5_CONTENT*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4F4C7A0003D5_GETHANDLEDEVENTCLASSES_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *4F4C7A0003D5_GETHANDLEDEVENTCLASSES_IMPLEMETATION*¤		return handledClasses;¤		//#UC END# *4F4C7A0003D5_GETHANDLEDEVENTCLASSES_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4F4C7A0003D5_HANDLEEVENT_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *4F4C7A0003D5_HANDLEEVENT_IMPLEMETATION*¤		if ((event instanceof LabelAddEvent)¤				|| (event instanceof LabelRemoveEvent)) {¤			LabelEvent labelEvent  = (LabelEvent)event;¤			Label label = labelEvent.getLabel();¤			AbstractPage page = null;¤			if(labelEvent.getLabelled() instanceof AbstractPage){¤				page = (AbstractPage)labelEvent.getLabelled();¤			}¤			if(page == null){¤				return;¤			}¤			String spaceKey = page.getSpaceKey();¤			Label label_config = ContainerManager.Factory.get().getLabelManager().getLabel("config_onlabelevent");¤			if(label_config != null){¤				//находим все страницы в данном спейсе с конфигурационной меткой ¤				List<ContentEntityObject> contents = ContainerManager.Factory.get().getLabelManager().getCurrentContentForLabelAndSpace(label_config, spaceKey);¤				for(ContentEntityObject content : contents){¤					String body = content.getContent();¤					if(StringUtils.isNotEmpty(body)){¤						//на каждой странице ищем изменяемую метку¤						findCoincidence(body, label, page);¤					}¤				}¤			}¤			¤			//смотрит что добавилась/удалилась метка ОГВ и добавляет/удаляет запись из таблицы gar_ogv_links,при создании страницы приезжает событие о новой метке ОГВ тоже¤			if(label.getName().equals("ogv")){¤				Page p = (Page)page;¤				if(event instanceof LabelAddEvent){¤					addOgvLink(p);¤					DpoUvsHelper.updateTask(UpdateConfigOGVTask.INSERT, p);¤				}else{¤					DpoUvsHelper.updateTask(UpdateConfigOGVTask.DELETE, p);¤					OGVLinksDAO ogv = OGVLinksManager.Factory.get(p).getOgvById(p.getId());¤					if(ogv != null){¤						Logs.LOG_D("LabelListener::handleEvent::LabelRemoveEvent::label=ogv from page with id=" + page.getId() + " username=" + AuthenticatedUserThreadLocal.getUsername() + "assignedUserFromUVS=" + ogv.getLogin() + " assignedUserFromUO=" + ogv.getLoginOdUoUser() + " assignedUserFromUOForProject=" + ogv.getLoginOdUoUserForProjectRequest());¤						removeOGVLink(p.getId());¤					}¤				}¤			}¤			if((event instanceof LabelRemoveEvent) && label.getName().equals("uvs")){¤				logging(page, "uvs");¤			}¤			if((event instanceof LabelAddEvent) && label.getName().equals(DpoUvsHelper.GARDOC_CONFIG_INI_LABEL_NAME)){¤				DpoUvsHelper.changeBandanaValueForGardocConfigIni((Page)page);¤			}¤			if((event instanceof LabelRemoveEvent) && label.getName().equals(DpoUvsHelper.NO_EXPORT)){¤				logging(page, DpoUvsHelper.NO_EXPORT);¤				UVSQuestDAO uvs = UVSQuestDAO.get(page.getId());¤				if(uvs != null && uvs.getCopy() != null){¤					uvs.getCopy().setCreationDate(new Date());¤					uvs.getCopy().setLastModificationDate(new Date());¤					uvs.getCopy().setArchiExportDate(null);¤				}¤			}¤			if(event instanceof LabelAddEvent){¤				removeLabelContainsGardocEvent(label, page);¤			}¤		} ¤		¤		//#UC END# *4F4C7A0003D5_HANDLEEVENT_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4F4C7A0003D5_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *4F4C7A0003D5_CUSTOM_METHODS_AND_DATA*¤	public void logging(AbstractPage page, String labelName){¤		Logs.LOG_D("LabelListener::handleEvent::LabelRemoveEvent::label=" + labelName + " from page with id=" + page.getId() + " username=" + AuthenticatedUserThreadLocal.getUsername());¤	}¤	¤	public void addOgvLink(Page p){¤		OGVLinksDAO link = new OGVLinksDAO();¤		link.setId(p.getId());¤		link.setPage(p);¤		OGVLinksManager.Factory.get(p).doAdd(link);¤	}¤	¤	public void removeOGVLink(long id){¤		try {¤			OGVLinksDAO.remove(id);¤		} catch (HibernateException e) {¤			Logs.LOG_SEX(e);¤		}¤	}¤	¤	private void findCoincidence(String body, Label label, AbstractPage page){¤		String regex = "\\{code\\}[\\s]([\\s\\S]*?)[\\s]\\{code\\}";¤		Pattern re = Pattern.compile(regex, Pattern.MULTILINE);¤		Matcher m = re.matcher(body);¤		while(m.find()){¤			String labelConfig = m.group(1);¤			¤			List<String> foundedFields = getGlobalHelper().getFieldFromContentWithRegex(labelConfig);¤			if(foundedFields.get(getGlobalHelper().CONFIG_PAGE_TO).contains("pageAuthorEmail") == false || getGlobalHelper().getUserSettingCanSendMailAuthor(page.getCreatorName())){¤				String labelNameString = foundedFields.get(getGlobalHelper().CONFIG_ONLABELEVENT_LABEL);¤				String[] labelNames = labelNameString.split(", ");¤				List<String> labelNamesList = Arrays.asList(labelNames);¤				if(labelNamesList.size() > 0){¤					for(String labelName : labelNamesList){¤						//если нашли метку в конфигурационном файле, генерируем velocity текст для отправки письма¤						if(label.getName().equals(labelName)){¤							Map<String, Object> params = new HashMap<String, Object>();¤							params.put("page", page);¤							params.put("label", labelName);¤	¤							getGlobalHelper().sendMail(foundedFields, params);¤						}¤					}¤				}¤			}¤		}¤	}¤	¤	private void removeLabelContainsGardocEvent(Label label, AbstractPage page){¤		if(label.getName().contains("gardoc_event_")){¤			ContainerManager.Factory.get().getLabelManager().removeLabel(page, label);¤		}¤	}¤	¤	public GlobalHelper getGlobalHelper(){¤		if(globalHelper_ == null){¤			globalHelper_ = new GlobalHelper();¤		}¤		return globalHelper_;¤	}¤¤	private GlobalHelper globalHelper_ = null;¤	//#UC END# *4F4C7A0003D5_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/DiscussionPlugins/DiscussionsSupport/LabelListener|4F4C7A0003D5
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki"))
	    quid       	"4F4C7A0003D5"
	    documentation 	"листенер К-шных событий о удалении, добавлении лэйбла"
	    stereotype 	"KListenerPlugin"
	    language   	"MDA Generator")
	(object Class "SendMailWithHibernateConditionJob"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"1392371974863787")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory auto reg"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory default impl"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Servant Pool"
		    value      	"none")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"cron-expression"
		    value      	"0 0/10 * * * ?")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"debug log"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"factory priority"
		    value      	"0")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"local supervisor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"repeated"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"singleton"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/DiscussionsSupport/SendMailWithHibernateConditionJob.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*52FDE906035E_CUSTOM_IMPORT*"
		    value      	"//#UC START# *52FDE906035E_CUSTOM_IMPORT*¤import com.atlassian.confluence.core.ContentEntityObject;¤import com.atlassian.confluence.labels.Label;¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.Page;¤import com.atlassian.confluence.renderer.radeox.macros.MacroUtils;¤import com.atlassian.confluence.setup.bandana.ConfluenceBandanaContext;¤import com.atlassian.confluence.util.velocity.VelocityUtils;¤import com.atlassian.gzipfilter.org.apache.commons.lang.StringUtils;¤¤import ru.garant.shared.ConfluenceCore.HibernateSupportImpl.QueryHelper;¤import ru.garant.MDProcess.ConfluencePlugins.CommonVelocityContext.GlobalHelper;¤¤import java.util.Calendar;¤import java.util.Date;¤import java.util.HashMap;¤import java.util.List;¤import java.util.Map;¤import java.util.regex.Matcher;¤import java.util.regex.Pattern;¤¤//#UC END# *52FDE906035E_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*52FDE906035E_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *52FDE906035E_CUSTOM_CLASS_DEFINITION*¤//#UC END# *52FDE906035E_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*52FDE906035E_DO_EXECUTE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *52FDE906035E_DO_EXECUTE_IMPLEMETATION*¤		super.doExecute(jec);¤		//#UC END# *52FDE906035E_DO_EXECUTE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*52FDE906035E_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *52FDE906035E_CUSTOM_METHODS_AND_DATA*¤	@Override¤	protected void executeJob() {¤		Logs.LOG_W("SendMailWithHibernateConditionJob::start");¤		Label label_config = ContainerManager.Factory.get().getLabelManager().getLabel("config_job");¤		if(label_config != null){¤			List<ContentEntityObject> contents = ContainerManager.Factory.get().getLabelManager().getCurrentContentForLabel(label_config);¤			sendMailForConditionsFromContents(contents);¤		}¤		Logs.LOG_W("SendMailWithHibernateConditionJob::end");¤	}¤	¤	public void sendMailForConditionsFromContents(List<ContentEntityObject> contents){¤		for(ContentEntityObject content : contents){¤			String body = content.getContent();¤			if(StringUtils.isNotEmpty(body)){¤				findCondition(body, (AbstractPage)content);¤			}¤		}¤	}¤¤	private void findCondition(String body, AbstractPage page){¤		String regex = "\\{code\\}[\\s]([\\s\\S]*?)[\\s]\\{code\\}";¤		Pattern re = Pattern.compile(regex, Pattern.MULTILINE);¤		Matcher m = re.matcher(body);¤		while(m.find()){¤			String config = m.group(1);¤			¤			List<String> foundedFields = getGlobalHelper().getFieldFromContentWithRegex(config);¤			String interval = (foundedFields.size() > 4)?foundedFields.get(getGlobalHelper().CONFIG_JOB_INTERVAL):null;¤			if(isTimeToSendMail(interval, page.getSpaceKey())){¤				String hibernateCondition = foundedFields.get(getGlobalHelper().CONFIG_JOB_CONDITION);¤				List<Object> hibernateResults = getHibernateResult(hibernateCondition);¤				if(hibernateResults.size() > 0){¤					if(foundedFields.get(getGlobalHelper().CONFIG_PAGE_TO).contains("@")){¤						Map<String, Object> params = new HashMap<String, Object>();¤						params.put("configPage", page);¤						params.put("pages", hibernateResults);¤						getGlobalHelper().sendMail(foundedFields, params);¤					}else{¤						for(Object obj : hibernateResults){¤							Page curPage = (Page)obj;¤							if(foundedFields.get(getGlobalHelper().CONFIG_PAGE_TO).contains("pageAuthorEmail") == false || getGlobalHelper().getUserSettingCanSendMailAuthor(curPage.getCreatorName())){¤								Map<String, Object> params = new HashMap<String, Object>();¤								params.put("configPage", page);¤								params.put("page", curPage);¤								getGlobalHelper().sendMail(foundedFields, params);¤							}¤						}¤					}¤				}¤			}¤		}¤	}¤	¤	public boolean isTimeToSendMail(String intervalString, String spaceKey){¤		if(StringUtils.isEmpty(intervalString)){¤			return true;¤		}¤		int interval = Integer.parseInt(intervalString);¤		ConfluenceBandanaContext context = new ConfluenceBandanaContext(spaceKey);¤¤		Date lastSendMailDate = (Date) ContainerManager.Factory.get ().getBandanaManager ().getValue (context, "SendMailWithHibernateConditionJob.LastSendMailDate");¤		boolean flag = false;¤		Date date = new Date();¤		if(lastSendMailDate == null){¤			flag = true;¤		}else{¤			Calendar cal = Calendar.getInstance();¤			cal.setTime(date);¤			cal.set(Calendar.MINUTE, cal.get(Calendar.MINUTE) - interval);¤			date = cal.getTime();¤			if(lastSendMailDate.before(date)){¤				flag = true;¤			}¤		}¤		Date currentDate = new Date();¤		ContainerManager.Factory.get ().getBandanaManager ().setValue (context, "SendMailWithHibernateConditionJob.LastSendMailDate", currentDate);¤		Logs.LOG_D ("SendMailWithHibernateConditionJob.isTimeToSendMail: bandana.setValue, currentDate = " + currentDate);¤		return flag;¤	}¤	¤	public List<Object> getHibernateResult(String hibernateCondition){¤		long startH = System.currentTimeMillis();¤		Logs.LOG_D("START execute list query: " + hibernateCondition);¤		¤		Map<String, Object> hibernateParams = new HashMap<String, Object>();¤		if(hibernateCondition.contains("CURRENT_TIME_MINUS_1_HOUR")){¤			Date date = new Date();¤			Calendar cal = Calendar.getInstance();¤			cal.setTime(date);¤			cal.set(Calendar.HOUR_OF_DAY, cal.get(Calendar.HOUR_OF_DAY) - 1);¤			hibernateParams.put("CURRENT_TIME_MINUS_1_HOUR", cal.getTime());¤		}¤		List<Object> needObjects =  QueryHelper.getListByQuery(hibernateCondition, hibernateParams);¤		long resH = System.currentTimeMillis() - startH;¤		Logs.LOG_D("FINISH Hibernate execute list.size=" + needObjects.size() + "in " + resH + "ms");¤		return needObjects;¤	}¤	¤	@Override¤	protected boolean isNeedWriteTransaction() {¤		return true;¤	}¤	¤	public GlobalHelper getGlobalHelper(){¤		if(globalHelper_ == null){¤			globalHelper_ = new GlobalHelper();¤		}¤		return globalHelper_;¤	}¤¤	private GlobalHelper globalHelper_ = null;¤	¤	//#UC END# *52FDE906035E_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Модель проекта "MDProcess"/ConfluencePlugins/DiscussionsSupport/SendMailWithHibernateConditionJob|52FDE906035E
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki"))
	    quid       	"52FDE906035E"
	    documentation 	"Реализация писем для переодической рассылки по условию раз в 10 минут"
	    stereotype 	"KJobPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"1392372267783543"))
		    quid       	"52FDEA2B030E"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::EntitySupport::GarantAbstractJobWithLock"
		    quidu      	"4FBA1F4403CC"))
	    language   	"MDA Generator")
	(object Association "$UNNAMED$0"
	    quid       	"468F53700290"
	    roles      	(list role_list
		(object Role "$UNNAMED$1"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006343219"))
		    quid       	"468F53710138"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadComments"
		    quidu      	"468F4D8C0109"
		    keys       	(list class_attribute_list
			(object ClassAttribute "Key"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ValueInitialized"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ResolvedTypeGuid"
				    value      	"3DBFFE240068")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19006343543"))
			    quid       	"468F537D034B"
			    type       	"string"
			    exportControl 	"Public"
			    Containment 	"By Value"))
		    Containment 	"By Value"
		    is_navigable 	TRUE)
		(object Role "$UNNAMED$2"
		    quid       	"468F5371013A"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadDiscussion::UnreadCommentsMap"
		    quidu      	"468F533F002E"
		    is_aggregate 	TRUE)))
	(object Association "$UNNAMED$3"
	    quid       	"468F539F03C8"
	    roles      	(list role_list
		(object Role "users"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"final")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*468F53A001C5_INIT_users*"
			    value      	(value Text 
|//#UC START# *468F53A001C5_INIT_users*¤		return Collections.synchronizedMap(¤				new java.util.HashMap<String, ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.UnreadComments> ()¤		);¤		//#UC END# *468F53A001C5_INIT_users*
			    ))
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"Readonly accessor"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"debug log"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator User Properties"
			    name       	"is persistent"
			    value      	"true")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*468F53A001C5_GET_ACCESSOR*"
			    value      	(value Text 
|//#UC START# *468F53A001C5_GET_ACCESSOR*¤		return users_;¤		//#UC END# *468F53A001C5_GET_ACCESSOR*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"java:*468F53A001C5_SET_ACCESSOR*"
			    value      	(value Text 
|//#UC START# *468F53A001C5_SET_ACCESSOR*¤		users_ = users;¤		//#UC END# *468F53A001C5_SET_ACCESSOR*
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19006344286"))
		    quid       	"468F53A001C5"
		    stereotype 	"property"
		    label      	"users"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadDiscussion::UnreadCommentsMap"
		    quidu      	"468F533F002E"
		    Containment 	"By Value"
		    exportControl 	"Protected"
		    is_navigable 	TRUE)
		(object Role "$UNNAMED$4"
		    quid       	"468F53A001C7"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadDiscussion"
		    quidu      	"468F4D7A00DA"
		    is_aggregate 	TRUE))))
    logical_presentations 	(list unit_reference_list
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsChanged"
		    value      	""))
	    quid       	"45B719B40280"
	    title      	"Main"
	    zoom       	80
	    max_height 	28350
	    max_width  	21600
	    origin_x   	0
	    origin_y   	0
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::CommentListener" @1
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"1686")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1416")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"406")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(2001, 1659)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@1
			location   	(1807, 1630)
			fill_color 	13434879
			nlines     	1
			max_width  	388
			justify    	0
			label      	"CommentListener")
		    stereotype 	(object ItemLabel
			Parent_View 	@1
			location   	(1807, 1580)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	388
			justify    	0
			label      	"<<KListenerPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"45B719C1003E"
		    width      	406
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::OpenDiscussionsMacro" @2
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"312")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"381")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"478")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"182"))
		    location   	(294, 1044)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@2
			location   	(64, 1015)
			fill_color 	13434879
			nlines     	1
			max_width  	460
			justify    	0
			label      	"OpenDiscussionsMacro")
		    stereotype 	(object ItemLabel
			Parent_View 	@2
			location   	(64, 965)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	460
			justify    	0
			label      	"<<KMacroPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"45B72EE10213"
		    width      	478
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::PageListener" @3
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"1830")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1632")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"406")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(2010, 1884)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@3
			location   	(1816, 1855)
			fill_color 	13434879
			nlines     	1
			max_width  	388
			justify    	0
			label      	"PageListener")
		    stereotype 	(object ItemLabel
			Parent_View 	@3
			location   	(1816, 1805)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	388
			justify    	0
			label      	"<<KListenerPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"45BDE64A004E"
		    width      	406
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::CloseDiscussionPlugin" @4
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"1446")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1164")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"480")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(1947, 1431)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@4
			location   	(1716, 1402)
			fill_color 	13434879
			nlines     	1
			max_width  	462
			justify    	0
			label      	"CloseDiscussionPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@4
			location   	(1716, 1352)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	462
			justify    	0
			label      	"<<KSpringPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"45FA6DAC034B"
		    width      	480
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionVelocityContextPlugin" @5
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3609")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"882")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"658")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"242"))
		    location   	(3702, 1440)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@5
			location   	(3371, 1381)
			fill_color 	13434879
			nlines     	1
			max_width  	662
			justify    	0
			label      	"• DiscussionVelocityContextPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@5
			location   	(3371, 1331)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	662
			justify    	0
			label      	"<<KVelocityContextPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"45FA988B008C"
		    compartment 	(object Compartment
			Parent_View 	@5
			location   	(3371, 1443)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	334
			justify    	1)
		    width      	680
		    height     	242
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::RecentlyUpdatedContentMacro" @6
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"393")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"117")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"624")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(1131, 1278)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@6
			location   	(829, 1249)
			fill_color 	13434879
			nlines     	1
			max_width  	604
			justify    	0
			label      	"RecentlyUpdatedContentMacro")
		    stereotype 	(object ItemLabel
			Parent_View 	@6
			location   	(829, 1199)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	604
			justify    	0
			label      	"<<KMacroPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"460A5B8C0242"
		    width      	622
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionsMacroBase" @7
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"1050")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"417")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"480")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(954, 783)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	TRUE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@7
			location   	(723, 754)
			fill_color 	13434879
			nlines     	1
			max_width  	462
			justify    	0
			label      	"DiscussionsMacroBase")
		    stereotype 	(object ItemLabel
			Parent_View 	@7
			location   	(723, 704)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	462
			justify    	0
			label      	"<<KMacroPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"460A5C2100AB"
		    width      	480
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::external::JavaConfluence::ConfluencePlugins::AbstractHtmlGeneratingMacro" @8
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2028")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"168")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"606")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"180"))
		    location   	(639, 165)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	658120
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@8
			location   	(238, 137)
			fill_color 	13434879
			nlines     	1
			max_width  	802
			justify    	0
			label      	"• AbstractHtmlGeneratingMacro")
		    stereotype 	(object ItemLabel
			Parent_View 	@8
			location   	(238, 87)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	802
			justify    	0
			label      	"<<KMacroPlugin>>")
		    icon_style 	"Label"
		    line_color 	14803425
		    fill_color 	14803425
		    quidu      	"460A5C880148"
		    width      	820
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @9
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"1290,354;1724,206"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"460A5CE70251"
		    client     	@7
		    supplier   	@8
		    vertices   	(list Points
			(906, 691)
			(683, 255))
		    line_style 	0)
		(object InheritView "" @10
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"563,301;809,404"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"460BB55B0138"
		    client     	@2
		    supplier   	@7
		    vertices   	(list Points
			(521, 952)
			(721, 874))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsView::DiscussionsMacro" @11
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"285")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"879")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"394")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"182"))
		    location   	(846, 1548)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@11
			location   	(658, 1520)
			nlines     	1
			max_width  	376
			justify    	0
			label      	"DiscussionsMacro")
		    stereotype 	(object ItemLabel
			Parent_View 	@11
			location   	(658, 1470)
			anchor     	10
			nlines     	1
			max_width  	376
			justify    	0
			label      	"<<VM>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"46120DA70290"
		    width      	394
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::ClosedDiscussionMacro" @12
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"357")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"609")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"500")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(525, 1275)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@12
			location   	(284, 1246)
			fill_color 	13434879
			nlines     	1
			max_width  	482
			justify    	0
			label      	"ClosedDiscussionMacro")
		    stereotype 	(object ItemLabel
			Parent_View 	@12
			location   	(284, 1196)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	482
			justify    	0
			label      	"<<KMacroPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"45E43B700203"
		    width      	500
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @13
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"577,470;809,483"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"461110FA00DA"
		    client     	@12
		    supplier   	@7
		    vertices   	(list Points
			(603, 1183)
			(873, 874))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DashboardFilter" @14
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"1569")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"807")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"368")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"190"))
		    location   	(1422, 153)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@14
			location   	(1228, 123)
			fill_color 	13434879
			nlines     	1
			max_width  	388
			justify    	0
			label      	"• DashboardFilter")
		    stereotype 	(object ItemLabel
			Parent_View 	@14
			location   	(1228, 73)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	388
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"465ADE52034B"
		    width      	406
		    height     	184
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::GarantDashboardFilterXWorkPlugin" @15
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3135")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"2283")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"690")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"190"))
		    location   	(438, 3222)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@15
			location   	(10, 3201)
			fill_color 	13434879
			nlines     	1
			max_width  	856
			justify    	0
			label      	"GarantDashboardFilterXWorkPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@15
			location   	(10, 3151)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	856
			justify    	0
			label      	"<<KXWorkPlugin>>")
		    icon_style 	"Label"
		    line_color 	7885055
		    fill_color 	16111871
		    quidu      	"465ADEC3030D"
		    width      	874
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DashboardFilterAction" @16
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2985")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"2064")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"454")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"190"))
		    location   	(2925, 2217)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@16
			location   	(2710, 2188)
			fill_color 	13434879
			nlines     	1
			max_width  	430
			justify    	0
			label      	"DashboardFilterAction")
		    stereotype 	(object ItemLabel
			Parent_View 	@16
			location   	(2710, 2138)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	430
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"465ADEEF0280"
		    width      	448
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::external::JavaConfluence::ConfluenceClassPack::ConfluenceActionSupport" @17
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2946")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1773")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"506")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"186"))
		    location   	(2883, 1917)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	658120
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@17
			location   	(2617, 1889)
			fill_color 	13434879
			nlines     	1
			max_width  	532
			justify    	0
			label      	"• ConfluenceActionSupport")
		    stereotype 	(object ItemLabel
			Parent_View 	@17
			location   	(2617, 1839)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	532
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    line_color 	14803425
		    fill_color 	14803425
		    quidu      	"465ADCCA036B"
		    width      	550
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @18
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2971,1842;2957,1707"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"465ADF1400CB"
		    client     	@16
		    supplier   	@17
		    vertices   	(list Points
			(2911, 2125)
			(2894, 2007))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin" @19
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3693")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1770")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"514")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(1125, 3183)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@19
			location   	(815, 3162)
			fill_color 	13434879
			nlines     	1
			max_width  	620
			justify    	0
			label      	"UnreadStateXWorkPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@19
			location   	(815, 3112)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	620
			justify    	0
			label      	"<<KXWorkPlugin>>")
		    icon_style 	"Label"
		    line_color 	7885055
		    fill_color 	16111871
		    quidu      	"46690C39037A"
		    width      	638
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin" @20
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3642")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1563")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"504")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(3477, 2211)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@20
			location   	(3234, 2182)
			fill_color 	13434879
			nlines     	1
			max_width  	486
			justify    	0
			label      	"UnreadStateActionPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@20
			location   	(3234, 2132)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	486
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"46690C610109"
		    width      	504
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @21
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"0")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"3389,1637;3199,1707"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"46690C7B031C"
		    client     	@20
		    supplier   	@17
		    vertices   	(list Points
			(3294, 2119)
			(3066, 2007))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::VelocityItem" @22
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2082")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"453")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"358")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(1413, 396)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@22
			location   	(1247, 366)
			fill_color 	13434879
			nlines     	1
			max_width  	332
			justify    	0
			label      	"VelocityItem")
		    stereotype 	(object ItemLabel
			Parent_View 	@22
			location   	(1247, 316)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	332
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"468F4D100213"
		    width      	350
		    height     	184
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadEntity" @23
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2784")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"465")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"358")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(2784, 465)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@23
			location   	(2618, 435)
			fill_color 	13434879
			nlines     	1
			max_width  	332
			justify    	0
			label      	"UnreadEntity")
		    stereotype 	(object ItemLabel
			Parent_View 	@23
			location   	(2618, 385)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	332
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"468F4D500196"
		    width      	350
		    height     	184
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadDocument" @24
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2553")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"906")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"362")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(2553, 906)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@24
			location   	(2375, 878)
			fill_color 	13434879
			nlines     	1
			max_width  	356
			justify    	0
			label      	"UnreadDocument")
		    stereotype 	(object ItemLabel
			Parent_View 	@24
			location   	(2375, 828)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	354
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"468F4D6B002E"
		    width      	374
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @25
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2599,813;2734,557"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"468F4DA501B5"
		    client     	@24
		    supplier   	@23
		    vertices   	(list Points
			(2598, 815)
			(2734, 557))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::GarantHibernate" @26
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2028")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1059")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"358")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(3477, 870)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@26
			location   	(3307, 840)
			fill_color 	13434879
			nlines     	1
			max_width  	340
			justify    	0
			label      	"GarantHibernate")
		    stereotype 	(object ItemLabel
			Parent_View 	@26
			location   	(3307, 790)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	340
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"468F4E6C003E"
		    width      	358
		    height     	184
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DiscussionManager" @27
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2910")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1440")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"482")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(2910, 1440)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@27
			location   	(2685, 1411)
			fill_color 	13434879
			nlines     	1
			max_width  	450
			justify    	0
			label      	"DiscussionManager")
		    stereotype 	(object ItemLabel
			Parent_View 	@27
			location   	(2685, 1361)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	447
			justify    	0
			label      	"<<KComponentPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"468F4EC30177"
		    width      	468
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DeadDiscussionMacro" @28
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"939")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"711")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"468")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(1497, 1059)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@28
			location   	(1279, 1030)
			fill_color 	13434879
			nlines     	1
			max_width  	436
			justify    	0
			label      	"DeadDiscussionMacro")
		    stereotype 	(object ItemLabel
			Parent_View 	@28
			location   	(1279, 980)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	436
			justify    	0
			label      	"<<KMacroPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"468F4F130261"
		    width      	454
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @29
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"973,618;1014,509"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"468F4F4400AB"
		    client     	@28
		    supplier   	@7
		    vertices   	(list Points
			(1319, 967)
			(1133, 874))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DashboardQuery" @30
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2070")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"774")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"358")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(1794, 783)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@30
			location   	(1620, 753)
			fill_color 	13434879
			nlines     	1
			max_width  	348
			justify    	0
			label      	"DashboardQuery")
		    stereotype 	(object ItemLabel
			Parent_View 	@30
			location   	(1620, 703)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	348
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"468F4F6203B9"
		    width      	366
		    height     	184
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::CheckForDeadDiscussionsJob" @31
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"348")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1485")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"616")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(438, 1803)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@31
			location   	(29, 1774)
			fill_color 	13434879
			nlines     	1
			max_width  	818
			justify    	0
			label      	"• CheckForDeadDiscussionsJob")
		    stereotype 	(object ItemLabel
			Parent_View 	@31
			location   	(29, 1724)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	818
			justify    	0
			label      	"<<KJobPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"468F4FB90148"
		    width      	836
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadComments" @32
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3051")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"162")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"372")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(2787, 234)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@32
			location   	(2604, 204)
			fill_color 	13434879
			nlines     	1
			max_width  	366
			justify    	0
			label      	"UnreadComments")
		    stereotype 	(object ItemLabel
			Parent_View 	@32
			location   	(2604, 154)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	366
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"468F4D8C0109"
		    width      	384
		    height     	184
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadDiscussion::UnreadCommentsMap" @33
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3453")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"486")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"448")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"180"))
		    location   	(3570, 231)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	6572835
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@33
			location   	(3351, 203)
			nlines     	1
			max_width  	438
			justify    	0
			label      	"UnreadCommentsMap")
		    stereotype 	(object ItemLabel
			Parent_View 	@33
			location   	(3351, 153)
			anchor     	10
			nlines     	1
			max_width  	438
			justify    	0
			label      	"<<Map>>")
		    icon_style 	"Label"
		    line_color 	6572835
		    fill_color 	16777215
		    quidu      	"468F533F002E"
		    width      	456
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object AssociationViewNew "$UNNAMED$0" @34
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"3341,395;3164,254"))
		    location   	(3160, 232)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"468F53700290"
		    roleview_list 	(list RoleViews
			(object RoleView "$UNNAMED$1" @35
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"LineVertices"
				    value      	"3252,324;3164,254"))
			    Parent_View 	@34
			    location   	(-83, -956)
			    stereotype 	TRUE
			    line_color 	3342489
			    quidu      	"468F53710138"
			    client     	@34
			    supplier   	@32
			    vertices   	(list Points
				(3160, 232)
				(2979, 232))
			    line_style 	0)
			(object RoleView "$UNNAMED$2" @36
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"LineVertices"
				    value      	"3252,324;3341,395"))
			    Parent_View 	@34
			    location   	(-83, -956)
			    font       	(object Font
				size       	10
				face       	"Arial"
				charSet    	204
				bold       	FALSE
				italics    	FALSE
				underline  	FALSE
				strike     	FALSE
				color      	0
				default_color 	TRUE)
			    stereotype 	TRUE
			    line_color 	3342489
			    quidu      	"468F5371013A"
			    client     	@34
			    supplier   	@33
			    vertices   	(list Points
				(3160, 232)
				(3341, 231))
			    line_style 	0
			    label      	(object SegLabel @37
				Parent_View 	@36
				location   	(3219, 231)
				font       	(object Font
				    size       	10
				    face       	"Arial"
				    charSet    	204
				    bold       	FALSE
				    italics    	FALSE
				    underline  	FALSE
				    strike     	FALSE
				    color      	0
				    default_color 	TRUE)
				anchor     	5
				anchor_loc 	1
				nlines     	1
				max_width  	203
				justify    	0
				label      	"Key : string"
				pctDist    	0.900000
				height     	12
				orientation 	1))))
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadDiscussion" @38
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3033")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"873")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"380")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(3036, 873)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@38
			location   	(2851, 843)
			fill_color 	13434879
			nlines     	1
			max_width  	370
			justify    	0
			label      	"UnreadDiscussion")
		    stereotype 	(object ItemLabel
			Parent_View 	@38
			location   	(2851, 793)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	370
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"468F4D7A00DA"
		    width      	388
		    height     	184
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @39
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2983,852;2831,557"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"468F4DA80157"
		    client     	@38
		    supplier   	@23
		    vertices   	(list Points
			(2978, 780)
			(2841, 557))
		    line_style 	0)
		(object AssociationViewNew "$UNNAMED$3" @40
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"3199,780;3430,576"))
		    location   	(3302, 550)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"468F539F03C8"
		    roleview_list 	(list RoleViews
			(object RoleView "users" @41
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"LineVertices"
				    value      	"3313,678;3430,576"))
			    Parent_View 	@40
			    location   	(269, -395)
			    font       	(object Font
				size       	10
				face       	"Arial"
				charSet    	204
				bold       	FALSE
				italics    	FALSE
				underline  	FALSE
				strike     	FALSE
				color      	0
				default_color 	TRUE)
			    label      	(object SegLabel @42
				Parent_View 	@41
				location   	(3488, 394)
				font       	(object Font
				    size       	10
				    face       	"Arial"
				    charSet    	204
				    bold       	FALSE
				    italics    	FALSE
				    underline  	FALSE
				    strike     	FALSE
				    color      	0
				    default_color 	TRUE)
				anchor     	1
				anchor_loc 	1
				nlines     	1
				max_width  	202
				justify    	0
				label      	"#users"
				pctDist    	0.800000
				height     	42
				orientation 	1)
			    stereotype 	(object SegLabel @43
				Parent_View 	@41
				location   	(3541, 316)
				font       	(object Font
				    size       	10
				    face       	"Arial"
				    charSet    	204
				    bold       	FALSE
				    italics    	FALSE
				    underline  	FALSE
				    strike     	FALSE
				    color      	0
				    default_color 	TRUE)
				anchor     	10
				anchor_loc 	1
				nlines     	1
				max_width  	450
				justify    	0
				label      	"<<property>>"
				pctDist    	0.500000
				height     	120
				orientation 	1)
			    line_color 	3342489
			    quidu      	"468F53A001C5"
			    client     	@40
			    supplier   	@33
			    vertices   	(list Points
				(3302, 550)
				(3493, 321))
			    line_style 	0)
			(object RoleView "$UNNAMED$4" @44
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"LineVertices"
				    value      	"3313,678;3199,780"))
			    Parent_View 	@40
			    location   	(269, -395)
			    stereotype 	TRUE
			    line_color 	3342489
			    quidu      	"468F53A001C7"
			    client     	@40
			    supplier   	@38
			    vertices   	(list Points
				(3302, 550)
				(3110, 780))
			    line_style 	0)))
		(object UsesView "" @45
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"1889,1419;2494,1343"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @46
			Parent_View 	@45
			location   	(2419, 1502)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.482671
			height     	52
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F5741009C"
		    client     	@1
		    supplier   	@27
		    vertices   	(list Points
			(2204, 1608)
			(2675, 1494))
		    line_style 	0)
		(object UsesView "" @47
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2033,1595;2494,1370"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @48
			Parent_View 	@47
			location   	(2429, 1622)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.485501
			height     	48
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F5744031C"
		    client     	@3
		    supplier   	@27
		    vertices   	(list Points
			(2193, 1792)
			(2723, 1531))
		    line_style 	0)
		(object UsesView "" @49
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"3389,1519;3151,1469"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @50
			Parent_View 	@49
			location   	(3408, 2004)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.129765
			height     	68
			orientation 	1)
		    line_color 	3947680
		    quidu      	"468F5748037A"
		    client     	@20
		    supplier   	@27
		    vertices   	(list Points
			(3409, 2119)
			(2976, 1531))
		    line_style 	0)
		(object UsesView "" @51
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2532,1284;2207,1139"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @52
			Parent_View 	@51
			location   	(3182, 1081)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.585093
			height     	58
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F574C0203"
		    client     	@27
		    supplier   	@26
		    vertices   	(list Points
			(2998, 1348)
			(3383, 962))
		    line_style 	0)
		(object UsesView "" @53
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2797,1284;2968,1037"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @54
			Parent_View 	@53
			location   	(2902, 1068)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.686266
			height     	88
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F575000AB"
		    client     	@27
		    supplier   	@38
		    vertices   	(list Points
			(2929, 1348)
			(3014, 965))
		    line_style 	0)
		(object UsesView "" @55
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2699,1284;2588,998"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @56
			Parent_View 	@55
			location   	(2658, 1177)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.586971
			height     	64
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F575300BB"
		    client     	@27
		    supplier   	@24
		    vertices   	(list Points
			(2847, 1348)
			(2613, 996))
		    line_style 	0)
		(object UsesView "" @57
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"3455,1003;2977,1469"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @58
			Parent_View 	@57
			location   	(3247, 1466)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.525346
			height     	26
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F57820157"
		    client     	@5
		    supplier   	@27
		    vertices   	(list Points
			(3361, 1440)
			(3144, 1440))
		    line_style 	0)
		(object UsesView "" @59
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"1686,1208;2494,1324"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @60
			Parent_View 	@59
			location   	(2451, 1397)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.540343
			height     	38
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F578F03D8"
		    client     	@4
		    supplier   	@27
		    vertices   	(list Points
			(2187, 1433)
			(2675, 1437))
		    line_style 	0)
		(object InheritView "" @61
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"596,209;848,324"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"468F771801A5"
		    client     	@6
		    supplier   	@7
		    vertices   	(list Points
			(1097, 1186)
			(986, 874))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::SweepOldDiscussionsJob" @62
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"1125")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1476")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"524")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(1257, 2190)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@62
			location   	(984, 2161)
			fill_color 	13434879
			nlines     	1
			max_width  	546
			justify    	0
			label      	"• SweepOldDiscussionsJob")
		    stereotype 	(object ItemLabel
			Parent_View 	@62
			location   	(984, 2111)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	546
			justify    	0
			label      	"<<KJobPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"471C9E650261"
		    width      	564
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::CommentBranchStateActionPlugin" @63
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2145")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1863")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"684")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(2205, 2220)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@63
			location   	(1875, 2191)
			fill_color 	13434879
			nlines     	1
			max_width  	660
			justify    	0
			label      	"CommentBranchStateActionPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@63
			location   	(1875, 2141)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	660
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"4729BB88003E"
		    width      	678
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @64
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2487,1823;2692,1800"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"4729BBB50000"
		    client     	@63
		    supplier   	@17
		    vertices   	(list Points
			(2406, 2128)
			(2677, 2007))
		    line_style 	0)
		(object UsesView "" @65
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2310,1770;2739,1532"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @66
			Parent_View 	@65
			location   	(2521, 1781)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.517134
			height     	59
			orientation 	0)
		    line_color 	3947680
		    quidu      	"4729BBB8035B"
		    client     	@63
		    supplier   	@27
		    vertices   	(list Points
			(2286, 2128)
			(2824, 1531))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::CommentBranchStateXWorkPlugin" @67
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2076")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"2106")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"688")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(423, 3048)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@67
			location   	(8, 3027)
			fill_color 	13434879
			nlines     	1
			max_width  	830
			justify    	0
			label      	"CommentBranchStateXWorkPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@67
			location   	(8, 2977)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	830
			justify    	0
			label      	"<<KXWorkPlugin>>")
		    icon_style 	"Label"
		    line_color 	7885055
		    fill_color 	16111871
		    quidu      	"4729BD22000F"
		    width      	848
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @68
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"1290,500;1890,709"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @69
			Parent_View 	@68
			location   	(1344, 740)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.359524
			height     	44
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F575B005D"
		    client     	@7
		    supplier   	@30
		    vertices   	(list Points
			(1194, 783)
			(1610, 783))
		    line_style 	0)
		(object UsesView "" @70
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"1173,509;1442,711"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @71
			Parent_View 	@70
			location   	(1234, 589)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.150997
			height     	184
			orientation 	1)
		    line_color 	3947680
		    quidu      	"468F576302DE"
		    client     	@7
		    supplier   	@14
		    vertices   	(list Points
			(1050, 692)
			(1050, 174)
			(1219, 174))
		    line_style 	3
		    origin_attachment 	(1050, 692)
		    terminal_attachment 	(1219, 174))
		(object UsesView "" @72
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"1290,424;1902,446"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @73
			Parent_View 	@72
			location   	(1127, 142)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	1.282637
			height     	379
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F576F038A"
		    client     	@7
		    supplier   	@22
		    vertices   	(list Points
			(1061, 691)
			(1302, 488))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserData::UserData" @74
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(2106, 156)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	16714250
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@74
			location   	(1964, 128)
			nlines     	1
			max_width  	284
			justify    	0
			label      	"• UserData")
		    stereotype 	(object ItemLabel
			Parent_View 	@74
			location   	(1964, 78)
			anchor     	10
			nlines     	1
			max_width  	284
			justify    	0
			label      	"<<Interface>>")
		    icon       	"Interface"
		    icon_style 	"Label"
		    line_color 	16714250
		    fill_color 	16777215
		    quidu      	"4760022E0189"
		    width      	302
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @75
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"1890,785;1753,794"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @76
			Parent_View 	@75
			location   	(1616, 589)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.153188
			height     	204
			orientation 	0)
		    line_color 	3947680
		    quidu      	"468F57660399"
		    client     	@30
		    supplier   	@14
		    vertices   	(list Points
			(1819, 691)
			(1819, 212)
			(1625, 212))
		    line_style 	3
		    origin_attachment 	(1819, 691)
		    terminal_attachment 	(1625, 212))
		(object UsesView "" @77
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"LineVertices"
			    value      	"2073,681;2078,545"))
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @78
			Parent_View 	@77
			location   	(1723, 254)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	1.048820
			height     	320
			orientation 	1)
		    line_color 	3947680
		    quidu      	"468F576C03D8"
		    client     	@30
		    supplier   	@22
		    vertices   	(list Points
			(1702, 690)
			(1504, 488))
		    line_style 	0)
		(object UsesView "" @79
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @80
			Parent_View 	@79
			location   	(1791, 92)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.506775
			height     	28
			orientation 	0)
		    line_color 	3342489
		    quidu      	"47861AD502CC"
		    client     	@14
		    supplier   	@74
		    vertices   	(list Points
			(1625, 119)
			(1955, 119))
		    line_style 	3
		    origin_attachment 	(1625, 119)
		    terminal_attachment 	(1955, 119))
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserData::UserData" @81
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(2853, 2592)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	16714250
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@81
			location   	(2711, 2565)
			nlines     	1
			max_width  	284
			justify    	0
			label      	"• UserData")
		    stereotype 	(object ItemLabel
			Parent_View 	@81
			location   	(2711, 2514)
			anchor     	10
			nlines     	1
			max_width  	284
			justify    	0
			label      	"<<Interface>>")
		    icon       	"Interface"
		    icon_style 	"Label"
		    line_color 	16714250
		    fill_color 	16777215
		    quidu      	"4760022E0189"
		    width      	302
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @82
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @83
			Parent_View 	@82
			location   	(3073, 2404)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"47861B0C0383"
		    client     	@16
		    supplier   	@81
		    vertices   	(list Points
			(2953, 2308)
			(2953, 2501))
		    line_style 	3
		    origin_attachment 	(2953, 2308)
		    terminal_attachment 	(2953, 2501))
		(object ClassView "Class" "Logical View::external::ConfluenceSupport::com.atlassian.confluence.pages.actions::ViewPageAction" @84
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(2022, 2571)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	658120
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@84
			location   	(1582, 2539)
			fill_color 	13434879
			nlines     	1
			max_width  	880
			justify    	0
			label      	"ViewPageAction")
		    stereotype 	(object ItemLabel
			Parent_View 	@84
			location   	(1582, 2489)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	880
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    line_color 	14803425
		    fill_color 	14803425
		    quidu      	"4795D26C01D7"
		    width      	898
		    height     	188
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::GarantViewPageAction" @85
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1980, 3063)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@85
			location   	(1568, 2975)
			fill_color 	13434879
			nlines     	1
			max_width  	824
			justify    	0
			label      	"GarantViewPageAction")
		    stereotype 	(object ItemLabel
			Parent_View 	@85
			location   	(1568, 2925)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	824
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"47B2B67300EB"
		    compartment 	(object Compartment
			Parent_View 	@85
			location   	(1568, 3037)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	3
			max_width  	821
			justify    	1)
		    width      	842
		    height     	300
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @86
		    stereotype 	TRUE
		    line_color 	3342489
		    quidu      	"47B2B6B2004D"
		    client     	@85
		    supplier   	@84
		    vertices   	(list Points
			(1852, 2913)
			(1852, 2665))
		    line_style 	3
		    origin_attachment 	(1852, 2913)
		    terminal_attachment 	(1852, 2665))
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::AutoCompleteSupport::AutoCompleteProviderInVelocity" @87
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(3153, 3045)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@87
			location   	(2799, 3017)
			nlines     	1
			max_width  	708
			justify    	0
			label      	"• AutoCompleteProviderInVelocity")
		    stereotype 	(object ItemLabel
			Parent_View 	@87
			location   	(2799, 2967)
			anchor     	10
			nlines     	1
			max_width  	708
			justify    	0
			label      	"<<KVelocityContextPlugin>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"47BD59E202B3"
		    width      	726
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @88
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @89
			Parent_View 	@88
			location   	(2594, 2934)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"47BD5C1D0190"
		    client     	@85
		    supplier   	@87
		    vertices   	(list Points
			(2401, 3056)
			(2789, 3049))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::Unreading" @90
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(2214, 459)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@90
			location   	(1939, 356)
			fill_color 	13434879
			nlines     	1
			max_width  	550
			justify    	0
			label      	"Unreading")
		    stereotype 	(object ItemLabel
			Parent_View 	@90
			location   	(1939, 306)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	550
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"49D5ED8400CA"
		    compartment 	(object Compartment
			Parent_View 	@90
			location   	(1939, 418)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	4
			max_width  	587
			justify    	1)
		    width      	568
		    height     	330
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @91
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @92
			Parent_View 	@91
			location   	(2315, 792)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"49D5EE5D028D"
		    client     	@24
		    supplier   	@90
		    vertices   	(list Points
			(2483, 815)
			(2338, 624))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::LabelListener" @93
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(4116, 1938)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@93
			location   	(3923, 1907)
			fill_color 	13434879
			nlines     	1
			max_width  	386
			justify    	0
			label      	"LabelListener")
		    stereotype 	(object ItemLabel
			Parent_View 	@93
			location   	(3923, 1857)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	383
			justify    	0
			label      	"<<KListenerPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"4F4C7A0003D5"
		    width      	404
		    height     	186
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::SendMailWithHibernateConditionJob" @94
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1344, 1833)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@94
			location   	(907, 1802)
			fill_color 	13434879
			nlines     	1
			max_width  	874
			justify    	0
			label      	"• SendMailWithHibernateConditionJob")
		    stereotype 	(object ItemLabel
			Parent_View 	@94
			location   	(907, 1752)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	874
			justify    	0
			label      	"<<KJobPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"52FDE906035E"
		    width      	892
		    height     	186
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::EntitySupport::GarantAbstractJobWithLock" @95
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(462, 2238)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	TRUE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@95
			location   	(185, 2209)
			nlines     	1
			max_width  	554
			justify    	0
			label      	"GarantAbstractJobWithLock")
		    stereotype 	(object ItemLabel
			Parent_View 	@95
			location   	(185, 2159)
			anchor     	10
			nlines     	1
			max_width  	554
			justify    	0
			label      	"<<KJobPlugin>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"4FBA1F4403CC"
		    width      	572
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @96
		    stereotype 	TRUE
		    line_color 	3342489
		    quidu      	"4FBA204B00C2"
		    client     	@31
		    supplier   	@95
		    vertices   	(list Points
			(442, 1894)
			(456, 2146))
		    line_style 	0)
		(object InheritView "" @97
		    stereotype 	TRUE
		    line_color 	3342489
		    quidu      	"52FDEA2B030E"
		    client     	@94
		    supplier   	@95
		    vertices   	(list Points
			(1137, 1926)
			(656, 2146))
		    line_style 	0)
		(object InheritView "" @98
		    stereotype 	TRUE
		    line_color 	3342489
		    quidu      	"4FBA204D0129"
		    client     	@62
		    supplier   	@95
		    vertices   	(list Points
			(974, 2206)
			(748, 2220))
		    line_style 	0)))
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ClassUID"
		    value      	"465ADEC3030D"))
	    quid       	"477CDF9E014B"
	    title      	"Main"
	    zoom       	100
	    max_height 	28350
	    max_width  	21600
	    origin_x   	0
	    origin_y   	0
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::GarantDashboardFilterXWorkPlugin::GarantDashboardFilterXPackage" @99
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3027")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"2463")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"650")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"180"))
		    location   	(543, 237)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@99
			location   	(220, 209)
			fill_color 	16777215
			nlines     	1
			max_width  	646
			justify    	0
			label      	"• GarantDashboardFilterXPackage")
		    stereotype 	(object ItemLabel
			Parent_View 	@99
			location   	(220, 159)
			fill_color 	16777215
			anchor     	10
			nlines     	1
			max_width  	646
			justify    	0
			label      	"<<XPackage>>")
		    icon_style 	"Label"
		    line_color 	7885055
		    fill_color 	13357823
		    quidu      	"465ADED20280"
		    width      	664
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)))
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ClassUID"
		    value      	"465ADED20280")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsChanged"
		    value      	""))
	    quid       	"477CE1180250"
	    title      	"Main"
	    zoom       	100
	    max_height 	28350
	    max_width  	21600
	    origin_x   	0
	    origin_y   	0
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::DashboardFilterAction" @100
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(1023, 366)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@100
			location   	(808, 345)
			nlines     	1
			max_width  	430
			justify    	0
			label      	"DashboardFilterAction")
		    stereotype 	(object ItemLabel
			Parent_View 	@100
			location   	(808, 295)
			anchor     	10
			nlines     	1
			max_width  	430
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"465ADEEF0280"
		    width      	448
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::GarantDashboardFilterXWorkPlugin::GarantDashboardFilterXPackage::SetCheck" @101
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(510, 861)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@101
			location   	(223, 779)
			fill_color 	13434879
			nlines     	1
			max_width  	574
			justify    	0
			label      	"SetCheck")
		    stereotype 	(object ItemLabel
			Parent_View 	@101
			location   	(223, 729)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	574
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE1520369"
		    compartment 	(object Compartment
			Parent_View 	@101
			location   	(223, 894)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	592
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::GarantDashboardFilterXWorkPlugin::GarantDashboardFilterXPackage::SetRadio" @102
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1479, 858)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@102
			location   	(1192, 776)
			fill_color 	13434879
			nlines     	1
			max_width  	574
			justify    	0
			label      	"SetRadio")
		    stereotype 	(object ItemLabel
			Parent_View 	@102
			location   	(1192, 726)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	574
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE1D40029"
		    compartment 	(object Compartment
			Parent_View 	@102
			location   	(1192, 891)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	592
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @103
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @104
			Parent_View 	@103
			location   	(715, 498)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"477CE1E70374"
		    client     	@101
		    supplier   	@100
		    vertices   	(list Points
			(659, 716)
			(935, 449))
		    line_style 	0)
		(object UsesView "" @105
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @106
			Parent_View 	@105
			location   	(1135, 662)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"477CE1F002CA"
		    client     	@102
		    supplier   	@100
		    vertices   	(list Points
			(1344, 713)
			(1100, 449))
		    line_style 	0)))
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ClassUID"
		    value      	"46690C39037A")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsChanged"
		    value      	""))
	    quid       	"477CE2580011"
	    title      	"Main"
	    zoom       	100
	    max_height 	28350
	    max_width  	21600
	    origin_x   	0
	    origin_y   	0
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage" @107
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3741")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1977")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"470")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"230"))
		    location   	(471, 228)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@107
			location   	(228, 200)
			fill_color 	16777215
			nlines     	1
			max_width  	486
			justify    	0
			label      	"• UnreadStateXPackage")
		    stereotype 	(object ItemLabel
			Parent_View 	@107
			location   	(228, 150)
			fill_color 	16777215
			anchor     	10
			nlines     	1
			max_width  	486
			justify    	0
			label      	"<<XPackage>>")
		    icon_style 	"Label"
		    line_color 	7885055
		    fill_color 	13357823
		    quidu      	"46690C5102CE"
		    width      	504
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)))
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ClassUID"
		    value      	"46690C5102CE")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsChanged"
		    value      	""))
	    quid       	"477CE25E0094"
	    title      	"Main"
	    zoom       	100
	    max_height 	28350
	    max_width  	21600
	    origin_x   	653
	    origin_y   	832
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateActionPlugin" @108
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"3642")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1563")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"504")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(1275, 504)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@108
			location   	(1032, 483)
			nlines     	1
			max_width  	486
			justify    	0
			label      	"UnreadStateActionPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@108
			location   	(1032, 433)
			anchor     	10
			nlines     	1
			max_width  	486
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"46690C610109"
		    width      	504
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage::SetReadState" @109
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(324, 1107)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@109
			location   	(93, 1025)
			fill_color 	13434879
			nlines     	1
			max_width  	462
			justify    	0
			label      	"SetReadState")
		    stereotype 	(object ItemLabel
			Parent_View 	@109
			location   	(93, 975)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	462
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE27B01EC"
		    compartment 	(object Compartment
			Parent_View 	@109
			location   	(93, 1140)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	480
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage::SetUnreadState" @110
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(2349, 1086)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@110
			location   	(2118, 1004)
			fill_color 	13434879
			nlines     	1
			max_width  	462
			justify    	0
			label      	"SetUnreadState")
		    stereotype 	(object ItemLabel
			Parent_View 	@110
			location   	(2118, 954)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	462
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE28702B3"
		    compartment 	(object Compartment
			Parent_View 	@110
			location   	(2118, 1119)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	480
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage::SetReadEntityState" @111
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(960, 1092)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@111
			location   	(729, 1010)
			fill_color 	13434879
			nlines     	1
			max_width  	462
			justify    	0
			label      	"• SetReadEntityState")
		    stereotype 	(object ItemLabel
			Parent_View 	@111
			location   	(729, 960)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	462
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE2BE0096"
		    compartment 	(object Compartment
			Parent_View 	@111
			location   	(729, 1125)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	480
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage::SetUnreadEntityState" @112
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1623, 1098)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@112
			location   	(1392, 1016)
			fill_color 	13434879
			nlines     	1
			max_width  	462
			justify    	0
			label      	"• SetUnreadEntityState")
		    stereotype 	(object ItemLabel
			Parent_View 	@112
			location   	(1392, 966)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	462
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE2C80019"
		    compartment 	(object Compartment
			Parent_View 	@112
			location   	(1392, 1131)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	480
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage::SetReadStateForAll" @113
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1266, 1575)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@113
			location   	(999, 1493)
			fill_color 	13434879
			nlines     	1
			max_width  	534
			justify    	0
			label      	"• SetReadStateForAll")
		    stereotype 	(object ItemLabel
			Parent_View 	@113
			location   	(999, 1443)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	534
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE2DC02B7"
		    compartment 	(object Compartment
			Parent_View 	@113
			location   	(999, 1608)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	537
			justify    	1)
		    width      	552
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage::SetUnreadCommentState" @114
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(573, 1575)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@114
			location   	(306, 1493)
			fill_color 	13434879
			nlines     	1
			max_width  	534
			justify    	0
			label      	"• SetUnreadCommentState")
		    stereotype 	(object ItemLabel
			Parent_View 	@114
			location   	(306, 1443)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	534
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE2F90279"
		    compartment 	(object Compartment
			Parent_View 	@114
			location   	(306, 1608)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	537
			justify    	1)
		    width      	552
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage::SetReadCommentState" @115
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1947, 1572)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@115
			location   	(1680, 1490)
			fill_color 	13434879
			nlines     	1
			max_width  	534
			justify    	0
			label      	"• SetReadCommentState")
		    stereotype 	(object ItemLabel
			Parent_View 	@115
			location   	(1680, 1440)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	534
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE30702D0"
		    compartment 	(object Compartment
			Parent_View 	@115
			location   	(1680, 1605)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	537
			justify    	1)
		    width      	552
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @116
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @117
			Parent_View 	@116
			location   	(1289, 1368)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.073505
			height     	22
			orientation 	1)
		    line_color 	3947680
		    quidu      	"477CE329026B"
		    client     	@113
		    supplier   	@108
		    vertices   	(list Points
			(1267, 1430)
			(1273, 587))
		    line_style 	0)
		(object UsesView "" @118
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @119
			Parent_View 	@118
			location   	(1027, 711)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"477CE3350120"
		    client     	@111
		    supplier   	@108
		    vertices   	(list Points
			(1036, 947)
			(1229, 587))
		    line_style 	0)
		(object UsesView "" @120
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @121
			Parent_View 	@120
			location   	(1329, 831)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"477CE336038E"
		    client     	@112
		    supplier   	@108
		    vertices   	(list Points
			(1538, 953)
			(1323, 587))
		    line_style 	0)
		(object UsesView "" @122
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @123
			Parent_View 	@122
			location   	(2137, 609)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"477CE339033B"
		    client     	@110
		    supplier   	@108
		    vertices   	(list Points
			(2294, 942)
			(2294, 489)
			(1527, 489))
		    line_style 	3
		    origin_attachment 	(2294, 942)
		    terminal_attachment 	(1527, 489))
		(object UsesView "" @124
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @125
			Parent_View 	@124
			location   	(1844, 768)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"477CE32C01E9"
		    client     	@115
		    supplier   	@108
		    vertices   	(list Points
			(1963, 1428)
			(1963, 542)
			(1527, 542))
		    line_style 	3
		    origin_attachment 	(1963, 1428)
		    terminal_attachment 	(1527, 542))
		(object UsesView "" @126
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @127
			Parent_View 	@126
			location   	(496, 425)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.569157
			height     	57
			orientation 	0)
		    line_color 	3947680
		    quidu      	"477CE330009B"
		    client     	@109
		    supplier   	@108
		    vertices   	(list Points
			(284, 963)
			(284, 481)
			(1023, 481))
		    line_style 	3
		    origin_attachment 	(284, 963)
		    terminal_attachment 	(1023, 481))
		(object UsesView "" @128
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @129
			Parent_View 	@128
			location   	(508, 780)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"477CE3260379"
		    client     	@114
		    supplier   	@108
		    vertices   	(list Points
			(627, 1431)
			(627, 524)
			(1023, 524))
		    line_style 	3
		    origin_attachment 	(627, 1431)
		    terminal_attachment 	(1023, 524))
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage::SetReadTwoStates" @130
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(240, 2049)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@130
			location   	(10, 1967)
			fill_color 	13434879
			nlines     	1
			max_width  	460
			justify    	0
			label      	"SetReadTwoStates")
		    stereotype 	(object ItemLabel
			Parent_View 	@130
			location   	(10, 1917)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	460
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"48AAC1AD0018"
		    compartment 	(object Compartment
			Parent_View 	@130
			location   	(10, 2082)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	478
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @131
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @132
			Parent_View 	@131
			location   	(790, 165)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.759845
			height     	52
			orientation 	0)
		    line_color 	3342489
		    quidu      	"48AAC22200BF"
		    client     	@130
		    supplier   	@108
		    vertices   	(list Points
			(240, 1904)
			(247, 219)
			(1288, 213)
			(1278, 420))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::UnreadStateXWorkPlugin::UnreadStateXPackage::SetUnreadTwoStates" @133
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(2544, 1938)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@133
			location   	(2314, 1856)
			fill_color 	13434879
			nlines     	1
			max_width  	460
			justify    	0
			label      	"SetUnreadTwoStates")
		    stereotype 	(object ItemLabel
			Parent_View 	@133
			location   	(2314, 1806)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	460
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"48AAC276010B"
		    compartment 	(object Compartment
			Parent_View 	@133
			location   	(2314, 1971)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	478
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @134
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @135
			Parent_View 	@134
			location   	(2434, 352)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"48AAC2A902CF"
		    client     	@133
		    supplier   	@108
		    vertices   	(list Points
			(2544, 1793)
			(2553, 268)
			(1359, 265)
			(1303, 420))
		    line_style 	0)))
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ClassUID"
		    value      	"4729BD22000F")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsChanged"
		    value      	""))
	    quid       	"477CE3FB0012"
	    title      	"Main"
	    zoom       	100
	    max_height 	28350
	    max_width  	21600
	    origin_x   	0
	    origin_y   	0
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::CommentBranchStateXWorkPlugin::CommentBranchStateXPackage" @136
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2115")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"2307")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"642")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"180"))
		    location   	(549, 279)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@136
			location   	(129, 251)
			fill_color 	16777215
			nlines     	1
			max_width  	840
			justify    	0
			label      	"• CommentBranchStateXPackage")
		    stereotype 	(object ItemLabel
			Parent_View 	@136
			location   	(129, 201)
			fill_color 	16777215
			anchor     	10
			nlines     	1
			max_width  	840
			justify    	0
			label      	"<<XPackage>>")
		    icon_style 	"Label"
		    line_color 	7885055
		    fill_color 	13357823
		    quidu      	"4729BDBB00CB"
		    width      	858
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)))
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ClassUID"
		    value      	"4729BDBB00CB")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsChanged"
		    value      	""))
	    quid       	"477CE40C0238"
	    title      	"Main"
	    zoom       	100
	    max_height 	28350
	    max_width  	21600
	    origin_x   	0
	    origin_y   	0
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::CommentBranchStateActionPlugin" @137
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewXPosition"
			    value      	"2145")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewYPosition"
			    value      	"1863")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewWidth"
			    value      	"684")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ItemViewHeight"
			    value      	"184"))
		    location   	(816, 477)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@137
			location   	(486, 456)
			nlines     	1
			max_width  	660
			justify    	0
			label      	"CommentBranchStateActionPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@137
			location   	(486, 406)
			anchor     	10
			nlines     	1
			max_width  	660
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"4729BB88003E"
		    width      	678
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::DiscussionsSupport::CommentBranchStateXWorkPlugin::CommentBranchStateXPackage::SetCollapseState" @138
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(822, 1053)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@138
			location   	(538, 971)
			fill_color 	13434879
			nlines     	1
			max_width  	568
			justify    	0
			label      	"• SetCollapseState")
		    stereotype 	(object ItemLabel
			Parent_View 	@138
			location   	(538, 921)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	568
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"477CE41200C7"
		    compartment 	(object Compartment
			Parent_View 	@138
			location   	(538, 1086)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	537
			justify    	1)
		    width      	586
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @139
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @140
			Parent_View 	@139
			location   	(699, 735)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"477CE43701E3"
		    client     	@138
		    supplier   	@137
		    vertices   	(list Points
			(819, 908)
			(816, 560))
		    line_style 	0)))))
