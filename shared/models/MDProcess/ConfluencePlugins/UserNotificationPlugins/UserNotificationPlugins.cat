
(object Petal
    version    	50
    _written   	"Rose 2006.0.0.060314"
    charSet    	204)

(object Class_Category "UserNotificationPlugins"
    is_unit    	TRUE
    is_loaded  	TRUE
    attributes 	(list Attribute_Set
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"AbstarctOperation"
	    value      	"regular")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"IsNative"
	    value      	"false")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"WikiPageID (wiki)"
	    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins|4841471A010A
	    ))
	(object Attribute
	    tool       	"MDA Generator User Properties"
	    name       	"name"
	    value      	"UserNotificationManager")
	(object Attribute
	    tool       	"MDA Generator User Properties"
	    name       	"vendor name"
	    value      	"ÎÎÎ ÍÏÏ 'Ãàðàíò-Ñåðâèñ'")
	(object Attribute
	    tool       	"MDA Generator User Properties"
	    name       	"vendor url"
	    value      	"www.garant.ru")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"NESTED GENERATED FILES (java)"
	    value      	"")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"NESTED GENERATED WikiPageID (wiki)"
	    value      	(value Text ""))
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"SourceType (wiki)"
	    value      	"wiki")
	(object Attribute
	    tool       	"MDA Generator"
	    name       	"ElementCreationOrder"
	    value      	"19011026165"))
    quid       	"4841471A010A"
    documentation 	
|ïëàãèíû äëÿ ïîääåðæêè ôè÷è "ïðèâëå÷ü ïîëüçîâàòåëÿ ê îáñóæäåíèþ"
    
    stereotype 	"KPlugins"
    visible_categories 	(list visibility_relationship_list
	(object Visibility_Relationship
	    quid       	"48414BE00162"
	    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotification"
	    quidu      	"48414B78012E")
	(object Visibility_Relationship
	    quid       	"48A2F101001D"
	    supplier   	"Logical View::external::ConfluenceSupport::com.atlassian.confluence.coreImpl"
	    quidu      	"4649E1A40231")
	(object Visibility_Relationship
	    quid       	"490ACCB2015B"
	    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationUnit"
	    quidu      	"490ACC32003C")
	(object Visibility_Relationship
	    quid       	"4AB237B80260"
	    supplier   	"Logical View::external::ConfluenceSupport::com.atlassian.confluence.plugin.descriptor.web.conditions"
	    quidu      	"49523C25001F")
	(object Visibility_Relationship
	    quid       	"4FB9FC5C0169"
	    supplier   	"Logical View::MDProcess::ConfluencePlugins::EntitySupport"
	    quidu      	"4B1F4958003C"))
    exportControl 	"Public"
    logical_models 	(list unit_reference_list
	(object Class "SendNotifyForUserMacro"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory auto reg"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory default impl"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need unsorted less"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Servant Pool"
		    value      	"none")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"debug log"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"finished"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"local supervisor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"singleton"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ImplementSelectType"
		    value      	"all")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"OverloadSelectType"
		    value      	"include")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ApplyedGens"
		    value      	"All")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/UserNotificationPlugins/SendNotifyForUserMacro.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48410D300306_CUSTOM_IMPORT*"
		    value      	"//#UC START# *48410D300306_CUSTOM_IMPORT*¤import ru.garant.MDProcess.ConfluencePlugins.UserData.UserData;¤import ru.garant.MDProcess.ConfluencePlugins.UserWarning;¤import ru.garant.MDProcess.ConfluencePlugins.UserWarningRequest;¤import ru.garant.MDProcess.ConfluencePlugins.UserWarningRequestTimeTask;¤¤import net.sf.hibernate.HibernateException;¤import net.sf.hibernate.Query;¤import net.sf.hibernate.Session;¤¤import org.apache.commons.lang.StringUtils;¤import com.atlassian.user.Group;¤import com.atlassian.user.User;¤import com.opensymphony.util.TextUtils;¤import com.opensymphony.xwork.Action;¤import com.opensymphony.xwork.ActionContext;¤import com.opensymphony.xwork.ActionInvocation;¤import com.atlassian.confluence.renderer.PageContext;¤import com.atlassian.confluence.renderer.radeox.macros.MacroUtils;¤import com.atlassian.confluence.security.Permission;¤import com.atlassian.confluence.security.PermissionManager;¤import com.atlassian.confluence.spaces.Space;¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤import com.atlassian.confluence.util.velocity.VelocityUtils;¤import com.atlassian.confluence.labels.LabelManager;¤import com.atlassian.confluence.pages.*;¤import com.atlassian.confluence.pages.actions.ViewPageAction;¤import com.atlassian.confluence.core.ContentEntityObject;¤import ru.garant.MDProcess.ConfluencePlugins.UserNotification.UserNotification;¤import ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.CommentBranchStateActionPlugin;¤¤import ru.garant.shared.GCI.I18N.Messages;¤import ru.garant.shared.GCL.DateUtils;¤import ru.garant.shared.GCL.DateUtils.WrongFormat;¤¤import java.sql.Connection;¤import java.sql.PreparedStatement;¤import java.sql.ResultSet;¤import java.sql.SQLException;¤import java.text.DateFormat;¤import java.text.ParseException;¤import java.text.SimpleDateFormat;¤¤import java.util.regex.*;¤//#UC END# *48410D300306_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48410D300306_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *48410D300306_CUSTOM_CLASS_DEFINITION*¤//#UC END# *48410D300306_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48410D300306_EXECUTE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *48410D300306_EXECUTE_IMPLEMETATION*¤¤		if (!isOwnRenderContext()) {¤			return "";¤		}¤//		String macrosNotifyString = "{notify:";¤		String macrosNotifyString =  "";¤		String notificationMacroIdString = (String) parameters.get("id");¤		if(notificationMacroIdString != null){¤			long notificationMacroId = Long.valueOf(notificationMacroIdString);¤			macrosNotifyString = UserNotificationService.Factory.create().getNotifyMacroString("id=" + notificationMacroId);¤//			macrosNotifyString+= ("id=" + notificationMacroId + "}");¤			UserNotificationService unService = UserNotificationService.Factory.create();¤			UserWarning uwMacros = unService.getMacrosNotifyParameters (notificationMacroId);¤			¤			InformationAboutUserWarningRequest params = getUserWarningRequestParams(notificationMacroId);¤			if(params.getContentId() != 0){¤				boolean notify_dismissed = true;¤				if(params.getNeedMonitoring() == true){¤					notify_dismissed = false;¤				}¤				if(params.getStartDate() != null || params.getEndDate() != null || params.getCycle() != null)¤					return makeOutHTML(¤							params.getTitle(), ¤							params.getUsers(), ¤							(params.getCycle() == null)?null:params.getCycle().getTime() + "", ¤							(params.getEndDate() == null)?null:params.getEndDate().getTime() + "", ¤							(params.getStartDate() == null)?null:params.getStartDate().getTime() + "", ¤							params.getWarningPlaceId(), ¤							params.getContentId(), ¤							macrosNotifyString, ¤							uwMacros, ¤							false, ¤							params.getSender(), ¤							notify_dismissed¤						);¤				else¤					return makeOutHTML(¤							params.getTitle(), ¤							params.getUsers(), ¤							null, ¤							null, ¤							null, ¤							params.getWarningPlaceId(), ¤							params.getContentId(), ¤							macrosNotifyString, ¤							uwMacros, ¤							false, ¤							params.getSender(), ¤							notify_dismissed¤						);¤			}¤			else¤				return renderErrorMessage(Messages.Factory.messages().get("sendnotifyforusermacro.can.not.send.notify"));¤		}else{¤			¤			String notificationNames = (String) parameters.get("0");¤			String title = (String) parameters.get(TITLE_MARKER);¤			String deliveredNotificationNames = (String) parameters.get(NOTIFY_DELIVERED_MARKER);¤¤			String startDate = (String) parameters.get(START_DATE_MARKER);¤			String duration = (String) parameters.get(DURATION_MARKER);¤			String cycle = (String) parameters.get(CYCLE_MARKER);¤			ContentEntityObject renderEntity = ((PageContext) renderContext).getEntity();¤			if(notificationNames == null && deliveredNotificationNames == null){¤				return renderErrorMessage(Messages.Factory.messages().get("sendnotifyforusermacro.no.user.for.notify"));¤			}¤			if(notificationNames != null)¤				macrosNotifyString+= notificationNames;¤			¤			if(title != null){¤				if(notificationNames != null)¤					macrosNotifyString+= "|";¤				macrosNotifyString+= ("title=" + title);¤			}	¤			if(deliveredNotificationNames != null){¤				if(title != null)¤					macrosNotifyString+= "|";¤				macrosNotifyString+= ("delivered=" + deliveredNotificationNames);¤			}¤		¤			if(startDate != null){¤				macrosNotifyString+= ("|date=" + startDate);¤			}¤			if(cycle != null){¤				macrosNotifyString+= ("|cycle=" + cycle);¤			}¤			if(duration != null){¤				macrosNotifyString+= ("|duration=" + duration);¤			}¤			macrosNotifyString = UserNotificationService.Factory.create().getNotifyMacroString(macrosNotifyString);¤			if (notificationNames == null) { ¤				// if all notification had been already sent, just render macro¤				return makeOutHTML(title, deliveredNotificationNames, cycle, duration, startDate, renderEntity.getId(), getPage(renderEntity).getId(), macrosNotifyString, null, true, null, false);¤			}¤			¤			if (¤				!getRemoteUser().getName().equals (¤					((PageContext)renderContext).getEntity().getLastModifierName()¤				)¤			) {¤				return "";¤			}¤¤			if (false == checkSetNotifyDeliveredMarkerFor(renderEntity, macrosNotifyString)) {¤				Logs.LOG_E(¤					"Can't parse notify: checkSetNotifyDeliveredMarkerFor == false,"¤					+" for " + renderEntity.getType() + " with id=" + renderEntity.getId()¤				);¤				return renderErrorMessage(Messages.Factory.messages().get("sendnotifyforusermacro.wrong.parameter.format"));¤			}¤			¤			UserWarning uw = null;¤			UserNotification notify = null;¤			try {¤				Collection<String> usersNames = getUserNamesToNotify(notificationNames, getPage(renderEntity));¤				if(usersNames == null){¤					return renderErrorMessage(Messages.Factory.messages().get("sendnotifyforusermacro.can.not.send.notify") + ". " + errorString + ".");¤				}¤					notify = createNotification(title, getPage(renderEntity), renderEntity, startDate, duration, cycle, new Date());¤				uw = sendNotifyFor(notify, usersNames, notificationNames);¤				if (uw == null) {¤					return renderErrorMessage(Messages.Factory.messages().get("sendnotifyforusermacro.can.not.send.notify"));¤				}¤			} catch (Exception e) {¤				return e.getMessage();¤			}¤			¤			macrosNotifyString = setNotifyDeliveredMarkerFor(renderEntity, macrosNotifyString, uw.getId());¤			if(notify != null){¤				cycle = "" + notify.getCycle();¤				duration = "" + notify.getEndDate();¤				startDate = "" + notify.getStartDate();¤			}¤			if (deliveredNotificationNames != null) {¤				return makeOutHTML(title, deliveredNotificationNames + "," + notificationNames, cycle, duration, startDate, renderEntity.getId(), getPage(renderEntity).getId(), macrosNotifyString, null, false, null, false);¤			} else {¤				return makeOutHTML(title, notificationNames, cycle, duration, startDate, renderEntity.getId(), getPage(renderEntity).getId(), macrosNotifyString, null, false, getRemoteUser().getName(), false);¤			}¤			¤		}¤		¤		//#UC END# *48410D300306_EXECUTE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48410D300306_ISINLINE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *48410D300306_ISINLINE_IMPLEMETATION*¤		return true;¤		//#UC END# *48410D300306_ISINLINE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48410D300306_HASBODY_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *48410D300306_HASBODY_IMPLEMETATION*¤		return false;¤		//#UC END# *48410D300306_HASBODY_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48410D300306_GETBODYRENDERMODE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *48410D300306_GETBODYRENDERMODE_IMPLEMETATION*¤		return RenderMode.NO_RENDER;¤		//#UC END# *48410D300306_GETBODYRENDERMODE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48410D300306_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *48410D300306_CUSTOM_METHODS_AND_DATA*¤	private class InformationAboutUserWarningRequest{¤		private String users_ = null;¤		public String getUsers(){¤			return users_;¤		}¤		¤		private String sender_ = null;¤		public String getSender(){¤			return sender_;¤		}¤		private boolean needMonitoring_ = false;¤		public boolean getNeedMonitoring(){¤			return needMonitoring_;¤		}¤¤		private String title_ = null;¤		public String getTitle(){¤			return title_;¤		}¤¤		private long contentId_ = 0;¤		public long getContentId(){¤			return contentId_;¤		}¤¤		private long warningPlaceId_ = 0;¤		public long getWarningPlaceId(){¤			return warningPlaceId_;¤		}¤¤		private Date startDate_ = null;¤		public Date getStartDate(){¤			return startDate_;¤		}¤¤		private Date endDate_ = null;¤		public Date getEndDate(){¤			return endDate_;¤		}¤		¤		private Date cycle_ = null;¤		public Date getCycle(){¤			return cycle_;¤		}¤		¤		public InformationAboutUserWarningRequest(String users, String sender, boolean needMonitoring, String title, long contentId, long warningPlaceId, Date startDate, Date endDate, Date cycle){¤			users_ = users;¤			sender_ = sender;¤			needMonitoring_ = needMonitoring;¤			title_ = title;¤			contentId_ = contentId;¤			warningPlaceId_ = warningPlaceId;¤			startDate_ = startDate;¤			endDate_ = endDate;¤			cycle_ = cycle;¤		}¤	}¤	¤	¤	¤	¤	¤	¤	¤	¤	public InformationAboutUserWarningRequest getUserWarningRequestParams (final long userWarningId) {¤		ResultSet rs = null;¤		PreparedStatement ps = null;¤		InformationAboutUserWarningRequest iauwr = null;¤		try {¤			Connection con = ContainerManager.Factory.get().getSession().connection();¤			ps = con.prepareStatement("select GROUP_CONCAT(uwr.user), uwr.sender, uwr.need_monitoring, uwr.title, uwr.contentid, uwr.warning_place, uwrtt.start_date, uwrtt.end_date, uwrtt.cycle " +¤										  "from gar_user_warning_request uwr " +¤										  "left outer join gar_user_warning_request_time_task as uwrtt on (uwrtt.id=uwr.id) " +¤										  "where uwr.parent_id=" + userWarningId + "");¤			rs = ps.executeQuery();¤			if(rs.next()){¤				iauwr = new InformationAboutUserWarningRequest(¤						rs.getString(1), ¤						rs.getString(2),¤						rs.getBoolean(3),¤						rs.getString(4),¤						rs.getLong(5),¤						rs.getLong(6),¤						(rs.getLong(7) == 0)?null:new Date(rs.getLong(7)),¤						(rs.getLong(8) == 0)?null:new Date(rs.getLong(8)),¤						(rs.getLong(9) == 0)?null:new Date(rs.getLong(9))¤					);¤			}¤		}	¤		catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}finally{¤			if(rs != null){¤				try {¤					rs.close();¤				} catch (SQLException e) {¤					Logs.LOG_SEX(e);¤				}¤			}¤			if(ps != null){¤				try {¤					ps.close();¤				} catch (SQLException e) {¤					Logs.LOG_SEX(e);¤				}¤			}¤		}¤		return iauwr;¤	}¤	¤	private static final String TITLE_MARKER = "title";¤	private static final String NOTIFY_DELIVERED_MARKER = "delivered";¤	private static final String START_DATE_MARKER = "date";¤	private static final String CYCLE_MARKER = "cycle";¤	private static final String DURATION_MARKER = "duration";¤	¤	private boolean isOwnRenderContext () {¤		ActionContext context = ActionContext.getContext();¤		if (context == null) {¤			return false;¤		}¤		ActionInvocation actionInvocation = context.getActionInvocation();¤		if (actionInvocation == null) {¤			return false;¤		}¤		Action currentAction = actionInvocation.getAction();¤		if (currentAction == null) {¤			return false;¤		}¤		return currentAction instanceof ViewPageAction ¤				|| currentAction instanceof CommentBranchStateActionPlugin;¤	}¤	¤	private UserNotification createNotification (String title, ContentEntityObject content,¤			ContentEntityObject warningPlace, String startDateStr, String durationStr, String cycleStr, Date date)¤			throws WrongParameterFormatException {¤		User user = getRemoteUser();¤		UserNotification notify = new UserNotification(title, content, warningPlace, true, user.getName(), date);¤		¤		long now = new Date().getTime();¤		¤		long startDate = DateUtils.parseCombinedDate(startDateStr, now);¤		long cycle = DateUtils.parseCombinedDate(cycleStr, false);¤		long endDate;¤		if(startDate == 0)¤			endDate = DateUtils.parseCombinedDate(durationStr, now);¤		else¤			endDate = DateUtils.parseCombinedDate(durationStr, startDate);¤		¤		if(startDate < 0) {¤			throw new WrongParameterFormatException("date");¤		}¤		¤		if (startDate > 0 || (cycle > 0 || endDate > 0)) {¤			if (cycle < 0 || cycle == 0 && endDate > 0) {¤				throw new WrongParameterFormatException("cycle");¤			}¤			if (endDate < 0) {¤				throw new WrongParameterFormatException("duration");¤			}¤		}¤		if(endDate < 0)¤			throw new WrongParameterFormatException("duration");¤		if (cycle < 0) ¤			throw new WrongParameterFormatException("cycle");¤		¤		notify.setStartDate(startDate);¤		notify.setCycle(cycle);¤		notify.setEndDate(endDate);¤		¤		return notify;¤	}¤	¤	private String responseContent = null;¤    public String getResponseContent () {¤    	return this.responseContent;¤    }¤¤	private String makeOutHTML (String title, String notifyTo, String cycle, String duration, String startDate, long renderCommentId, long renderPageId, String macrosNotifyString, UserWarning uwMacros, boolean oldNotify, String senderName, boolean notify_dismissed) {¤		String titleHtml = title != null ? title : "";¤		String cycleHtml = cycle != null ? cycle : "";¤		String durationHtml = duration != null ? duration : "";¤		String startDateHtml = startDate != null ? startDate : "";¤		String notifyToHtml = null; ¤		if(uwMacros != null)¤			notifyToHtml = uwMacros.getUsersNotificationString(); ¤		else if(notifyTo != null && !notifyTo.equals(""))¤			notifyToHtml = notifyTo;¤¤		long startHtmlTime = System.currentTimeMillis();¤		long queryTime = 0L;¤		String strListTitle = null;¤		boolean notifyForSender = false;¤		boolean notifyDeferred = false;¤		¤		if(notifyTo.equals(senderName) && getRemoteUser().getName().equals(senderName) ){¤			notifyForSender = true;¤			notify_dismissed = false;¤		}else if(startDate != null && !startDate.equals("0")){¤			Long date = Long.parseLong(startDate);¤			if (date > new Date().getTime()) {¤				notifyDeferred = true;¤			}	¤		}¤		¤		try {¤			// now create a simple velocity context and render a template for the output¤			Map<String, Object> contextMap = MacroUtils.defaultVelocityContext();¤			contextMap.put("titleNotify", titleHtml);¤			contextMap.put("notifyTo", notifyToHtml);¤			contextMap.put("cycleNotify", cycleHtml);¤			contextMap.put("durationNotify", durationHtml);¤			contextMap.put("startDateNotify", startDateHtml);¤			contextMap.put("renderCommentId", renderCommentId);¤			contextMap.put("renderPageId", renderPageId);¤			contextMap.put("macrosNotifyString", macrosNotifyString);¤			contextMap.put("oldNotify", oldNotify);¤			contextMap.put("notifyForSender", notifyForSender);¤			contextMap.put("notifyDeferred", notifyDeferred);¤			contextMap.put("spaceKey", null);¤			contextMap.put("parentId", 0);¤			contextMap.put("notifyDismissed", notify_dismissed);¤			String tipNotify = VelocityUtils.getRenderedTemplate("/ConfluencePlugins/UserNotificationUnit/editnotifymonitoring.vm", contextMap);¤			return tipNotify;		¤¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		} finally {¤			if (queryTime > 3000) { // more than 3 sec.¤				this.timeLog(strListTitle, queryTime, System.currentTimeMillis () - startHtmlTime);¤			}¤		}¤		return null;¤	}¤¤    protected User getRemoteUser()¤    {¤        return AuthenticatedUserThreadLocal.getUser();¤    }¤¤    private void timeLog (String strListTitle, long queryTime, long htmlTime) {¤		java.util.Date curDate = new java.util.Date();¤		String userName = (this.getRemoteUser()!=null)? this.getRemoteUser().getName() : "Anonymous";¤		String out =¤			curDate + "[" + userName + "]: SendNotifyForUserMacro::htmlTimeStr: "¤			+ this.getTimerStr(strListTitle, htmlTime) + "\n"¤			+ curDate + "[" + userName + "]: SendNotifyForUserMacro::queryTimeStr "¤			+ this.getTimerStr(strListTitle, queryTime) + "\n"¤			+ "***************************************************************\n";¤		Logs.LOG_I(out);¤	}¤¤    private String getTimerStr (String title, long time) {¤		String s = null;¤		try {¤			s = new String (title.getBytes ("CP866"));¤		} catch (java.io.UnsupportedEncodingException e) {¤			Logs.LOG_E ("getTimerStr::UnsupportedEncodingException: " + e);¤			s = title;¤		}¤		com.atlassian.user.User user = this.getRemoteUser ();¤		return s + ": HTML time " + time + "ms. [" + (user==null? "Anonymous":user.getName()) + "]";¤	}¤¤	private UserWarning sendNotifyFor (UserNotification notify, Collection<String> namesToNotify, String userNamesForMacro) {¤		try {¤			UserNotificationService unService = UserNotificationService.Factory.create();¤			java.util.Set<UserWarningRequest> uwr = unService.saveOrUpdateUsersNotification(notify, new ArrayList<String>(namesToNotify), null, USER_TYPE, null);¤			if(uwr == null)¤				return null;¤			UserWarning uw = unService.saveOrUpdateUserNotificationsMacro(-1, uwr, userNamesForMacro);¤			if(uw == null) ¤				return null;¤			return uw;¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤			return null;¤		}¤	}¤	¤	private boolean checkSetNotifyDeliveredMarkerFor (ContentEntityObject contentObject, String macrosNotifyString) {¤		String original = Pattern.quote(macrosNotifyString);¤		String s = contentObject.getContent();		¤		return Pattern.compile(original).matcher(s).find();¤	}¤	¤	private String setNotifyDeliveredMarkerFor (ContentEntityObject contentObject, String macrosNotifyString, long idNotify) {¤		if (false == checkSetNotifyDeliveredMarkerFor(contentObject, macrosNotifyString)) {¤			throw new IllegalStateException ("setNotifyDeliveredMarkerFor: precondition failed!!!");¤		}¤		¤		String original = macrosNotifyString;¤		String replace = UserNotificationService.Factory.create().getNotifyMacroString("id=" + idNotify);¤//		String replace = "{notify:id=" + idNotify + "}";¤		String s = contentObject.getContent();		¤		String cont = s.replaceAll(Pattern.quote(original), replace);¤		contentObject.setContent(cont);		¤		return replace;¤	}¤	¤	private Collection<String> getUserNamesToNotify(String notificationNames, AbstractPage page) throws UnknownNotifierException, NoNotifiersSelectedException {¤		String notifiers[] = notificationNames.split(",");¤		if (notifiers == null || notifiers.length == 0) {¤			throw new NoNotifiersSelectedException();¤		}¤		¤		Collection<String> result = new HashSet<String>();¤		for (String notifier : notifiers) {¤			Collection<String> notifierUserNames = extractUserNames(notifier, page);¤			if(notifierUserNames == null) return null;¤			else if (notifierUserNames.isEmpty()) {¤				throw new UnknownNotifierException(notifier);¤			}¤¤			result.addAll(notifierUserNames);¤		}¤		return result;¤	}¤	¤	private boolean showNotificationsOnlyForNonFavouriteSpaces(String userName) {¤		return getNotificationUserData(userName).contains("FOLLOW_FOR_NOT_FAVOURITE_CONTENT");¤	}¤	¤	private Collection<String> getNotificationUserData (String userName) {¤		try {¤			return (Collection<String>) UserData.Factory.get(userName, "NotifyParameters").getData();¤		} catch (Exception e) {¤			Logs.LOG_E("SendNotifyForUserMacro::getNotificationUserData: " + e);¤			return Collections.emptyList();¤		}¤	}¤¤	private boolean isSpaceFavouriteAndCheckOption (Space space, String userName) {¤		return showNotificationsOnlyForNonFavouriteSpaces(userName)¤				&& getFavouriteSpaces(userName).contains(space);¤	}¤	¤	private List<Space> getFavouriteSpaces (String userName) {¤		LabelManager labelManager = ContainerManager.Factory.get().getLabelManager();¤		return labelManager.getFavouriteSpaces(userName);¤	}¤	¤	private Collection<String> extractUserNames (String notifier, AbstractPage page) {¤		final String name = TextUtils.innerTrim(notifier);¤		final GarUserAccessor ua = ContainerManager.Factory.get().getUserAccessor();¤		final PermissionManager pm = ContainerManager.Factory.get().getPermissionManager();¤		¤		User user = ua.getUser(name);¤		if (user != null) {¤/*			¤			if (page != null && !pm.hasPermission(user, Permission.VIEW, page)) {¤				errorString = Messages.Factory.messages()¤						.get("notifytooltipcontent.user.have.not.permissions");¤				errorString = errorString.replace("{0}", user.getFullName());¤			} else if (page != null && isSpaceFavouriteAndCheckOption(page.getSpace(), name)) {¤				errorString = Messages.Factory.messages()¤						.get("notifytooltipcontent.user.check.option.favourite.spaces");¤				errorString = errorString.replace("{0}", user.getFullName());¤			} ¤*/				return Arrays.asList(user.getName());¤			¤		}¤¤		final Group group = ua.getGroup(name);¤		if (group != null) {¤//			String usersString = null;¤			List<String> userNames = new ArrayList<String>();¤			for (Iterator<String> it = ua.getMemberNames(group).iterator(); it.hasNext();) {¤				String userName = it.next();¤				user = ua.getUser(userName);¤/*				if(page != null && !pm.hasPermission(user, Permission.VIEW, page)){¤					if(usersString == null)¤						usersString = user.getFullName();¤					else¤						usersString+= (", " + user.getFullName());¤				}¤				else¤*/					userNames.add(userName);¤			}¤/*			if(usersString != null && user != null){¤				errorString = Messages.Factory.messages().get("notifytooltipcontent.user.of.this.group.have.not.permissions");¤				errorString = errorString.replace("{0}", user.getFullName());¤				return null;¤			}	¤*/¤			return userNames;¤		}¤¤		return Collections.emptyList();¤	}¤	¤	private AbstractPage getPage (ContentEntityObject renderEntity) {¤		if (renderEntity instanceof Comment) {¤			return ((Comment) renderEntity).getPage();¤		}¤¤		return ((AbstractPage) renderEntity);¤	}¤	¤	public String renderErrorMessage(String message) {¤		return String.format("<div class=\"error\"><span class=\"error\">%s</span></div>", message);¤	}¤	¤	private final class WrongParameterFormatException extends Exception {¤		private static final long serialVersionUID = -4985465594971635499L;¤		¤		public WrongParameterFormatException(String parameter) {¤			super(renderErrorMessage(String.format(Messages.Factory.messages().get("sendnotifyforusermacro.wrong.parameter.format") + ": %s", parameter)));¤		}¤	}¤	¤	private final class NoNotifiersSelectedException extends Exception {¤		private static final long serialVersionUID = -4982465594971635499L;¤¤		public NoNotifiersSelectedException() {¤			super(renderErrorMessage(Messages.Factory.messages().get("sendnotifyforusermacro.no.user.for.notify")));¤		}¤	}¤¤	private final class UnknownNotifierException extends Exception {¤		private static final long serialVersionUID = 7128439623647664978L;¤¤		public UnknownNotifierException(String name) {¤			super(renderErrorMessage(String.format(Messages.Factory.messages().get("sendnotifyforusermacro.unknown.user.or.group") + ": %s", name)));¤		}¤	}¤	¤	private short USER_TYPE = 1;¤	private String errorString;¤	//#UC END# *48410D300306_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/SendNotifyForUserMacro|48410D300306
		    ))
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"alias"
		    value      	"notify")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039114925"))
	    quid       	"48410D300306"
	    documentation 	
|íóæåí äëÿ ïðèâëå÷åíèÿ âíèìàíèÿ ê îáñóæäåíèþ çàäàííîãî þçåðà èìååò âèä:
|{noformat}
|{notify:ses,cyberz}
|{noformat}
	    
	    stereotype 	"KMacroPlugin"
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011039058"))
		    quid       	"4841505D011B"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotification::UserNotificationService"
		    quidu      	"48414BFC0288"))
	    language   	"MDA Generator")
	(object Class "PrintNotifyListMacro"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/UserNotificationPlugins/PrintNotifyListMacro.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4843E26F016E_CUSTOM_IMPORT*"
		    value      	"//#UC START# *4843E26F016E_CUSTOM_IMPORT*¤import ru.garant.shared.ConfluenceCore.PageSupport.GarPageManager;¤import ru.garant.MDProcess.ConfluencePlugins.UserNotification.NotifyForPuData;¤import java.util.*;¤¤import ru.garant.shared.GCI.I18N.Messages;¤import ru.garant.shared.GCL.DateUtils;¤¤import com.atlassian.confluence.renderer.PageContext;¤¤import ru.garant.MDProcess.ConfluencePlugins.UserData.UserData;¤¤import com.opensymphony.webwork.ServletActionContext;¤¤import ru.garant.MDProcess.ConfluencePlugins.CommonVelocityContext.GlobalHelper;¤import ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DashboardQuery;¤import ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager;¤import ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.VelocityItem;¤import ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DashboardFilter.DashboardListType;¤¤¤import com.atlassian.confluence.labels.LabelManager;¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.Comment;¤import com.atlassian.confluence.pages.CommentManager;¤import com.atlassian.confluence.pages.PageManager;¤¤import java.io.IOException;¤¤import javax.servlet.http.HttpServletRequest;¤¤import net.sf.hibernate.Session;¤import net.sf.hibernate.SessionFactory;¤¤import org.apache.axis.utils.StringUtils;¤import org.radeox.macro.parameter.MacroParameter;¤import org.springframework.orm.hibernate.SessionFactoryUtils;¤¤import com.atlassian.confluence.renderer.radeox.macros.MacroUtils;¤import com.atlassian.confluence.spaces.Space;¤import com.atlassian.confluence.util.GeneralUtil;¤import com.atlassian.confluence.util.velocity.VelocityUtils;¤import com.atlassian.core.exception.InfrastructureException;¤¤import ru.garant.MDProcess.ConfluencePlugins.UserNotification.NotificationSortType;¤import ru.garant.MDProcess.ConfluencePlugins.UserWarningRequest;¤¤//#UC END# *4843E26F016E_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4843E26F016E_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *4843E26F016E_CUSTOM_CLASS_DEFINITION*¤//#UC END# *4843E26F016E_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4843E26F016E_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *4843E26F016E_CUSTOM_METHODS_AND_DATA*¤	¤	public String getName() {¤		return "PrintNotifyListMacro";¤	}¤¤	private int listSize_ = 10;¤¤	/**¤	 * ¤	 * @return default number of elements in result list¤	 */¤	private final int getListSize () {¤		return listSize_;¤	}¤	¤	private final void setListSize (MacroParameter macroParameter) {¤		String strLines = parseParameterForKey(macroParameter, "lines");¤		listSize_ = strLines != null ? Integer.parseInt(strLines) : 10;¤	}¤	¤	private String maxListSizeParameterName_ = null;¤¤	private String getMaxListSizeParameterName () {¤		if (StringUtils.isEmpty(maxListSizeParameterName_)) {¤			maxListSizeParameterName_ = "maxCount" + DashboardListType.WARNING_REQUEST.name();¤		}¤		return maxListSizeParameterName_;¤	}¤¤	private int getMaxListSize () {¤		try {¤			HttpServletRequest request = ServletActionContext.getRequest();¤			return request == null ? getListSize() : Integer.parseInt(request¤					.getParameter(getMaxListSizeParameterName()));¤		} catch (NumberFormatException e) {¤			return getListSize();¤		}¤	}¤	¤	private DiscussionManager discussionManager = null;¤¤	private DiscussionManager getDiscussionManager() {¤		if (discussionManager == null) {¤			discussionManager = (DiscussionManager) com.atlassian.spring.container.ContainerManager¤					.getComponent("ru.garant.MDProcess.ConfluencePlugins.DiscussionsSupport.DiscussionManager");¤			if (discussionManager == null) {¤				Logs.LOG_E("CommentListener::getOpenDiscussionManager: can not find OpenDiscussionManager");¤			}¤		}¤		return discussionManager;¤	}¤	¤	private List<Space> getFavouriteSpaces () {¤		LabelManager labelManager = ContainerManager.Factory.get().getLabelManager();¤		return labelManager.getFavouriteSpaces(getRemoteUser().getName());¤	}¤¤	protected String getHtml (MacroParameter macroParameter) throws IllegalArgumentException, IOException {¤//		Logs.LOG_D(AuthenticatedUserThreadLocal.getUsername() + " : begin getHtml - PrintNotifyListMacro");¤//		long startDate = new Date().getTime();¤¤		List<Long> idNotify = new LinkedList<Long>();¤		List<Boolean> flagNotify = new LinkedList<Boolean>();¤		List<Long> userNotifiesContentId = new LinkedList<Long>();¤		List<Long> userNotifiesWarningPlaceId = new LinkedList<Long>();¤		List<VelocityItem> viList = new LinkedList<VelocityItem>();¤		List<Boolean> watchOnForSender = new LinkedList<Boolean>();¤		List<Boolean> watchOnDeferred = new LinkedList<Boolean>();¤		¤		Map<String, Object> contextMap = MacroUtils.defaultVelocityContext();¤		¤		try {¤			long st = System.currentTimeMillis();¤			¤			setListSize(macroParameter);¤¤			contextMap.put("macroKey", DashboardListType.WARNING_REQUEST.name());¤			contextMap.put("header", Messages.Factory.messages().get("printnotifylist.notify.monitoring"));¤			contextMap.put("needSpace", true);¤			contextMap.put("isDiscussion", true);¤			fillNotificationsInfo(idNotify, flagNotify, userNotifiesContentId, userNotifiesWarningPlaceId, viList, watchOnForSender, watchOnDeferred);¤			¤			List<VelocityItem> filtratedViList = filteredNotifyList(new LinkedList<VelocityItem>(viList));¤			¤			final int maxListSize = getMaxListSize();¤			int i = 0;¤			while (i < viList.size()) {¤				VelocityItem vi = viList.get(i);¤¤				if (isFiltratedVi(filtratedViList, vi) && i < maxListSize) {¤					i++;¤				} else {¤					viList.remove(i);¤					idNotify.remove(i);¤					flagNotify.remove(i);¤					userNotifiesContentId.remove(i);¤					userNotifiesWarningPlaceId.remove(i);¤					watchOnForSender.remove(i);¤					watchOnDeferred.remove(i);¤				}¤			}¤¤			contextMap.put("itemList", viList);¤			contextMap.put("idNotifyList", idNotify);¤			contextMap.put("flagNotifyList", flagNotify);¤			contextMap.put("userNotifyContentId", userNotifiesContentId);¤			contextMap.put("userNotifyWarningPlaceId", userNotifiesWarningPlaceId);¤			contextMap.put("watchOnForSender", watchOnForSender);¤			contextMap.put("watchOnDeferred", watchOnDeferred);¤¤			contextMap.put("maxCount", viList.size());¤			addMoreLessUrl(contextMap, macroParameter, viList.size(), filtratedViList.size());¤			¤			int unreadCountInList = 0;¤			for (VelocityItem vi : viList) {¤				if (vi.isRead() == false) {¤					unreadCountInList++;¤				}¤			}¤			if (unreadCountInList > 0) {¤				contextMap.put("unreadCountInList", unreadCountInList);¤			}¤			¤			contextMap.put("remoteUser", getRemoteUser());¤			¤			¤			¤//			diff = new Date().getTime() - startDate;¤//			Logs.LOG_D(AuthenticatedUserThreadLocal.getUsername() + " : end getHtml - PrintNotifyListMacro3" + " ("¤//					+ diff + "ms)");¤¤			long pt = System.currentTimeMillis() - st;¤			st = System.currentTimeMillis();¤			String ret = VelocityUtils.getRenderedTemplate("/ConfluencePlugins/DiscussionsView/DiscussionsMacro.vm", contextMap);¤			long rt = System.currentTimeMillis() - st;¤			Logs.LOG_D(getClass().getSimpleName() + ": execute in " + pt + "ms, render in " + rt + "ms");¤			return ret;¤		} catch (Exception e) {¤			Logs.LOG_E("******************************************************");¤			Logs.LOG_E("PrintNotifyListMacro::getHtml: " + e);¤			Logs.LOG_SEX(e);¤			Logs.LOG_E("******************************************************");¤			throw new IOException(e.getMessage());¤		}¤	}¤¤	private boolean isFiltratedVi (List<VelocityItem> filtatedViList, VelocityItem vi) {¤		for (VelocityItem filteredVi : filtatedViList) {¤			if (vi == filteredVi) { // if is the same instance¤				return true;¤			}¤		}¤		return false;¤	}¤	¤	private void fillNotificationsInfo (List<Long> idNotify, List<Boolean> flagNotify,¤			List<Long> userNotifiesContentIds,List<Long> userNotifiesWarningPlaceIds, List<VelocityItem> viList, List<Boolean> watchOnForSender, List<Boolean> watchOnDeferred) throws Exception {¤		UserNotificationService unService = UserNotificationService.Factory.create();¤		java.util.List<NotifyForPuData> nfp = unService¤				.getPersonalUserNotificationListForPu(getRemoteUser().getName(), NotificationSortType.DATE_DESC);¤		boolean deferredWatch;¤		boolean senderWatch;¤		PageManager pageManager = ContainerManager.Factory.get().getPageManager();¤		for (Iterator<NotifyForPuData> it = nfp.iterator(); it.hasNext();) {¤			NotifyForPuData notifyForPuData = it.next();¤			deferredWatch = false;¤			senderWatch = false;¤			long now = new Date().getTime();¤			if(notifyForPuData.getStartDateNotify() != 0 && notifyForPuData.getStartDateNotify() > now)¤				deferredWatch = true;¤¤			if(notifyForPuData.getSender() != null && getRemoteUser().getName().equals(notifyForPuData.getSender())){¤				senderWatch = true;¤			}¤			¤			int positionToAdd = getPositionToAdd(nfp, notifyForPuData, userNotifiesContentIds);¤				if (positionToAdd != IGNORE) {¤				VelocityItem vi = createVelocityItem(pageManager, notifyForPuData, notifyForPuData.getSender(), notifyForPuData.getPostingDate());¤				if (vi != null) {¤					if (positionToAdd == ADD || positionToAdd >= viList.size()) {¤						viList.add(vi);¤						idNotify.add(notifyForPuData.getIdNotify());¤						flagNotify.add(true);¤						userNotifiesContentIds.add(notifyForPuData.getContentidNotify());¤						userNotifiesWarningPlaceIds.add(notifyForPuData.getWarningPlaceNotify());¤						watchOnDeferred.add(deferredWatch);¤						watchOnForSender.add(senderWatch);¤					} else if (positionToAdd >= 0) {¤						if (shouldBeGrouped()) {¤							viList.set(positionToAdd, vi);¤							idNotify.set(positionToAdd, notifyForPuData.getIdNotify());¤							flagNotify.set(positionToAdd, true);¤							userNotifiesContentIds.set(positionToAdd,notifyForPuData.getContentidNotify());¤							userNotifiesWarningPlaceIds.set(positionToAdd,notifyForPuData.getWarningPlaceNotify());¤							watchOnDeferred.set(positionToAdd,deferredWatch);¤							watchOnForSender.set(positionToAdd,senderWatch);¤						}¤						else{¤							int index = viList.size() - 1;¤							viList.add(viList.get(index));¤							idNotify.add(idNotify.get(index));¤							flagNotify.add(true);¤							userNotifiesContentIds.add(userNotifiesContentIds.get(index));¤							userNotifiesWarningPlaceIds.add(userNotifiesWarningPlaceIds.get(index));¤							watchOnDeferred.add(deferredWatch);¤							watchOnForSender.add(senderWatch);¤							int i;¤							for(i = viList.size() - 2; i > positionToAdd; i--){¤								viList.set(i, viList.get(i - 1));¤								idNotify.set(i, idNotify.get(i - 1));¤								flagNotify.set(i, true);¤								userNotifiesContentIds.set(i, userNotifiesContentIds.get(i - 1));¤								userNotifiesWarningPlaceIds.set(i, userNotifiesWarningPlaceIds.get(i - 1));¤								watchOnDeferred.set(i,deferredWatch);¤								watchOnForSender.set(i,senderWatch);¤							}¤							¤							viList.set(positionToAdd, vi);¤							idNotify.set(positionToAdd, notifyForPuData.getIdNotify());¤							flagNotify.set(positionToAdd, true);¤							userNotifiesContentIds.set(positionToAdd,notifyForPuData.getContentidNotify());¤							userNotifiesWarningPlaceIds.set(positionToAdd,notifyForPuData.getWarningPlaceNotify());¤							watchOnDeferred.set(positionToAdd,deferredWatch);¤							watchOnForSender.set(positionToAdd,senderWatch);¤						}¤					}¤				}¤			}¤		}¤	}¤¤	private static final int IGNORE = -2;¤	private static final int ADD = -1; ¤	¤	private Date getNewLastModification(NotifyForPuData newNotification, CommentManager cm, GarPageManager pm){¤		if(newNotification.getStartDateNotify() != 0){¤			return new Date(newNotification.getStartDateNotify());¤		}¤		else{ ¤			return newNotification.getPostingDate();¤		}	¤	}¤	¤	private int getPositionToAdd (List<NotifyForPuData> userNotifies, NotifyForPuData newNotification, List<Long> userNotifiesContentIds) {¤		final CommentManager cm = ContainerManager.Factory.get().getCommentManager();¤		final GarPageManager pm = ContainerManager.Factory.get().getPageManager();¤¤		if (shouldBeGrouped()) {¤			if (!userNotifiesContentIds.contains(newNotification.getContentidNotify())) {¤				return ADD;¤			}¤			¤			final long newPageId = newNotification.getContentidNotify();¤			final Date newLastModification = getNewLastModification(newNotification, cm, pm);¤			¤			for (int i = 0; i < userNotifies.size(); i++) {¤				final NotifyForPuData notificationForPu = userNotifies.get(i);¤				final long tmpPageId = notificationForPu.getContentidNotify();¤				if (newPageId == tmpPageId¤						&& notificationForPu.getIdNotify() != newNotification¤								.getIdNotify()) {¤					final Date lastModification;¤					if (notificationForPu.getContentidNotify() != notificationForPu.getWarningPlaceNotify()) {¤						lastModification = cm.getComment(notificationForPu.getWarningPlaceNotify())¤								.getLastModificationDate();¤					} else {¤						lastModification = pm.getAbstractPage(notificationForPu.getContentidNotify())¤								.getLastModificationDate();¤					}¤¤					// replace existing notification if it is older, else ignore¤					// new notification¤					if (lastModification != null && newLastModification != null) {¤						return lastModification.before(newLastModification) ? i : IGNORE;¤					}¤				}¤			}¤		}¤		else{¤			final Date newLastModification = getNewLastModification(newNotification, cm, pm);¤			Date previousLastModification = null;¤			Date nextLastModification = null;¤			if(newLastModification != null){¤				for (int i = 0; i < userNotifies.size(); i++) {¤					final NotifyForPuData notificationForPu = userNotifies.get(i);¤					nextLastModification = getNewLastModification(notificationForPu, cm, pm);¤					if((nextLastModification == null || newLastModification.after(nextLastModification)) && ¤							(previousLastModification == null || newLastModification.before(previousLastModification))){¤						return i;¤					}¤					previousLastModification = nextLastModification; ¤				}¤			}¤		}¤		return ADD;¤	}¤¤	private boolean shouldBeGrouped () {¤		if (!groupSimilar()) {¤			return false;¤		}¤		return true;¤	}¤¤	private VelocityItem createVelocityItem (PageManager pageManager, NotifyForPuData notificationForPu, String sender, Date dateNotify) throws Exception {¤		AbstractPage page = pageManager.getAbstractPage(notificationForPu.getContentidNotify());¤		VelocityItem vi = new VelocityItem();¤		Date date = null;¤		if(notificationForPu.getStartDateNotify() != 0){¤			date = new Date(notificationForPu.getStartDateNotify());¤		} else{¤			date = dateNotify;¤		}¤		¤		vi.setDate(date);¤		vi.setAuthor(sender);¤		¤		if(notificationForPu.getCountUnreadCommentsNotify() == 0){¤			if(notificationForPu.getLastCommentIdNotify() != 0){¤				vi.setLastCommentId(notificationForPu.getLastCommentIdNotify());¤			}¤			else{¤				vi.setLastCommentId(0);¤			}¤		}¤		else{¤			vi.setLastCommentId(notificationForPu.getWarningPlaceNotify());¤		}¤		vi.setPage(page);¤		vi.setDocumentBodyRead(notificationForPu.getIsDocumentRead());¤		vi.setTitle(notificationForPu.getTitleNotify() == null ? page.getTitle() : notificationForPu.getTitleNotify());¤		vi.setUnreadCommentCount(notificationForPu.getCountUnreadCommentsNotify());¤		return vi;¤	}¤¤	protected void addMoreLessUrl (Map<String, Object> contextMap, MacroParameter macroParameter,¤			int resCount, int maxListCount) throws Exception {¤		String url = null;¤		HttpServletRequest request = ServletActionContext.getRequest();¤		if (request != null) {¤			url = buildBaseUrl(request, Arrays.asList(getMaxListSizeParameterName()));¤		} else {¤			PageContext context = getPageContext(macroParameter);¤			String baseurl = GlobalHelper.getBaseUrl();¤			url = GeneralUtil.appendAmpsandOrQuestionMark(baseurl + context.getEntity().getUrlPath());¤		}¤		if (resCount > getListSize()) {¤			int newCount = resCount / 2 < getListSize() ? getListSize() : resCount / 2;¤			contextMap.put("showless", url + getMaxListSizeParameterName() + "=" + newCount);¤		}¤		if (resCount < maxListCount) {¤			contextMap.put("showmore", url + getMaxListSizeParameterName() + "=" + resCount * 2);¤		}¤	}¤	¤	private boolean groupSimilar () {¤		return getNotificationUserData().contains("GROUP_SIMILAR_NOTIFICATIONS_ON_DASHBOARD");¤	}¤¤	private boolean showNotificationsOnlyForNonFavouriteSpaces() {¤		return getNotificationUserData().contains("FOLLOW_FOR_NOT_FAVOURITE_CONTENT");¤	}¤¤	private Collection<String> getNotificationUserData () {¤		Collection<String> result;¤		try {¤			final String name = getRemoteUser().getName();¤			result = (Collection<String>) UserData.Factory.get(name, "NotifyParameters").getData();¤		} catch (Exception e) {¤			Logs.LOG_E("PrintNotifyUserMacro::getUserSettings: " + e);¤			result = Collections.emptyList();¤		}¤		return result;¤	}¤	¤	private List<VelocityItem> filteredNotifyList (List<VelocityItem> notifyPages) {¤		if (notifyPages == null || notifyPages.isEmpty()) {¤			return new ArrayList<VelocityItem>();¤		}¤		try {¤			return DashboardQuery.filteredPages(getSession(), notifyPages, DashboardQuery.WITHOUT_CHANGING_AUTHOR_AND_DATE);¤		} catch (Exception e) {¤			Logs.LOG_E("PrintNotifyListMacro::filteredNotifyList: catch Exception - " + e);¤			throw new InfrastructureException(e);¤		}¤	}¤	¤	private boolean isTimeNotification (long startDate) {¤		return startDate > 0;¤	}¤¤	private Session getSession () {¤		final SessionFactory sf = ContainerManager.Factory.get().getSessionFactory();¤		return SessionFactoryUtils.getSession(sf, false);¤	}¤¤//#UC END# *4843E26F016E_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/PrintNotifyListMacro|4843E26F016E
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039228496"))
	    quid       	"4843E26F016E"
	    documentation 	"âîçâðàùàåò áëîê HTML ñî ñïèñêîì êîíòåíòîâ, òðåáóþùèõ âíèìàíèå òåêóùåãî ïîëüçîâàòåëÿ. èñïîëüçóåòñÿ íà äàøáîàðäå."
	    stereotype 	"KMacroPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"4843E31501D9"
		    supplier   	"Logical View::external::JavaConfluence::ConfluencePlugins::AbstractHtmlGeneratingMacro"
		    quidu      	"460A5C880148"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011039962"))
		    quid       	"4843E2FB0270"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotification::UserNotificationService"
		    quidu      	"48414BFC0288"))
	    language   	"MDA Generator")
	(object Class "UserNotificationsXPlugin"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin|48A3D84F01FD
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19011040520"))
	    quid       	"48A3D84F01FD"
	    documentation 	"ñîäåðæèò ôóíêöèîíàëüíîñòü ñâÿçàííóþ ñ çàïðîñàìè, ðåàëèçîâàííóþ c ïîìîùüþ òåõíîëîãèè XWork"
	    stereotype 	"KXWorkPlugin"
	    language   	"MDA Generator"
	    nestedClasses 	(list nestedClasses
		(object Class "UserNotificationsXPackage"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"WikiPageID (wiki)"
			    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin/UserNotificationsXPackage|48A3D89702F4
			    ))
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"SourceType (wiki)"
			    value      	"wiki")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011040796"))
		    quid       	"48A3D89702F4"
		    documentation 	"XWork êîíòåéíåð äëÿ ýêøàíîâ"
		    stereotype 	"XPackage"
		    nestedClasses 	(list nestedClasses
			(object Class "ChangeNotifyMonitoring"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"finished"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"changeNotifyMonitoring")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin/UserNotificationsXPackage/ChangeNotifyMonitoring|48A3D8B000F1
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039229833"))
			    quid       	"48A3D8B000F1"
			    documentation 	"Ïðèâëå÷åíèå âíèìàíèÿ ê êîíòåíòó"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011042371"))
				    quid       	"48A3DA290051"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::ChangeNotifyMonitoring"
				    quidu      	"48A3D9B30032"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011041454"))
				    quid       	"48A448C4023B"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011041911"))
				    quid       	"48A448DB005C"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SendNotifyFromComment"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"finished"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"sendNotifyFromComment")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin/UserNotificationsXPackage/SendNotifyFromComment|48B7F9BB0151
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039119438"))
			    quid       	"48B7F9BB0151"
			    documentation 	"Ïðèâëå÷åíèå âíèìàíèÿ ê êîììåíòàðèþ"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011044287"))
				    quid       	"48B7FA0D0263"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::SendNotifyFromComment"
				    quidu      	"48B7F5260119"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011043386"))
				    quid       	"48B7F9E9002C"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator User Properties"
					    name       	"params"
					    value      	"${@com.atlassian.confluence.util.GeneralUtil@customGetPageUrl(page)}focusedCommentId=${comment.id}#comment-${comment.id}")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011043824"))
				    quid       	"48B7F9F2021F"
				    stereotype 	"redirect"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "NotifyTooltip"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"finished"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"notifyTooltip")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin/UserNotificationsXPackage/NotifyTooltip|490C565E004F
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039123601"))
			    quid       	"490C565E004F"
			    documentation 	"äîêóìåíòàöèÿ îòñóòñòâóåò"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011046199"))
				    quid       	"490C568503AE"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTooltip"
				    quidu      	"490C556700A3"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator User Properties"
					    name       	"xml_name"
					    value      	"ConfluencePlugins/AjaxResponse.xml")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011045298"))
				    quid       	"49114CEF02FF"
				    stereotype 	"velocity-xml"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011045720"))
				    quid       	"49114D280055"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "RemoveNotify"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"finished"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"removeNotify")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin/UserNotificationsXPackage/RemoveNotify|4912A5F7001F
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039125232"))
			    quid       	"4912A5F7001F"
			    documentation 	"äîêóìåíòàöèÿ îòñóòñòâóåò"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011048120"))
				    quid       	"4912A610011F"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTooltip"
				    quidu      	"490C556700A3"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011047216"))
				    quid       	"4912A6340361"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")
				(object ClassAttribute "error"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011047640"))
				    quid       	"4912A641021D"
				    stereotype 	"rawText"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "SendNotifyAgain"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"finished"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"defaultStack")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"sendNotify")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin/UserNotificationsXPackage/SendNotifyAgain|4912A64D013F
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039126846"))
			    quid       	"4912A64D013F"
			    documentation 	"äîêóìåíòàöèÿ îòñóòñòâóåò"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011049789"))
				    quid       	"4912A66F024E"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTooltip"
				    quidu      	"490C556700A3")))
			(object Class "ChangeNotify"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"finished"
				    value      	"true")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"defaultStack")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"changeNotify")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin/UserNotificationsXPackage/ChangeNotify|4917FAB00244
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039128550"))
			    quid       	"4917FAB00244"
			    documentation 	"äîêóìåíòàöèÿ îòñóòñòâóåò"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011051412"))
				    quid       	"4917FAD603B0"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTooltip"
				    quidu      	"490C556700A3")))
			(object Class "DisablePageNotifyMonitoring"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"validatingStack")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"disablePageNotifyMonitoring")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin/UserNotificationsXPackage/DisablePageNotifyMonitoring|4AB236DB02A7
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039168172"))
			    quid       	"4AB236DB02A7"
			    documentation 	"âûçûâàòåñÿ äëÿ ñíÿòèÿ ñëåæåíèÿ çà âñåìè íîòèôèêàöèÿìè íà ñòðàíèöå"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011052942"))
				    quid       	"4AB2375600F6"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::ChangeNotifyMonitoring"
				    quidu      	"48A3D9B30032"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator User Properties"
					    name       	"params"
					    value      	"${notificationContent.urlPath}")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011052424"))
				    quid       	"4AB2370F026B"
				    documentation 	" "
				    stereotype 	"redirect"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "NotifyForExecutors"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"none")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"notifyForExecutors")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"WikiPageID (wiki)"
				    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/UserNotificationsXPlugin/UserNotificationsXPackage/NotifyForExecutors|4B04F8FA0170
				    ))
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"SourceType (wiki)"
				    value      	"wiki")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"19039175995"))
			    quid       	"4B04F8FA0170"
			    documentation 	"íîòèôèêàöèÿ äëÿ ðàçðàáîò÷èêîâ"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011054416"))
				    quid       	"4B04F96E0383"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTooltip"
				    quidu      	"490C556700A3"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator User Properties"
					    name       	"xml_name"
					    value      	"ConfluencePlugins/AjaxResponse.xml")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"19011053949"))
				    quid       	"4B04F98D00B4"
				    stereotype 	"velocity-xml"
				    exportControl 	"Public"
				    Containment 	"By Value")))
			(object Class "ValidatorNotify"
			    attributes 	(list Attribute_Set
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"ElementCreationOrder"
				    value      	"1398677532837911")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"AbstarctOperation"
				    value      	"regular")
				(object Attribute
				    tool       	"MDA Generator"
				    name       	"IsNative"
				    value      	"false")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"interceptor"
				    value      	"defaultStack")
				(object Attribute
				    tool       	"MDA Generator User Properties"
				    name       	"method"
				    value      	"validator"))
			    quid       	"535E201C0341"
			    stereotype 	"XAction"
			    used_nodes 	(list uses_relationship_list
				(object Uses_Relationship
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"1398677553204077")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false"))
				    quid       	"535E203100CB"
				    stereotype 	"call"
				    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTooltip"
				    quidu      	"490C556700A3"))
			    class_attributes 	(list class_attribute_list
				(object ClassAttribute "success"
				    attributes 	(list Attribute_Set
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ElementCreationOrder"
					    value      	"1398677620632935")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"AbstarctOperation"
					    value      	"regular")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"ValueInitialized"
					    value      	"true")
					(object Attribute
					    tool       	"MDA Generator"
					    name       	"IsNative"
					    value      	"false")
					(object Attribute
					    tool       	"MDA Generator User Properties"
					    name       	"xml_name"
					    value      	"ConfluencePlugins/AjaxResponse2.xml"))
				    quid       	"535E2074026B"
				    stereotype 	"velocity-xml"
				    exportControl 	"Public"
				    Containment 	"By Value")))))))
	(object Class "ChangeNotifyMonitoring"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/UserNotificationPlugins/ChangeNotifyMonitoring.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48A3D9B30032_CUSTOM_IMPORT*"
		    value      	"//#UC START# *48A3D9B30032_CUSTOM_IMPORT*¤¤import java.util.*;¤¤import net.sf.hibernate.*;¤¤import org.springframework.orm.hibernate.SessionFactoryUtils;¤¤import com.atlassian.confluence.core.ContentEntityObject;¤¤import ru.garant.MDProcess.ConfluencePlugins.UserData.UserData;¤¤import ru.garant.MDProcess.ConfluencePlugins.*;¤¤//#UC END# *48A3D9B30032_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48A3D9B30032_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *48A3D9B30032_CUSTOM_CLASS_DEFINITION*¤//#UC END# *48A3D9B30032_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48A3D9B30032_ACTION_NAME*"
		    value      	(value Text 
|//#UC START# *48A3D9B30032_ACTION_NAME*¤		return getClass ().getName ();¤		//#UC END# *48A3D9B30032_ACTION_NAME*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48A3D9B30032_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *48A3D9B30032_CUSTOM_METHODS_AND_DATA*¤	¤	private Long idNotify_ = null;¤¤	public void setIdNotify(Long idNotify) {¤		this.idNotify_ = idNotify;¤	}¤¤	public Long getIdNotify() {¤		return this.idNotify_;¤	}¤	¤	private boolean processGroupped_ = false;¤	¤	public void setProcessGroupped(boolean value) {¤		processGroupped_ = value;¤	}¤	¤	private long notificationContentId_;¤	¤	public long getNotificationContentId() {¤		return notificationContentId_;¤	}¤	¤	public void setNotificationContentId(long id) {¤		notificationContentId_ = id;¤	}¤	¤	public ContentEntityObject getNotificationContent() {¤		return ContainerManager.Factory.get().getContentEntityManager().getById(getNotificationContentId());¤	}¤	¤	public String changeNotifyMonitoring () {¤		try {¤			Session session = getHibernateSession();¤			UserWarningRequest uwr = (UserWarningRequest) session.get(UserWarningRequest.class, idNotify_);¤			if (uwr != null) {¤				updateMonitoring(session, uwr);¤			} else {¤				Logs.LOG_E("ChangeNotifyMonitoring::changeNotifyMonitoring - "¤						+ "cant find UserWarningRequest by id='" + idNotify_ + "'");¤				return ERROR;¤			}¤		} catch (HibernateException e) {¤			Logs.LOG_SEX(e);¤			return ERROR;¤		}¤		return SUCCESS;¤	}¤¤	public String disablePageNotifyMonitoring () {¤		try {¤			Session session = getHibernateSession();¤			Query q = session.createQuery("from UserWarningRequest as uwr" +¤					" where uwr.user=:userName" +¤					" and uwr.content.id=:contentId" +¤					" and uwr.needMonitoring=:needMonitoring");¤			q.setString("userName", getRemoteUser().getName())¤				.setLong("contentId", getNotificationContentId()).setBoolean("needMonitoring", true);¤			for (UserWarningRequest uwr : (List<UserWarningRequest>) q.list()) {¤				uwr.setNeedMonitoring(false);¤				session.saveOrUpdate(uwr);¤			}¤		} catch (HibernateException e) {¤			Logs.LOG_SEX(e);¤			return ERROR;¤		}¤		¤		return SUCCESS;¤	}¤	¤	private void updateMonitoring (Session session, UserWarningRequest uwr) throws HibernateException {¤		List<UserWarningRequest> uwrs = new ArrayList<UserWarningRequest>();¤		uwrs.add(uwr);¤¤		if (processGroupped_ && groupSimilar()) {¤			Query similarQuery = session.createQuery("from UserWarningRequest as uwr where "¤					+ "uwr.user=:user and uwr.content.id=:contentid");¤			similarQuery.setString("user", uwr.getUser()).setLong("contentid", uwr.getContent().getId());¤			uwrs.addAll(similarQuery.list());¤		}¤		¤		boolean needMonitoring = !uwr.getNeedMonitoring();¤		for (UserWarningRequest eachUwr : uwrs) {¤			eachUwr.setNeedMonitoring(needMonitoring);¤			session.saveOrUpdate(eachUwr);¤		}¤	}¤	¤	private Collection<String> getNotificationUserData () {¤		Collection<String> result;¤		try {¤			final String name = getRemoteUser().getName();¤			result = (Collection<String>) UserData.Factory.get(name, "NotifyParameters").getData();¤		} catch (Exception e) {¤			Logs.LOG_E("PrintNotifyUserMacro::getUserSettings: " + e);¤			result = Collections.emptyList();¤		}¤		return result;¤	}¤	¤	private boolean groupSimilar () {¤		return getNotificationUserData().contains("GROUP_SIMILAR_NOTIFICATIONS_ON_DASHBOARD");¤	}¤	¤	private Session getHibernateSession() {¤		return SessionFactoryUtils.getSession(ContainerManager.Factory.get()¤		                  					.getSessionFactory(), false);¤	}¤	//#UC END# *48A3D9B30032_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/ChangeNotifyMonitoring|48A3D9B30032
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039231459"))
	    quid       	"48A3D9B30032"
	    documentation 	"íàñòðîéêà ñëåæåíèå çà èçìåíåíèÿìè êîíòåíòà"
	    stereotype 	"KActionPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"48A3DC510063"
		    supplier   	"Logical View::external::ConfluenceSupport::com.atlassian.confluence.coreImpl::ConfluenceActionSupport"
		    quidu      	"468C9C950186"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011056007"))
		    quid       	"48A3D9E900B3"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotification::UserNotificationService"
		    quidu      	"48414BFC0288"))
	    language   	"MDA Generator")
	(object Class "SendNotifyFromComment"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/UserNotificationPlugins/SendNotifyFromComment.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48B7F5260119_CUSTOM_IMPORT*"
		    value      	"//#UC START# *48B7F5260119_CUSTOM_IMPORT*¤¤import org.apache.commons.lang.StringUtils;¤¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.Comment;¤import com.atlassian.confluence.pages.CommentManager;¤import com.atlassian.confluence.pages.PageManager;¤¤//#UC END# *48B7F5260119_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48B7F5260119_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *48B7F5260119_CUSTOM_CLASS_DEFINITION*¤//#UC END# *48B7F5260119_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48B7F5260119_ACTION_NAME*"
		    value      	(value Text 
|//#UC START# *48B7F5260119_ACTION_NAME*¤		return getClass().getName();¤		//#UC END# *48B7F5260119_ACTION_NAME*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48B7F5260119_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *48B7F5260119_CUSTOM_METHODS_AND_DATA*¤	¤	public String sendNotifyFromComment () throws Exception {¤		try {¤			String users = notifyBody_;¤			String params = null;¤			if (notifyBody_.contains("|")) {¤				int parametersPosition = notifyBody_.indexOf("|");¤				users = notifyBody_.substring(0, parametersPosition);¤				params = notifyBody_.substring(parametersPosition).trim();¤			}¤			String newNotifyString = "{html}<br>{html}";¤			String notifyText = users;¤			if (StringUtils.isNotBlank(params)) {¤				notifyText += params;¤			}¤			newNotifyString += UserNotificationService.Factory.create().getNotifyMacroString(notifyText);¤			comment_.setContent(comment_.getContent() + newNotifyString);¤¤			return SUCCESS;¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤			throw e;¤		}¤	}¤¤	private String notifyBody_ = null;¤¤	public void setNotifyBody (String notifyBody) {¤		notifyBody_ = notifyBody;¤	}¤¤	private Comment comment_ = null;¤¤	public void setCommentId (String commentId) {¤		comment_ = getCommentManager().getComment(Long.valueOf(commentId));¤	}¤¤	private AbstractPage page_ = null;¤¤	public void setPageId (String pageId) {¤		page_ = getPageManager().getAbstractPage(Long.valueOf(pageId));¤	}¤¤	public CommentManager getCommentManager () {¤		return ContainerManager.Factory.get().getCommentManager();¤	}¤¤	public PageManager getPageManager () {¤		return ContainerManager.Factory.get().getPageManager();¤	}¤¤	public Comment getComment () {¤		return comment_;¤	}¤¤	public AbstractPage getPage () {¤		return page_;¤	}¤	¤	//#UC END# *48B7F5260119_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/SendNotifyFromComment|48B7F5260119
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19027274174"))
	    quid       	"48B7F5260119"
	    documentation 	"ïðèâëå÷ü âíèìàíèå ê ÷óæîìó êîììåíòàðèþ"
	    stereotype 	"KActionPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"48B7F58B034E"
		    supplier   	"Logical View::external::ConfluenceSupport::com.atlassian.confluence.coreImpl::ConfluenceActionSupport"
		    quidu      	"468C9C950186"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011056956"))
		    quid       	"48B7F5930362"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotification::UserNotificationService"
		    quidu      	"48414BFC0288")
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011057333"))
		    quid       	"491C00CA015C"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTimerTaskJob"
		    quidu      	"48F6F9F5035E"))
	    language   	"MDA Generator")
	(object Class "NotifyTimerTaskJob"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/NotifyTimerTaskJob|48F6F9F5035E
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/UserNotificationPlugins/NotifyTimerTaskJob.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48F6F9F5035E_CUSTOM_IMPORT*"
		    value      	"//#UC START# *48F6F9F5035E_CUSTOM_IMPORT*¤import ru.garant.shared.ConfluenceCore.ActionSupport.ActionContextThreadLocalFactory;¤//#UC END# *48F6F9F5035E_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48F6F9F5035E_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *48F6F9F5035E_CUSTOM_CLASS_DEFINITION*¤//#UC END# *48F6F9F5035E_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48F6F9F5035E_DO_EXECUTE_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *48F6F9F5035E_DO_EXECUTE_IMPLEMETATION*¤		super.doExecute(jec);¤		//#UC END# *48F6F9F5035E_DO_EXECUTE_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*48F6F9F5035E_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *48F6F9F5035E_CUSTOM_METHODS_AND_DATA*¤	@Override¤	protected void executeJob() {¤		UserNotificationService.Factory.create().processTimeScheduledUserNotifications();¤	}¤	¤	protected boolean isNeedWriteTransaction() {¤		return true;¤	}¤	¤	//#UC END# *48F6F9F5035E_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory auto reg"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Factory default impl"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Need unsorted less"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"Servant Pool"
		    value      	"none")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"cron-expression"
		    value      	"0 0/10 * * * ?")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"debug log"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"finished"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"local supervisor"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"need UC"
		    value      	"true")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"repeated"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"singleton"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator User Properties"
		    name       	"factory priority"
		    value      	"0")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ImplementSelectType"
		    value      	"all")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"OverloadSelectType"
		    value      	"include")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ApplyedGens"
		    value      	"All")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19027293845"))
	    quid       	"48F6F9F5035E"
	    documentation 	"ïåðåîäè÷åñêè (ðàç â 10 ìèíóò) çàäà÷à äëÿ ïîñûëêè íîòèôèêàöèé"
	    stereotype 	"KJobPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"1337600020813723"))
		    quid       	"4FBA2814032C"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::EntitySupport::GarantAbstractJobWithLock"
		    quidu      	"4FBA1F4403CC"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011058309"))
		    quid       	"48F6FA9B016A"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotification::UserNotificationService"
		    quidu      	"48414BFC0288"))
	    language   	"MDA Generator")
	(object Class "NotifyTooltip"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/UserNotificationPlugins/NotifyTooltip.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*490C556700A3_CUSTOM_IMPORT*"
		    value      	"//#UC START# *490C556700A3_CUSTOM_IMPORT*¤import ru.garant.MDProcess.ConfluencePlugins.UserData.UserData;¤import ru.garant.shared.GCI.I18N.Messages;¤import ru.garant.shared.GCL.DateUtils;¤¤import java.util.ArrayList;¤import java.util.Arrays;¤import java.util.Collection;¤import java.util.Collections;¤import java.util.Date;¤import java.util.Iterator;¤import java.util.List;¤import java.util.Map;¤import java.util.Set;¤import java.util.regex.Matcher;¤import java.util.regex.Pattern;¤¤import ru.garant.MDProcess.ConfluencePlugins.UserWarning;¤import ru.garant.MDProcess.ConfluencePlugins.UserWarningRequest;¤¤import org.apache.commons.lang.StringUtils;¤¤import com.atlassian.confluence.mail.notification.NotificationManager;¤import com.atlassian.confluence.pages.AbstractPage;¤import com.atlassian.confluence.pages.Comment;¤import com.atlassian.confluence.pages.CommentManager;¤import com.atlassian.confluence.pages.PageManager;¤import com.atlassian.confluence.renderer.radeox.macros.MacroUtils;¤import com.atlassian.confluence.security.Permission;¤import com.atlassian.confluence.security.PermissionManager;¤import com.atlassian.confluence.spaces.Space;¤import com.atlassian.confluence.user.AuthenticatedUserThreadLocal;¤import com.atlassian.confluence.user.UserAccessor;¤import com.atlassian.confluence.util.velocity.VelocityUtils;¤import com.atlassian.core.task.MultiQueueTaskManager;¤import com.atlassian.renderer.WikiStyleRenderer;¤import com.atlassian.user.Group;¤import com.atlassian.user.User;¤import com.opensymphony.util.TextUtils;¤¤import ru.garant.MDProcess.ConfluenceMDChange.MDChangeDAO.AbstractRequestDAOProxy;¤import ru.garant.MDProcess.ConfluenceMDChange.Requests.AbstractRequestLifeCycle;¤import ru.garant.MDProcess.ConfluenceMDChange.Requests.CommonRequestManager;¤import ru.garant.MDProcess.ConfluenceMDChange.Requests.sm.AbstractRequestLifeCycle.AbstractState;¤import ru.garant.MDProcess.ConfluenceMDChange.Requests.sm.AbstractRequestLifeCycle.Active;¤¤import com.atlassian.confluence.core.ContentEntityObject;¤¤import ru.garant.MDProcess.ConfluencePlugins.UserNotification.UserNotification;¤¤//#UC END# *490C556700A3_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*490C556700A3_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *490C556700A3_CUSTOM_CLASS_DEFINITION*¤//#UC END# *490C556700A3_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*490C556700A3_ACTION_NAME*"
		    value      	(value Text 
|//#UC START# *490C556700A3_ACTION_NAME*¤		return getClass().getName();¤		//#UC END# *490C556700A3_ACTION_NAME*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*490C556700A3_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *490C556700A3_CUSTOM_METHODS_AND_DATA*¤¤	private static final String NOTIFY_TOOLTIP_TEMPLATE_PATH = "/ConfluencePlugins/UserNotificationUnit/notifytooltipcontent.vm";¤¤	public String notifyTooltip() {¤		try {¤			if (StringUtils.isEmpty(notifyTo_))¤				setFullNamesNotifyTo(Messages.Factory.messages().get(¤						"editnotifymonitoring.no.specifed"));¤			if (StringUtils.isEmpty(titleNotify_))¤				setTitleNotify(Messages.Factory.messages().get(¤						"editnotifymonitoring.no.specifed"));¤			if (StringUtils.isEmpty(cycleNotify_) || cycleNotify_.equals("0")) {¤				setCycleNotify(Messages.Factory.messages().get(¤						"editnotifymonitoring.no.specifed"));¤			} else {¤				Date cycleDate = new Date();¤				long cycle = Long.valueOf(cycleNotify_);¤				cycleDate.setTime(cycle);¤				setCycleNotify(DateUtils.formatDHDateFullDay(cycleDate));¤			}¤			if (StringUtils.isEmpty(durationNotify_)¤					|| durationNotify_.equals("0")) {¤				setDurationNotify(Messages.Factory.messages().get(¤						"editnotifymonitoring.no.specifed"));¤			} else {¤				Date durationDate = new Date();¤				long duration = Long.valueOf(durationNotify_);¤				durationDate.setTime(duration);¤				setDurationNotify(durationDate.toLocaleString());¤¤			}¤			if (StringUtils.isEmpty(startDateNotify_)¤					|| startDateNotify_.equals("0")) {¤				setStartDateNotify(Messages.Factory.messages().get(¤						"editnotifymonitoring.no.specifed"));¤			} else {¤				Date startDateNotify = new Date();¤				long startDate = Long.valueOf(startDateNotify_);¤				startDateNotify.setTime(startDate);¤				setStartDateNotify(startDateNotify.toLocaleString());¤			}¤¤			if (!StringUtils.isEmpty(macrosNotifyString_)¤					&& !StringUtils.isEmpty(notifyTo_)) {¤				final UserNotificationService notificationService = UserNotificationService.Factory.create();¤				long id = notificationService.getIdNotifyFromMatcher(macrosNotifyString_);¤				userNotification_ = notificationService.getPersonalUserNotification(¤						AuthenticatedUserThreadLocal.getUsername(), id);¤				UserWarning uw = notificationService.getMacrosNotifyParameters(id);¤				defNotify_ = isDateDeffered();¤				boolean isSender = false;¤				if(userNotification_ != null)¤					isSender = userNotification_.getSender().equals(notifyTo_);¤				isSender_ = isSender;¤¤				List<String> namesToNotify = getUserNamesToNotifyWithoutValidation(¤						notifyTo_, false, uw);¤				String listNotify = namesToNotify.toString();¤				listNotify = listNotify.substring(1, listNotify.length() - 1);¤				setFullNamesNotifyTo(listNotify);¤			}¤¤			responseContent = renderTooltip();¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤		return SUCCESS;¤	}¤¤	public String notifyForExecutors() {¤		try {¤			String pastInEditFormString = "";¤			String curExecutor = "";¤			long curState = -1;¤			long prevCurState = -1;¤			String prevCurExecutor = "";¤			if (renderPageId_ != 0) {¤				for (Long id : CommonRequestManager.Factory.get()¤						.getAllVersionIds(renderPageId_)) {¤					AbstractRequestDAOProxy dao = AbstractRequestDAOProxy¤							.get(id);¤					curExecutor = dao.getDeveloper();¤					curState = dao.getState();¤					if (prevCurState == -1) {¤						prevCurState = curState;¤					} else if (curExecutor != null¤							&& !curExecutor.isEmpty()¤							&& prevCurState != curState¤							&& Byte.parseByte(curState + "") == ((AbstractState) AbstractRequestLifeCycle.ST_ACTIVE)¤									.getSortValue()) {¤						if (pastInEditFormString.isEmpty()) {¤							pastInEditFormString = prevCurExecutor;¤						} else if (prevCurExecutor != null ¤								&& !pastInEditFormString.contains(prevCurExecutor)) {¤							pastInEditFormString = pastInEditFormString + ", "¤									+ prevCurExecutor;¤						}¤¤					}¤					if (prevCurState != curState)¤						prevCurState = curState;¤					prevCurExecutor = curExecutor;¤				}¤				if (!pastInEditFormString.isEmpty()) {¤					responseContent = "<fullNamesIdString>"¤							+ UserNotificationService.Factory.create()¤									.getNotifyMacroString(pastInEditFormString)¤							+ "</fullNamesIdString>";¤				}¤			}¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤¤		return SUCCESS;¤	}¤¤	public String removeNotify() {¤		removeNotifyInDB();¤		if (renderCommentId_ != renderPageId_) {¤			CommentManager manager = ContainerManager.Factory.get()¤					.getCommentManager();¤			Comment comment = (Comment) manager.getById(renderCommentId_);¤			String content = deleteNotifyFromContent(comment.getContent());¤			comment.setContent(content);¤			manager.refreshContentEntity(comment);¤		} else {¤			PageManager manager = ContainerManager.Factory.get()¤					.getPageManager();¤			AbstractPage page = (AbstractPage) manager.getById(renderPageId_);¤			String content = deleteNotifyFromContent(page.getContent());¤			page.setContent(content);¤			try {¤				manager.refreshContentEntity(page);¤			} catch (Exception ex) {¤				Logs.LOG_SEX(ex);¤			}¤		}¤		return SUCCESS;¤	}¤¤	public String sendNotify() {¤		if (getHasError()) {¤			return SUCCESS;¤		} ¤		¤		if (!StringUtils.isEmpty(macrosNotifyString_)) {¤			removeNotifyInDB();¤		} else {¤			String[] errorString = getErrorHTMLString();¤¤			if (StringUtils.isEmpty(notifyTo_)¤					|| notifyTo_.equals(Messages.Factory.messages().get(¤							"editnotifymonitoring.no.specifed"))) {¤				errorString[0] = Messages.Factory.messages().get(¤						"notifytooltipcontent.blank.name");¤				setErrorCode(VALIDATION_FAILED_NAMES);¤				setErrorMessage(errorString);¤				return SUCCESS;¤			}¤			if (editContent_ == true) {¤				String pastInEditFormString = notifyTo_;¤				if (StringUtils.isNotEmpty(titleNotify_)¤						&& !titleNotify_.equals(Messages.Factory.messages()¤								.get("editnotifymonitoring.no.specifed"))) {¤					pastInEditFormString += ("|title=" + titleNotify_);¤				}¤¤				if (StringUtils.isNotEmpty(startDateNotify_)¤						&& !startDateNotify_.equals(Messages.Factory.messages()¤								.get("editnotifymonitoring.no.specifed"))) {¤					pastInEditFormString += ("|date=" + startDateNotify_);¤				}¤				if (StringUtils.isNotEmpty(cycleNotify_)¤						&& !cycleNotify_.equals(Messages.Factory.messages()¤								.get("editnotifymonitoring.no.specifed"))) {¤					pastInEditFormString += ("|cycle=" + cycleNotify_);¤				}¤				if (StringUtils.isNotEmpty(durationNotify_)¤						&& !durationNotify_.equals(Messages.Factory.messages()¤								.get("editnotifymonitoring.no.specifed"))) {¤					pastInEditFormString += ("|duration=" + durationNotify_);¤				}¤¤				errorString[1] = UserNotificationService.Factory.create()¤						.getNotifyMacroString(pastInEditFormString);¤				setErrorMessage(errorString);¤				return SUCCESS;¤			}¤		}¤¤		preventDefaultValues();¤		UserWarning uw = saveChangesNotify(-1, getNames());¤		if (uw != null) {¤			if (renderCommentId_ != renderPageId_) {¤				CommentManager manager = ContainerManager.Factory.get()¤						.getCommentManager();¤				Comment comment = (Comment) manager.getById(renderCommentId_);¤				try {¤					String content = changeNotifyInContent(¤							comment.getContent(), uw.getId());¤					comment.setContent(content);¤					manager.refreshContentEntity(comment);¤				} catch (Exception ex) {¤					Logs.LOG_SEX(ex);¤				}¤¤			} else {¤				PageManager manager = ContainerManager.Factory.get()¤						.getPageManager();¤				AbstractPage page = (AbstractPage) manager¤						.getById(renderPageId_);¤				try {¤					String content = changeNotifyInContent(page.getContent(),¤							uw.getId());¤					page.setContent(content);¤					manager.refreshContentEntity(page);¤				} catch (Exception ex) {¤					Logs.LOG_SEX(ex);¤				}¤			}¤		}¤¤		return SUCCESS;¤	}¤¤	List<String> names_ = null;¤¤	public List<String> getNames() {¤		if (names_ == null) {¤			names_ = getUserNamesToNotify(notifyTo_, false);¤		}¤		return names_;¤	}¤¤	public String changeNotify() {¤		String[] errorString = getErrorHTMLString();¤		if (StringUtils.isEmpty(notifyTo_)) {¤			setErrorCode(VALIDATION_FAILED_NAMES);¤			errorString[0] = Messages.Factory.messages().get(¤					"notifytooltipcontent.blank.name");¤			setErrorMessage(errorString);¤			return SUCCESS;¤		}¤		if (getNames() == null) {¤			return SUCCESS;¤		}¤		preventDefaultValues();¤¤		Date currentDate = new Date();¤		long now = currentDate.getTime();¤		String message = Messages.Factory.messages().get(¤		"editnotifymonitoring.no.specifed");¤		String startDateN = startDateNotify_;¤		if(message.equals(startDateNotify_)){¤			startDateN = "";¤		}¤¤		long startDate = DateUtils.parseCombinedDate(startDateN, now);¤		Date beginDate = new Date();¤		beginDate.setTime(startDate);¤		if (beginDate.getDay() == currentDate.getDay()¤				&& beginDate.getMonth() == currentDate.getMonth()¤				&& beginDate.getYear() == currentDate.getYear()¤				&& beginDate.getHours() == 0 && beginDate.getMinutes() == 0¤				&& beginDate.getSeconds() == 0) {¤			startDate = now;¤			startDateNotify_ = currentDate.toLocaleString();¤		}¤		long cycle = DateUtils.parseCombinedDate(cycleNotify_, false);¤		long endDate = DateUtils.parseCombinedDate(durationNotify_, startDate);¤		Date durationDate = new Date();¤		durationDate.setTime(endDate);¤		if (startDate < 0) {¤			errorString[0] = Messages.Factory.messages().get(¤					"notifytooltipcontent.invalid.start.date");¤			setErrorCode(VALIDATION_FAILED_START_DATE);¤			setErrorMessage(errorString);¤		} else if (startDate != 0 && startDate < System.currentTimeMillis()) {¤			errorString[0] = Messages.Factory.messages().get(¤					"notifytooltipcontent.blank.start.date");¤			setErrorCode(VALIDATION_FAILED_START_DATE);¤			setErrorMessage(errorString);¤		} else if (cycle < 0) {¤			errorString[0] = Messages.Factory.messages().get(¤					"notifytooltipcontent.invalid.cycle");¤			setErrorCode(VALIDATION_FAILED_CYCLE);¤			setErrorMessage(errorString);¤		} else if (endDate < 0 || (endDate > 0 && cycle == 0)) {¤¤			setErrorCode(VALIDATION_FAILED_DURATION);¤			if (endDate < 0) {¤				errorString[0] = Messages.Factory.messages().get(¤						"notifytooltipcontent.invalid.end.date");¤				setErrorMessage(errorString);¤			} else {¤				errorString[0] = Messages.Factory.messages().get(¤						"notifytooltipcontent.blank.duration");¤				setErrorMessage(errorString);¤			}¤		} else if (macrosNotifyString_.equals("")) {¤			return sendNotify();¤		} else {¤			long id = UserNotificationService.Factory.create()¤					.getIdNotifyFromMatcher(macrosNotifyString_);¤			if (id > 0) {¤				if (titleNotify_ != null¤						&& (titleNotify_.equals("") || titleNotify_¤								.equals(Messages.Factory.messages().get(¤										"editnotifymonitoring.no.specifed"))))¤					titleNotify_ = null;¤¤				saveChangesNotify(id, getNames());¤			}¤		}¤		return SUCCESS;¤	}¤¤	public boolean isStartDateLater() {¤		long now = new Date().getTime();¤		String date = isNotifyParameterEmpty(startDateNotify_);¤		if (date == null)¤			return false;¤		long startDate = DateUtils.parseCombinedDate(date, now);¤		Date currentDate = new Date();¤		Date startingDate = new Date();¤		startingDate.setTime(startDate);¤		if (currentDate.after(startingDate))¤			return false;¤		else¤			return true;¤	}¤¤	private String renderTooltip() {¤		// now create a simple velocity context and render a template for the¤		// output¤		Map<String, Object> contextMap = MacroUtils.defaultVelocityContext();¤		if(macrosNotifyString_.isEmpty()){¤			notifyDismissed_ = false;¤		}¤		contextMap.put("renderCommentId", renderCommentId_);¤		contextMap.put("renderPageId", renderPageId_);¤		contextMap.put("action", this);¤		contextMap.put("macrosNotifyString", macrosNotifyString_);¤		contextMap.put("editContent", editContent_);¤		contextMap.put("spaceKey", spaceKey_);¤		contextMap.put("parentId", parentId_);¤		contextMap.put("isSender", isSender_);¤		contextMap.put("defNotify", defNotify_);¤		contextMap.put("notifyDismissed", notifyDismissed_);¤		return VelocityUtils.getRenderedTemplate(NOTIFY_TOOLTIP_TEMPLATE_PATH,¤				contextMap);¤	}¤¤	private AbstractPage getPage(ContentEntityObject renderEntity) {¤		if (renderEntity instanceof Comment) {¤			return ((Comment) renderEntity).getPage();¤		}¤		return ((AbstractPage) renderEntity);¤	}¤¤	private String deleteNotifyFromContent(String bodyContent) {¤		String bodyContentStart, bodyContentEnd;¤		bodyContentStart = bodyContent.substring(0, bodyContent¤				.indexOf(macrosNotifyString_));¤		bodyContentEnd = bodyContent.substring(bodyContentStart.length()¤				+ macrosNotifyString_.length());¤		return bodyContentStart + bodyContentEnd;¤	}¤¤	private String isNotifyParameterEmpty(String param) {¤		if (Messages.Factory.messages().get("editnotifymonitoring.no.specifed")¤				.equals(param))¤			return null;¤		return param;¤	}¤¤	private String removeNotifyInDB() {¤		UserNotificationService.Factory.create().deleteNotificationMacroses(¤				macrosNotifyString_);¤		return SUCCESS;¤	}¤¤	private UserWarning saveChangesNotify(long id, List<String> names) {¤		ContentEntityObject ceo = null;¤		if (renderCommentId_ != renderPageId_)¤			ceo = ContainerManager.Factory.get().getCommentManager()¤					.getComment(renderCommentId_);¤		else¤			ceo = ContainerManager.Factory.get().getPageManager()¤					.getAbstractPage(renderCommentId_);¤		String notifyNames = "";¤		for(String name : names_){¤			if(!notifyNames.isEmpty()){¤				notifyNames+= ",";¤			}¤			notifyNames+= name;¤		}¤		if(dateNotify_ == null){¤			dateNotify_ = new Date();¤		}¤		return updateNotifyMacroInBD(notifyNames, titleNotify_, ceo,¤				startDateNotify_, durationNotify_, cycleNotify_, id, names, dateNotify_);¤	}¤¤	private String changeNotifyInContent(String bodyContent, long id) {¤		String bodyContentStart, bodyContentEnd, content;¤		String bodyContentCopy = bodyContent;¤		if (StringUtils.isNotEmpty(macrosNotifyString_)) {¤			bodyContentStart = bodyContentCopy.substring(0, bodyContentCopy¤					.indexOf(macrosNotifyString_));¤			bodyContentCopy = bodyContentCopy.substring(bodyContentStart¤					.length());¤			if (bodyContentCopy.length() > macrosNotifyString_.length())¤				bodyContentEnd = bodyContentCopy.substring(macrosNotifyString_¤						.length());¤			else¤				bodyContentEnd = "";¤		} else {¤			bodyContentStart = bodyContentCopy;¤			bodyContentEnd = "";¤		}¤		content = UserNotificationService.Factory.create()¤				.getNotifyMacroString("id=" + id);¤		return bodyContentStart + " " + content + bodyContentEnd;¤	}¤¤	private void preventDefaultValues() {¤		if (titleNotify_ != null¤				&& (titleNotify_.equals(Messages.Factory.messages().get(¤						"editnotifymonitoring.no.specifed")) || titleNotify_¤						.equals(""))) {¤			titleNotify_ = null;¤		}¤		if (startDateNotify_ != null¤				&& (startDateNotify_.equals(Messages.Factory.messages().get(¤						"editnotifymonitoring.no.specifed")) || startDateNotify_¤						.equals(""))) {¤			startDateNotify_ = null;¤		}¤		if (durationNotify_ != null¤				&& (durationNotify_.equals(Messages.Factory.messages().get(¤						"editnotifymonitoring.no.specifed")) || durationNotify_¤						.equals(""))) {¤			durationNotify_ = null;¤		}¤		if (cycleNotify_ != null¤				&& (cycleNotify_.equals(Messages.Factory.messages().get(¤						"editnotifymonitoring.no.specifed")) || cycleNotify_¤						.equals(""))) {¤			cycleNotify_ = null;¤		}¤	}¤¤	// error message¤	private boolean isHTMLResponse_ = true;¤	private String extendedResponse_ = "";¤¤	protected String getExtendedResponse() {¤		return extendedResponse_;¤	}¤¤	protected void addToResponse(String info) {¤		extendedResponse_ += info;¤	}¤¤	protected void setIsHTMLResponse(boolean value) {¤		isHTMLResponse_ = value;¤	}¤¤	protected boolean getIsHTMLResponse() {¤		return isHTMLResponse_;¤	}¤¤	public String getResponse() {¤		String ret = "";¤		String[] a = getErrorHTMLString();¤		if(VALIDATION_NOT_SEND_ONE_NAME == errorCode_ || VALIDATION_NOT_SEND_NAMES == errorCode_){¤			a[0] = a[0].replace("{0}", "");¤			a[0] = a[0].replace("{1}", "");¤			a[0] = a[0].replace("{2}", "");¤			a[0] = a[0].replace("{3}", "");¤			if(VALIDATION_NOT_SEND_ONE_NAME == errorCode_){¤				for(int i = 58; i < a[0].length(); i=i+58){¤					if(i >= a[0].length()){¤						i = a[0].length() - 1;¤					}¤					if(a[0].substring(i, i+1) != " "){¤						while(i < a[0].length() && !a[0].substring(i, i+1).equals(" ")){¤							i++;¤						}	¤					}¤					a[0] = a[0].substring(0, i) + "<br>" + a[0].substring(i, a[0].length());¤				}¤			}¤		}¤¤		if (getHasError() && VALIDATION_NOT_SEND_NAMES != errorCode_) {¤			ret += "<has-error code=\"" + getErrorCode() + "\"><![CDATA[";¤			if(errorCode_ == VALIDATION_MANY_USERS_ON_ONE_SURNAME){¤				ret += a[0];¤			}else{¤				if (isHTMLResponse_) {¤					ret += "<span class=\"errorMessage\">";¤					if (a[0] != null){¤						ret += a[0];¤					}	¤					ret += "</span>";¤				} else {¤					if (a[0] != null)¤						ret += a[0].replaceAll("<.+>", "");¤				}¤			}¤		¤			ret += "]]></has-error>";¤		} else {¤			if (a[0] != null)¤				ret += "<errorString>" + a[0] + "</errorString>";¤			if (a[1] != null)¤				ret += "<fullNamesIdString>" + a[1] + "</fullNamesIdString>";¤		}¤		ret += getExtendedResponse();¤		return ret;¤	}¤¤	private String[] errorMessage_ = new String[2];¤¤	protected String[] getErrorMessage() {¤		return errorMessage_;¤	}¤¤	protected void setErrorMessage(String[] errorMessage) {¤		errorMessage_ = errorMessage;¤	}¤¤	private int errorCode_ = 0;¤¤	protected int getErrorCode() {¤		return errorCode_;¤	}¤¤	protected void setErrorCode(int code) {¤		errorCode_ = code;¤	}¤¤	public boolean getHasError() {¤		return (errorCode_ != 0);¤	}¤¤	public String[] getErrorHTMLString() {¤		return errorMessage_;¤	}¤¤	// end error message¤	private List<String> extractNamesWithoutValidation(String notifier,¤			boolean expandGroups, UserWarning uw) {¤		String[] errorString = getErrorHTMLString();¤		String name = TextUtils.innerTrim(notifier);¤		GarUserAccessor ua = ContainerManager.Factory.get().getUserAccessor();¤		User user = ua.getUser(name);¤¤		if (user != null) {¤			Set<UserWarningRequest> listUWR = uw.getUserWarningNotifications();¤			for(UserWarningRequest uwr : listUWR){¤				if(uwr.getUser().equals(user.getName()) && uwr.getNeedMonitoring() == false && !isDateDeffered() && !isSender_){¤					return Arrays.asList("<span style='color: rgb(102, 102, 102)'>" + user.getFullName() + "</span>");¤				}	¤			}¤			notifyDismissed_ = false;¤			return Arrays.asList(user.getFullName());¤		}	¤¤		Group group = ua.getGroup(name);¤		if (group != null) {¤			notifyDismissed_ = false;¤			if (expandGroups) {¤				return ua.getMemberNamesAsList(group);¤			} else {¤				return Arrays.asList(group.getName());¤			}¤		}¤		setErrorCode(VALIDATION_FAILED_NAMES);¤		errorString[0] = Messages.Factory.messages().get(¤				"notifytooltipcontent.invalid.name") + " " + name;¤		setErrorMessage(errorString);¤¤		return Arrays.asList();¤	}¤¤	private boolean isDateDeffered(){¤		long now = new Date().getTime();¤		String message = Messages.Factory.messages().get(¤		"editnotifymonitoring.no.specifed");¤		String startDate = startDateNotify_;¤		if(message.equals(startDateNotify_)){¤			startDate = "";¤		}¤		Long date = DateUtils.parseCombinedDate(startDate, now);¤		return date != 0 && date > now;¤	}¤	¤	private List<String> getUserNamesToNotifyWithoutValidation(¤			String notificationNames, boolean expandGroups, UserWarning uw) {¤		String notifiers[] = notificationNames.split(",");¤		int i = 0;¤		List<String> result = new ArrayList<String>();¤		for (String notifier : notifiers) {¤			List<String> notifierUserNames = extractNamesWithoutValidation(¤					notifier, expandGroups, uw);¤			result.addAll(notifierUserNames);¤			if(i == SPACER_NAMES){¤				i = 0;¤				String value = result.get(result.size() - 1);¤				result.set(result.size() - 1,  "<br/>" + value);¤			}¤			i++;¤¤		}¤		return result;¤	}¤	¤	private List<String> getUserNamesToNotify(String notificationNames) {¤		String notifiers[] = notificationNames.split(",");¤¤		List<String> result = new ArrayList<String>();¤		for (String notifier : notifiers) {¤			List<String> notifierUserNames = extractNames(notifier, notifiers.length);¤			result.addAll(notifierUserNames);¤		}¤		return result;¤	}¤¤	private UserNotification createNotification(String title,¤			ContentEntityObject content, ContentEntityObject warningPlace,¤			String startDateStr, String durationStr, String cycleStr, Date date) {¤		User user = getRemoteUser();¤		UserNotification notify = new UserNotification(title, content,¤				warningPlace, true, user.getName(), date);¤¤		long now = new Date().getTime();¤¤		long startDate = DateUtils.parseCombinedDate(startDateStr, now);¤		long cycle = DateUtils.parseCombinedDate(cycleStr, false);¤		long endDate;¤		if (startDate == 0)¤			endDate = DateUtils.parseCombinedDate(durationStr, now);¤		else¤			endDate = DateUtils.parseCombinedDate(durationStr, startDate);¤¤		notify.setStartDate(startDate);¤		notify.setCycle(cycle);¤		notify.setEndDate(endDate);¤¤		return notify;¤	}¤¤	private UserWarning updateNotifyMacroInBD(String notificationNames,¤			String title, ContentEntityObject renderEntity, String startDate,¤			String duration, String cycle, long id, List<String> userNames, Date date) {¤		UserWarning uw = null;¤		try {¤			UserNotification notify = createNotification(title,¤					getPage(renderEntity), renderEntity, startDate, duration,¤					cycle, date);¤¤			try {¤				UserNotificationService unService = UserNotificationService.Factory¤						.create();¤				UserWarning parent = null;¤				java.util.Set<UserWarningRequest> uwr = null;¤				if (id != -1) {¤					parent = unService.getMacrosNotifyParameters(id);¤					uwr = parent.getUserWarningNotifications();¤				}¤				uwr = unService.saveOrUpdateUsersNotification(notify,¤						new ArrayList<String>(userNames), uwr, USER_TYPE,¤						parent);¤				if (uwr == null)¤					return null;¤				uw = unService.saveOrUpdateUserNotificationsMacro(id, uwr,¤						notifyTo_);¤			} catch (Exception e) {¤				Logs.LOG_SEX(e);¤				return null;¤			}¤		} catch (Exception ex) {¤			Logs.LOG_E("NotifyTooltip::updateNotifyMacroInBD - " + ex);¤			return null;¤		}¤		return uw;¤	}¤¤	protected static final int VALIDATION_FAILED_CYCLE = 1000;¤	protected static final int VALIDATION_FAILED_DURATION = 1010;¤	protected static final int VALIDATION_FAILED_START_DATE = 1020;¤	protected static final int VALIDATION_FAILED_NAMES = 1030;¤	protected static final int VALIDATION_NOT_SEND_NAMES = 1040;¤	protected static final int VALIDATION_MANY_USERS_ON_ONE_SURNAME = 1050;¤	protected static final int VALIDATION_NOT_SEND_ONE_NAME = 1060;¤¤	private Collection<String> getNotificationUserData(String userName) {¤		try {¤			return (Collection<String>) UserData.Factory.get(userName,¤					"NotifyParameters").getData();¤		} catch (Exception e) {¤			Logs.LOG_E("SendNotifyForUserMacro::getNotificationUserData: " + e);¤			return Collections.emptyList();¤		}¤	}¤¤	private boolean showNotificationsOnlyForNonFavouriteSpaces(String userName) {¤		Collection<String> collection = getNotificationUserData(userName);¤		return collection.contains("FOLLOW_FOR_NOT_FAVOURITE_CONTENT");¤	}¤¤	private boolean isSpaceFavouriteAndCheckOption(Space space, User user) {¤		final String userName = user.getName();¤		return showNotificationsOnlyForNonFavouriteSpaces(userName)¤				&& ContainerManager.Factory.get().getLabelManager().getFavouriteSpaces(userName).contains(space);¤	}¤¤	private List<String> extractNames(String notifier, int notifiersLength) {¤		String[] errorString = getErrorHTMLString();¤		String name = TextUtils.innerTrim(notifier);¤		GarUserAccessor ua = ContainerManager.Factory.get().getUserAccessor();¤		User user = ua.getUser(name);¤		¤		AbstractPage page = ContainerManager.Factory.get().getPageManager()¤				.getAbstractPage(renderPageId_);¤		AbstractPage parentPage = ContainerManager.Factory.get()¤				.getPageManager().getAbstractPage(parentId_);¤		Space space = ContainerManager.Factory.get().getSpaceManager()¤				.getSpace(spaceKey_);¤		PermissionManager pm = ContainerManager.Factory.get()¤				.getPermissionManager();¤¤		Group group = ua.getGroup(name);¤		if (group != null) {¤			String usersString = null;¤			List<String> userNames = new ArrayList<String>();¤			for (Iterator<String> it = ua.getMemberNames(group).iterator(); it¤					.hasNext();) {¤				user = ua.getUser(it.next());¤				if (page != null¤						&& !pm.hasPermission(user, Permission.VIEW, page)¤						|| page == null && parentPage != null¤						&& !pm.hasPermission(user, Permission.VIEW, parentPage)¤						|| page == null && parentPage == null && space != null¤						&& !pm.hasPermission(user, Permission.VIEW, space)) {¤					if (usersString == null)¤						usersString = user.getFullName();¤					else¤						usersString += (", " + user.getFullName());¤				} else¤					userNames.add(user.getName());¤			}¤			if (usersString != null) {¤				java.util.List<String> args = Arrays.asList(usersString, group¤						.getName());¤				if (errorString[0] == null)¤					errorString[0] = "";¤				errorString[0] = errorString[0]¤						+ " "¤						+ Messages.Factory¤								.messages()¤								.get(¤										"notifytooltipcontent.user.of.this.group.have.not.permissions",¤										args);¤				setErrorMessage(errorString);¤			}¤¤			return userNames;¤		}¤		¤		if(user == null){¤			List<User> usersList = UserNotificationService.Factory.create().getUsersBySurname(name);¤			if(usersList.size() == 1){¤				user = usersList.get(0);¤				int index = notifyTo_.indexOf(name);¤				String startSeq = notifyTo_.substring(0, index);¤				String endSeq = "";¤				int lengthPosEndSeq = index + name.length(); ¤				if(lengthPosEndSeq != notifyTo_.length())¤					endSeq = notifyTo_.substring(lengthPosEndSeq); ¤				notifyTo_ = startSeq + user.getName() + endSeq;¤			}¤			else if(usersList.size() > 1){¤				errorString[0] = name;¤				setErrorCode(VALIDATION_MANY_USERS_ON_ONE_SURNAME);¤				setErrorMessage(errorString);¤				return Arrays.asList();¤			}¤		}¤		¤		if (user != null) {¤			if (page != null && !pm.hasPermission(user, Permission.VIEW, page)¤					|| page == null && parentPage != null¤					&& !pm.hasPermission(user, Permission.VIEW, parentPage)¤					|| page == null && parentPage == null && space != null¤					&& !pm.hasPermission(user, Permission.VIEW, space)) {¤				java.util.List<String> args = Arrays.asList(user.getFullName());¤				if (errorString[0] == null)¤					errorString[0] = "";¤				if(notifiersLength > 1){¤					String validationMessage1 = Messages.Factory.messages().get("sendnotifyforusermacro.you.must.know");¤					String validationMessage2 = Messages.Factory.messages().get("notifytooltipcontent.user.have.not.permissions");¤					validationMessage2 = validationMessage2.replace("{0}", "{1}");¤					if(!errorString[0].contains(validationMessage2)){¤						validationMessage1 = validationMessage1.replace("{0}", args.get(0) + "{0}");¤						validationMessage2 = validationMessage2.replace("{1}", args.get(0) + "{1}");¤						errorString[0] = errorString[0]	+ " " + validationMessage1 + " " + validationMessage2;¤					}else{¤						errorString[0] = errorString[0].replace("{0}", ", " + args.get(0) + "{0}");¤						errorString[0] = errorString[0].replace("{1}", ", " + args.get(0) + "{1}");¤					}¤					setErrorCode(VALIDATION_NOT_SEND_NAMES);¤				}¤				else{¤					setErrorCode(VALIDATION_NOT_SEND_ONE_NAME);¤					errorString[0] = errorString[0]  ¤					                             + Messages.Factory¤													.messages()¤													.get(¤															"notifytooltipcontent.user.have.not.permissions",¤															args);¤				}¤				setErrorMessage(errorString);¤				return Arrays.asList();¤			} else if (page != null¤					&& isSpaceFavouriteAndCheckOption(page.getSpace(), user)¤					|| page == null && space != null¤					&& isSpaceFavouriteAndCheckOption(space, user)) {¤				java.util.List<String> args = Arrays.asList(user.getFullName());¤				if (errorString[0] == null)¤					errorString[0] = "";¤				String validationMessage1 = Messages.Factory.messages().get("sendnotifyforusermacro.you.must.know");¤				String validationMessage2 = Messages.Factory.messages().get("notifytooltipcontent.user.check.option.favourite.spaces");¤				validationMessage1 = validationMessage1.replace("{0}", "{2}");¤				validationMessage2 = validationMessage2.replace("{0}", "{3}");¤				if(!errorString[0].contains(validationMessage2)){¤					validationMessage1 = validationMessage1.replace("{2}", args.get(0) + "{2}");¤					validationMessage2 = validationMessage2.replace("{3}", args.get(0) + "{3}");¤					errorString[0] = errorString[0]	+ " " + validationMessage1 + " " + validationMessage2;¤				}else{¤					errorString[0] = errorString[0].replace("{2}", ", " + args.get(0) + "{2}");¤					errorString[0] = errorString[0].replace("{3}", ", " + args.get(0) + "{3}");¤				}¤				setErrorCode(VALIDATION_NOT_SEND_NAMES);¤				setErrorMessage(errorString);¤			}¤			return Arrays.asList(user.getName());¤		}¤¤¤		setErrorCode(VALIDATION_FAILED_NAMES);¤		errorString[0] = Messages.Factory.messages().get(¤				"notifytooltipcontent.invalid.name") + " " + name;¤		setErrorMessage(errorString);¤¤		return Arrays.asList();¤	}¤¤	private List<String> extractFullUserNames(String notifier, int notifiersLength) {¤		String[] errorString = getErrorHTMLString();¤		String name = TextUtils.innerTrim(notifier);¤		GarUserAccessor ua = ContainerManager.Factory.get().getUserAccessor();¤		AbstractPage page = ContainerManager.Factory.get().getPageManager()¤				.getAbstractPage(renderPageId_);¤		AbstractPage parentPage = ContainerManager.Factory.get()¤				.getPageManager().getAbstractPage(parentId_);¤		PermissionManager pm = ContainerManager.Factory.get()¤				.getPermissionManager();¤		Space space = ContainerManager.Factory.get().getSpaceManager()¤				.getSpace(spaceKey_);¤		User user = ua.getUser(name);¤		Group group = ua.getGroup(name);¤		¤		if (group != null) {¤			String usersString = null;¤			for (Iterator<String> it = ua.getMemberNames(group).iterator(); it¤					.hasNext();) {¤				user = ua.getUser(it.next());¤				if (page != null¤						&& !pm.hasPermission(user, Permission.VIEW, page)¤						|| page == null && parentPage != null¤						&& !pm.hasPermission(user, Permission.VIEW, parentPage)¤						|| page == null && parentPage == null && space != null¤						&& !pm.hasPermission(user, Permission.VIEW, space)) {¤					if (usersString == null)¤						usersString = user.getFullName();¤					else¤						usersString += (", " + user.getFullName());¤				}¤			}¤			if (usersString != null) {¤				java.util.List<String> args = Arrays.asList(usersString, group¤						.getName());¤				if (errorString[0] == null)¤					errorString[0] = "";¤				errorString[0] = errorString[0]¤						+ " "¤						+ Messages.Factory¤								.messages()¤								.get(¤										"notifytooltipcontent.user.of.this.group.have.not.permissions",¤										args);¤				setErrorMessage(errorString);¤			}¤¤			return Arrays.asList(group.getName());¤		}¤¤		if (user != null) {¤			if (page != null && !pm.hasPermission(user, Permission.VIEW, page)¤					|| page == null && parentPage != null¤					&& !pm.hasPermission(user, Permission.VIEW, parentPage)¤					|| page == null && parentPage == null && space != null¤					&& !pm.hasPermission(user, Permission.VIEW, space)) {¤				java.util.List<String> args = Arrays.asList(user.getFullName());¤				if(notifiersLength > 1){¤					setErrorCode(VALIDATION_NOT_SEND_NAMES);¤					if (errorString[0] == null)¤						errorString[0] = "";¤¤					errorString[0] = errorString[0]¤						+ " "¤						+ Messages.Factory.messages().get(¤								"sendnotifyforusermacro.you.must.know", args)¤						+ " "¤						+ Messages.Factory¤								.messages()¤								.get(¤										"notifytooltipcontent.user.have.not.permissions",¤										args);¤				}¤				else{¤					setErrorCode(VALIDATION_NOT_SEND_ONE_NAME);¤					if (errorString[0] == null)¤						errorString[0] = "";¤					errorString[0] = errorString[0]  ¤					                             + Messages.Factory¤													.messages()¤													.get(¤															"notifytooltipcontent.user.have.not.permissions",¤															args);	¤				}¤				setErrorMessage(errorString);¤				return Arrays.asList();¤			} else if (page != null¤					&& isSpaceFavouriteAndCheckOption(page.getSpace(), user)¤					|| page == null && space != null¤					&& isSpaceFavouriteAndCheckOption(space, user)) {¤				java.util.List<String> args = Arrays.asList(user.getFullName());¤				if (errorString[0] == null)¤					errorString[0] = "";¤¤				errorString[0] = errorString[0]¤						+ " "¤						+ Messages.Factory.messages().get(¤								"sendnotifyforusermacro.you.must.know", args)¤						+ " "¤						+ Messages.Factory¤								.messages()¤								.get(¤										"notifytooltipcontent.user.check.option.favourite.spaces",¤										args);¤				setErrorCode(VALIDATION_NOT_SEND_NAMES);¤				setErrorMessage(errorString);¤			}¤			return Arrays.asList(user.getFullName());¤		}¤¤		if(user == null){¤			List<User> usersList = UserNotificationService.Factory.create().getUsersBySurname(name);¤			if(usersList.size() == 1){¤				user = usersList.get(0);¤				int index = notifyTo_.indexOf(name);¤				String startSeq = notifyTo_.substring(0, index);¤				String endSeq = "";¤				int lengthPosEndSeq = index + name.length(); ¤				if(lengthPosEndSeq != notifyTo_.length())¤					endSeq = notifyTo_.substring(lengthPosEndSeq); ¤				notifyTo_ = startSeq + user.getName() + endSeq;¤			}¤			else if(usersList.size() > 1){¤				errorString[0] = name;¤				setErrorCode(VALIDATION_MANY_USERS_ON_ONE_SURNAME);¤				setErrorMessage(errorString);¤			}¤¤		}¤¤¤		return Arrays.asList();¤	}¤¤	private List<String> getUserNamesToNotify(String notificationNames,¤			boolean extractFullNames) {¤		String notifiers[] = null;¤		if (notificationNames.contains(","))¤			notifiers = notificationNames.split(",");¤		else {¤			notifiers = new String[1];¤			notifiers[0] = notificationNames;¤		}¤¤		if (notifiers == null || notifiers.length == 0) {¤			return null;¤		}¤¤		int i = 0;¤		List<String> result = new ArrayList<String>();¤		for (String notifier : notifiers) {¤			List<String> notifierUserNames;¤			if (extractFullNames)¤				notifierUserNames = extractFullUserNames(notifier, notifiers.length);¤			else¤				notifierUserNames = extractNames(notifier, notifiers.length);¤			if (!notifierUserNames.isEmpty())¤			{¤				result.addAll(notifierUserNames);¤				if(extractFullNames){¤					if(i == SPACER_NAMES){¤						i = 0;¤						result.add("<br/>");¤					}¤					i++;¤				}¤			}¤		}¤		if(result.size() == 0){¤			if(getErrorCode() == VALIDATION_NOT_SEND_NAMES)¤				setErrorCode(VALIDATION_NOT_SEND_ONE_NAME);¤			return null;¤		}¤		return result;¤	}¤¤	public String validator(){¤		setIsHTMLResponse(false);¤		String pattern = "(\\{notify:.*?\\})";¤		Pattern p = Pattern.compile(pattern, Pattern.MULTILINE);¤		Matcher m = p.matcher(text_);¤		while(m != null && m.find()){¤			String notify = m.group(1);¤			String patternNotify = "\\{notify:([^\\|]*)?.*?\\}";¤			Pattern pn = Pattern.compile(patternNotify);¤			Matcher mn = pn.matcher(notify);¤			if(mn != null && mn.find()){¤				String users = mn.group(1);¤				getUserNamesToNotify(users, true);¤				if(StringUtils.isNotEmpty(getErrorMessage()[0])){¤					getErrorMessage()[0] = getErrorMessage()[0] + "\n";¤				}¤			}¤		}¤		String[] errors = getErrorMessage();¤		if(errors != null && errors.length > 0){¤			if(responseContent == null){¤				responseContent = "";¤			}¤			if(StringUtils.isNotEmpty(errors[0])){¤				responseContent += errors[0];¤			}¤		}¤		¤		return SUCCESS;¤	}¤	¤    private int SPACER_NAMES = 3;¤¤    private String responseContent = null;¤¤	public String getResponseContent() {¤		return this.responseContent;¤	}¤¤	private String text_ = null;¤¤	public void setText(String text) {¤		text_ = text;¤	}¤¤	public String getText() {¤		return text_;¤	}¤¤	private String titleNotify_ = null;¤¤	public void setTitleNotify(String titleNotify) {¤		titleNotify_ = titleNotify;¤	}¤¤	public String getTitleNotify() {¤		return titleNotify_;¤	}¤¤	private String fullNamesNotifyTo_ = null;¤¤	public void setFullNamesNotifyTo(String fullNamesNotifyTo) {¤		fullNamesNotifyTo_ = fullNamesNotifyTo;¤	}¤¤	public String getFullNamesNotifyTo() {¤		return fullNamesNotifyTo_;¤	}¤¤	private String notifyTo_ = null;¤¤	public void setNotifyTo(String notifyTo) {¤		notifyTo_ = notifyTo;¤	}¤¤	public String getNotifyTo() {¤		return notifyTo_;¤	}¤¤	private String cycleNotify_ = null;¤¤	public void setCycleNotify(String cycleNotify) {¤		cycleNotify_ = cycleNotify;¤	}¤¤	public String getCycleNotify() {¤		return cycleNotify_;¤	}¤	¤	private Date dateNotify_ = null;¤¤	public void setDateNotify(Date dateNotify) {¤		dateNotify_ = dateNotify;¤	}¤¤	public Date getDateNotify() {¤		return dateNotify_;¤	}¤	private String durationNotify_ = null;¤¤	public void setDurationNotify(String durationNotify) {¤		durationNotify_ = durationNotify;¤	}¤¤	public String getDurationNotify() {¤		return durationNotify_;¤	}¤¤	private String startDateNotify_ = null;¤¤	public void setStartDateNotify(String startDateNotify) {¤		startDateNotify_ = startDateNotify;¤	}¤¤	public String getStartDateNotify() {¤		return startDateNotify_;¤	}¤¤	private long renderCommentId_;¤¤	public void setRenderCommentId(long renderCommentId) {¤		renderCommentId_ = renderCommentId;¤	}¤¤	private long renderPageId_;¤¤	public void setRenderPageId(long renderPageId) {¤		renderPageId_ = renderPageId;¤	}¤¤	private String macrosNotifyString_;¤¤	public void setMacrosNotifyString(String macrosNotifyString) {¤		macrosNotifyString_ = macrosNotifyString;¤	}¤¤	public String getMacrosNotifyString() {¤		return macrosNotifyString_;¤	}¤¤	private boolean editContent_;¤¤	public void setEditContent(boolean editContent) {¤		editContent_ = editContent;¤	}¤¤	public boolean getEditContent() {¤		return editContent_;¤	}¤¤	private String spaceKey_;¤¤	public void setSpaceKey(String spaceKey) {¤		spaceKey_ = spaceKey;¤	}¤¤	public String getSpaceKey() {¤		return spaceKey_;¤	}¤¤	private long parentId_;¤¤	public void setParentId(long parentId) {¤		parentId_ = parentId;¤	}¤¤	public long getParentId() {¤		return parentId_;¤	}¤¤	private UserNotification userNotification_;¤¤	private boolean defNotify_ = false;¤	private boolean isSender_ = false;¤	private boolean notifyDismissed_ = true;¤	/**¤	 * @return íîòèôèêàöèþ äëÿ òåêóùåãî ïîëüçîâàòåëÿ¤	 */¤	public UserNotification getUserNotification() {¤		return userNotification_;¤	}¤¤	protected UserAccessor userAccessor;¤	protected MultiQueueTaskManager taskManager;¤	protected NotificationManager notificationManager;¤	protected PermissionManager permissionManager;¤	protected WikiStyleRenderer wikiStyleRenderer;¤¤    private short USER_TYPE = 1;¤	¤	//#UC END# *490C556700A3_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/NotifyTooltip|490C556700A3
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19027286727"))
	    quid       	"490C556700A3"
	    documentation 	"ðåíäåðèò vm-íèê â òóëòèï íîòèôèêàöèè"
	    stereotype 	"KActionPlugin"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"490C55E50207"
		    supplier   	"Logical View::external::ConfluenceSupport::com.atlassian.confluence.coreImpl::ConfluenceActionSupport"
		    quidu      	"468C9C950186"))
	    used_nodes 	(list uses_relationship_list
		(object Uses_Relationship
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011059486"))
		    quid       	"490C55DE016F"
		    stereotype 	"uses"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotification::UserNotificationService"
		    quidu      	"48414BFC0288"))
	    language   	"MDA Generator")
	(object Class "ContentUpdateListener"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/ContentUpdateListener|494A5A800064
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/UserNotificationPlugins/ContentUpdateListener.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*494A5A800064_CUSTOM_IMPORT*"
		    value      	"//#UC START# *494A5A800064_CUSTOM_IMPORT*¤import com.atlassian.confluence.event.events.content.comment.CommentCreateEvent;¤import com.atlassian.confluence.event.events.content.comment.CommentRemoveEvent;¤import com.atlassian.event.EventListener;¤import com.atlassian.event.Event;¤import com.opensymphony.webwork.ServletActionContext;¤¤import ru.garant.MDProcess.ConfluencePlugins.UserNotification.UserNotificationService;¤¤import javax.servlet.http.HttpServletRequest;¤¤import com.atlassian.confluence.pages.Comment;¤¤import ru.garant.MDProcess.ConfluencePlugins.UserNotification.UserNotificationService;¤¤import java.util.regex.Matcher;¤import java.util.regex.Pattern;¤¤//#UC END# *494A5A800064_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*494A5A800064_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *494A5A800064_CUSTOM_CLASS_DEFINITION*¤//#UC END# *494A5A800064_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*494A5A800064_CONTENT*"
		    value      	(value Text 
|//#UC START# *494A5A800064_CONTENT*¤		CommentRemoveEvent.class, CommentCreateEvent.class		¤		//#UC END# *494A5A800064_CONTENT*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*494A5A800064_GETHANDLEDEVENTCLASSES_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *494A5A800064_GETHANDLEDEVENTCLASSES_IMPLEMETATION*¤		return handledClasses;¤		//#UC END# *494A5A800064_GETHANDLEDEVENTCLASSES_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*494A5A800064_HANDLEEVENT_IMPLEMETATION*"
		    value      	(value Text 
|//#UC START# *494A5A800064_HANDLEEVENT_IMPLEMETATION*¤		try {¤			if (event instanceof CommentRemoveEvent && isMoveDiscussionsAction() == false) {¤				long commentId = ((CommentRemoveEvent) event).getComment().getId();¤				UserNotificationService.Factory.create().deleteNotificationInComment(commentId);¤			} ¤		} catch (Exception e) {¤			Logs.LOG_E("ContentUpdateListener::handleEvent: ERROR: " + e);¤		}¤		//#UC END# *494A5A800064_HANDLEEVENT_IMPLEMETATION*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*494A5A800064_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *494A5A800064_CUSTOM_METHODS_AND_DATA*¤	private boolean isMoveDiscussionsAction () {¤		boolean ret = false;¤		try {¤			HttpServletRequest reqHTTP = ServletActionContext.getRequest();¤			if (reqHTTP != null) {¤				StringBuffer requestURL = reqHTTP.getRequestURL();¤				String actionName = requestURL.substring(requestURL.lastIndexOf("/") + 1);¤				if (actionName != null && actionName.equals("doeditcomment.action")) {¤					ret = true;¤				}¤			}¤		} catch (Exception e) {¤			Logs.LOG_SEX(e);¤		}¤		return ret;¤	}¤	//#UC END# *494A5A800064_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19038995002"))
	    quid       	"494A5A800064"
	    documentation 	"Ñëóøàåò ñîáûòèÿ Ê. CommentRemoveEvent - åñëè åñòü íîòèôèêàöèÿ, óäàëÿåò åå. "
	    stereotype 	"KListenerPlugin"
	    language   	"MDA Generator")
	(object Class "ChangePageNotifyMonitoringCondition"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"AbstarctOperation"
		    value      	"regular")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsNative"
		    value      	"false")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SELF GENERATED FILE (java)"
		    value      	"w:/MDProcess/java/src/java/ru/garant/MDProcess/ConfluencePlugins/UserNotificationPlugins/ChangePageNotifyMonitoringCondition.java")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (java)"
		    value      	"file")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4AB237640038_CUSTOM_IMPORT*"
		    value      	"//#UC START# *4AB237640038_CUSTOM_IMPORT*¤¤import com.atlassian.confluence.plugin.descriptor.web.WebInterfaceContext;¤¤import ru.garant.MDProcess.ConfluencePlugins.UserNotification.UserNotificationService;¤¤//#UC END# *4AB237640038_CUSTOM_IMPORT*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4AB237640038_CUSTOM_CLASS_DEFINITION*"
		    value      	"//#UC START# *4AB237640038_CUSTOM_CLASS_DEFINITION*¤//#UC END# *4AB237640038_CUSTOM_CLASS_DEFINITION*")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"java:*4AB237640038_CUSTOM_METHODS_AND_DATA*"
		    value      	(value Text 
|//#UC START# *4AB237640038_CUSTOM_METHODS_AND_DATA*¤	¤	@Override¤	protected boolean shouldDisplay (WebInterfaceContext context) {¤		if(context.getPage() == null || context.getUser() == null) {¤			return false;¤		}¤		long a = System.currentTimeMillis();¤		boolean res = UserNotificationService.Factory.create()¤				.hasAnyNotificationForContent(context.getPage().getId(), context.getUser().getName(), true);¤		long b = System.currentTimeMillis() - a;¤		return res;¤	}¤¤	//#UC END# *4AB237640038_CUSTOM_METHODS_AND_DATA*
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"WikiPageID (wiki)"
		    value      	(value Text 
|MDProcess,key:MDP,guid:456C0DD70110/Home/Ìîäåëü ïðîåêòà "MDProcess"/ConfluencePlugins/UserNotificationPlugins/ChangePageNotifyMonitoringCondition|4AB237640038
		    ))
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"SourceType (wiki)"
		    value      	"wiki")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ElementCreationOrder"
		    value      	"19039166769"))
	    quid       	"4AB237640038"
	    documentation 	"êîíòðîëèðóåò ïîÿâëåíèå êíîïêè ñáðîñà ñëåæåíèÿ çà âñåìè íîòèôèêàöèÿìè íàñòðàíèöå"
	    stereotype 	"SimpleClass"
	    superclasses 	(list inheritance_relationship_list
		(object Inheritance_Relationship
		    quid       	"4AB237A0005E"
		    supplier   	"Logical View::external::ConfluenceSupport::com.atlassian.confluence.plugin.descriptor.web.conditions::BaseConfluenceCondition"
		    quidu      	"4A53516B029A"))
	    language   	"MDA Generator")
	(object Association "$UNNAMED$0"
	    quid       	"491936F803AA"
	    roles      	(list role_list
		(object Role "success"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011050937"))
		    quid       	"491936F90169"
		    stereotype 	"velocity-xml"
		    label      	"success"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationUnit::changenotify_error"
		    quidu      	"491936C003C9"
		    Containment 	"By Value"
		    is_navigable 	TRUE)
		(object Role "$UNNAMED$1"
		    quid       	"491936F9016C"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::ChangeNotify"
		    quidu      	"4917FAB00244"
		    is_aggregate 	TRUE)))
	(object Association "$UNNAMED$2"
	    quid       	"4922B1AB01F8"
	    roles      	(list role_list
		(object Role "success"
		    attributes 	(list Attribute_Set
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"AbstarctOperation"
			    value      	"regular")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"IsNative"
			    value      	"false")
			(object Attribute
			    tool       	"MDA Generator"
			    name       	"ElementCreationOrder"
			    value      	"19011049302"))
		    quid       	"4922B1AC0117"
		    stereotype 	"velocity-xml"
		    label      	"success"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationUnit::changenotify_error"
		    quidu      	"491936C003C9"
		    Containment 	"By Value"
		    is_navigable 	TRUE)
		(object Role "$UNNAMED$3"
		    quid       	"4922B1AC011A"
		    supplier   	"Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::SendNotifyAgain"
		    quidu      	"4912A64D013F"
		    is_aggregate 	TRUE))))
    logical_presentations 	(list unit_reference_list
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsChanged"
		    value      	""))
	    quid       	"4841479F025E"
	    title      	"Main"
	    zoom       	80
	    max_height 	28350
	    max_width  	21600
	    origin_x   	0
	    origin_y   	0
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::SendNotifyForUserMacro" @1
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1143, 1059)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@1
			location   	(878, 1031)
			fill_color 	13434879
			nlines     	1
			max_width  	530
			justify    	0
			label      	" SendNotifyForUserMacro")
		    stereotype 	(object ItemLabel
			Parent_View 	@1
			location   	(878, 981)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	530
			justify    	0
			label      	"<<KMacroPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"48410D300306"
		    width      	548
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotification::UserNotificationService" @2
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(1317, 279)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	16714250
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@2
			location   	(1088, 252)
			nlines     	1
			max_width  	458
			justify    	0
			label      	"UserNotificationService")
		    stereotype 	(object ItemLabel
			Parent_View 	@2
			location   	(1088, 201)
			anchor     	10
			nlines     	1
			max_width  	458
			justify    	0
			label      	"<<Interface>>")
		    icon       	"Interface"
		    icon_style 	"Label"
		    line_color 	16714250
		    fill_color 	16777215
		    quidu      	"48414BFC0288"
		    width      	476
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @3
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @4
			Parent_View 	@3
			location   	(1274, 743)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.397392
			height     	60
			orientation 	1)
		    line_color 	3947680
		    quidu      	"4841505D011B"
		    client     	@1
		    supplier   	@2
		    vertices   	(list Points
			(1161, 968)
			(1296, 369))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::PrintNotifyListMacro" @5
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(471, 297)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@5
			location   	(266, 268)
			fill_color 	13434879
			nlines     	1
			max_width  	410
			justify    	0
			label      	"PrintNotifyListMacro")
		    stereotype 	(object ItemLabel
			Parent_View 	@5
			location   	(266, 218)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	410
			justify    	0
			label      	"<<KMacroPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"4843E26F016E"
		    width      	428
		    height     	182
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @6
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @7
			Parent_View 	@6
			location   	(872, 252)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.479308
			height     	36
			orientation 	0)
		    line_color 	3947680
		    quidu      	"4843E2FB0270"
		    client     	@5
		    supplier   	@2
		    vertices   	(list Points
			(685, 291)
			(1078, 283))
		    line_style 	0)
		(object ClassView "Class" "Logical View::external::JavaConfluence::ConfluencePlugins::AbstractHtmlGeneratingMacro" @8
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(462, 765)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	658120
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@8
			location   	(67, 737)
			fill_color 	13434879
			nlines     	1
			max_width  	790
			justify    	0
			label      	" AbstractHtmlGeneratingMacro")
		    stereotype 	(object ItemLabel
			Parent_View 	@8
			location   	(67, 687)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	790
			justify    	0
			label      	"<<KMacroPlugin>>")
		    icon_style 	"Label"
		    line_color 	14803425
		    fill_color 	14803425
		    quidu      	"460A5C880148"
		    width      	808
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @9
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"4843E31501D9"
		    client     	@5
		    supplier   	@8
		    vertices   	(list Points
			(468, 388)
			(463, 674))
		    line_style 	0)
		(object ClassView "Class" "Logical View::external::ConfluenceSupport::com.atlassian.confluence.coreImpl::ConfluenceActionSupport" @10
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(2133, 273)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	658120
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@10
			location   	(1657, 241)
			fill_color 	13434879
			nlines     	1
			max_width  	952
			justify    	0
			label      	"ConfluenceActionSupport")
		    stereotype 	(object ItemLabel
			Parent_View 	@10
			location   	(1657, 191)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	952
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    line_color 	14803425
		    fill_color 	14803425
		    quidu      	"468C9C950186"
		    width      	970
		    height     	188
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin" @11
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(378, 1110)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@11
			location   	(72, 1089)
			fill_color 	13434879
			nlines     	1
			max_width  	612
			justify    	0
			label      	"UserNotificationsXPlugin")
		    stereotype 	(object ItemLabel
			Parent_View 	@11
			location   	(72, 1039)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	612
			justify    	0
			label      	"<<KXWorkPlugin>>")
		    icon_style 	"Label"
		    line_color 	7885055
		    fill_color 	16111871
		    quidu      	"48A3D84F01FD"
		    width      	630
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::ChangeNotifyMonitoring" @12
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1791, 1152)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@12
			location   	(1563, 1124)
			fill_color 	13434879
			nlines     	1
			max_width  	456
			justify    	0
			label      	"ChangeNotifyMonitoring")
		    stereotype 	(object ItemLabel
			Parent_View 	@12
			location   	(1563, 1074)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	456
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"48A3D9B30032"
		    width      	474
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @13
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"48A3DC510063"
		    client     	@12
		    supplier   	@10
		    vertices   	(list Points
			(1824, 1061)
			(2095, 367))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::SendNotifyFromComment" @14
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(2385, 1071)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@14
			location   	(2136, 1040)
			fill_color 	13434879
			nlines     	1
			max_width  	498
			justify    	0
			label      	"SendNotifyFromComment")
		    stereotype 	(object ItemLabel
			Parent_View 	@14
			location   	(2136, 990)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	498
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"48B7F5260119"
		    width      	516
		    height     	186
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @15
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"48B7F58B034E"
		    client     	@14
		    supplier   	@10
		    vertices   	(list Points
			(2355, 977)
			(2162, 367))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTimerTaskJob" @16
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1956, 1605)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@16
			location   	(1734, 1574)
			fill_color 	13434879
			nlines     	1
			max_width  	444
			justify    	0
			label      	" NotifyTimerTaskJob")
		    stereotype 	(object ItemLabel
			Parent_View 	@16
			location   	(1734, 1524)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	444
			justify    	0
			label      	"<<KJobPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"48F6F9F5035E"
		    width      	462
		    height     	186
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotification::UserNotificationService" @17
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(1176, 1587)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	16714250
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@17
			location   	(947, 1560)
			nlines     	1
			max_width  	458
			justify    	0
			label      	"UserNotificationService")
		    stereotype 	(object ItemLabel
			Parent_View 	@17
			location   	(947, 1509)
			anchor     	10
			nlines     	1
			max_width  	458
			justify    	0
			label      	"<<Interface>>")
		    icon       	"Interface"
		    icon_style 	"Label"
		    line_color 	16714250
		    fill_color 	16777215
		    quidu      	"48414BFC0288"
		    width      	476
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @18
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @19
			Parent_View 	@18
			location   	(1573, 1627)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.487768
			height     	32
			orientation 	0)
		    line_color 	3947680
		    quidu      	"48F6FA9B016A"
		    client     	@16
		    supplier   	@17
		    vertices   	(list Points
			(1724, 1599)
			(1414, 1591))
		    line_style 	0)
		(object UsesView "" @20
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @21
			Parent_View 	@20
			location   	(1449, 772)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"48A3D9E900B3"
		    client     	@12
		    supplier   	@2
		    vertices   	(list Points
			(1741, 1061)
			(1365, 369))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTooltip" @22
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(2844, 825)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@22
			location   	(2652, 797)
			fill_color 	13434879
			nlines     	1
			max_width  	384
			justify    	0
			label      	"NotifyTooltip")
		    stereotype 	(object ItemLabel
			Parent_View 	@22
			location   	(2652, 747)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	381
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"490C556700A3"
		    width      	402
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @23
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @24
			Parent_View 	@23
			location   	(2059, 670)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3947680
		    quidu      	"490C55DE016F"
		    client     	@22
		    supplier   	@2
		    vertices   	(list Points
			(2642, 751)
			(1555, 364))
		    line_style 	0)
		(object InheritView "" @25
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3947680
		    quidu      	"490C55E50207"
		    client     	@22
		    supplier   	@10
		    vertices   	(list Points
			(2728, 734)
			(2254, 367))
		    line_style 	0)
		(object UsesView "" @26
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @27
			Parent_View 	@26
			location   	(1964, 865)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<uses>>"
			pctDist    	0.298875
			height     	86
			orientation 	0)
		    line_color 	3947680
		    quidu      	"48B7F5930362"
		    client     	@14
		    supplier   	@2
		    vertices   	(list Points
			(2258, 977)
			(1439, 369))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::ContentUpdateListener" @28
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(354, 1422)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@28
			location   	(130, 1394)
			fill_color 	13434879
			nlines     	1
			max_width  	448
			justify    	0
			label      	"ContentUpdateListener")
		    stereotype 	(object ItemLabel
			Parent_View 	@28
			location   	(130, 1344)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	448
			justify    	0
			label      	"<<KListenerPlugin>>")
		    icon_style 	"Label"
		    fill_color 	15448575
		    quidu      	"494A5A800064"
		    width      	466
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::ChangePageNotifyMonitoringCondition" @29
		    ShowCompartmentStereotypes 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(2670, 1659)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@29
			location   	(2310, 1628)
			fill_color 	13434879
			nlines     	1
			max_width  	720
			justify    	0
			label      	"ChangePageNotifyMonitoringCondition")
		    stereotype 	(object ItemLabel
			Parent_View 	@29
			location   	(2310, 1578)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	720
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    fill_color 	12842465
		    quidu      	"4AB237640038"
		    width      	738
		    height     	186
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::external::ConfluenceSupport::com.atlassian.confluence.plugin.descriptor.web.conditions::BaseConfluenceCondition" @30
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(3153, 1326)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	658120
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@30
			location   	(2718, 1298)
			fill_color 	13434879
			nlines     	1
			max_width  	870
			justify    	0
			label      	" BaseConfluenceCondition")
		    stereotype 	(object ItemLabel
			Parent_View 	@30
			location   	(2718, 1248)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	870
			justify    	0
			label      	"<<SimpleClass>>")
		    icon_style 	"Label"
		    line_color 	14803425
		    fill_color 	14803425
		    quidu      	"4A53516B029A"
		    width      	888
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @31
		    stereotype 	TRUE
		    line_color 	3342489
		    quidu      	"4AB237A0005E"
		    client     	@29
		    supplier   	@30
		    vertices   	(list Points
			(2802, 1565)
			(3020, 1416))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::EntitySupport::GarantAbstractJobWithLock" @32
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(1119, 2121)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@32
			location   	(843, 2093)
			nlines     	1
			max_width  	552
			justify    	0
			label      	"GarantAbstractJobWithLock")
		    stereotype 	(object ItemLabel
			Parent_View 	@32
			location   	(843, 2043)
			anchor     	10
			nlines     	1
			max_width  	552
			justify    	0
			label      	"<<KJobPlugin>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"4FBA1F4403CC"
		    width      	570
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object InheritView "" @33
		    stereotype 	TRUE
		    line_color 	3342489
		    quidu      	"4FBA2814032C"
		    client     	@16
		    supplier   	@32
		    vertices   	(list Points
			(1802, 1698)
			(1264, 2030))
		    line_style 	0)))
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ClassUID"
		    value      	"48A3D84F01FD"))
	    quid       	"48A3D914019F"
	    title      	"Main"
	    zoom       	100
	    max_height 	28350
	    max_width  	21600
	    origin_x   	0
	    origin_y   	0
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage" @34
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(606, 453)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@34
			location   	(348, 425)
			fill_color 	13434879
			nlines     	1
			max_width  	516
			justify    	0
			label      	"UserNotificationsXPackage")
		    stereotype 	(object ItemLabel
			Parent_View 	@34
			location   	(348, 375)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	516
			justify    	0
			label      	"<<XPackage>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"48A3D89702F4"
		    width      	534
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)))
	(object ClassDiagram "Main"
	    attributes 	(list Attribute_Set
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"ClassUID"
		    value      	"48A3D89702F4")
		(object Attribute
		    tool       	"MDA Generator"
		    name       	"IsChanged"
		    value      	""))
	    quid       	"48A3D9340372"
	    title      	"Main"
	    zoom       	80
	    max_height 	28350
	    max_width  	21600
	    origin_x   	0
	    origin_y   	794
	    items      	(list diagram_item_list
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::ChangeNotifyMonitoring" @35
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(762, 498)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@35
			location   	(505, 416)
			fill_color 	13434879
			nlines     	1
			max_width  	514
			justify    	0
			label      	" ChangeNotifyMonitoring")
		    stereotype 	(object ItemLabel
			Parent_View 	@35
			location   	(505, 366)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	514
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"48A3D8B000F1"
		    compartment 	(object Compartment
			Parent_View 	@35
			location   	(505, 532)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	532
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::ChangeNotifyMonitoring" @36
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(1884, 486)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@36
			location   	(1588, 465)
			nlines     	1
			max_width  	592
			justify    	0
			label      	"ChangeNotifyMonitoring")
		    stereotype 	(object ItemLabel
			Parent_View 	@36
			location   	(1588, 415)
			anchor     	10
			nlines     	1
			max_width  	592
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"48A3D9B30032"
		    width      	610
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @37
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @38
			Parent_View 	@37
			location   	(1303, 373)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"48A3DA290051"
		    client     	@35
		    supplier   	@36
		    vertices   	(list Points
			(1028, 495)
			(1578, 489))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::SendNotifyFromComment" @39
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(759, 945)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@39
			location   	(440, 862)
			fill_color 	13434879
			nlines     	1
			max_width  	638
			justify    	0
			label      	" SendNotifyFromComment")
		    stereotype 	(object ItemLabel
			Parent_View 	@39
			location   	(440, 812)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	638
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"48B7F9BB0151"
		    compartment 	(object Compartment
			Parent_View 	@39
			location   	(440, 978)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	459
			justify    	1)
		    width      	656
		    height     	290
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::SendNotifyFromComment" @40
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(1869, 930)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@40
			location   	(1557, 909)
			nlines     	1
			max_width  	624
			justify    	0
			label      	"SendNotifyFromComment")
		    stereotype 	(object ItemLabel
			Parent_View 	@40
			location   	(1557, 859)
			anchor     	10
			nlines     	1
			max_width  	624
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"48B7F5260119"
		    width      	642
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @41
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @42
			Parent_View 	@41
			location   	(1316, 818)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"48B7FA0D0263"
		    client     	@39
		    supplier   	@40
		    vertices   	(list Points
			(1087, 940)
			(1547, 933))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::NotifyTooltip" @43
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(2037, 2013)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@43
			location   	(1808, 1992)
			nlines     	1
			max_width  	458
			justify    	0
			label      	"NotifyTooltip")
		    stereotype 	(object ItemLabel
			Parent_View 	@43
			location   	(1808, 1942)
			anchor     	10
			nlines     	1
			max_width  	456
			justify    	0
			label      	"<<KActionPlugin>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"490C556700A3"
		    width      	476
		    height     	167
		    annotation 	8
		    autoResize 	TRUE)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::NotifyTooltip" @44
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(765, 2007)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@44
			location   	(498, 1925)
			fill_color 	13434879
			nlines     	1
			max_width  	534
			justify    	0
			label      	" NotifyTooltip")
		    stereotype 	(object ItemLabel
			Parent_View 	@44
			location   	(498, 1875)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	534
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"490C565E004F"
		    compartment 	(object Compartment
			Parent_View 	@44
			location   	(498, 2041)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	537
			justify    	1)
		    width      	552
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @45
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @46
			Parent_View 	@45
			location   	(1423, 1965)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.504559
			height     	45
			orientation 	0)
		    line_color 	3342489
		    quidu      	"490C568503AE"
		    client     	@44
		    supplier   	@43
		    vertices   	(list Points
			(1041, 2007)
			(1798, 2011))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::RemoveNotify" @47
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(795, 1470)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@47
			location   	(552, 1388)
			fill_color 	13434879
			nlines     	1
			max_width  	486
			justify    	0
			label      	" RemoveNotify")
		    stereotype 	(object ItemLabel
			Parent_View 	@47
			location   	(552, 1338)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	486
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"4912A5F7001F"
		    compartment 	(object Compartment
			Parent_View 	@47
			location   	(552, 1504)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	2
			max_width  	462
			justify    	1)
		    width      	504
		    height     	288
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @48
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @49
			Parent_View 	@48
			location   	(1493, 1645)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"4912A610011F"
		    client     	@47
		    supplier   	@43
		    vertices   	(list Points
			(1047, 1579)
			(1845, 1929))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::ChangeNotify" @50
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(2784, 1647)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@50
			location   	(2540, 1594)
			fill_color 	13434879
			nlines     	1
			max_width  	488
			justify    	0
			label      	" ChangeNotify")
		    stereotype 	(object ItemLabel
			Parent_View 	@50
			location   	(2540, 1544)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	488
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"4917FAB00244"
		    width      	506
		    height     	230
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @51
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @52
			Parent_View 	@51
			location   	(2427, 1953)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"4917FAD603B0"
		    client     	@50
		    supplier   	@43
		    vertices   	(list Points
			(2547, 1762)
			(2203, 1929))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationUnit::changenotify_error" @53
		    ShowCompartmentStereotypes 	TRUE
		    SuppressAttribute 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    location   	(2496, 1209)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	13110000
			default_color 	FALSE)
		    label      	(object ItemLabel
			Parent_View 	@53
			location   	(2304, 1181)
			nlines     	1
			max_width  	384
			justify    	0
			label      	"changenotify_error")
		    stereotype 	(object ItemLabel
			Parent_View 	@53
			location   	(2304, 1131)
			anchor     	10
			nlines     	1
			max_width  	384
			justify    	0
			label      	"<<VM>>")
		    icon_style 	"Label"
		    line_color 	13110000
		    fill_color 	16777215
		    quidu      	"491936C003C9"
		    width      	402
		    height     	180
		    annotation 	8
		    autoResize 	TRUE)
		(object AssociationViewNew "$UNNAMED$0" @54
		    location   	(2631, 1415)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3342489
		    quidu      	"491936F803AA"
		    roleview_list 	(list RoleViews
			(object RoleView "success" @55
			    Parent_View 	@54
			    location   	(279, -13)
			    font       	(object Font
				size       	10
				face       	"Arial"
				charSet    	204
				bold       	FALSE
				italics    	FALSE
				underline  	FALSE
				strike     	FALSE
				color      	0
				default_color 	TRUE)
			    label      	(object SegLabel @56
				Parent_View 	@55
				location   	(2804, 1423)
				font       	(object Font
				    size       	10
				    face       	"Arial"
				    charSet    	204
				    bold       	FALSE
				    italics    	FALSE
				    underline  	FALSE
				    strike     	FALSE
				    color      	0
				    default_color 	TRUE)
				anchor     	1
				anchor_loc 	1
				nlines     	1
				max_width  	272
				justify    	0
				label      	"+success"
				pctDist    	-0.731905
				height     	140
				orientation 	1)
			    stereotype 	(object SegLabel @57
				Parent_View 	@55
				location   	(2827, 1357)
				font       	(object Font
				    size       	10
				    face       	"Arial"
				    charSet    	204
				    bold       	FALSE
				    italics    	FALSE
				    underline  	FALSE
				    strike     	FALSE
				    color      	0
				    default_color 	TRUE)
				anchor     	10
				anchor_loc 	1
				nlines     	1
				max_width  	450
				justify    	0
				label      	"<<velocity-xml>>"
				pctDist    	-0.424709
				height     	196
				orientation 	1)
			    line_color 	3342489
			    quidu      	"491936F90169"
			    client     	@54
			    supplier   	@53
			    vertices   	(list Points
				(2631, 1415)
				(2554, 1299))
			    line_style 	0)
			(object RoleView "$UNNAMED$1" @58
			    Parent_View 	@54
			    location   	(279, -13)
			    stereotype 	TRUE
			    line_color 	3342489
			    quidu      	"491936F9016C"
			    client     	@54
			    supplier   	@50
			    vertices   	(list Points
				(2631, 1415)
				(2707, 1531))
			    line_style 	0)))
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::SendNotifyAgain" @59
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(1605, 1353)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@59
			location   	(1363, 1300)
			fill_color 	13434879
			nlines     	1
			max_width  	484
			justify    	0
			label      	" SendNotifyAgain")
		    stereotype 	(object ItemLabel
			Parent_View 	@59
			location   	(1363, 1250)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	484
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"4912A64D013F"
		    width      	502
		    height     	230
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @60
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @61
			Parent_View 	@60
			location   	(1931, 1633)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"4912A66F024E"
		    client     	@59
		    supplier   	@43
		    vertices   	(list Points
			(1681, 1468)
			(1982, 1929))
		    line_style 	0)
		(object AssociationViewNew "$UNNAMED$2" @62
		    location   	(2075, 1275)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	TRUE
		    line_color 	3342489
		    quidu      	"4922B1AB01F8"
		    roleview_list 	(list RoleViews
			(object RoleView "success" @63
			    Parent_View 	@62
			    location   	(362, -162)
			    font       	(object Font
				size       	10
				face       	"Arial"
				charSet    	204
				bold       	FALSE
				italics    	FALSE
				underline  	FALSE
				strike     	FALSE
				color      	0
				default_color 	TRUE)
			    label      	(object SegLabel @64
				Parent_View 	@63
				location   	(2054, 1238)
				font       	(object Font
				    size       	10
				    face       	"Arial"
				    charSet    	204
				    bold       	FALSE
				    italics    	FALSE
				    underline  	FALSE
				    strike     	FALSE
				    color      	0
				    default_color 	TRUE)
				anchor     	1
				anchor_loc 	1
				nlines     	1
				max_width  	272
				justify    	0
				label      	"+success"
				pctDist    	-0.067174
				height     	39
				orientation 	0)
			    stereotype 	(object SegLabel @65
				Parent_View 	@63
				location   	(2080, 1188)
				font       	(object Font
				    size       	10
				    face       	"Arial"
				    charSet    	204
				    bold       	FALSE
				    italics    	FALSE
				    underline  	FALSE
				    strike     	FALSE
				    color      	0
				    default_color 	TRUE)
				anchor     	10
				anchor_loc 	1
				nlines     	1
				max_width  	450
				justify    	0
				label      	"<<velocity-xml>>"
				pctDist    	0.084170
				height     	85
				orientation 	0)
			    line_color 	3342489
			    quidu      	"4922B1AC0117"
			    client     	@62
			    supplier   	@53
			    vertices   	(list Points
				(2075, 1275)
				(2294, 1239))
			    line_style 	0)
			(object RoleView "$UNNAMED$3" @66
			    Parent_View 	@62
			    location   	(362, -162)
			    stereotype 	TRUE
			    line_color 	3342489
			    quidu      	"4922B1AC011A"
			    client     	@62
			    supplier   	@59
			    vertices   	(list Points
				(2075, 1275)
				(1856, 1310))
			    line_style 	0)))
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::DisablePageNotifyMonitoring" @67
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(3006, 498)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@67
			location   	(2638, 441)
			fill_color 	13434879
			nlines     	1
			max_width  	736
			justify    	0
			label      	" DisablePageNotifyMonitoring")
		    stereotype 	(object ItemLabel
			Parent_View 	@67
			location   	(2638, 391)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	736
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"4AB236DB02A7"
		    compartment 	(object Compartment
			Parent_View 	@67
			location   	(2638, 557)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	1
			max_width  	459
			justify    	1)
		    width      	754
		    height     	238
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @68
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @69
			Parent_View 	@68
			location   	(2431, 444)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.448375
			height     	48
			orientation 	1)
		    line_color 	3342489
		    quidu      	"4AB2375600F6"
		    client     	@67
		    supplier   	@36
		    vertices   	(list Points
			(2628, 493)
			(2189, 489))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::NotifyForExecutors" @70
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(3090, 2097)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@70
			location   	(2828, 2039)
			fill_color 	13434879
			nlines     	1
			max_width  	524
			justify    	0
			label      	" NotifyForExecutors")
		    stereotype 	(object ItemLabel
			Parent_View 	@70
			location   	(2828, 1989)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	524
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"4B04F8FA0170"
		    compartment 	(object Compartment
			Parent_View 	@70
			location   	(2828, 2155)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	1
			max_width  	537
			justify    	1)
		    width      	542
		    height     	240
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @71
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @72
			Parent_View 	@71
			location   	(2537, 2173)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"4B04F96E0383"
		    client     	@70
		    supplier   	@43
		    vertices   	(list Points
			(2818, 2075)
			(2275, 2031))
		    line_style 	0)
		(object ClassView "Class" "Logical View::MDProcess::ConfluencePlugins::UserNotificationPlugins::UserNotificationsXPlugin::UserNotificationsXPackage::ValidatorNotify" @73
		    ShowCompartmentStereotypes 	TRUE
		    SuppressOperation 	TRUE
		    IncludeAttribute 	TRUE
		    IncludeOperation 	TRUE
		    ShowOperationSignature 	TRUE
		    location   	(2112, 2637)
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    label      	(object ItemLabel
			Parent_View 	@73
			location   	(1851, 2580)
			fill_color 	13434879
			nlines     	1
			max_width  	522
			justify    	0
			label      	" ValidatorNotify")
		    stereotype 	(object ItemLabel
			Parent_View 	@73
			location   	(1851, 2530)
			fill_color 	13434879
			anchor     	10
			nlines     	1
			max_width  	522
			justify    	0
			label      	"<<XAction>>")
		    icon_style 	"Label"
		    fill_color 	13357823
		    quidu      	"535E201C0341"
		    compartment 	(object Compartment
			Parent_View 	@73
			location   	(1851, 2696)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			icon_style 	"Icon"
			fill_color 	16777215
			anchor     	2
			nlines     	1
			max_width  	537
			justify    	1)
		    width      	540
		    height     	238
		    annotation 	8
		    autoResize 	TRUE)
		(object UsesView "" @74
		    font       	(object Font
			size       	10
			face       	"Arial"
			charSet    	204
			bold       	FALSE
			italics    	FALSE
			underline  	FALSE
			strike     	FALSE
			color      	0
			default_color 	TRUE)
		    stereotype 	(object SegLabel @75
			Parent_View 	@74
			location   	(1953, 2320)
			font       	(object Font
			    size       	10
			    face       	"Arial"
			    charSet    	204
			    bold       	FALSE
			    italics    	FALSE
			    underline  	FALSE
			    strike     	FALSE
			    color      	0
			    default_color 	TRUE)
			anchor     	10
			anchor_loc 	1
			nlines     	1
			max_width  	450
			justify    	0
			label      	"<<call>>"
			pctDist    	0.500000
			height     	120
			orientation 	0)
		    line_color 	3342489
		    quidu      	"535E203100CB"
		    client     	@73
		    supplier   	@43
		    vertices   	(list Points
			(2096, 2517)
			(2046, 2096))
		    line_style 	0)))))
