UNIT ElementsRTTI.ms.dict

USES 
 types.ms.dict
 axiom_push.ms.dict
 core.ms.dict
 NoStrangeSymbols.ms.dict
 WordsRTTI.ms.dict
;

USES
 ModelElementsDefinition.ms.dict
;

USES
 DoCacheElemMember.ms.dict
;

USES
 TransformElementMember.ms.dict
;

USES
 ElemMemberPrim.ms.dict
;

USES
 CompileTimeVar.ms.dict
;

USES
 arrays.ms.dict
;

USES
 axiom:WordBox
;

elem_iterator Children
 Self 'Children' .ElemList >>> Result
; // Children

elem_iterator Constants
 Self 'Constants' .ElemList >>> Result
; // Constants

elem_iterator Dependencies
 Self 'Dependencies' .ElemList >>> Result
; // Dependencies

elem_iterator UsedElements
 Self 'UsedElements' .ElemList >>> Result
; // UsedElements

elem_iterator NeededElementsList
 Self 'NeededElementsList' .ElemList >>> Result
; // NeededElementsList

elem_iterator ImplementedElements
 Self 'ImplementedElements' .ElemList >>> Result
; // ImplementedElements

elem_iterator Depends
 Self 'Depends' .ElemList >>> Result
; // Depends

elem_iterator DiagramsNames
 Self 'DiagramsNames' .ElemList >>> Result
; // DiagramsNames

elem_iterator Injected
 Self 'Injected' .ElemList >>> Result
; // Injected

elem_iterator Zones
 Self 'Zones' .ElemList >>> Result
; // Zones

elem_iterator Implementors
 Self 'Implementors' .ElemList >>> Result
; // Implementors

elem_iterator Forwarded
 Self 'Forwarded' .ElemList >>> Result
; // Forwarded

elem_iterator Parameters
 Self 'Parameters' .ElemList >>> Result
; // Parameters

elem_iterator Operations
 Self 'Operations' .ElemList >>> Result
; // Operations

elem_iterator Overridden
 Self 'Overridden' .ElemList >>> Result
; // Overridden

elem_iterator Implemented
 Self 'Implemented' .ElemList >>> Result
; // Implemented

elem_iterator CanRaise
 Self 'CanRaise' .ElemList >>> Result
; // CanRaise

elem_iterator CanRaiseInSet
 Self 'CanRaiseInSet' .ElemList >>> Result
; // CanRaiseInSet

STRING elem_func Documentation
 Self '%SUM' .ElemString >>> Result
; // Documentation

STRING elem_func TargetStereotype
 Self 'TargetStereotype' .ElemString >>> Result
; // TargetStereotype

ModelElement elem_func ValueType
 Self 'ValueType' .ElemWord >>> Result
; // ValueType

BOOLEAN elem_func UPisTrue
  Literal IN aName
  
 Self aName |N false .ElemMember true ?== >>> Result  
; // UPisTrue

USES
 MDProcess_CoreTemplates.tpi.ms.dict
;

USES
 MDProcess_ForDelphi.tpi.ms.dict
;

USES
 MDProcess_ForF1.tpi.ms.dict
;

BOOLEAN elem_func IsUnstereotypedStereo
 RULES
  ( Self .UPisTrue "unstereotyped" )
   true
  ( Self .GetUP "unstereotyped" false ?== )
   false
  ( Self .IsStereotype: st_MDAParameter )
   true 
  DEFAULT
   false
 ; // RULES   
 >>> Result
; // IsUnstereotypedStereo

USES
 MDProcess_Templates.tpi.ms.dict
;

USES
 IsNil.ms.dict
;

USES
 DoCache.ms.dict
;

USES
 RoseModel.ms.dict
;  

BOOLEAN elem_func IsSummoned
 Self 'IsSummoned' false .ElemMember >>> Result
; // IsSummoned

BOOLEAN elem_func IsAuto
 Self 'IsAuto' false .ElemMember >>> Result
; // IsAuto

BOOLEAN elem_func IsSubRoot
 Self 'IsSubRoot' false .ElemMember >>> Result
; // IsSubRoot

INTEGER elem_func Visibility
 Self 'Visibility' UnknownAccess /*PublicAccess*/ .ElemMember >>> Result
; // Visibility

INTEGER elem_func MDAClass
 Self 'Class' class_Unknown .ElemMember >>> Result
; // MDAClass

INTEGER elem_func Kind
 Self 'Kind' kind_Unknown .ElemMember >>> Result
; // Kind

INTEGER elem_func LinkType
 Self 'LinkType' lt_unknown .ElemMember >>> Result
; // LinkType

STRING elem_func LinkViewType
 Self 'LinkViewType' .ElemString >>> Result
; // LinkViewType

STRING elem_func GUID
 Self 'GUID' '' .ElemMember >>> Result
; // GUID

ModelElement elem_func Viewed
 RULES
  ( Self .IsSomeView )
   RULES
    ( Self .Original .NotIsNil )
     ( Self .Original )
    DEFAULT
     Self
   ; // RULES 
  DEFAULT
   Self
 ; // RULES
 >>> Result
; // Viewed

ModelElement elem_func From
 Self 'From' .ElemWord >>> Result
; // From

ModelElement elem_func To
 Self 'To' .ElemWord >>> Result
; // To

ModelElement elem_func Creator
 Self 'Creator' .ElemWord >>> Result
; // Creator

ModelElement elem_func SpelledFor
 Self 'SpelledFor' .ElemWord >>> Result
; // SpelledFor

ModelElement elem_func Speller
 Self 'Speller' .ElemWord >>> Result
; // Speller

ModelElement elem_func Facet
 Self 'Facet' .ElemWord >>> Result
; // Facet

ModelElement elem_func MixIn
 Self 'Mixin' .ElemWord >>> Result
; // MixIn

ModelElement elem_func Action
 Self 'Action' .ElemWord >>> Result
; // Action

ModelElement elem_func Stub
 Self 'Stub' .ElemWord >>> Result
; // Stub

ModelElement elem_func Implementor
 Self 'Implementor' .ElemWord >>> Result
; // Implementor

USES
 ref.ms.dict
;

USES
 MEPrefix.ms.dict
;

USES
 cCachePrefix.ms.dict
;

BOOLEAN elem_func IsUP
 RULES
  ( 'uc:' Self .WordName StartsStr )
   false
  ( 'msm:' Self .WordName StartsStr )
   false
  ( Self pop:Word:Producer @ UP ?== ) 
   true
  ( 'CompiledProcedure:' Self .WordName StartsStr )
   false
  ( cCachePrefix Self .WordName StartsStr )
   false
  ( MEPrefix Self .WordName StartsStr )
   false
  ( 'IsSummoned' Self .WordName == )
   true
  ( 'Speller' Self .WordName == )
   true
  ( 'Version' Self .WordName == )
   true
  ( 'SpelledFor' Self .WordName == )
   true
  ( 'Action' Self .WordName == )
   true
  ( 'Stub' Self .WordName == )
   true
  ( '.' Self .WordName StartsStr )
   false
  ( '"' Self .WordName StartsStr )
   true
  ( Self .WordName ':' string:Pos -1 != )
   true
  DEFAULT
   false
 ; // RULES
 >>> Result
; // IsUP

USES
 TransformElementMemberIfNeeded.ms.dict
;

elem_iterator UpList
 RULES
  (
   ( Self .IsSomeView )
   AND ( Self .Viewed Self ?!= )
  ) 
   ( Self .Viewed call.me )
  DEFAULT
   begin
    RULES
     ( Self IsIntf )
      ( Self pop:WordBox:Boxed )
     DEFAULT
      Self
    ; // RULES  
    MembersIterator
    .filter> .IsUP
    .map> (
      IN aVar
     aVar DO aVar TransformElementMemberIfNeeded SWAP DROP
     // - трансформируем и оставляем только переменную, а значение - выкидываем
    ) // .map>
   end // DEFAULT
  ; // RULES
 >>> Result
; // UpList

STRING elem_func UIDEx
 Cached:
 (
  VAR l_UID
  Self .UID >>> l_UID
  RULES
   ( l_UID IsNil )
    (
     VAR l_Name
     Self .Name >>> l_Name 
     RULES
      ( l_Name IsNil )
       ( Self .WordName )
      DEFAULT
       ( l_Name '_' Self .WordName Cat Cat )
     ; // RULES
    )
   DEFAULT
    l_UID
  ; // RULES
 )
 >>> Result  
; // UIDEx 

BOOLEAN FUNCTION .IsValueValid
  IN aValue
 RULES
  ( aValue IsInt )
   true
  ( aValue IsBool )
   true
  ( aValue IsNil )
   false
  DEFAULT
   true
 ; // RULES
 >>> Result
; // .IsValueValid

STRING FUNCTION ValueToKey
  ANY IN aValue
 RULES
  //( aValue .IsValueValid ! )
  // ''
  ( aValue IsString )
   aValue
  ( aValue IsArray )
   ( 
    aValue 
    .map> call.me
    '|'
    strings:CatSep
   )
  ( aValue IsBool )
   ( aValue ToPrintable )
  ( aValue IsInt )
   ( aValue ToPrintable )  
  ( aValue IsIntf )
   ( aValue pop:WordBox:Boxed .UIDEx )
   //ERROR 'Невозможно построить ключ для интерфейса'
  ( aValue Is class::TkwCompiledWord )
   ( aValue .UIDEx )
  ( aValue Is class::TtfwWord )
   ( aValue .WordName )
  ( aValue IsObj )
   ERROR 'Невозможно построить ключ для абстрактного объекта'
  ( aValue IsNil )
   ''   
  DEFAULT
   ( aValue ToPrintable )
 ; // RULES
 >>> Result
; // ValueToKey

STRING elem_func MDAClassString
 RULES
  ( Self .MDAClass class_Operation == )
   'Operation'
  ( Self .MDAClass class_Attribute == )
   'Attribute'
  ( Self .MDAClass class_Parameter == )
   'Parameter'
  ( Self .MDAClass class_Category == )
   'Category'
  ( Self .MDAClass class_Dependency == )
   'Dependency'
  ( Self .MDAClass class_Class == )
   'Class'
  ( Self .MDAClass class_Depends == )
   'Depends'
  ( Self .MDAClass class_Inherits == )
   'Inherits'
  ( Self .MDAClass class_Implements == )
   'Implements'
  ( Self .MDAClass class_Const == )
   'Const'
  DEFAULT
   ( Self .MDAClass ToPrintable )
 ; // RULES
 >>> Result
; // MDAClassString

: CacheWordEx
  ANY IN aKey
  ModelElement IN aCacheWhere
  TtfwWord IN aWord
  ^ IN aLambda
 aCacheWhere 
 aKey ValueToKey aWord .WordName Cat 
 nil 
 // - вообще это надо вычислять из типа слова
 DoCache ( aLambda DO )
; // CacheWordEx

MACRO :Cached:
 'Self' Ctx:Parser:PushSymbol
 axiom:PushSymbol @SELF
 axiom:PushSymbol CacheWordEx
; // :Cached:

USES
 LoadOnDemand.ms.dict
;

USES
 ME.ms.dict
;

ME ME_EmptyStereo
 MEPROP Name 'empty_stereo'
ENDME

ME st_ModelRoot
 MEPROP Name 'ModelRoot'
ENDME // st_ModelRoot

ME st_in
 MEPROP UID 'in'
 MEPROP Name 'in'
 %SUMMARY 'Входной параметр' ;
 MEPROP Stereotype st_MDAParameter
 UP "unstereotyped" true
 //MEPROP Stereotype ME_EmptyStereo
ENDME // st_in

ME st_inout
 MEPROP UID 'inout'
 MEPROP Name 'inout'
 %SUMMARY 'Изменяемый параметр' ;
 UP "unstereotyped" false
 MEPROP Stereotype st_MDAParameter
 //MEPROP Stereotype ME_EmptyStereo
ENDME // st_inout

ME st_out
 MEPROP UID 'out'
 MEPROP Name 'out'
 %SUMMARY 'Выходной параметр' ;
 UP "unstereotyped" false
 MEPROP Stereotype st_MDAParameter
 //MEPROP Stereotype ME_EmptyStereo
ENDME // st_out

ME st_const
 MEPROP UID 'const'
 MEPROP Name 'const'
 %SUMMARY 'Гарантированно константный параметр' ;
 UP "unstereotyped" false
 MEPROP Stereotype st_MDAParameter
 //MEPROP Stereotype ME_EmptyStereo
ENDME // st_const

ME st_noconst
 MEPROP UID 'noconst'
 MEPROP Name 'noconst'
 %SUMMARY 'Гарантированно неконстантный параметр' ;
 UP "unstereotyped" false
 MEPROP Stereotype st_MDAParameter
 //MEPROP Stereotype ME_EmptyStereo
ENDME // st_noconst

ME st_NodeType_
 MEPROP Name 'NodeType_'
ENDME // st_NodeType_

ME ME_PublicAccess
 MEPROP Name 'public'
 MEPROP msm:Value PublicAccess
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_ProtectedAccess
 MEPROP Name 'protected'
 MEPROP msm:Value ProtectedAccess
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_PrivateAccess
 MEPROP Name 'private'
 MEPROP msm:Value PrivateAccess
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_Regular
 MEPROP Name 'regular'
 MEPROP msm:Value at_regular
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_Abstract
 MEPROP Name 'abstract'
 MEPROP msm:Value at_abstract
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_Final
 MEPROP Name 'final'
 MEPROP msm:Value at_final
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_Undefined
 MEPROP Name 'undefined'
 MEPROP msm:Value 'undefined'
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_False
 MEPROP Name 'false'
 MEPROP msm:Value false
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_True
 MEPROP Name 'true'
 MEPROP msm:Value true
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_agr
 MEPROP Name 'agr'
 MEPROP msm:Value lt_agr
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_lnk
 MEPROP Name 'lnk'
 MEPROP msm:Value lt_lnk
 MEPROP Stereotype ME_EmptyStereo
ENDME

ME ME_ref
 MEPROP Name 'ref'
 MEPROP msm:Value lt_ref
 MEPROP Stereotype ME_EmptyStereo
ENDME

EXPORTS
 ElemMemberPrim.ms.dict

EXPORTS
 LoadOnDemand.ms.dict
 
EXPORTS
 RoseModel.ms.dict
 
EXPORTS
 ModelElementsDefinition.ms.dict

EXPORTS
 MDProcess_ForF1.tpi.ms.dict
 
EXPORTS
 ref.ms.dict

EXPORTS
 ME.ms.dict

EXPORTS
 ModelElement.ms.dict

EXPORTS
 MDProcess_CoreTemplates.tpi.ms.dict
 
EXPORTS
 MDProcess_Templates.tpi.ms.dict
 
EXPORTS
 MDProcess_ForDelphi.tpi.ms.dict
 