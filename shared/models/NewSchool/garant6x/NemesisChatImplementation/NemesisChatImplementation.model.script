<<ServerLibrary>> NemesisChatImplementation
 %UID '4A30E8E402C2'
 %DOCUMENTATION 'реализация чата для немезис'
 %DEPENDS
  U$ '4503D5DC0290' /* omg */
  U$ '4A2E061E0198' /* ChatLibrary */
  U$ '4A41C53F00C6' /* IDLCompilationSet */
 ; // %DEPENDS
 %META
  %upv "exec mode" 'idle'
  %upv "gui" 'tie'
  %upv "is namespace" true
  %upv "old gcm" false
  %upv "vendor" '/Garant'
 ; // %META
 %TOBEINCLUDED
  U$ '4503D5DC0290' /* omg */
  U$ '4A2E061E0198' /* ChatLibrary */
  U$ '4A41C53F00C6' /* IDLCompilationSet */
 ; // %TOBEINCLUDED
 %CHILDREN
  
  PROTECTED <<Impl>> ChatImplementation
   %UID '4A30E97102AD'
   %DOCUMENTATION 'реализация чата'
   %DEPENDS
    U$ '4503D5F900AB' /* CORBA */
    U$ '4579530202AA' /* CosNaming */
    U$ '4A2E035D01EA' /* ChatService */
   ; // %DEPENDS
   %META
    %upv "is namespace" true
   ; // %META
   %TOBEINCLUDED
    U$ '4503D5DC0290' /* omg */
    U$ '4A2E061E0198' /* ChatLibrary */
    U$ '4A30E8E402C2' /* NemesisChatImplementation */
   ; // %TOBEINCLUDED
   %CHILDREN
    
     <<LocalInterface>> LocalChatManager
      %UID '4A364586005F'
      %DOCUMENTATION 'менеджер с возможностью посылки сообщений'
      %META
       %upv "single impl" false
      ; // %META
      %TOBEINCLUDED
       U$ '4A2E061E0198' /* ChatLibrary */
      ; // %TOBEINCLUDED
      %IMPLEMENTS
       U$ '4A2E0B760095' /* ChatManager */
      ; // %IMPLEMENTS
      %REALIZES
       U$ '4A2E0BCB03DF' /* get_user_info */
       U$ '4A2E2CD00128' /* add_listener */
       U$ '4A2FA1260301' /* delete_listener */
      ; // %REALIZES
      %OPERATIONS
        ABSTRACT <<chg>> send_message
         %UID '4A3645DE03A9'
         %DOCUMENTATION 'послать сообщение от заданного пользователя заданному'
         %TOBEINCLUDED
          U$ '4A2E061E0198' /* ChatLibrary */
         ; // %TOBEINCLUDED
         %RAISES
          U$ '4A2E0928038F' /* UnknownUser */
         ; // %RAISES
         %PARAMETERS
           <<in>> from
            %UID '4A3645DE03B9'
           ; // from
           <<in>> to
            %UID '4A3645DF0000'
           ; // to
           <<in>> message
            %UID '4A3645DF003A'
            %TARGET U$ '4A2E2A0A02B1' /* MessageData */
            %TOBEINCLUDED
             U$ '4A2E061E0198' /* ChatLibrary */
            ; // %TOBEINCLUDED
           ; // message
         ; // %PARAMETERS
        ; // send_message
      ; // %OPERATIONS
     ; // LocalChatManager
     <<Servant>> MessageManager_i
      %UID '4A30A4B300FB'
      %META
       %upv "Factory auto reg" false
       %upv "Factory default impl" true
       %upv "Servant Pool" 'none'
       %upv "factory priority" 0
      ; // %META
      %TOBEINCLUDED
       U$ '4A2E061E0198' /* ChatLibrary */
      ; // %TOBEINCLUDED
      %IMPLEMENTS
       U$ '4A30A0EE00F5' /* MessageManager */
      ; // %IMPLEMENTS
      %REALIZES
       U$ '4A30A17A01B3' /* get_messages_for_user */
       U$ '4A30A17D02FD' /* get_unreaded_list */
       U$ '4A30A181009B' /* send_message */
       U$ '4A35F1E801BD' /* clean_history_for_user */
       U$ '4A41D68701D4' /* set_messages_as_read */
      ; // %REALIZES
      %LINKS
        <<uses>> "4A3648A5026D"
         %UID '4A3648A5026D'
         %TARGET U$ '4A364586005F' /* LocalChatManager */
        ; // 4A3648A5026D
        <<uses>> "4A364AA20210"
         %UID '4A364AA20210'
         %TARGET U$ '4A364A4E009C' /* UserHelper */
        ; // 4A364AA20210
        <<uses>> "4A38EBDE0285"
         %UID '4A38EBDE0285'
         %TARGET U$ '4A38CF6A0260' /* indexes */
        ; // 4A38EBDE0285
        <<uses>> "4A3A2C4C025E"
         %UID '4A3A2C4C025E'
         %TARGET U$ '4A38C38303B8' /* Storage */
        ; // 4A3A2C4C025E
      ; // %LINKS
      %ATTRIBUTES
        PRIVATE <<Attribute>> uid
         %UID '4A364207018E'
        ; // uid
      ; // %ATTRIBUTES
     ; // MessageManager_i
     <<Servant>> UsersListManager_i
      %UID '4A2E3A060102'
      %META
       %upv "Factory auto reg" false
       %upv "Factory default impl" true
       %upv "Servant Pool" 'none'
       %upv "factory priority" 0
      ; // %META
      %TOBEINCLUDED
       U$ '4A2E061E0198' /* ChatLibrary */
      ; // %TOBEINCLUDED
      %IMPLEMENTS
       U$ '4A2E039200FC' /* UsersListManager */
      ; // %IMPLEMENTS
      %REALIZES
       U$ '4A2E03E401C9' /* add_user_to_list */
       U$ '4A2E06EB02D6' /* del_user_from_list */
       U$ '4A2E0717034A' /* get_contacts_list */
      ; // %REALIZES
      %LINKS
        <<uses>> "4A364A9B0070"
         %UID '4A364A9B0070'
         %TARGET U$ '4A364A4E009C' /* UserHelper */
        ; // 4A364A9B0070
        <<uses>> "4A3B345D032F"
         %UID '4A3B345D032F'
         %TARGET U$ '4A38C38303B8' /* Storage */
        ; // 4A3B345D032F
      ; // %LINKS
      %ATTRIBUTES
        PRIVATE <<Attribute>> uid
         %UID '4A364A0A0375'
        ; // uid
      ; // %ATTRIBUTES
     ; // UsersListManager_i
     <<SimpleClass>> ORBFacet_i
      %UID '4A2F5A910254'
      %DOCUMENTATION 'реализация ORBFacet для нужд старого GCM'
      %META
       %upv "need UC" true
       %upv "needs InstanceR" 'undefined'
       %upv "no hands" false
       %upv "register in scripts" 'undefined'
      ; // %META
      %OPERATIONS
        FINAL <<ctor>> make
         %UID '4A2F6A7101EA'
         %DOCUMENTATION 'создать реализацию фасета'
        ; // make
      ; // %OPERATIONS
     ; // ORBFacet_i
     <<Servant>> ChatManager_i
      %UID '4A2E39DA02B7'
      %META
       %upv "Factory auto reg" false
       %upv "Factory default impl" true
       %upv "Servant Pool" 'none'
       %upv "factory priority" 0
      ; // %META
      %TOBEINCLUDED
       U$ '4A2E061E0198' /* ChatLibrary */
       U$ '4A30E8E402C2' /* NemesisChatImplementation */
      ; // %TOBEINCLUDED
      %IMPLEMENTS
       U$ '4A364586005F' /* LocalChatManager */
      ; // %IMPLEMENTS
      %REALIZES
       U$ '4A2E0BCB03DF' /* get_user_info */
       U$ '4A2E2CD00128' /* add_listener */
       U$ '4A2FA1260301' /* delete_listener */
       U$ '4A3645DE03A9' /* send_message */
      ; // %REALIZES
      %LINKS
        <<uses>> "4A374E12026F"
         %UID '4A374E12026F'
         %TARGET U$ '4A364A4E009C' /* UserHelper */
        ; // 4A374E12026F
        <<uses>> "4A3A07BD027D"
         %UID '4A3A07BD027D'
         %TARGET U$ '4A38C38303B8' /* Storage */
        ; // 4A3A07BD027D
      ; // %LINKS
      %ATTRIBUTES
        PRIVATE <<Attribute>> listeners
         %UID '4A374AC50397'
         %TARGET U$ '4A374A520045' /* Listeners */
         %TOBEINCLUDED
          U$ '4A30E8E402C2' /* NemesisChatImplementation */
         ; // %TOBEINCLUDED
        ; // listeners
        PRIVATE <<Attribute>> listeners_guard
         %UID '4F71A7860313'
         %TARGET U$ '450E6C340232' /* mutex */
        ; // listeners_guard
      ; // %ATTRIBUTES
      %CHILDREN
       
        <<Map>> Listeners
         %UID '4A374A520045'
         %DOCUMENTATION 'список слушателей сообщений чата'
         %TOBEINCLUDED
          U$ '4A2E061E0198' /* ChatLibrary */
         ; // %TOBEINCLUDED
         %ATTRIBUTES
           <<Attribute>> "4A374A8F0198"
            %UID '4A374A8F0198'
            %TARGET U$ '4A2E213E025E' /* MessageListener */
            %TOBEINCLUDED
             U$ '4A2E061E0198' /* ChatLibrary */
            ; // %TOBEINCLUDED
            %INDEXES
             %INDEX key ;
            ; // %INDEXES
           ; // 4A374A8F0198
         ; // %ATTRIBUTES
        ; // Listeners
      ; // %CHILDREN
     ; // ChatManager_i
     <<UtilityClass>> UserHelper
      %UID '4A364A4E009C'
      %DOCUMENTATION 'определение идентификатора пользователя'
      %META
       %upv "need UC" true
      ; // %META
      %TOBEINCLUDED
       U$ '4A2E061E0198' /* ChatLibrary */
      ; // %TOBEINCLUDED
      %OPERATIONS
        <<Operation>> get_user_id
         %UID '4A364A6B026F'
         %DOCUMENTATION 'получить идентификатор пользователя'
        ; // get_user_id
        <<Operation>> get_user_info
         %UID '4A3754650389'
         %DOCUMENTATION 'плучить информацию о пользователе'
         %TARGET U$ '4A2E07F803CF' /* UserInfo */
         %TOBEINCLUDED
          U$ '4A2E061E0198' /* ChatLibrary */
         ; // %TOBEINCLUDED
         %PARAMETERS
           <<in>> user
            %UID '4A375478036F'
           ; // user
         ; // %PARAMETERS
        ; // get_user_info
        BOOLEAN FUNCTION is_user_exists
         %UID '4A3777D40314'
         %DOCUMENTATION 'возвращает true, если пользователь есть в системе'
         %TARGET U$ '3DBFFE100240' /* boolean */
         %PARAMETERS
           <<in>> user
            %UID '4A37789103DF'
           ; // user
         ; // %PARAMETERS
        ; // is_user_exists
      ; // %OPERATIONS
     ; // UserHelper
     FINAL <<UtilityPack>> StorageStreamOperators
      %UID '4A388C6D0102'
      %DOCUMENTATION 'операторы записи/считывания данных в индексы'
      %META
       %upv "need UC" true
       %upv "no hands" false
      ; // %META
     ; // StorageStreamOperators
     <<SimpleClass>> Storage
      %UID '4A38C38303B8'
      %DOCUMENTATION 'инкапсуляция методов доступа к базе'
      %META
       %upv "need UC" true
       %upv "needs InstanceR" 'undefined'
       %upv "no hands" false
       %upv "non virtual base" true
       %upv "register in scripts" 'undefined'
      ; // %META
      %TOBEINCLUDED
       U$ '4A2E061E0198' /* ChatLibrary */
      ; // %TOBEINCLUDED
      %LINKS
        <<uses>> "4A38CFA802C2"
         %UID '4A38CFA802C2'
         %TARGET U$ '4A38CF6A0260' /* indexes */
        ; // 4A38CFA802C2
        <<uses>> "4A39F0B7011E"
         %UID '4A39F0B7011E'
         %TARGET U$ '4A388C6D0102' /* StorageStreamOperators */
        ; // 4A39F0B7011E
      ; // %LINKS
      %OPERATIONS
        PRIVATE FINAL <<ctor>> make
         %UID '4A39D54D0351'
         %DOCUMENTATION 'создание файлов базы'
        ; // make
        PRIVATE <<static>> key_file
         %UID '4A39DEF2019C'
         %DOCUMENTATION 'имя файла ключей'
         %TARGET U$ '452257A0036F' /* "a-string" */
        ; // key_file
        PRIVATE ABSTRACT <<static>> stream_file
         %UID '4A39DF2E0009'
         %DOCUMENTATION 'имя файла данных'
         %TARGET U$ '452257A0036F' /* "a-string" */
        ; // stream_file
        PRIVATE <<static>> base_file
         %UID '4A39DFEE03CE'
         %DOCUMENTATION 'название файла базы'
         %TARGET U$ '452257A0036F' /* "a-string" */
        ; // base_file
        PRIVATE <<static>> data_path
         %UID '4A39E18A00B0'
         %DOCUMENTATION 'путь к базам'
         %TARGET U$ '452257A0036F' /* "a-string" */
        ; // data_path
        PRIVATE FINAL <<chg>> build_fast_key
         %UID '4A39EB7C02C4'
         %DOCUMENTATION 'получить ключ'
         %TARGET U$ '3DBFFDE101CA' /* "unsigned long" */
        ; // build_fast_key
        FINAL <<chg>> delete_from_contacts
         %UID '4A3A02ED01C9'
         %DOCUMENTATION 'удалить пользователя _user_ из списка контактов для _mine_'
         %PARAMETERS
           <<in>> mine
            %UID '4A3A03420136'
           ; // mine
           <<in>> user
            %UID '4A3A03420162'
           ; // user
         ; // %PARAMETERS
        ; // delete_from_contacts
        FINAL <<chg>> is_user_in_contacts_list
         %UID '4A3A09A8003B'
         %DOCUMENTATION 'проверяет включён ли пользователь _user_ в список контактов для _mine_'
         %TARGET U$ '3DBFFE100240' /* boolean */
         %PARAMETERS
           <<in>> mine
            %UID '4A3A09E70005'
           ; // mine
           <<in>> user
            %UID '4A3A09E70066'
           ; // user
         ; // %PARAMETERS
        ; // is_user_in_contacts_list
        FINAL <<chg>> add_message
         %UID '4A3A0DB6014B'
         %DOCUMENTATION 'положить сообщение в базу'
         %TARGET U$ '4A3B6187008D' /* MessageId */
         %TOBEINCLUDED
          U$ '4A2E061E0198' /* ChatLibrary */
         ; // %TOBEINCLUDED
         %PARAMETERS
           <<in>> message
            %UID '4A3A0DD80304'
            %TARGET U$ '4A2E0C550171' /* Message */
            %TOBEINCLUDED
             U$ '4A2E061E0198' /* ChatLibrary */
            ; // %TOBEINCLUDED
           ; // message
         ; // %PARAMETERS
        ; // add_message
        FINAL <<chg>> clean_history
         %UID '4A3A1C3F0034'
         %DOCUMENTATION 'очистить историю сообщений для пользователя _mine_ с пользователем _user_'#13#10'(_user_ историю переписки с _mine_ не теряет)'
         %PARAMETERS
           <<in>> mine
            %UID '4A3A1CC000D9'
           ; // mine
           <<in>> user
            %UID '4A3A1CC00147'
           ; // user
         ; // %PARAMETERS
        ; // clean_history
        FINAL <<chg>> get_history
         %UID '4A3A2D5A028D'
         %DOCUMENTATION 'получить _count_ сообщений из истории переписки для заданных пользователей. Если count=0, вернётся вся история сообщений'
         %TARGET U$ '4A2E2E7A02F2' /* MessageList */
         %TOBEINCLUDED
          U$ '4A2E061E0198' /* ChatLibrary */
         ; // %TOBEINCLUDED
         %PARAMETERS
           <<in>> my_uid
            %UID '4A49ED1B024D'
           ; // my_uid
           <<in>> second
            %UID '4A3A2DD5031C'
           ; // second
           <<in>> count
            %UID '4A3A2DD50395'
            %TARGET U$ '3DBFFDE101CA' /* "unsigned long" */
           ; // count
         ; // %PARAMETERS
        ; // get_history
        <<chg>> get_history_with_all_new
         %UID '4A49E76101BB'
         %DOCUMENTATION 'то же, что и get_history, но возвращает все новые'
         %TARGET U$ '4A2E2E7A02F2' /* MessageList */
         %TOBEINCLUDED
          U$ '4A2E061E0198' /* ChatLibrary */
         ; // %TOBEINCLUDED
         %PARAMETERS
           <<in>> my_uid
            %UID '4A49ED2300A2'
           ; // my_uid
           <<in>> second
            %UID '4A49E76E00EE'
           ; // second
           <<in>> count
            %UID '4A49E76E0147'
            %TARGET U$ '3DBFFDE101CA' /* "unsigned long" */
           ; // count
         ; // %PARAMETERS
        ; // get_history_with_all_new
        FINAL <<chg>> get_unreaded
         %UID '4A3A340502AB'
         %DOCUMENTATION 'получить все непрочитанные сообщения для заданного пользователя'
         %TARGET U$ '4A2E2E7A02F2' /* MessageList */
         %TOBEINCLUDED
          U$ '4A2E061E0198' /* ChatLibrary */
         ; // %TOBEINCLUDED
         %PARAMETERS
           <<in>> user
            %UID '4A3A3433026A'
           ; // user
         ; // %PARAMETERS
        ; // get_unreaded
        FINAL <<chg>> add_to_contacts
         %UID '4A3B2DC9026C'
         %DOCUMENTATION 'добавить пользователя _user_ в список контактов для _mine_'
         %PARAMETERS
           <<in>> mine
            %UID '4A3B2E820265'
           ; // mine
           <<in>> user
            %UID '4A3B2E8202C3'
           ; // user
         ; // %PARAMETERS
        ; // add_to_contacts
        FINAL <<chg>> get_contacts
         %UID '4A3B3882021F'
         %DOCUMENTATION 'получить список контактов для пользователя _mine_'
         %TARGET U$ '4A2E073B02B4' /* UidList */
         %TOBEINCLUDED
          U$ '4A2E061E0198' /* ChatLibrary */
         ; // %TOBEINCLUDED
         %PARAMETERS
           <<in>> mine
            %UID '4A3B38B40178'
           ; // mine
         ; // %PARAMETERS
        ; // get_contacts
        FINAL <<chg>> mark_as_read
         %UID '4A41F2A202CF'
         %DOCUMENTATION 'пометить сообщения как прочитанные'
         %TOBEINCLUDED
          U$ '4A2E061E0198' /* ChatLibrary */
         ; // %TOBEINCLUDED
         %PARAMETERS
           <<in>> keys
            %UID '4A41F4DA03C2'
            %TARGET U$ '4A41F2E300CD' /* MessageIds */
            %TOBEINCLUDED
             U$ '4A2E061E0198' /* ChatLibrary */
            ; // %TOBEINCLUDED
           ; // keys
         ; // %PARAMETERS
        ; // mark_as_read
      ; // %OPERATIONS
     ; // Storage
     FINAL <<UtilityPack>> indexes
      %UID '4A38CF6A0260'
      %DOCUMENTATION 'индексы для чата'
      %META
       %upv "need UC" true
       %upv "no hands" false
      ; // %META
     ; // indexes
     <<Vector>> UidList
      %UID '4A3B3AA9037F'
      %DOCUMENTATION 'список идентификаторов пользователей'
      %META
       %upv "array type" 'dynamic'
       %upv "force usage" true
      ; // %META
      %ATTRIBUTES
        <<Attribute>> "4A3B3AD8025B"
         %UID '4A3B3AD8025B'
        ; // 4A3B3AD8025B
      ; // %ATTRIBUTES
     ; // UidList
     <<Servant>> Session_i
      %UID '4A4B3C240198'
      %DOCUMENTATION 'заглушка для получения идентификатора пользователя'
      %META
       %upv "Factory auto reg" false
       %upv "Factory default impl" true
       %upv "Servant Pool" 'none'
       %upv "factory priority" 0
      ; // %META
      %LINKS
        <<uses>> "4A4B3ECE0234"
         %UID '4A4B3ECE0234'
         %TARGET U$ '4A364A4E009C' /* UserHelper */
        ; // 4A4B3ECE0234
      ; // %LINKS
     ; // Session_i
   ; // %CHILDREN
  ; // ChatImplementation
 ; // %CHILDREN
; // NemesisChatImplementation